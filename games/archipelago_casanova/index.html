<!DOCTYPE HTML>
<html>

<!-- HEADER -->

<!-- Borksy 4.3 -->
<!-- Bitsy 7.0 -->
<head>

<meta charset="UTF-8">

<title>Archipelago Casanova</title>

<script type="text/bitsyGameData" id="exportedGameData">
Archipelago Casanova

# BITSY VERSION 7.1

! ROOM_FORMAT 1

PAL 0
NAME p1
37,165,219
156,221,255
202,238,255

PAL 1
NAME p2
37,165,219
38,170,226
38,170,226

PAL 2
NAME p3
37,165,219
38,170,226
202,238,255

PAL 3
NAME p4
255,94,96
255,150,137
255,202,188

PAL 4
NAME p5
255,255,255
156,221,255
202,238,255

PAL 5
NAME p6
255,255,255
156,221,255
156,221,255

PAL 6
NAME p7
0,0,0
255,255,255
0,0,0

ROOM 0
2a,2b,2a,2b,2a,2b,2a,2b,2a,2b,2a,2b,2a,2b,2a,2b
29,l,m,a,29,0,29,a,29,0,29,0,29,a,28,0
t,o,n,p,2a,2b,2a,2b,2a,2b,2a,2b,2a,2b,2a,2b
29,s,r,q,y,ix,29,0,29,0,29,a,29,0,29,ix
2a,2b,2a,1a,2a,2b,2a,2b,2a,2b,2a,2b,2a,2b,2a,2b
29,ix,29,a,29,0,29,0,29,ix,1b,1c,29,0,29,0
2a,2b,2a,2b,2a,22,2a,2b,2a,2b,2a,2b,2a,2b,2a,2b
29,a,29,0,29,21,20,a,29,0,29,a,29,a,27,0
2a,2b,2a,2b,2a,1w,1z,2b,2a,2b,2a,2b,2a,25,24,2b
29,0,29,0,29,1y,1x,a,29,a,29,0,29,26,23,ix
2a,2b,2a,2b,2a,2b,2a,13,14,19,18,2b,2a,2b,2a,2b
29,1n,1o,0,29,ix,16,12,v,u,17,a,29,a,29,0
1i,1d,1e,1k,2a,2b,15,x,w,11,2a,2b,2a,2b,2a,2b
1j,1f,1g,1h,29,0,29,z,10,ix,29,0,29,3u,29,0
0,1m,1l,2b,2a,2b,2a,2b,2a,2b,2a,2b,2a,2b,1v,2b
1s,1p,1q,1r,1t,1t,1t,1t,1t,1t,1t,1t,1t,1t,1u,1t
NAME atlas
EXT 10,5 1 9,4 FX tunnel
EXT 11,5 1 9,4 FX tunnel
EXT 14,1 2 7,11 FX tunnel
EXT 13,13 7 6,6 FX tunnel
EXT 14,7 8 10,5 FX tunnel
EXT 14,9 9 10,6 FX tunnel
EXT 13,9 9 10,6 FX tunnel
EXT 3,2 c 7,13 FX tunnel
EXT 1,1 b 13,7 FX tunnel
EXT 3,3 d 10,1 FX tunnel
EXT 2,2 c 3,12 FX tunnel
EXT 4,3 e 9,7 FX tunnel
EXT 6,8 16 5,5 FX tunnel
EXT 5,6 15 6,5 FX tunnel
EXT 9,11 1e 2,7 FX tunnel
EXT 10,10 1e 11,4 FX tunnel
EXT 8,13 1g 9,12 FX tunnel
EXT 9,12 1f 6,3 FX tunnel
EXT 7,12 1g 4,5 FX tunnel
EXT 8,11 1d 10,9 FX tunnel
EXT 7,11 1d 4,13 FX tunnel
PAL 0

ROOM 1
0,0,2y,2g,2w,2y,2y,0,0,0,2y,2x,2f,2j,2w,0
0,2x,2f,3w,2i,2i,2j,2w,0,0,2x,2n,2e,3w,2j,2y
2y,2f,35,0,0,35,0,2j,2y,2y,2w,2t,2r,2d,2m,2w
2y,2h,34,0,33,0,33,37,2i,2i,2j,2w,2w,2v,2d,2l
2f,36,0,32,0,35,0,2e,0,35,2e,3v,2w,a,2v,2u
2d,34,0,35,0,2e,2k,2r,2d,2k,2r,3a,2x,0,a,2x
2v,2d,0,0,2k,2r,2s,a,2v,2s,2x,3a,2x,0,0,0
a,2v,2d,2k,2s,0,0,0,a,0,2w,3b,2x,0,0,0
0,a,2v,2s,0,0,0,0,0,0,3m,3c,2x,0,0,0
0,0,a,0,0,0,0,0,0,2z,3o,0,2w,2z,0,ix
0,0,0,0,0,0,a,2q,0,0,2q,0,2z,0,0,0
3q,0,a,0,0,0,0,0,0,0,2z,0,0,0,0,0
3r,3q,0,0,0,0,0,2z,0,0,0,2z,0,2z,0,3s
3q,3p,0,0,0,ix,0,0,0,0,a,0,2q,0,0,3p
3r,3p,3q,0,0,0,0,0,0,0,3q,0,0,0,3s,3p
3q,3r,3p,3p,3p,3q,0,0,0,3s,3t,0,0,3s,3p,3t
NAME island1
ITM 0 13,0
EXT 3,1 1 13,1
EXT 13,1 1 3,1
EXT 11,7 0 11,6 FX tunnel
PAL 0

ROOM 2
0,0,0,0,2q,0,2z,0,0,2q,0,0,0,3s,3t,3p
0,2z,0,0,0,0,0,0,0,0,2w,0,0,3t,3s,3p
0,0,2q,0,0,0,0,0,3k,0,0,0,0,3s,3p,3t
2z,0,0,2z,ix,0,0,3i,3h,0,2y,0,0,3r,3t,0
2q,0,0,0,0,0,0,3f,3g,2y,2g,2y,0,0,0,0
0,0,2q,0,0,0,2x,3j,3g,2i,2k,2y,ix,0,0,2z
2q,0,ix,0,0,2x,2f,3d,3e,2m,2s,2x,0,0,0,0
0,0,0,0,2y,2n,36,3l,0,35,2l,2y,0,0,2w,0
0,0,0,0,2x,2t,2d,39,2e,2k,2u,2w,0,0,0,0
2z,0,0,0,0,2w,2v,3a,2r,2s,2w,0,0,0,0,0
0,0,2w,0,0,0,2x,3a,2w,2x,0,0,a,0,0,2z
0,0,0,0,0,2w,0,3b,2w,0,0,0,0,0,2q,0
0,3s,3q,0,0,0,3m,3c,2w,0,0,0,0,2z,2q,0
0,3p,3t,0,0,0,3o,2x,0,0,2z,0,0,0,0,2q
3s,3p,3s,3q,0,0,0,0,0,0,0,0,2q,0,2z,0
3p,3p,3t,3r,3q,0,0,0,0,0,2q,0,0,0,0,0
NAME island2
EXT 7,11 0 13,1 FX tunnel
EXT 7,6 3 6,13 FX tunnel
PAL 0

ROOM 3
4q,4t,0,0,0,5n,5g,5g,5g,5g,5o,0,0,0,0,5i
0,0,0,0,5n,52,45,46,5j,5j,5a,5o,0,0,5h,0
0,0,0,5n,52,57,43,47,5i,5h,59,5a,5o,0,0,0
0,5h,5n,52,57,51,49,48,3x,42,58,59,5a,5o,0,0
5i,0,54,57,51,40,3z,40,42,3y,42,58,59,5c,0,0
0,0,54,51,40,3z,40,3z,3y,42,3y,42,58,5c,0,0
0,0,54,40,3z,4g,4f,40,42,4g,4f,3y,42,5c,5i,0
0,5i,54,41,4g,4f,4e,4n,4m,4h,4g,4f,41,o9,2y,0
0,0,54,41,4h,4e,3x,4l,4k,3x,4h,4e,41,5c,0,0
0,0,54,3y,42,3x,42,4i,4j,40,3x,40,3z,5c,0,0
0,0,5l,55,3y,42,3y,42,40,3z,40,3z,5d,5m,5h,0
0,0,0,5l,55,3y,42,3y,3z,40,3z,5d,5m,0,0,0
0,0,0,0,5l,55,3y,3x,3x,3z,5d,5m,0,0,5i,0
0,5h,0,0,0,54,5k,5d,5f,5f,5m,0,0,0,0,0
5i,0,0,0,0,5l,5f,5m,0,0,0,0,5h,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME tower.1
EXT 6,2 4 6,2
EXT 7,2 4 7,2
EXT 6,13 2 7,6 FX tunnel
EXT 13,7 2d 5,7 FX tunnel
PAL 0

ROOM 4
4q,4r,0,0,0,5n,5g,5g,4z,4v,50,0,0,5i,0,0
0,0,5h,2q,5n,52,45,46,5j,4v,5a,5o,5h,0,0,5i
0,5i,0,5n,52,57,43,47,5h,4v,59,5a,5o,0,0,0
0,0,5n,52,57,51,4x,4x,4s,4x,58,59,5a,5o,2q,0
0,2z,54,57,51,4s,4x,4s,4s,4x,4x,58,59,5c,0,2z
0,0,54,51,4s,4x,4x,4y,4x,4x,4x,4x,58,5c,0,0
5i,0,54,4x,4y,4x,4x,4s,4s,4x,4s,4x,4x,5c,0,0
0,0,54,4x,4s,4x,4x,4x,4y,4x,4s,4x,4x,5c,2q,0
0,0,54,4x,4s,4x,4s,4s,4s,4x,4s,4y,4s,5c,0,0
0,0,54,4x,4x,4x,4x,4s,4x,4x,4s,4x,4x,5c,0,5h
0,0,5l,55,4x,4x,4s,4y,4x,4s,4x,4x,5d,5m,5i,0
0,2q,0,5l,55,4x,4x,4x,4x,4x,4x,5d,5m,0,0,0
0,0,0,0,5l,55,4x,4x,4s,4x,5d,5m,0,0,2z,0
0,0,0,0,0,5l,5f,5f,5f,5f,5m,0,5h,0,0,0
0,0,0,5h,5i,0,2q,0,0,0,0,0,0,5h,0,0
0,0,0,0,0,0,0,0,0,0,0,2z,0,0,0,0
NAME tower.2
EXT 6,2 3 6,2
EXT 7,2 3 7,2
EXT 9,0 5 9,3 FX tunnel DLG o
EXT 9,0 6 9,3 FX tunnel DLG p
PAL 0

ROOM 5
0,0,3s,0,0,2q,0,2z,0,0,2z,0,2q,0,3r,3p
0,3s,3t,0,2z,0,0,0,0,2q,0,2z,0,6b,0,3p
3s,3p,2q,0,0,5w,5u,5u,5u,5u,5t,0,6a,68,2q,3r
3p,3t,0,0,5w,5v,5r,6g,5r,61,5s,5t,67,69,0,0
3t,0,0,5w,5v,6f,5p,5q,5p,62,5p,5s,5t,0,0,0
0,0,5w,5v,65,6g,5r,2y,5r,6c,5r,2y,5s,5t,3q,0
6o,6p,5x,63,2y,66,5p,6d,5p,5q,5p,6d,63,5x,3r,3q
0,6n,5x,2y,64,2y,5r,6e,5r,2y,65,2y,2y,5x,3q,3p
0,0,5x,6d,5p,6f,5p,5q,5p,63,2y,2y,66,5x,3r,3p
3q,0,5x,6e,65,6g,5r,2y,5r,2y,64,2y,2y,5x,0,3r
3p,3q,5s,5t,2y,66,5p,6d,5p,5q,5p,5q,5w,5v,0,0
3p,3p,5z,5s,5t,2y,5r,6e,5r,2y,5r,5w,5v,5y,0,0
3t,3r,5z,5z,5s,5t,5p,5q,5p,5q,5w,5v,5y,5y,0,0
6q,6q,5z,5z,5z,5s,5u,5u,5u,5u,5v,5y,5y,5y,6q,6q
0,0,5z,5z,5z,5z,5i,6j,6k,0,5y,5y,5y,5y,0,ix
0,a,5z,5z,5z,5z,6m,6h,6i,6l,5y,5y,5y,5y,a,0
NAME tower rafters.1
ITM 1 0,6
EXT 9,3 4 9,0 FX tunnel
PAL 0

ROOM 6
0,0,3s,0,0,2q,0,2z,0,0,2z,0,2q,0,3r,3p
0,3s,3t,0,2z,0,0,0,0,2q,0,2z,0,6b,0,3p
3s,3p,2q,0,0,5w,5u,5u,5u,5u,5t,0,6a,68,2q,3r
3p,3t,0,0,5w,5v,5r,6g,5r,61,5s,5t,67,69,0,0
3t,0,0,5w,5v,6f,5p,5q,5p,62,5p,5s,5t,0,0,0
0,0,5w,5v,65,6g,5r,2y,5r,6c,5r,2y,5s,5t,3q,0
6o,6p,5x,63,2y,66,5p,6d,5p,5q,5p,6d,63,5x,3r,3q
0,6n,5x,2y,64,2y,5r,6e,5r,2y,65,2y,2y,5x,3q,3p
0,0,5x,6d,5p,6f,5p,5q,5p,63,2y,2y,66,5x,3r,3p
3q,0,5x,6e,65,6g,5r,2y,5r,2y,64,2y,2y,5x,0,3r
3p,3q,5s,5t,2y,66,5p,6d,5p,5q,5p,5q,5w,5v,0,0
3p,3p,5z,5s,5t,2y,5r,6e,5r,2y,5r,5w,5v,5y,0,0
3t,3r,5z,5z,5s,5t,5p,5q,5p,5q,5w,5v,5y,5y,0,0
6q,6q,5z,5z,5z,5s,5u,5u,5u,5u,5v,5y,5y,5y,6q,6q
0,0,5z,5z,5z,5z,5i,6j,6k,0,5y,5y,5y,5y,0,ix
0,a,5z,5z,5z,5z,6m,6h,6i,6l,5y,5y,5y,5y,a,0
NAME tower rafters.2
ITM 2 5,8
EXT 9,3 4 9,0 FX tunnel
PAL 0

ROOM 7
0,0,0,0,0,0,0,0,0,0,0,0,3p,3t,3s,3t
0,2q,0,0,0,2w,0,0,2q,0,0,3s,3t,3s,3t,3s
0,0,0,2z,0,0,0,0,0,0,3s,3t,0,3p,3p,3p
0,0,0,0,0,0,0,0,0,3s,3p,3q,3s,3p,3p,3t
0,0,0,0,2x,0,71,2x,3s,3p,3p,3p,3p,3t,0,2w
0,2q,0,0,0,2w,6z,6x,6x,6x,6w,3t,2x,2q,0,0
0,0,0,2z,2y,3m,6y,6v,6v,6v,6u,2x,0,0,0,0
0,2w,0,0,0,3o,6y,6v,6v,6v,6u,2y,0,0,0,0
0,0,0,0,0,3s,6r,6s,6s,6s,6t,70,0,2x,0,0
0,0,0,0,0,3p,3p,3p,3p,3t,2x,0,0,0,0,0
0,2x,0,0,3s,3p,3p,3t,0,0,0,2z,0,0,0,2q
0,0,0,3s,3p,3p,3t,0,0,0,0,0,0,0,0,0
3q,3s,3p,3p,3p,3t,0,0,0,0,0,0,2x,0,2w,0
3p,3p,3p,3p,3t,0,0,0,0,0,0,0,3r,3q,0,2z
3p,3p,3t,3p,3q,0,0,2w,0,0,0,0,0,3r,3q,0
3p,3t,3s,3p,3p,3q,0,0,0,2z,0,0,0,3s,3p,3p
NAME raft
ITM 5 8,7
EXT 5,6 0 12,13 FX tunnel
PAL 0

ROOM 8
0,0,0,0,2z,3r,3p,3q,0,0,0,7e,0,0,0,0
0,2z,0,0,0,0,3r,3p,2y,0,2y,7a,0,0,2z,0
0,0,0,2x,0,0,3s,3t,2q,73,2f,7c,2w,0,0,2q
2y,0,0,2y,0,3s,3t,0,0,2x,2d,2m,7e,0,0,3s
2x,0,0,0,0,0,2q,0,0,2w,2v,2h,7c,2y,0,3p
0,0,0,2w,0,0,0,0,2x,3m,7i,7j,2m,2x,3s,3t
0,0,0,0,0,0,2y,0,0,3o,7u,2h,7l,2w,0,0
0,0,0,2q,0,0,2x,0,0,2y,7n,2m,2s,2x,0,0
0,0,0,0,0,0,0,0,0,2w,2t,7m,2j,2w,0,0
3q,0,0,0,0,3s,0,2w,0,0,2w,2v,74,2y,0,0
3p,3q,0,3s,3p,3t,0,0,0,2w,2y,2x,75,2w,0,0
3r,3p,3p,3p,3t,0,0,0,0,5i,2g,2y,2x,0,2x,0
0,3r,3t,0,0,0,0,0,2x,2f,2k,2x,0,0,0,0
0,0,0,0,0,0,0,2x,2f,2m,2s,0,0,2q,0,0
0,2q,0,0,0,2w,2y,2w,2h,86,71,0,0,0,0,0
0,0,0,0,2w,2x,2f,2i,0,9c,7c,2w,0,0,0,0
NAME island3.1
EXT 9,5 0 13,7 FX tunnel
EXT 9,15 9 9,0 FX slide_d
PAL 0

ROOM 9
0,0,2y,2y,2f,2i,84,84,0,9c,81,82,83,71,0,0
2w,2y,2y,2f,71,84,84,85,84,84,80,87,7z,7c,7e,0
2y,2y,2f,84,7v,84,2k,2r,2d,84,7w,7x,7y,0,7c,2w
2y,2f,84,84,85,2k,2s,2w,2v,2h,3l,84,7e,71,86,2y
2y,2d,84,2k,2r,2s,2x,0,2x,7o,7p,84,7a,7v,86,2y
2w,2v,74,2s,2x,72,0,0,2w,7q,7r,2d,7v,85,2k,2y
0,2w,75,0,72,73,2x,0,0,7q,7r,2v,74,2r,2s,72
0,0,0,0,73,2w,0,0,0,7q,7r,2w,75,2x,2w,73
0,0,0,2x,0,0,0,0,2y,7t,7s,3m,2x,0,0,0
0,0,0,0,0,0,0,0,2x,7u,7u,3o,0,0,0,0
0,2x,0,0,0,0,0,0,0,2x,2w,0,0,0,0,2w
0,0,0,0,0,2w,0,0,0,0,0,0,2q,0,0,0
0,0,2q,0,0,0,0,2z,0,0,0,0,0,0,0,3s
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3p
0,0,0,0,0,0,2x,0,0,0,0,0,2q,0,3s,3p
0,0,0,0,2z,3s,3p,3p,3q,0,0,0,3s,3p,3p,3p
NAME island3.2
EXT 11,8 0 14,10 FX tunnel
EXT 10,2 a 6,10 FX tunnel
EXT 9,0 8 9,15 FX slide_u
PAL 0

ROOM 10
0,0,0,0,0,0,0,0,0,0,0,cv,cu,0,0,0
0,0,dq,dr,ds,dt,du,dv,dw,dx,0,cs,ct,0,0,0
5g,5g,5g,5g,5g,5g,5g,5g,5g,5g,5g,cq,cr,5g,5g,5g
2y,2y,2y,2y,2y,2y,2y,0,2y,40,3x,3x,3x,42,2x,0
40,42,9v,40,3x,42,2y,2x,2y,3y,3x,3x,3x,3z,2y,0
3y,3z,do,3y,3x,3z,2y,2y,2y,do,9v,do,do,9v,2y,2y
do,do,0,do,do,40,42,2y,2y,40,42,2y,2y,40,42,2y
0,0,2y,2y,2y,3y,3z,9v,40,3z,3y,42,2y,41,41,2y
0,2w,40,3x,42,9v,do,do,3y,3x,42,41,2y,3y,3z,2y
2y,2y,41,do,41,do,2y,0,do,do,3y,3z,2y,do,do,0
42,9v,3y,3x,3z,40,42,2y,0,0,do,9v,2y,0,0,2x
3z,9v,do,do,do,41,41,2x,2y,2y,40,42,2y,40,3x,42
do,do,2x,0,2y,41,41,9v,40,42,3y,3z,2y,3y,3x,3z
0,0,0,0,2y,3y,3z,do,3y,3z,do,do,2x,do,do,do
0,0,0,0,0,do,do,0,do,do,0,0,0,0,2x,0
0,0,0,2w,0,0,0,0,0,0,0,2z,0,0,0,0
NAME museum.11
EXT 0,10 z 15,10 FX slide_l
EXT 0,11 z 15,11 FX slide_l
EXT 0,4 z 15,4 FX slide_l
EXT 11,2 12 7,12 FX tunnel
EXT 12,2 12 8,12 FX tunnel
PAL 0

ROOM 11
3x,42,0,40,3x,42,0,40,3x,42,0,40,3x,42,0,40
3x,41,3x,3x,3x,41,3x,3x,3x,41,3x,3x,3x,41,3x,3x
0,3y,3x,3z,0,3y,3x,3z,0,3y,3x,3z,0,3y,3x,3z
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,5n,5g,5g,5g,5o,0,cv,cu,0,5n,5g,5g,5g,5o,0
0,54,e9,e8,eb,5c,0,cs,ct,0,54,e4,e0,e3,5c,0
0,54,e6,e7,ea,5c,0,cs,ct,0,54,e5,e1,e2,5c,0
2y,5l,5f,5f,5f,5m,2y,cq,cr,2y,5l,5f,5f,5f,5m,2y
3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x
3x,3x,da,db,dc,3x,3x,3x,3x,3x,3x,da,db,dc,3x,3x
2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y
NAME museum.12
EXT 7,12 y 2,10 FX tunnel
EXT 8,12 y 3,10 FX tunnel
EXT 15,13 12 0,13 FX slide_r
EXT 15,14 12 0,14 FX slide_r
EXT 0,13 13 15,13 FX slide_l
EXT 0,14 13 15,14 FX slide_l
PAL 0

ROOM 12
3x,42,0,40,3x,42,0,40,3x,42,0,40,3x,42,0,0
3x,41,3x,3x,3x,41,3x,3x,3x,41,3x,3x,3x,41,42,0
0,3y,3x,3z,0,3y,3x,3z,0,3y,3x,3z,0,3y,3z,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,el,ek,0,0,cv,cu,0,0,0,0,0,0,0
0,0,0,ej,ei,0,0,cs,ct,0,0,ee,ef,0,0,0
0,0,0,eh,eg,0,0,cs,ct,0,0,ec,ed,0,0,0
2y,2y,2y,d9,cc,0,2y,cq,cr,2y,0,d9,cc,2y,0,0
3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,42,2y,0
3x,3x,3x,da,dc,3x,3x,3x,3x,3x,3x,da,dc,3z,2y,0
2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,0
NAME museum.13
EXT 7,12 10 11,2 FX tunnel
EXT 8,12 10 12,2 FX tunnel
EXT 0,13 11 15,13 FX slide_l
EXT 0,14 11 15,14 FX slide_l
PAL 0

ROOM 13
40,42,0,40,3x,42,0,40,3x,42,0,40,3x,42,0,40
3y,41,3x,3x,3x,41,3x,3x,3x,41,3x,3x,3x,41,3x,3x
0,3y,3x,3z,0,3y,3x,3z,0,3y,3x,3z,0,3y,3x,3z
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,eo,ep,eo,ep,eo,ep,eo,ep,eo,ep,eo,ep,0
0,2y,0,en,eq,en,eq,en,eq,en,eq,en,eq,en,eq,2y
0,2y,40,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x
0,2y,3y,3x,3x,3x,da,db,db,db,db,dc,3x,3x,3x,3x
0,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y
NAME museum.14
EXT 15,13 11 0,13 FX slide_r
EXT 15,14 11 0,14 FX slide_r
PAL 0

ROOM 14
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,4x,4x,4x,4x,4x,4x,4x,4x,4x,4x,0,0,0
0,0,0,4x,5w,5u,5u,5u,5u,5u,5u,5t,4x,0,0,0
0,0,0,4x,5x,0,ew,et,et,eu,0,5x,4x,0,0,0
0,0,0,4x,5x,0,0,ev,ev,0,0,5x,4x,0,0,0
0,0,0,4x,5x,5g,f0,ez,5g,5g,5g,5x,4x,0,0,0
0,0,0,4x,5x,f1,ex,ey,f1,f6,f4,5x,4x,0,0,0
0,0,0,4x,5x,4x,f2,4x,f1,4x,f5,5x,4x,0,0,0
0,0,0,4x,5x,4x,4x,4x,4x,4x,4x,5x,4x,0,0,0
0,0,0,4x,5x,4x,4x,4x,4x,4x,4x,5x,4x,0,0,0
0,0,0,4x,5x,4x,4x,4x,f7,4x,f8,5x,4x,0,0,0
0,0,0,4x,5x,4x,4x,4x,f9,f9,f8,5x,4x,0,0,0
0,0,0,4x,5s,5t,4x,5w,5u,5u,5u,5v,4x,0,0,0
0,0,0,4x,4x,5s,5u,5v,4x,4x,4x,4x,4x,0,0,0
0,0,0,0,4x,4x,4x,4x,4x,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME museum.15
ITM 8 9,6
EXT 6,12 z 13,2 FX tunnel
PAL 0

ROOM 15
0,0,0,0,0,2z,0,3s,3p,3p,3p,3p,3p,3p,3p,3p
0,2x,0,0,2q,0,0,3p,3p,3p,3t,2q,3s,3p,3p,3p
0,0,0,2y,2y,0,0,3r,3p,3t,0,3s,3p,3p,3p,3p
0,0,ga,2f,2j,2w,0,0,2z,0,3s,3p,3p,3p,3t,3r
0,2x,2f,84,84,2j,2x,2y,2y,0,3p,3p,3p,3p,0,2q
2y,2f,84,2e,84,8z,7h,7h,90,2z,3r,3p,3p,3t,0,3s
2x,2d,2m,2r,2d,2k,7u,7u,3m,2y,2w,0,0,2z,3s,3p
0,2v,2d,2j,2v,2s,2x,0,3o,0,0,0,0,0,3p,3p
0,2w,2v,2d,2l,2w,0,0,0,2w,0,0,0,3s,3p,3t
0,0,2w,2v,2u,2x,0,0,2y,0,0,0,0,3r,3t,0
0,0,0,2x,2w,0,0,2x,2g,2y,0,0,0,0,0,0
0,0,2w,0,0,0,2y,2f,86,2w,0,0,0,2x,0,0
0,0,0,0,0,0,2y,2h,fb,2j,2w,0,0,0,0,2z
0,0,0,0,2y,2x,2f,84,fa,84,2j,2w,0,0,0,0
0,0,0,2x,2f,fc,fb,0,84,fb,fb,2j,2x,0,0,0
0,0,2x,2n,37,fb,fa,9c,9c,fa,fa,86,2w,0,0,0
NAME island5.1
EXT 7,5 0 6,6 FX tunnel
EXT 7,15 1b 7,0 FX slide_d
EXT 8,15 1b 8,0 FX slide_d
PAL 0

ROOM 16
0,0,0,2t,2d,fa,fb,9c,9c,fb,fa,86,2w,0,0,0
0,0,2w,2w,2v,2h,fa,84,37,fa,fb,84,2j,2w,2y,72
0,0,0,0,2y,2d,36,33,0,84,fa,35,0,2i,2j,73
0,0,0,0,2w,2v,2h,0,7e,0,84,fg,fh,36,2k,2y
0,0,2y,2x,2y,2y,2h,0,7a,0,0,fe,ff,2m,2s,2x
2w,8z,7h,fd,7h,7h,7j,0,7v,0,0,fi,fj,2k,2y,0
0,0,7u,3m,7u,7u,2d,0,36,0,7e,0,2k,2s,2w,0
0,2x,0,3o,0,2w,2v,2h,0,71,7v,2m,2s,2x,0,0
0,2w,0,0,0,0,2y,2h,0,7v,0,7l,2w,0,0,0
0,0,0,0,2q,0,2x,7m,0,36,2k,2s,0,0,0,2q
0,0,0,0,0,0,2w,2v,2h,2m,2s,2w,2w,0,0,0
0,0,0,0,2x,0,0,2x,2h,2k,2w,0,0,0,0,0
3q,2q,0,0,3s,3t,0,2y,74,2s,0,0,0,0,2w,3s
3p,3q,0,3s,3p,0,0,2x,75,2x,0,0,0,3r,3q,3p
3p,3p,3p,3p,3t,2q,0,0,2x,0,3s,0,2z,0,3p,3p
3p,3p,3t,0,0,0,0,0,0,0,3p,3q,0,3s,3p,3p
NAME island5.2
EXT 3,5 0 5,8 FX tunnel
EXT 7,0 17 7,15 FX slide_u
EXT 8,0 17 8,15 FX slide_u
PAL 0

ROOM 17
35,fb,33,fa,36,fb,0,9c,9c,fb,84,fb,84,fa,36,fa
fb,fa,84,fb,fb,fa,36,0,0,fa,fb,fa,fb,fb,84,fb
fa,84,fb,fa,fa,fb,0,35,0,36,fa,36,fa,fa,fb,fa
35,fb,fa,36,84,fa,0,0,0,0,0,0,84,36,fa,84
36,fa,fb,fb,0,0,0,0,0,fb,0,0,0,0,0,fb
fb,0,fa,fa,0,0,0,0,0,fa,84,0,fb,0,fb,fa
fa,0,0,0,0,0,0,0,0,84,0,0,fa,0,fa,36
9c,0,0,0,fb,0,0,0,0,0,0,0,84,0,84,9c
9c,0,0,0,fa,fb,0,0,0,0,0,0,0,0,0,9c
fb,35,0,0,84,fa,0,0,0,0,fb,0,0,36,fb,fb
fa,fb,0,0,0,84,0,0,0,84,fa,84,fb,fb,fa,fa
fb,fa,fb,fb,0,0,0,0,0,0,84,fb,fa,fa,fb,35
fa,fb,fa,fa,0,0,0,0,36,0,36,fa,fb,34,fa,fb
84,fa,84,fb,0,36,0,0,0,36,fb,fb,fa,84,33,fa
fb,36,fb,fa,fb,0,fb,0,0,fb,fa,fa,37,fb,84,84
fa,37,fa,36,fa,fb,fa,9c,9c,fa,fb,35,84,fa,36,33
NAME island5.3
EXT 7,15 16 7,0 FX slide_d
EXT 8,15 16 8,0 FX slide_d
EXT 15,7 18 0,7 FX slide_r
EXT 15,8 18 0,8 FX slide_r
EXT 0,7 18 15,7 FX slide_l
EXT 0,8 18 15,8 FX slide_l
EXT 7,0 1a 7,15 FX slide_u
EXT 8,0 1a 8,15 FX slide_u
PAL 0

ROOM 18
36,fb,36,fa,fb,84,fb,9c,9c,fa,36,fa,36,fb,fa,84
fb,fa,fb,84,fa,fb,fa,0,0,0,fb,36,fb,fa,36,fb
fa,84,fa,fb,84,fa,0,fg,fh,0,fa,35,fa,84,33,fa
36,fb,36,fa,0,0,0,fe,ff,37,0,0,84,fb,35,37
84,fa,0,0,fg,fh,0,fi,fj,0,84,0,0,fa,fb,84
fb,0,0,84,fe,ff,84,0,0,0,fg,fh,0,36,fa,fb
fa,0,35,0,fi,fj,0,0,0,34,fo,fp,33,0,35,fa
9c,0,0,0,0,84,fg,fh,0,0,fi,fj,0,0,0,9c
9c,0,0,0,0,0,fe,ff,0,fm,fl,fg,fh,0,0,9c
fb,37,0,0,0,84,fi,fj,0,fk,fn,fe,ff,84,84,fb
fa,0,0,0,0,0,84,0,fm,fl,0,fi,fj,0,fb,fa
84,0,0,36,fb,0,0,0,0,fm,fl,0,36,0,fa,84
fb,0,0,fb,fa,36,0,0,84,0,0,0,0,0,fb,36
fa,0,35,fa,84,fb,0,0,36,fb,0,84,fb,84,fa,37
35,fb,84,fb,0,fa,fb,36,fb,fa,84,fb,fa,fb,0,36
84,fa,fb,fa,35,36,fa,fb,fa,37,fb,fa,0,fa,36,0
NAME island5.4
EXT 10,6 1c 10,6 FX tunnel
EXT 0,7 19 15,7 FX slide_l
EXT 0,8 19 15,8 FX slide_l
EXT 15,7 19 0,7 FX slide_r
EXT 15,8 19 0,8 FX slide_r
EXT 7,0 19 7,15 FX slide_u
EXT 8,0 19 8,15 FX slide_u
PAL 0

ROOM 19
84,0,fb,36,fb,fb,fa,9c,9c,fb,fa,fa,fa,fb,84,fa
0,fb,fa,fb,fa,fa,0,84,0,fa,37,0,0,fa,35,33
fb,fa,84,fa,84,0,0,0,84,0,0,0,36,0,fb,84
fa,fb,35,0,0,fu,fr,fr,fr,fr,fw,0,84,37,fa,fb
84,fa,0,0,fu,ft,fv,fv,fv,fv,fs,fw,0,0,36,fa
fb,84,0,fu,ft,fv,fv,fv,fv,fv,fv,fs,fw,0,fb,fb
fa,0,0,fv,fv,fv,g6,fc,fc,fc,fv,fv,fv,0,fa,fa
9c,0,0,fv,fv,g6,g7,84,84,84,fc,fv,fv,0,84,9c
9c,0,0,fv,fc,g7,84,84,84,84,84,fc,fv,0,0,9c
fb,0,0,fs,fw,84,84,84,84,84,84,fu,ft,0,0,fb
fa,fb,0,fv,fs,fw,84,84,84,84,fu,ft,fv,0,84,fa
fb,fa,0,fv,fv,fs,fx,g0,g3,fx,ft,fv,fv,0,fb,35
fa,84,0,0,fv,fv,g5,fz,g2,fv,fv,fv,0,0,fa,fb
fb,fb,84,0,0,fv,g4,fy,g1,fv,fv,0,0,35,37,fa
fa,fa,fb,fb,0,0,0,0,0,0,0,84,fb,fb,84,fb
36,84,fa,fa,fb,84,0,9c,9c,fb,37,fb,fa,fa,fb,fa
NAME island5.5
EXT 7,0 1b 7,15 FX slide_u
EXT 8,0 1b 8,15 FX slide_u
EXT 15,7 17 0,7 FX slide_r
EXT 15,8 17 0,8 FX slide_r
EXT 0,7 1a 15,7 FX slide_l
EXT 0,8 1a 15,8 FX slide_l
EXT 7,15 18 7,0 FX slide_d
EXT 8,15 18 8,0 FX slide_d
EXT 7,13 19 7,10 DLG 2w
EXT 7,10 19 7,13
EXT 8,13 19 8,10 DLG 2w
EXT 8,10 19 8,13
EXT 6,8 1y 6,0 FX tunnel DLG 41
PAL 0

ROOM 20
a6,a6,0,0,aj,ai,4v,aa,a6,0,a5,la,a5,0,aa,a5
0,a6,ab,a3,al,ak,4v,aa,a6,0,a5,0,a7,a7,aa,a5
a6,a6,0,0,aa,ab,4v,aj,ai,a4,a5,0,la,0,aa,2q
la,a6,ab,a3,a5,ab,4v,al,ak,0,a5,a7,0,a7,aa,a5
2q,ab,0,2y,aa,ab,4v,aa,ab,2y,a5,45,46,0,aa,la
a6,ab,ab,a3,a2,a2,an,a2,a2,a4,a9,43,47,a9,aa,0
2y,a3,a2,an,0,0,0,lc,ld,lc,lc,lc,lc,ld,a4,2y
ab,a4,0,0,0,an,0,ln,lc,lc,lc,lc,lo,0,a3,aa
ab,ab,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,aa,aa
ab,ab,0,0,la,0,0,0,0,2z,la,0,2q,0,aa,aa
ab,ab,0,2z,0,a7,0,0,2q,a7,0,a7,0,a7,ac,aa
ab,ab,0,0,2z,0,0,0,0,0,0,la,0,0,0,aa
ab,ab,0,0,0,0,0,2q,la,0,0,0,a7,a7,ac,aa
ab,a4,a7,0,a7,0,0,0,0,0,2z,0,0,0,aa,aa
ab,ab,0,0,0,0,0,0,0,2q,0,0,0,0,aa,aa
ab,ab,0,2q,0,0,2z,la,0,0,0,0,2q,0,0,aa
NAME final.2
EXT 6,0 1y 6,15 FX slide_u
EXT 11,5 21 3,7 FX tunnel
EXT 12,5 21 4,7 FX tunnel
PAL 0

ROOM 21
0,0,0,0,0,5x,lc,lc,c4,5x,0,0,0,0,2q,0
0,2q,0,2z,0,5x,lc,lc,c3,5x,0,la,0,0,0,0
0,0,la,0,0,5x,c4,lc,lc,5x,0,0,0,0,0,0
0,0,0,0,0,5x,c3,lc,lc,5x,0,0,0,0,0,0
0,5w,5u,5u,5u,5v,lc,lc,c4,5x,0,2z,0,la,0,la
0,5x,0,0,0,ba,lc,lc,c3,5x,0,0,0,0,0,0
0,5x,0,45,46,ba,c4,lc,lc,5x,0,0,0,0,2q,0
0,5x,5g,43,47,li,c3,lc,lc,5x,0,0,0,0,0,0
0,5x,c4,lc,lc,lc,lc,lc,c4,5x,0,0,0,0,0,0
0,5x,c3,lc,lc,lc,lc,lc,c3,5x,0,2q,0,0,la,0
0,5x,lc,lc,lc,lc,lc,lc,lc,5x,0,0,0,0,0,0
0,5s,5u,5u,5u,5u,5u,5u,5u,5v,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,la,0,0,0,0
0,0,la,0,0,0,0,0,0,0,0,0,0,0,2q,0
0,0,0,0,2q,0,0,la,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,2z,0,0,0,0
NAME final.3
EXT 3,7 20 11,5 FX tunnel
EXT 4,7 20 12,5 FX tunnel
EXT 6,0 1z 6,15 FX slide_u
EXT 7,0 1z 7,15 FX slide_u
EXT 8,0 1z 8,15 FX slide_u
PAL 0

ROOM 22
0,0,0,0,3r,3p,3q,0,0,0,0,3r,3q,0,0,0
0,2z,0,0,0,0,3r,3p,3q,0,0,0,3p,0,me,0
0,2q,0,0,0,0,0,0,3r,0,0,0,3r,3p,3q,0
0,0,0,0,2z,0,0,0,0,3r,0,0,0,3p,3p,3p
0,0,0,0,0,2z,0,2q,0,0,0,0,0,0,3r,3p
0,0,0,2z,0,0,0,0,0,2q,m4,m5,0,2z,0,3p
0,2z,0,0,3s,3t,0,40,42,0,m3,m2,2z,40,42,3r
0,0,0,0,3p,0,9v,41,41,lz,m0,m1,ly,41,41,9v
0,0,0,3s,3p,0,40,42,41,lv,0,0,lx,41,40,42
0,0,3s,3p,3t,0,3y,41,3z,lu,m7,m7,lw,3y,41,3z
3s,3p,3p,3p,0,0,40,3y,3x,ls,md,mc,lt,3x,3z,42
3p,3p,3p,3t,0,0,3y,3x,3x,ls,ma,mb,lt,3x,3x,3z
3p,3t,2y,2y,2y,2y,fx,fs,fr,ls,45,46,lt,fr,ft,fx
3m,6q,6q,6q,6q,6q,6q,6q,6q,lq,m9,m8,lr,6q,6q,6q
3o,2w,2y,2y,2y,2y,2y,2y,2y,2x,2w,2w,2x,2y,2y,2y
0,0,0,2x,0,0,0,2x,0,0,ix,0,0,2x,0,a
NAME world.6
EXT 10,13 24 7,13 FX tunnel
EXT 0,13 25 8,10 FX wave
EXT 10,13 24 7,13 FX tunnel
PAL 4

ROOM 24
40,41,3z,0,0,0,3y,3z,3y,3z,0,0,0,3y,41,42
41,3z,0,5n,5g,5g,5g,5g,5g,5g,5g,5g,5o,0,3y,41
3z,0,0,54,0,0,0,mf,mg,0,0,0,5c,0,0,3y
0,0,0,54,5g,5g,5g,mh,mi,5g,5g,5g,5c,0,0,0
5g,5g,5g,52,lf,lg,lh,40,42,lf,lg,lh,5a,5g,5g,5g
0,mf,mg,54,4x,4x,4x,41,41,4x,4x,4x,5c,mf,mg,0
5g,mh,mi,52,4x,4x,9v,41,41,9v,4x,4x,5a,mh,mi,5g
3x,3x,3x,3x,3x,3x,3x,3z,3y,3x,3x,3x,3x,3x,3x,3x
3x,3x,3x,3x,3x,3x,3x,42,40,3x,3x,3x,3x,3x,3x,3x
5f,5f,5f,55,4x,4x,9v,41,41,9v,4x,4x,5d,5f,5f,5f
40,42,0,54,4x,4x,4x,41,41,4x,4x,4x,5c,0,40,42
3x,41,42,54,4x,4x,4x,41,41,4x,4x,4x,5c,40,41,3x
40,3x,42,5l,5f,5f,55,41,41,5d,5f,5f,5m,40,3x,42
40,42,3x,3x,42,0,54,3y,3z,5c,0,40,3x,3x,40,42
3y,3x,41,42,3y,42,5l,5f,5f,5m,40,3z,40,41,3x,3z
41,3y,3z,3y,3x,41,3x,42,40,3x,41,3x,3z,3y,3z,41
NAME world.7
EXT 8,13 22 10,13 FX tunnel
EXT 15,7 24 0,7 FX slide_r
EXT 0,7 24 15,7 FX slide_l
EXT 15,8 24 0,8 FX slide_r
EXT 0,8 24 15,8 FX slide_l
EXT 7,13 22 10,13 FX tunnel
EXT 13,6 2c 7,10 FX wave DLG 4j
EXT 14,6 2c 8,10 FX wave DLG 4j
EXT 1,6 2a 7,9 FX wave DLG 4k
EXT 2,6 2a 8,9 FX wave DLG 4k
EXT 7,3 2e 7,13 FX wave DLG 4y
EXT 8,3 2e 8,13 FX wave DLG 4y
PAL 4

ROOM 25
2m,2m,2s,2v,8f,2h,8f,0,0,2m,2m,2m,2s,2v,8f,8f
2m,2s,2x,2w,2v,2h,8f,45,46,8g,2m,2s,2x,2w,2v,8f
2s,2x,0,2z,0,2v,8f,43,47,8g,2s,0,0,0,2q,2v
2x,0,0,0,0,2w,2v,7q,7r,2s,2x,0,0,0,0,2x
0,2q,2q,0,0,2w,2y,7q,7r,2x,0,2z,0,2q,0,0
0,0,0,0,0,0,2y,7q,7r,2y,0,0,0,0,0,2x
0,0,0,2q,0,0,2y,7q,7r,2w,0,0,0,0,0,0
0,0,0,0,0,2z,2y,7q,7r,2y,0,2q,0,0,0,0
2x,0,0,0,0,0,2x,7q,7r,2y,0,0,0,2q,0,2z
0,2q,0,2q,0,0,0,7q,7r,2y,0,0,0,2x,0,0
0,0,0,0,0,0,0,7t,7s,3m,2y,0,0,0,0,2q
0,0,2x,0,2z,0,2y,7k,7k,3o,0,2z,0,2z,0,0
0,0,0,0,0,0,0,2w,0,0,0,0,0,0,0,0
2j,2z,0,0,0,2f,2j,0,0,2f,2j,0,0,0,2q,2f
0,2j,0,0,2f,0,0,2i,2i,0,0,2j,0,0,2f,0
0,0,2j,2f,0,0,0,0,0,0,0,0,2j,2f,0,0
NAME world.4
EXT 7,2 28 7,10 FX tunnel
EXT 8,2 28 8,10 FX tunnel
PAL 4

ROOM 26
la,0,0,0,0,0,0,la,0,0,0,la,0,0,0,la
0,la,0,0,0,0,0,0,0,0,0,0,0,0,0,0
a2,0,0,a2,a2,a2,a2,a2,0,a2,0,a2,a2,0,a2,0
0,0,0,la,0,0,0,0,0,0,0,0,0,la,0,0
0,0,0,0,0,0,0,0,0,la,0,0,0,0,0,0
a2,a2,a2,0,a2,0,0,a2,a2,0,0,a2,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,a2,a2,0,0,0,0,a2,a2,0,0,a2,a2,0,a2,a2
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
a9,a9,a9,a9,a9,a9,fb,a9,a9,a9,a9,a9,a9,a9,a9,a9
3p,3t,35,0,fb,0,fa,0,0,34,0,fb,fg,fh,84,0
3p,3q,36,84,fa,35,37,36,fg,fh,37,fa,fe,ff,0,9c
3p,3p,3q,36,37,0,84,0,fe,ff,84,fk,37,0,34,9c
3p,3p,3p,3p,3p,3p,3p,3q,35,0,0,36,84,fg,fh,fb
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3q,37,fe,ff,fa
NAME world.1
EXT 15,12 27 0,12 FX slide_r
EXT 15,13 27 0,13 FX slide_r
PAL 4

ROOM 27
0,0,0,a7,a7,0,0,a7,a7,0,0,my,mz,0,0,0
0,5j,a6,ml,mq,a5,a6,mm,mr,a5,a6,mn,mu,a5,5j,0
0,a2,a6,9h,9i,aa,ab,mv,mw,aa,ab,9h,9i,aa,a2,a2
0,0,ab,mk,mj,aa,ab,mx,mj,aa,ab,mk,mj,aa,0,0
0,0,ab,9d,9e,aa,ab,9d,9e,aa,ab,9d,9e,aa,0,0
a2,a2,0,n2,n2,0,0,n2,n2,0,a2,n0,n1,0,a2,0
0,5j,a6,9k,9j,a5,a6,mo,mt,a5,a6,mp,ms,a5,5j,0
0,0,ab,9h,9i,aa,ab,9h,9i,aa,ab,9h,9i,aa,0,0
0,a2,ab,mk,mj,aa,ab,mk,mj,aa,ab,mk,mj,aa,0,a2
0,0,ab,9d,9e,aa,ab,9d,9e,aa,ab,9d,9e,aa,0,0
a9,a9,a9,n2,n2,a9,a9,n2,n2,a9,a9,n2,n2,a9,a9,a9
0,0,0,40,42,0,0,40,42,0,0,40,42,0,0,0
9c,0,84,3y,3z,fb,0,3y,3z,0,0,3y,3z,84,36,9c
9c,0,36,0,0,fa,0,0,0,84,0,36,0,fb,84,9c
0,37,0,40,42,0,36,40,42,35,fb,40,42,fa,0,0
0,84,0,3y,3z,0,0,3y,3z,0,fa,3y,3z,0,35,0
NAME world.2
EXT 0,12 26 15,12 FX slide_l
EXT 0,13 26 15,13 FX slide_l
EXT 15,12 28 0,12 FX slide_r
EXT 15,13 28 0,13 FX slide_r
PAL 4

ROOM 28
0,la,0,0,0,0,0,0,0,0,0,0,0,la,0,0
0,0,0,la,0,0,0,0,0,0,0,0,0,0,0,0
0,0,ap,0,0,ap,0,ap,ap,ap,0,0,ap,nd,nd,ap
0,0,0,0,0,0,0,0,0,0,0,la,ew,et,et,eu
0,0,0,0,0,0,0,0,0,0,0,0,0,ev,ev,0
0,ap,0,ap,ap,ap,0,la,ap,ap,0,ap,0,0,ap,ap
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
ap,0,ap,ap,0,0,0,ap,0,0,ap,ap,ap,ap,0,ap
0,0,0,0,0,0,0,45,46,0,0,0,0,0,0,0
a9,a9,a9,a9,a9,a9,a9,43,47,a9,a9,a9,a9,a9,a9,a9
0,37,0,0,0,37,0,0,0,0,0,37,0,3s,3p,3p
9c,0,0,35,36,0,84,36,35,3s,3p,3q,84,3r,3p,3p
9c,0,37,fb,84,35,0,36,3s,3p,3p,3p,3q,3s,3p,3p
84,0,0,fa,0,0,3s,3p,3p,3p,3p,3p,3p,3p,3p,3p
0,35,36,3s,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
NAME world.3
EXT 0,12 27 15,12 FX slide_l
EXT 0,13 27 15,13 FX slide_l
EXT 7,10 25 7,2 FX tunnel
EXT 8,10 25 8,2 FX tunnel
PAL 4

ROOM 29
0,0,0,0,0,0,0,0,0,2w,0,0,0,0,0,0
0,2w,0,0,0,0,0,0,2q,0,0,0,0,2x,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,2w,0,0,0
0,0,0,2w,0,0,0,0,0,0,0,0,0,0,0,2q
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,2q,0,0,0,0,2w,0,0,2z,0,0,0,2w,0
0,0,0,0,0,0,0,0,3m,0,0,0,0,2q,0,0
0,0,0,0,0,0,0,0,3o,0,0,0,0,0,0,0
0,2x,0,0,0,0,0,0,0,0,2x,0,0,0,0,0
0,0,0,0,0,2w,0,0,0,0,0,0,0,2w,0,0
0,0,2z,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,2q,0,0,0,0,2z,0,0,0
0,0,2w,0,0,0,0,0,0,0,2w,0,0,0,0,0
0,0,0,0,0,0,2x,0,2z,0,0,0,0,0,2w,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME world.5
PAL 4

ROOM a
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,5h,0,0,0
0,0,0,0,0,0,5i,0,0,0,0,0,0,0,0,0
0,0,0,5h,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,5n,5g,5g,5g,5g,5o,0,0,0,5i,0
0,0,0,0,5n,52,5j,8a,8b,5j,5a,5o,0,0,0,0
0,0,0,0,54,57,5g,88,89,5g,59,5c,0,0,0,0
0,0,0,0,54,52,40,42,40,42,5a,5c,0,0,5h,0
0,0,0,0,54,40,3z,3y,3z,3y,42,5c,0,0,0,0
0,0,0,0,54,3y,3x,3x,3x,3x,3z,5c,0,0,0,0
0,0,0,0,5l,55,5k,5d,5f,5f,5f,5m,0,0,0,0
0,5h,0,0,0,5l,5f,5m,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,5i,0,0
0,0,0,0,5i,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,5h,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME hut
EXT 6,10 9 10,2 FX tunnel
PAL 0

ROOM b
3p,3p,3t,0,0,0,0,0,0,0,2q,0,0,0,0,0
3p,3t,0,0,0,ix,0,0,2z,0,0,0,a,0,0,0
3p,0,0,0,0,0,0,0,0,94,97,96,95,0,0,2q
3p,0,0,0,0,0,0,0,2x,93,93,93,93,2w,0,0
3t,0,0,0,a,0,0,2y,2f,93,9b,9a,93,2j,2x,0
0,0,0,0,0,0,0,2w,2h,92,98,99,92,0,2j,2y
0,0,0,0,0,0,0,2y,2d,0,84,84,0,84,0,2i
0,0,ix,0,0,0,0,2w,2v,2d,0,84,84,0,0,0
0,0,0,0,0,0,0,0,2w,2v,2d,0,0,84,0,9c
0,0,0,0,ix,0,2z,0,0,2w,2v,2d,2e,0,84,9c
0,2q,0,0,0,0,0,2g,0,0,0,2v,2r,2d,0,0
0,0,0,0,0,0,2f,84,2j,0,0,0,2w,2v,2d,2e
0,0,0,0,0,0,2d,84,84,2j,0,0,a,2w,2v,2r
0,0,0,0,0,a,2v,2d,0,84,2l,0,0,0,a,0
a,0,2z,0,0,0,a,2v,2d,2k,2s,0,0,0,0,0
0,0,0,0,0,0,a,a,2v,2s,0,0,0,0,0,2f
NAME island4.1
EXT 15,8 c 0,8 FX slide_r
EXT 15,9 c 0,9 FX slide_r
EXT 10,5 q 2,12 FX tunnel
EXT 11,5 q 3,12 FX tunnel
PAL 0

ROOM c
0,3r,3p,3t,0,0,0,2z,0,2q,0,3r,3p,3p,3p,3p
0,0,3t,0,2w,0,2z,2q,2q,0,0,0,0,3r,3p,3p
0,0,2z,0,0,2q,8n,8o,2z,0,2z,0,0,0,3r,3t
2w,0,0,0,0,2z,8l,8m,2z,2q,2q,0,2w,0,0,0
0,0,0,2x,2z,2q,8q,8p,2q,8n,8o,2z,0,0,0,3s
2y,2y,0,2y,2n,8c,8r,8s,2l,8l,8m,2q,2z,0,2w,3r
2i,2j,2x,2f,8f,8e,0,0,8g,8k,8j,2w,0,0,0,0
0,0,8y,2h,2t,8d,2r,2r,2u,8h,8i,2j,2y,0,0,0
9c,0,8x,2d,2e,8w,2e,0,0,0,2e,2k,8t,2x,0,0
9c,0,2v,8f,2y,2y,2y,2d,2e,2k,2y,8g,36,2j,2w,0
0,0,35,2v,2r,2r,2r,8f,8e,8g,2r,2s,35,35,2j,2y
2e,0,0,35,37,36,36,2v,8d,2s,35,35,0,0,2k,2w
2r,2d,0,0,36,35,37,35,3l,36,36,0,2e,2k,2s,0
2x,2v,2d,0,36,37,36,36,8u,36,2e,2k,2r,2s,2w,2q
2x,2w,2v,2h,0,0,34,36,8v,2m,2r,2s,2w,2x,0,0
2l,2w,2x,2h,0,0,9c,9c,34,37,2j,2w,0,0,2w,0
NAME island4.2
EXT 0,8 b 15,8 FX slide_l
EXT 0,9 b 15,9 FX slide_l
EXT 7,15 d 7,0 FX slide_d
EXT 6,15 d 6,0 FX slide_d
EXT 8,11 f 8,12 FX tunnel
EXT 5,7 f 4,1 FX tunnel
PAL 0

ROOM d
0,2w,2w,2d,0,0,9c,9c,0,0,0,2j,2y,2y,2x,0
0,0,2w,2v,2h,0,0,0,0,0,0,8z,7h,7h,90,2q
0,0,0,2x,2d,0,0,35,0,0,0,2m,7u,7u,3m,0
0,0,0,0,2v,2d,0,0,0,0,35,0,2j,2x,3o,0
0,0,2q,0,2x,2v,2d,2e,0,0,0,0,0,2j,2y,0
2w,0,0,0,2w,2w,2v,2r,2d,0,0,0,0,0,2j,2x
0,0,0,0,0,0,2w,2x,2v,2d,0,0,35,0,0,2l
0,0,0,2x,0,0,0,2w,0,2v,2h,0,0,0,2k,2u
0,0,0,0,0,77,0,0,0,2x,2d,0,0,2k,2s,2x
3s,3p,0,0,2q,76,2q,0,2w,0,2v,2d,2m,2s,2x,0
3p,3t,0,0,0,2z,0,0,0,0,2w,2v,74,2x,0,0
3p,0,0,0,0,0,0,0,0,0,0,2w,75,0,0,0
3t,0,0,0,0,2w,0,0,0,0,0,0,0,2x,0,0
0,0,2z,0,3s,3t,0,0,2q,0,0,0,0,0,0,2x
3q,0,3s,3p,3p,0,0,0,0,0,3q,0,2x,2z,3r,3q
3p,0,3p,3p,3t,0,0,2x,0,3s,3p,3p,3q,0,3s,3p
NAME island4.3
EXT 7,0 c 7,15 FX slide_u
EXT 6,0 c 6,15 FX slide_u
EXT 13,1 0 4,4 FX tunnel
PAL 0

ROOM e
0,0,0,0,0,0,0,9c,9c,0,3r,3p,3p,3p,3p,3p
0,0,0,0,0,0,0,0,0,0,a,3p,3p,3p,3p,3p
0,0,0,0,2q,0,0,0,0,0,0,3r,3p,3p,3p,3p
0,0,ix,0,0,0,0,0,0,0,0,0,3r,3p,3p,3p
0,0,0,0,0,0,ix,0,0,0,0,0,0,3p,3p,3p
0,0,0,a,0,0,0,0,0,2z,0,0,2w,3r,3p,3p
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3r
0,2z,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,2y,0,0,0,2q,0,0,0,ix,0
0,0,9k,9j,2w,2y,72,2y,0,0,0,a,0,2z,0,0
0,0,9h,9i,2f,2l,73,2x,0,0,0,0,2q,0,2q,0
0,2w,9g,9f,2m,2u,2x,0,0,0,0,0,0,2z,0,0
2y,2n,9d,9e,2k,2w,2x,0,0,0,ix,0,0,0,0,0
2w,2t,2d,2k,2s,2x,0,0,0,0,0,0,0,0,2q,0
0,2w,2v,2s,2w,0,0,ix,0,0,0,0,0,0,0,0
0,0,2w,2x,0,0,0,0,0,0,0,0,ix,0,0,0
NAME island4.4
ITM k 13,10
EXT 7,0 0 4,2 FX tunnel
EXT 8,0 0 4,2 FX tunnel
PAL 0

ROOM f
0,0,0,0,9z,0,0,9m,0,0,9m,0,0,0,0,0
0,0,0,2y,a0,2y,0,9m,0,0,9m,0,0,0,0,0
0,0,2y,9x,9y,2y,0,9m,0,0,9m,0,0,0,0,0
0,0,2y,4v,2y,0,0,9m,0,0,9m,0,0,0,0,0
0,0,5n,4v,5g,5g,5g,9w,5g,5g,9w,5o,0,0,0,0
0,5n,52,4v,9z,0,9n,9o,0,0,9m,5a,5o,0,0,0
0,54,54,4v,a0,9n,9t,9r,5g,5g,9m,5c,5c,0,0,0
0,54,52,9v,9v,9q,9s,9p,9v,9n,9o,5a,5c,0,0,0
0,54,9v,9v,9v,9v,9v,9v,9n,9t,9r,9v,5c,0,0,0
0,54,9v,9v,9v,9v,9v,9v,9q,9s,9p,9v,5c,0,0,0
0,5l,55,9v,9v,9v,9v,9v,9v,9v,9v,9v,5c,0,0,0
0,0,5l,5f,5f,5f,55,9v,9v,9v,5d,5f,5m,0,0,0
0,0,0,0,0,0,5l,55,5k,5d,5m,0,0,0,0,0
0,0,0,0,0,0,0,5l,5f,5m,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME cave2.1
EXT 8,12 c 8,11 FX tunnel
EXT 4,1 c 5,7 FX tunnel
EXT 4,6 g 7,5 FX tunnel
PAL 0

ROOM g
0,0,0,0,0,0,0,2q,0,0,0,2z,0,0,0,2q
0,2z,0,0,0,0,a7,a7,a7,a7,0,0,0,0,0,0
0,0,0,2q,0,a3,a5,0,0,a6,a4,0,0,0,0,0
a7,a7,a7,a7,a3,0,aj,af,ad,ai,a4,a4,a7,a7,a7,a7
0,0,0,a6,0,ac,al,am,ag,ak,0,0,a5,0,0,0
ad,af,ad,ai,0,2y,aa,a0,0,ab,2y,a4,aj,af,ad,af
ag,ah,ag,ak,ac,a3,a2,a2,a2,a2,a4,2y,al,am,ag,ah
2y,2y,2y,ab,a3,0,0,0,0,0,0,a4,aa,a0,2y,ap
a2,a2,a2,a2,0,an,0,0,0,0,0,0,a2,a2,a2,a2
9c,0,0,0,0,0,0,0,0,0,an,0,0,0,0,9c
9c,0,0,an,0,0,0,0,0,0,0,0,0,an,0,9c
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap
2q,0,0,0,0,0,0,0,0,0,2z,0,0,0,0,0
0,0,0,2q,0,0,0,0,2z,0,0,0,2q,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2z
NAME cave2.2
EXT 15,9 h 0,9 FX slide_r
EXT 15,10 h 0,10 FX slide_r
EXT 7,5 f 4,6 FX tunnel
EXT 0,9 i 15,9 FX slide_l
EXT 0,10 i 15,10 FX slide_l
EXT 13,7 o 5,4 FX wave DLG 1k
PAL 0

ROOM h
0,a4,0,0,0,0,0,0,0,a4,0,0,0,0,0,a4
0,0,0,0,a4,0,0,0,0,2q,0,0,0,0,2z,0
0,0,0,a4,0,a4,0,0,0,0,0,a4,0,0,0,0
a9,a9,a9,a9,a9,0,0,0,0,0,0,0,a4,0,0,0
0,0,0,0,a6,a4,0,a4,0,0,0,2z,0,0,0,0
ad,af,ao,ad,ai,0,a4,0,a4,0,0,0,0,0,2q,0
ag,ah,2y,ag,ak,ae,0,a4,0,a4,0,a4,0,0,0,0
2y,2y,2y,ap,ab,2y,0,ae,a5,0,0,0,a4,0,0,0
a2,a2,a2,a2,a2,a4,ae,0,a5,0,0,0,0,a4,2z,0
9c,0,0,an,0,0,a4,ac,0,0,0,0,0,0,0,0
9c,an,0,0,0,0,ac,0,0,a4,0,0,0,0,0,0
0,0,an,0,0,ac,0,0,2q,0,0,0,0,0,0,0
ap,ap,ap,ap,ap,0,a4,0,0,0,0,a4,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,a4,2q,0,0
0,a4,0,0,0,2z,0,0,a4,0,0,0,0,a4,0,0
0,0,a4,0,0,0,0,0,0,a4,0,0,0,0,0,0
NAME cave2.3
EXT 0,9 g 15,9 FX slide_l
EXT 0,10 g 15,10 FX slide_l
PAL 0

ROOM i
0,0,ac,0,0,0,0,ac,0,0,0,0,0,0,ac,0
0,0,0,0,0,0,ac,0,0,0,2q,0,0,ac,2z,0
ac,0,0,0,0,0,0,2q,0,0,0,0,0,0,0,0
0,2q,0,0,0,0,0,ac,0,0,0,a7,a7,a7,a7,a7
0,0,ac,0,0,0,ac,0,0,0,a3,aa,0,0,0,0
0,0,0,2z,0,0,0,0,0,a3,0,aj,af,ao,ad,af
0,0,0,0,ac,0,0,0,a3,0,ac,al,ah,0,ag,ah
0,0,0,0,0,0,0,ab,ac,0,2y,aa,2y,2y,2y,2y
0,0,ac,0,0,0,0,ab,0,2y,a3,a2,a2,a2,a2,a2
0,2z,0,0,ac,0,0,ab,2y,a3,0,0,0,an,0,9c
0,0,0,0,2q,0,0,ab,a3,0,an,0,0,0,0,9c
0,0,ac,0,0,ac,0,ab,0,0,0,0,0,0,0,0
0,ac,0,0,0,0,0,ab,0,0,0,0,ac,ap,ap,ap
ac,0,0,0,0,0,0,ab,0,0,0,0,aa,0,0,0
0,0,0,0,ac,2z,0,ab,0,an,0,0,aa,0,0,2q
0,0,0,ac,0,0,0,ab,0,9c,9c,0,aa,0,0,0
NAME cave2.3
EXT 15,9 g 0,9 FX slide_r
EXT 15,10 g 0,10 FX slide_r
EXT 9,15 j 9,0 FX slide_d
EXT 10,15 j 10,0 FX slide_d
PAL 0

ROOM j
0,2q,0,0,0,2q,0,ab,0,9c,9c,0,aa,0,0,0
0,0,0,0,0,0,0,ab,0,an,0,0,aa,0,2q,0
0,0,0,2z,0,0,0,ac,a5,0,0,a6,ae,0,0,2z
2q,0,0,0,a7,a7,a3,2y,a5,0,an,a6,ae,a4,a7,a9
0,0,0,a3,a5,a6,0,ac,a5,0,0,a6,2y,0,a5,0
a9,a9,a3,0,aj,ai,0,2y,a5,0,0,a6,2y,0,aj,af
0,a6,0,0,al,ak,2y,a3,0,0,0,0,a4,ae,al,ah
0,a6,0,2y,aa,ab,a3,0,0,0,an,0,0,a4,aa,2y
0,a6,2y,a3,a2,a2,0,0,0,0,0,0,0,0,a2,a2
0,ab,a3,0,0,0,0,an,0,0,0,0,0,0,0,9c
0,ab,a4,0,an,0,0,0,0,0,0,an,0,0,a3,ap
0,ab,2y,a4,0,0,0,0,0,0,0,0,a3,ap,aa,aa
0,ab,0,ab,ap,ap,a4,61,a3,ap,ap,ap,aa,0,0,aa
0,ab,0,0,0,0,ab,4v,2y,0,0,0,aa,0,aa,aa
0,a6,0,0,0,0,2y,4v,aa,0,0,0,0,0,0,a5
0,a6,0,a6,0,0,ab,4v,aa,0,0,0,aa,0,0,a5
NAME cave2.4
EXT 7,15 l 7,0 FX slide_d
EXT 9,0 i 9,15 FX slide_u
EXT 10,0 i 10,15 FX slide_u
EXT 15,9 k 0,9 FX slide_r
PAL 0

ROOM k
0,0,0,0,0,0,0,0,0,0,0,0,0,0,2z,0
0,2z,0,0,0,0,2q,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
a9,a9,a9,a9,a9,a9,a9,a9,0,0,0,0,0,2q,0,0
0,0,0,0,0,0,0,a6,a4,0,0,0,0,0,0,0
ad,af,ao,aq,ar,ao,ad,ai,0,a4,a9,a9,a9,0,a9,a9
ag,ah,0,as,at,0,ag,ak,0,0,a5,0,0,0,0,0
2y,2y,2y,2y,2y,2y,2y,ab,2y,0,a5,0,0,a5,0,a5
a2,a2,a2,a2,a2,a2,a2,a2,a4,2y,a5,0,0,a5,0,0
9c,0,0,0,0,an,0,0,0,a4,aa,0,0,0,0,0
ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,aa,0,0,a5,0,0
0,0,0,0,0,0,0,0,0,0,aa,a5,0,0,0,a5
0,0,0,0,0,0,aa,0,0,0,0,0,0,0,0,a5
0,0,aa,0,0,0,aa,0,0,0,aa,0,0,a5,0,0
0,0,0,0,0,0,0,0,0,0,aa,0,0,0,0,0
0,0,0,0,0,0,aa,0,0,0,aa,0,0,0,0,0
NAME cave2.5
EXT 0,9 j 15,9 FX slide_l
PAL 0

ROOM l
aw,a6,0,0,0,0,ab,4v,aa,0,0,0,aa,0,0,aa
au,au,aw,a6,0,0,ab,4v,2y,0,0,0,0,0,av,au
au,au,au,aw,0,0,ab,4v,aa,0,0,0,av,au,au,au
au,ax,ax,au,au,au,aw,4v,av,au,au,au,au,ax,ax,au
au,au,ax,au,au,au,au,ax,au,ax,ax,ax,ax,ax,au,au
au,ax,ax,au,ax,ax,ax,ax,ax,ax,au,ax,au,ax,au,au
au,au,ax,ax,ax,au,au,ax,au,au,au,au,au,ax,ax,au
au,au,ax,au,au,au,au,au,au,ax,au,ax,ax,ax,au,au
au,au,ax,ax,ax,ax,ax,ax,ax,ax,au,au,ax,au,au,au
au,au,au,ax,au,au,au,au,ax,au,au,au,au,au,au,au
au,ax,ax,ax,au,au,ax,ax,ax,ax,au,ax,au,ax,au,au
au,au,ax,au,au,ax,ax,au,au,ax,au,ax,ax,ax,ax,au
au,au,ax,au,au,au,ax,au,au,ax,ax,ax,au,au,ax,au
au,au,ax,ax,ax,au,ax,ax,au,au,au,ax,ax,ax,ax,au
au,au,au,au,ax,au,au,ax,au,au,ax,ax,ax,au,au,au
au,au,au,au,au,au,au,au,au,au,au,au,b4,au,au,au
NAME cave2.6
EXT 7,0 j 7,15 FX slide_u
EXT 12,15 m 12,0 FX slide_d
PAL 1

ROOM m
ax,ax,ax,ax,ax,ax,ax,ax,ax,ax,ax,au,0,au,ax,ax
ax,ax,ax,ax,ax,ax,ax,ax,ax,ax,ax,b3,0,b2,ax,ax
ax,ax,ax,ax,ax,ax,ax,au,au,au,b3,0,an,0,b2,ax
ax,ax,ax,ax,ax,au,b3,0,0,0,b5,0,0,0,0,au
au,au,au,au,b3,0,0,0,0,an,0,0,0,0,an,au
au,au,au,b3,0,0,ac,ap,ap,ae,0,0,0,b5,0,au
au,b3,0,0,0,a6,ae,a7,a7,ac,a5,an,0,0,0,au
au,0,0,0,b5,a6,5j,0,0,5j,a5,0,3l,3s,3p,au
au,0,an,0,0,a6,2y,b0,b1,2y,a5,0,3a,3p,3t,au
au,0,0,0,0,0,a4,ay,az,a3,b5,3s,3a,3t,b5,au
au,0,0,0,0,0,0,a2,a2,0,3s,3p,3a,0,an,au
au,aw,0,b5,0,an,0,0,0,0,3p,3t,8v,0,av,au
au,au,aw,0,0,0,0,0,b5,3s,3p,0,0,av,au,au
au,au,au,aw,0,0,0,3s,3p,3p,3t,0,av,au,au,au
au,au,au,au,au,aw,3s,3p,3t,0,av,au,au,au,au,au
au,au,au,au,au,au,au,au,au,au,au,au,au,au,au,au
NAME cave2.7
ITM 6 14,6
EXT 12,0 l 12,15 FX slide_u
EXT 7,9 n 7,9 FX tunnel
EXT 8,9 n 8,9 FX tunnel
PAL 1

ROOM n
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,2q,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,2q,0
0,0,0,0,0,0,0,0,0,2z,0,0,0,0,0,0
0,0,0,0,0,0,5n,5g,5g,5g,5o,0,0,0,0,0
0,0,2z,0,0,5n,52,45,46,0,5a,5o,0,0,0,0
0,0,0,0,0,54,57,43,47,5g,59,5c,0,0,0,0
0,0,0,0,0,54,52,9v,9v,9v,5a,5c,0,0,2z,0
0,0,0,0,0,54,9v,9v,9v,9v,9v,5c,0,0,0,0
0,0,0,2q,0,5l,55,9v,9v,5d,5f,5m,0,0,0,2q
0,0,0,0,0,0,5l,5f,5f,5m,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,2z,0,0,0,0
0,2z,0,0,0,0,0,2q,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME cave2.8
EXT 8,9 m 7,9 FX tunnel
EXT 7,9 m 8,9 FX tunnel
EXT 8,6 o 8,4 FX tunnel
EXT 7,6 o 7,4 FX tunnel
PAL 0

ROOM o
0,5h,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,5w,5u,5u,5u,5u,5u,5u,5t,0,0,0,0
0,0,0,5w,5v,5i,0,0,5h,0,0,5s,5t,0,5h,0
5i,0,5w,5v,ba,9z,5j,45,46,5j,9z,5c,5s,5t,0,0
0,5w,5v,ba,ba,a0,5g,43,47,5g,a0,5c,5c,5s,5t,0
0,5x,ba,bb,b8,a4,a4,a4,a4,a4,a4,58,59,5c,5x,0
0,5x,ba,4g,4f,bc,a4,40,42,a4,bc,4g,4f,5c,5x,0
0,5x,4g,4f,4e,bd,40,3z,3x,42,bd,4h,4g,4f,5x,0
0,5x,4h,4e,bc,40,41,0,0,3y,42,bc,4h,4e,5x,0
0,5x,a4,a4,bd,3y,42,0,0,41,3z,bd,a4,a4,5x,0
0,5x,a4,a4,a4,bc,3y,3x,40,3z,bc,a4,a4,a4,5x,0
0,5s,5t,a4,a4,bd,a4,3y,3z,a4,bd,a4,a4,5w,5v,0
0,0,5s,5t,a4,a4,a4,a4,a4,a4,a4,a4,5w,5v,0,0
5h,0,0,5s,5t,a4,a4,a4,a4,a4,a4,5w,5v,0,0,5i
0,0,0,0,5s,5u,5u,5u,5u,5u,5u,5v,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,5h,0,0,0,0
NAME throne room
EXT 8,4 n 8,6 FX tunnel
EXT 7,4 n 7,6 FX tunnel
EXT 5,4 g 13,7 FX wave DLG 1j
EXT 10,4 p 10,4 FX tunnel
PAL 0

ROOM p
0,0,0,0,0,0,0,0,5w,5u,5u,5u,5t,0,0,2z
0,0,0,0,0,0,0,0,5x,5j,be,5j,5x,0,0,0
0,0,0,0,0,2z,0,0,5x,5g,5g,5g,5x,0,0,0
0,0,0,0,0,0,0,0,5x,0,a4,a4,5x,0,0,0
0,0,2q,0,0,0,0,0,5s,5t,a4,5w,5v,0,0,0
0,0,0,0,0,0,0,0,0,5s,5u,5v,0,0,2q,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,2z,0,0,0,2q,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,2z,0,0,0,0,0,0,0,0,0
0,0,2q,0,0,0,0,0,0,0,0,0,0,2z,0,0
0,0,0,0,0,0,0,0,0,0,2q,0,0,0,0,0
0,0,0,0,0,0,2z,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,2q,0,0,0,0
0,0,0,2z,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME cave2.9
EXT 10,4 o 10,4 FX tunnel
PAL 0

ROOM q
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,2q,0,0,2z,0,0,bn,bo,0,0,0,0,0,2q,0
0,0,0,0,0,0,bk,bm,bl,bj,2z,0,0,0,0,0
0,2z,0,0,2q,0,0,bh,bh,0,0,0,bn,bo,0,0
0,0,0,0,0,0,0,93,93,0,0,bk,bm,bl,bj,0
0,0,0,0,0,0,0,93,93,0,0,0,bh,bh,0,0
0,0,bf,bg,0,0,0,93,93,0,0,0,93,93,0,0
0,0,93,93,0,0,0,93,93,0,0,0,93,93,0,0
0,0,93,93,0,0,0,93,93,0,0,0,93,93,0,0
0,0,93,93,0,0,0,93,93,0,0,0,93,93,0,0
0,0,93,93,0,0,0,93,93,0,0,0,93,93,0,0
0,0,9b,9a,2y,2y,2y,93,93,2y,2y,2y,93,93,2y,2y
0,2y,98,99,bf,bg,2y,92,92,0,0,2y,92,92,2y,2y
0,2y,40,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,bp
0,2y,3y,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,bq
0,0,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y
NAME museum.1
EXT 2,12 b 10,5 FX tunnel
EXT 3,12 b 11,5 FX tunnel
EXT 15,13 r 0,13 FX slide_r DLG 1p
EXT 15,14 r 0,14 FX slide_r DLG 1p
PAL 0

ROOM r
0,0,cn,cn,cl,0,0,2q,0,0,ca,0,0,0,co,cm
0,0,0,0,cm,2z,0,0,0,0,ca,0,0,2q,cp,0
0,0,0,0,0,0,0,0,0,0,c8,2z,0,0,0,0
0,2q,0,0,0,0,0,0,0,0,c9,0,0,0,0,0
0,0,0,0,0,2q,0,0,0,2z,0,0,2q,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,2z,0,0,2q,0,0,0,0,0,0,0
0,bn,bo,0,0,0,0,0,0,0,0,2z,0,bn,bo,0
bk,bm,bl,bj,0,0,0,2q,0,0,0,0,bk,bs,br,bj
0,bh,bh,0,0,0,0,2q,2z,0,0,0,0,bh,bh,0
0,93,93,0,0,0,2z,c0,bz,2q,0,0,0,93,93,0
0,93,93,0,c4,0,c2,by,bx,c1,0,c4,0,93,93,0
c5,92,92,c6,c3,c5,bt,bu,bw,bv,c6,c3,c5,92,92,c6
42,9v,40,42,40,3x,42,40,3x,42,40,3x,42,42,9v,40
3z,9v,3y,3y,3x,3z,3y,3x,3z,3y,3x,3z,3y,3z,9v,3y
2y,c5,c5,2y,c5,c7,c5,c7,c5,2y,c7,c5,c5,2y,c5,2y
NAME museum.2
EXT 0,13 q 15,13 FX slide_l
EXT 0,14 q 15,14 FX slide_l
EXT 15,13 s 0,13 FX slide_r
EXT 15,14 s 0,14 FX slide_r
PAL 0

ROOM s
0,0,0,0,0,2q,0,0,0,0,0,0,0,2q,0,0
0,0,0,0,0,0,0,bn,bo,0,0,0,0,0,0,0
0,2q,0,0,0,0,bk,bs,br,bj,0,0,0,0,0,2z
0,0,bn,bo,0,0,0,bh,bh,0,0,2q,0,0,0,0
0,bk,bs,br,bj,0,2z,93,93,0,0,0,0,0,0,0
0,0,bh,bh,0,0,0,93,93,0,0,0,0,0,2q,0
0,0,93,93,0,0,0,93,93,0,0,0,0,0,0,0
0,0,93,93,0,0,0,93,93,0,0,0,0,0,0,0
0,0,93,93,0,0,0,93,93,0,0,0,0,0,0,0
0,0,93,93,0,0,0,93,93,0,0,0,cv,cu,0,0
0,0,93,93,0,0,0,93,93,0,0,0,cs,ct,0,0
0,0,93,93,0,0,0,93,93,0,0,0,cs,ct,0,0
c7,c5,92,92,c7,c5,c7,92,92,c6,2y,0,cq,cr,2y,2y
3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x
3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x
2y,2y,c6,2y,2y,2y,c6,c6,2y,2y,2y,2y,2y,2y,2y,2y
NAME museum.3
EXT 0,13 r 15,13 FX slide_l
EXT 0,14 r 15,14 FX slide_l
EXT 15,13 t 0,13 FX slide_r
EXT 15,14 t 0,14 FX slide_r
EXT 12,12 u 7,12 FX tunnel
EXT 13,12 u 8,12 FX tunnel
PAL 0

ROOM t
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,2z,0,0,2q,0,0,0,0,2q,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,2q,0
0,0,2q,0,0,0,0,0,2z,0,0,2z,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,cv,cu,0,0,0,0,0,0,0
0,0,0,0,0,0,0,cs,ct,0,0,0,0,0,0,0
0,0,0,0,0,c4,0,cs,ct,0,c4,0,0,0,0,0
0,0,0,0,2y,c3,2y,d2,d1,2y,c3,2y,0,0,0,0
0,0,0,0,2y,40,42,40,42,40,42,2y,0,0,0,0
2y,2y,2y,2y,2y,41,3y,3z,3y,3z,41,2y,0,0,0,0
3x,3x,3x,3x,3x,3z,40,42,40,42,41,2y,0,0,0,0
3x,3x,3x,3x,3x,3x,3z,3y,3z,3y,3z,2y,0,0,0,0
2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,0,0,0,0
NAME museum.4
EXT 0,13 s 15,13 FX slide_l
EXT 0,14 s 15,14 FX slide_l
EXT 7,10 y 7,10 FX tunnel
EXT 8,10 y 8,10 FX tunnel
PAL 0

ROOM u
d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3
d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3
d3,0,0,0,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,0
0,0,0,0,0,0,d3,d3,0,0,0,0,d3,d3,d3,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,cg,cf,0,0,0,0,0,0,0,0,0,0,0,0
0,0,cd,ce,0,0,0,0,0,0,0,0,ck,cj,0,0
0,0,cg,cf,0,0,0,0,0,0,0,0,ch,ci,0,0
0,0,cd,ce,0,0,0,cv,cu,0,0,0,ch,ci,0,0
0,0,cg,cf,0,0,0,cs,ct,0,0,0,ch,ci,0,0
0,0,cd,ce,0,0,0,cs,ct,0,0,0,ch,ci,0,0
2y,2y,d9,cc,2y,2y,2y,cq,cr,2y,2y,2y,d9,cc,2y,2y
3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x
3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x
2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y
NAME museum.5
EXT 7,12 s 12,12 FX tunnel
EXT 8,12 s 13,12 FX tunnel
EXT 15,13 v 0,13 FX slide_r
EXT 15,14 v 0,14 FX slide_r
EXT 0,13 w 15,13 FX slide_l
EXT 0,14 w 15,14 FX slide_l
PAL 0

ROOM v
d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3
d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3
0,0,d3,0,0,0,0,d3,d3,0,0,0,0,d3,d3,0
0,0,0,0,0,0,0,0,0,d3,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,cz,d4,d4,d4,d4,d4,d4,d4,d4,d4,d4,d0,0,0
0,0,d6,d8,d8,d8,d8,d8,d8,d8,d8,d8,d8,d7,0,0
0,0,cx,d5,d5,d5,d5,d5,d5,d5,d5,d5,d5,cy,0,0
2y,2y,2y,2y,2y,0,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y
3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,3x,42,2y,0
3x,3x,3x,3x,3x,3x,da,db,db,dc,3x,3x,3x,3z,2y,0
2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y
NAME museum.6
ITM d 10,14
EXT 0,13 u 15,13 FX slide_l
EXT 0,14 u 15,14 FX slide_l
PAL 0

ROOM w
d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3,d3
d3,0,0,d3,0,d3,d3,0,d3,d3,0,d3,d3,0,d3,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,dl,dk,0,0,0,0,0,0,0,0,dh,dg,0,0
0,0,dj,di,0,0,5d,5f,5f,55,0,0,de,df,0,0
0,2y,d9,cc,0,5d,5a,5g,5g,52,55,0,d9,cc,2y,0
0,2y,40,3x,42,5c,5c,dp,dd,54,54,40,3x,42,2y,0
0,2y,41,9v,41,5c,5a,dy,dz,52,54,41,9v,41,2y,0
0,2y,41,40,3z,5a,5g,5g,5g,5g,52,3y,42,41,2y,0
0,2y,41,3y,42,5c,0,0,0,0,54,40,3z,41,2y,0
0,2y,41,40,3z,5c,0,cv,cu,0,54,3y,42,41,2y,0
0,2y,41,3y,42,5c,0,cs,ct,0,54,40,3z,41,2y,0
0,2y,41,40,3z,5a,5g,cq,cr,5g,52,3y,42,41,2y,2y
0,2y,41,3y,3x,3x,3x,42,40,3x,3x,3x,3z,41,40,3x
0,2y,3y,3x,3x,3x,3x,3z,3y,3x,3x,3x,3x,3z,3y,3x
0,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y
NAME museum.7
EXT 15,13 u 0,13 FX slide_r
EXT 15,14 u 0,14 FX slide_r
EXT 7,12 x 7,13 FX tunnel
EXT 8,12 x 8,13 FX tunnel
PAL 0

ROOM x
0,0,0,0,0,0,0,0,2z,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,2q,0,0,0
0,0,0,0,2q,0,0,0,2q,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2z
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,5n,5g,5g,5g,5g,5g,5g,5o,0,0,0,0
0,0,2q,0,54,0,0,0,0,0,0,5c,0,0,0,0
0,2z,0,0,54,0,0,0,0,0,0,5c,0,2q,0,0
0,0,0,0,54,2y,0,0,0,0,2y,5c,0,0,0,0
0,0,0,0,54,40,3x,42,40,3x,42,5c,0,0,0,0
0,0,2q,0,54,3y,da,db,db,dc,3z,5c,0,0,0,0
0,0,2z,0,54,40,42,40,42,40,42,5c,0,0,0,2z
0,0,0,0,54,da,dc,3y,3z,da,dc,5c,0,0,0,0
0,0,0,0,5l,5f,55,5k,5k,5d,5f,5m,0,0,0,0
0,0,0,0,0,0,5l,5f,5f,5m,0,0,2q,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME museum.8
EXT 7,13 w 7,12 FX tunnel
EXT 8,13 w 8,12 FX tunnel
PAL 2

ROOM y
0,0,0,0,0,2q,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,2z,0,0,0,2z
2q,0,0,0,2z,0,0,0,0,0,2q,0,0,0,0,0
0,0,0,0,0,0,0,0,0,2z,0,0,0,0,0,0
0,2z,0,0,0,0,0,0,0,0,0,0,0,0,2q,0
0,0,0,0,0,2q,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,cv,cu,0,0,0,cv,cu,0,0,0,cv,cu,0,0
0,0,cs,ct,0,0,0,cs,ct,0,0,0,cs,ct,0,0
0,0,cs,ct,0,0,0,cs,ct,0,0,0,cs,ct,0,0
0,2y,cq,cr,2y,2y,2y,d2,d1,2y,2y,2y,cq,cr,2y,0
0,2y,40,42,9v,40,42,40,42,40,42,9v,40,42,2y,0
2y,2y,41,41,9v,41,3y,3z,3y,3z,41,9v,41,41,2y,0
0,2y,41,3y,3x,3z,40,42,40,42,3y,3x,3z,41,2y,0
0,2y,3y,3x,3x,3x,3z,3y,3z,3y,3x,3x,3x,3z,2y,0
2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,2y,0
NAME museum.9
EXT 7,10 t 7,10 FX tunnel
EXT 8,10 t 8,10 FX tunnel
EXT 12,10 z 7,2 FX tunnel
EXT 13,10 z 8,2 FX tunnel
EXT 2,10 11 7,12 FX tunnel
EXT 3,10 11 8,12 FX tunnel
PAL 0

ROOM z
0,0,0,0,0,0,0,cv,cu,0,0,0,0,0,0,0
0,0,0,0,0,0,0,cs,ct,0,0,0,0,es,0,0
5g,5g,5g,5g,5g,5g,5g,cq,cr,5g,5g,5g,5g,er,5g,5g
0,2w,0,0,0,2y,40,3x,3x,42,2y,0,2y,9v,2y,2y
2y,0,0,2w,2y,2y,3y,3x,3x,3z,2y,2x,2y,9v,9v,9v
2y,40,3x,42,2y,0,do,do,do,40,42,2y,2y,do,do,do
2y,41,9v,41,2y,2w,0,0,2y,3y,3z,2y,0,2x,0,2q
2y,3y,3x,3z,2y,2y,2y,2y,2y,9v,do,2w,0,0,0,2x
2y,9v,do,do,2x,40,42,2y,40,3x,42,2y,2y,0,0,0
2y,40,42,9v,40,3z,41,9v,3y,3x,3z,40,42,2y,2y,2y
2w,3y,3z,do,3y,3x,3z,do,do,do,do,3y,3z,40,3x,3x
0,do,do,0,do,do,40,3x,42,2y,40,42,do,3y,3x,3x
0,2z,0,0,0,2y,3y,3x,3z,9v,41,41,2y,do,do,do
0,0,2w,0,0,0,do,do,do,do,3y,3z,2y,0,0,0
0,0,0,0,0,0,0,2x,0,0,do,do,0,2x,0,0
0,0,0,0,2w,0,0,0,0,0,0,0,0,0,0,0
NAME museum.10
EXT 7,2 y 12,10 FX tunnel
EXT 8,2 y 13,10 FX tunnel
EXT 15,10 10 0,10 FX slide_r
EXT 15,11 10 0,11 FX slide_r
EXT 15,4 10 0,4 FX slide_r
EXT 13,2 14 6,12 FX tunnel DLG 2j
PAL 0

ROOM 1a
84,0,fb,36,fb,fa,fb,9c,9c,fb,fb,fa,35,35,fb,84
84,0,fa,fb,fa,fb,fa,0,84,fa,fa,36,fb,36,fa,fb
36,fb,fb,fa,37,fa,36,0,0,0,0,0,fa,fb,84,fa
fb,fa,fa,33,0,84,0,0,0,0,0,84,0,fa,36,fb
fa,84,33,36,0,0,a7,a7,a7,a7,a7,a7,0,37,fb,fa
fb,35,0,0,0,a6,a9,a9,a9,g8,a9,a9,a5,0,fa,fb
fa,fb,0,84,a6,ap,a5,a7,a7,a7,g9,2y,a5,0,0,fa
84,fa,fb,0,a6,ap,a6,g8,a9,a9,a5,g9,a5,0,84,9c
0,36,fa,0,a6,g9,a6,0,g9,g9,a5,g9,a5,0,0,9c
84,fb,35,0,a6,2y,a6,a7,a7,a7,a5,2y,a5,84,0,fb
36,fa,0,0,a6,2y,g9,2y,g9,2y,2y,g9,a5,0,0,fa
fb,0,84,fb,0,a2,a2,a2,a2,a2,a2,a2,0,0,0,fb
fa,35,0,fa,0,0,0,84,0,0,84,0,0,0,0,fa
36,fb,0,0,0,0,0,0,0,0,0,0,fb,0,fb,35
84,fa,fb,35,fb,0,fb,0,0,0,0,fb,fa,36,fa,36
35,84,fa,fb,fa,36,fa,9c,9c,0,36,fa,84,fb,36,fb
NAME island5.6
ITM e 4,7
EXT 7,0 17 7,15 FX slide_u
EXT 8,0 17 8,15 FX slide_u
EXT 15,7 17 0,7 FX slide_r
EXT 15,8 17 0,8 FX slide_r
EXT 7,15 17 7,0 FX slide_d
EXT 8,15 17 8,0 FX slide_d
PAL 0

ROOM 1b
35,84,84,35,fb,fa,fb,9c,9c,fb,fb,37,84,fb,fb,36
fb,35,fb,84,fa,36,fa,0,0,fa,fa,fb,fb,fa,fa,fb
fa,36,fa,fb,35,0,0,84,0,0,84,fa,fa,36,84,fa
36,84,fb,fa,fb,36,0,0,0,0,0,0,84,35,fb,36
84,fb,fa,84,fa,0,0,0,84,0,84,0,0,37,fa,fb
37,fa,0,0,0,0,0,84,0,0,0,0,0,fb,84,fa
fb,84,fb,fb,0,0,0,0,84,0,84,0,0,fa,fb,84
fa,36,fa,fa,0,0,0,0,0,0,0,0,0,84,fa,fb
36,fb,0,0,36,fb,0,0,0,84,0,fb,0,fb,84,fa
84,fa,fb,84,0,fa,36,0,0,0,0,fa,84,fa,fb,35
fb,84,fa,fb,0,84,0,0,84,0,0,84,0,0,fa,fb
fa,36,84,fa,0,0,0,0,0,0,34,37,0,0,84,fa
35,35,fb,36,fb,0,0,0,84,0,84,0,0,0,fb,84
84,fb,fa,fb,fa,0,0,0,0,0,0,0,0,0,fa,fb
fb,fa,84,fa,84,fb,0,84,0,0,0,0,0,fb,34,fa
fa,84,37,35,36,fa,84,9c,9c,0,fb,fb,fb,fa,84,fb
NAME island5.7
EXT 7,0 15 7,15 FX slide_u
EXT 8,0 15 8,15 FX slide_u
EXT 7,15 1a 7,0 FX slide_d
EXT 8,15 1a 8,0 FX slide_d
PAL 0

ROOM 1c
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,2q,0,0,2z,0
0,0,0,2q,0,0,2z,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,2q,0,0,0,2y,2y,0,0,0,2q
0,0,0,0,0,0,0,0,0,2y,fi,fj,2y,0,0,0
0,0,0,0,0,0,0,0,0,2y,fi,fj,2y,0,0,0
0,0,2z,0,0,0,0,0,0,0,2y,2y,0,0,0,0
0,0,0,0,0,0,2q,0,0,0,0,0,0,0,0,2z
0,0,0,0,0,0,0,0,0,0,2z,0,0,0,0,0
0,2q,0,0,0,0,0,0,0,0,0,0,2q,0,0,0
0,0,0,0,0,0,0,0,2q,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,2q,0,0,0,0,2z,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,2z,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME wigwam
ITM h 11,5
EXT 10,6 18 10,6 FX tunnel
PAL 0

ROOM 1d
0,3r,3p,0,jr,js,0,0,0,0,0,3r,3p,3q,3r,3p
2q,0,0,jp,jq,jl,jk,0,0,0,0,0,3r,3p,0,3r
0,0,0,jo,jt,ju,ji,0,0,0,0,0,0,3t,0,0
0,0,0,jn,jw,jw,jh,0,2z,0,0,2w,0,2y,2y,ix
0,a,jj,jm,jx,jy,jg,jc,0,0,0,2y,2x,2g,2y,0
0,0,j0,jf,je,jf,je,7z,0,0,2w,2f,2i,2k,2y,0
0,0,j9,k0,jz,ja,jd,jb,0,2x,2f,37,2m,2s,0,0
0,0,j0,5h,6j,6k,2y,7z,2w,2f,0,32,2k,2x,0,2z
0,0,80,6m,6h,6i,6l,iy,2f,35,32,2m,2s,0,0,0
0,2y,j0,j5,j3,j4,j8,7z,36,0,36,2k,2x,0,0,0
2y,2f,80,0,j7,j6,5i,7z,36,32,2k,2s,0,0,0,0
2i,36,j0,5j,b0,b1,5j,iy,36,2k,2s,2w,0,0,2w,0
36,35,iz,7x,ay,az,7x,7y,2k,2s,2w,0,0,0,2y,2y
0,36,37,0,j2,j1,37,2m,2s,2w,2y,2w,2x,2x,2f,2i
9c,0,37,35,j2,j1,35,2k,2w,2x,2f,2i,2i,2i,36,9c
0,35,9c,0,0,0,2k,2s,2x,2f,9c,gd,ge,ge,ge,ge
NAME island6.1
EXT 10,15 1g 10,0 FX slide_d
EXT 15,14 1e 0,14 FX slide_r
EXT 2,15 1g 2,0 FX slide_d
EXT 4,12 1s 7,12 FX tunnel
EXT 5,12 1s 8,12 FX tunnel
EXT 0,14 1w 15,14 FX slide_l
PAL 0

ROOM 1e
3p,3t,0,2x,2y,2y,8f,4v,8g,2y,0,0,2y,2y,3r,3p
3p,3q,0,0,2y,2f,8f,4v,8g,2j,2y,2x,2g,2y,2q,3p
3r,3p,0,0,2y,2h,2v,4v,2s,2m,2x,2f,2m,2y,0,3r
0,0,2x,0,2y,2d,84,2e,61,gc,2i,37,2m,2x,0,0
0,0,0,2y,2x,2h,74,2y,4v,8g,35,35,37,2j,2w,3s
0,0,2x,2f,2i,8f,gb,2y,4v,8g,8t,36,35,2m,2y,3r
0,2x,2f,35,36,8f,gb,2y,4v,8g,8g,37,36,2k,2y,0
2x,2f,36,36,gd,8f,gb,8e,4v,8g,8g,37,2k,2s,0,0
2y,2h,35,gf,84,2v,gb,8d,4v,2s,gc,2m,2s,2x,0,2w
2x,2d,37,8f,2h,fb,75,84,84,2k,8g,2m,2x,0,0,0
0,2v,2h,2t,2h,fa,84,84,2k,8g,2s,2m,2w,0,2z,0
2x,2f,37,gd,84,2e,2e,2k,8g,2s,36,2k,2y,0,0,0
2f,36,gd,84,2k,2y,8e,8g,2s,37,2k,2s,2w,0,0,0
35,gd,84,2m,8g,2r,8d,2s,35,2k,2s,2x,0,0,0,0
9c,8f,84,2k,2s,36,36,36,2k,2s,2x,0,2z,0,0,2x
ge,9c,2m,8g,37,35,2e,2k,2s,2x,2w,0,0,0,0,0
NAME island6.2
EXT 0,14 1d 15,14 FX slide_l
EXT 4,6 1e 10,4
EXT 10,4 1e 4,6
EXT 4,5 1e 10,3
EXT 10,3 1e 4,5
EXT 6,13 1h 6,13 FX tunnel
PAL 0

ROOM 1f
0,2e,gc,2s,2e,2k,0,0,0,0,0,0,0,0,0,0
gc,0,8g,2m,2r,2s,2x,0,0,0,0,0,0,0,2w,0
8g,2r,2s,0,2j,2w,2y,2y,2y,2y,2z,0,0,0,0,0
2s,0,0,0,8z,7h,7h,7h,7h,90,2y,0,0,0,0,0
0,0,0,0,2k,7u,7u,7u,7u,3m,2x,0,0,0,0,0
9c,0,0,2k,2s,2x,0,0,0,3o,0,0,0,2z,0,0
0,2e,2k,2s,2w,0,0,2q,0,0,0,0,0,0,0,0
2k,2r,2s,2x,0,0,0,0,0,0,0,0,0,0,0,0
2s,2w,2w,2x,0,0,0,0,0,0,77,0,0,0,0,0
2x,2x,0,0,0,0,0,0,0,2q,76,2q,0,0,2x,0
0,0,0,0,0,0,0,0,0,0,2z,0,0,0,0,0
0,0,0,0,0,2x,0,0,0,0,0,3s,0,0,0,0
0,0,0,0,0,0,2z,0,0,0,3s,3t,0,0,0,0
0,0,0,0,0,0,0,3s,0,0,3p,3q,3s,3t,2q,0
0,0,0,2z,0,0,0,3p,3q,0,3r,3p,3p,3q,0,0
0,0,0,0,0,0,3s,3p,3p,0,0,0,3r,3p,3q,0
NAME island6.3
EXT 0,5 1g 15,5 FX slide_l
EXT 8,3 0 10,12 FX tunnel
PAL 0

ROOM 1g
2e,0,9c,0,2e,gh,2w,2x,2x,2h,9c,8f,0,0,fb,9c
2r,2h,0,2k,2r,3a,2x,2f,2i,37,gd,0,0,fb,fa,0
2x,2d,2k,2s,2x,3a,2i,36,0,gd,84,84,84,fa,84,2k
2w,2v,2s,2x,2f,gg,gd,ge,ge,84,2n,8c,2l,84,2m,2m
0,2x,2f,2i,0,0,8x,2e,84,84,8f,8e,8g,84,2m,2s
2y,2n,0,37,0,0,8f,0,2d,84,2v,8d,2s,84,2k,9c
2w,2t,2d,2e,0,34,2v,2r,8f,2h,fb,84,84,2m,8g,0
0,2w,2v,2r,2d,2e,0,0,2v,2h,fa,84,84,2k,2s,0
0,0,2x,2w,2v,2r,2d,0,0,8x,2e,84,2m,8g,0,2m
0,0,0,0,2x,2w,2v,2h,0,8f,0,2h,2m,2s,0,2m
0,0,0,0,0,2x,2y,2h,0,2v,2r,2h,8g,0,0,2k
3q,0,0,0,2w,2x,2y,2h,34,0,0,8x,gc,0,2m,2s
3p,3q,0,0,0,0,2x,2d,0,0,0,8f,8g,0,2k,2x
3p,3p,0,0,0,0,2x,2v,2d,0,0,2v,2s,2m,2s,2x
3r,3p,0,0,0,0,0,2w,2v,2d,0,0,2e,2k,2w,0
0,3r,3q,0,0,0,0,0,2w,2v,2d,2k,2r,2s,2x,0
NAME island6.4
EXT 15,5 1f 0,5 FX slide_r
EXT 10,0 1d 10,15 FX slide_u
EXT 2,0 1d 2,15 FX slide_u
PAL 0

ROOM 1h
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,gi,0,2z,0,0,0,0,0,0,0
0,0,2z,0,0,0,0,0,0,0,0,gi,0,2q,0,0
0,0,0,0,0,0,a9,a9,a9,a9,0,0,0,0,2z,0
0,0,0,0,0,ac,0,0,3p,a6,ae,0,0,0,0,0
0,gi,0,0,ac,ab,gm,0,3p,a6,0,aa,0,0,gi,0
0,0,2q,ab,a3,ab,a0,2y,3p,ab,ae,aa,0,2q,0,0
0,0,0,ab,2y,a3,a2,3r,3p,3t,a4,aa,0,0,0,0
0,0,0,ab,a3,0,0,an,0,3s,3p,aa,0,0,2z,0
0,0,0,ac,a5,an,0,0,0,3r,3p,aa,gi,0,0,0
0,0,ac,2y,a5,0,0,3s,3p,0,ac,0,0,0,0,0
0,ac,0,ac,a5,0,0,3r,3t,ac,0,0,0,0,0,0
ab,ac,2y,a3,0,an,0,0,ac,0,0,0,0,0,2q,0
ab,2y,a3,0,0,0,5k,ac,0,0,0,0,2q,0,0,0
ab,a3,an,0,ac,ap,ap,0,0,0,gi,0,0,0,0,0
ab,0,9c,0,aa,0,0,0,0,0,0,0,0,0,0,0
NAME cave1.1
EXT 6,13 1e 6,13 FX tunnel
EXT 2,15 1i 2,0 FX slide_d
EXT 6,6 1l 6,6 FX tunnel
PAL 3

ROOM 1i
ac,a5,9c,0,aa,0,0,gi,0,0,0,0,0,2q,0,0
2y,a5,0,0,aa,0,0,0,0,0,3s,3q,0,0,0,3s
2y,a5,0,ac,0,0,0,0,2q,0,3p,3t,0,gi,3s,3p
a3,0,0,aa,0,0,0,0,0,3s,3p,0,0,0,3p,3p
9c,0,ac,0,2q,0,0,0,0,3p,3t,0,0,3s,3p,3p
ac,ap,0,0,0,0,0,0,3s,3t,0,0,3s,3p,3p,3p
0,0,0,0,0,gi,0,3s,3p,0,0,3s,3p,3p,3p,3p
0,0,2q,0,0,0,0,3r,3t,0,3s,3p,3p,3p,3t,0
0,0,0,0,0,2q,0,0,0,3s,3p,3p,3p,3t,0,0
0,gi,0,0,0,0,0,0,3s,3p,3p,3p,3t,gi,0,3s
0,0,0,2q,0,0,0,3s,3p,3p,3p,3t,0,0,0,3p
3q,0,0,0,0,0,3s,3p,3p,3p,3t,0,2q,0,3s,3p
3p,3p,3p,3q,0,3s,3p,3p,3p,3p,3q,gi,0,3s,3p,3p
0,3r,3p,3p,3p,3p,3p,3t,0,3p,3p,3q,0,3r,3t,0
0,0,3r,3p,3p,3t,0,0,gi,3r,3p,3p,3q,0,0,2q
0,2q,3s,3p,3t,3s,3p,3p,3q,0,3r,3p,3p,3p,3q,0
NAME cave1.2
EXT 2,0 1h 2,15 FX slide_u
EXT 0,4 1j 15,4 FX slide_l
PAL 3

ROOM 1j
0,0,3r,3p,0,2z,3r,3p,3t,0,2q,a7,a7,a7,a7,a9
2z,0,0,3r,3q,0,0,3t,0,gi,a3,a5,3p,3p,a9,a9
0,0,0,3s,3p,0,0,a7,a7,a3,a3,a5,3p,3p,0,0
0,3s,3p,3p,3t,0,a3,0,ab,a3,2y,aa,3p,3p,0,a9
3s,3p,3p,3t,0,a6,ab,9z,ab,2y,a3,3r,3p,3p,3t,9c
3p,3p,3p,0,2q,a6,ab,a0,ab,a3,0,0,0,0,an,0
3p,3t,3r,3q,0,ab,a3,a2,a2,0,0,gl,0,0,0,ac
3p,0,2z,3r,0,0,ae,0,0,an,3s,4v,3q,0,0,aa
3p,3q,0,0,0,gi,0,ap,ae,0,3p,4v,3p,an,0,aa
3p,3p,3p,3q,0,0,3s,0,ab,0,3r,0,3t,0,ac,2q
3r,3p,3p,3p,3p,3p,3t,0,ab,0,0,an,0,0,aa,gi
0,3r,3p,3p,3t,0,0,0,0,ae,a7,0,0,ac,0,3s
0,2q,3r,3p,3q,0,0,2q,0,0,ab,0,0,aa,0,3p
0,0,0,3p,3p,3p,3q,0,0,0,ab,0,an,aa,3s,3t
gi,0,0,3r,3p,3r,3p,0,0,gi,0,ae,ac,0,3p,0
0,0,0,0,3p,3q,3r,3q,0,0,0,2z,0,3s,3p,0
NAME cave1.3
EXT 15,4 1i 0,4 FX slide_r
EXT 7,5 1m 3,7 FX tunnel
EXT 11,7 1o 11,5 FX tunnel
PAL 3

ROOM 1k
3p,3p,3p,3t,0,gi,0,0,2y,4v,2y,3r,3p,3p,3p,3p
3p,3p,3t,0,0,0,0,0,gp,4v,2y,0,0,3r,3p,3p
3p,3t,0,0,0,2y,2y,2y,2y,4v,2y,0,gi,0,3r,3p
3p,0,gp,0,2y,2f,gn,gn,gn,gq,2j,2y,0,gp,0,3p
3t,0,0,2y,2f,2k,2r,2r,2r,2r,2d,2j,2y,2y,0,3p
0,gi,2y,2f,2k,2s,2y,2y,2y,gp,2v,2d,2j,2y,0,3r
0,2y,2f,2k,2s,2y,2f,gn,gn,2j,2y,2v,74,2y,0,0
gp,2y,go,2s,2y,2f,2k,2r,2r,2d,2j,2y,75,0,72,gp
0,2y,go,gp,2y,go,2s,gp,0,2v,2d,2j,2y,0,73,0
gi,2y,go,2y,gp,2d,2j,gs,gr,2g,2v,go,2y,gp,0,gi
0,2y,2d,2j,2y,2v,2d,gn,gn,2k,2y,go,2y,0,0,0
gp,0,2v,2d,2j,2y,2v,2r,2r,2s,2f,2k,gp,gi,0,3s
0,0,gp,2v,2d,2j,2y,2y,gp,2f,2k,2s,0,0,0,3p
3q,0,0,0,2v,2d,gn,gn,gn,2k,2s,0,0,0,3s,3p
3p,3p,3q,0,0,2v,2r,2r,2r,2s,0,0,3s,3p,3p,3p
3p,3p,3p,3q,0,gp,0,0,gi,0,gp,3s,3p,3p,3p,3p
NAME curse shrine.2
EXT 9,0 1l 9,15 FX slide_u
PAL 3

ROOM 1l
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,a2,a2,a2,a2,gv,gu,0,0,a2,a2,0,a2,0,a2,a2
0,0,0,0,0,gw,gx,0,0,gt,0,0,0,gt,0,0
0,0,gt,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,a2,0,a2,a2,0,gm,0,a2,0,a2,a2,gt,0,a2,a2
0,gv,gu,0,0,2y,a0,2y,0,0,0,0,0,0,0,0
0,gw,gx,0,hz,7h,7h,i0,0,0,0,0,0,0,gt,0
a2,a2,0,a2,2y,4v,2y,0,a2,gv,gu,0,a2,a2,0,a2
0,0,0,0,2y,4v,2y,0,0,gw,gx,0,0,0,gv,gu
0,0,gt,0,2y,4v,2y,0,0,0,0,0,0,0,gw,gx
a2,0,a2,ap,2y,4v,2y,ap,ap,2y,ap,2y,2y,ap,0,a2
0,0,0,2y,7i,7h,7h,7h,7h,7h,7h,gy,7h,90,0,0
0,gt,0,a9,a9,a9,a9,a9,a9,4v,a9,a9,a9,a9,0,0
a9,a9,3s,3p,3t,gp,0,0,2y,4v,3r,3p,3p,3p,3q,a9
3p,3p,3p,3p,0,0,0,gp,2y,4v,2y,3p,3p,3p,3p,3p
NAME curse shrine.1
EXT 9,15 1k 9,0 FX slide_d
EXT 6,6 1h 6,6 FX tunnel
PAL 3

ROOM 1m
0,0,0,2q,0,0,0,0,0,0,0,0,0,2q,0,0
0,0,0,0,0,0,2q,0,0,0,2z,0,0,0,0,0
0,2z,0,0,0,0,0,0,0,0,0,2q,0,0,2z,0
0,0,a9,a9,a9,a9,a9,a9,a9,a9,a9,a9,a9,a9,a9,a9
0,ac,aa,0,0,0,0,0,0,0,0,0,0,0,0,0
ab,0,aa,a2,a2,h6,h5,h4,0,h8,ha,h9,a2,hh,ho,hn
ab,0,aa,9z,a2,h2,h7,h3,0,he,hg,hb,0,hi,hp,hm
ab,ac,aa,a0,0,gz,h0,h1,a2,hd,hf,hc,0,hk,hj,hl
ab,a3,a2,a2,a2,fi,3x,fj,a2,fi,3x,fj,a2,fi,3x,fj
ab,0,0,an,0,0,0,0,0,0,0,0,0,0,an,9c
ab,0,0,0,0,0,0,0,0,0,an,0,0,0,0,9c
0,ae,0,0,0,0,an,0,0,0,0,0,0,0,0,0
0,0,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap,ap
2z,0,0,0,0,0,2z,0,0,0,0,2q,0,0,2z,0
0,0,0,2q,0,0,0,0,2z,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,2q,0
NAME hall of history.1
EXT 3,7 1j 7,5 FX tunnel
EXT 15,9 1n 0,9 FX slide_r
EXT 15,10 1n 0,10 FX slide_r
PAL 3

ROOM 1n
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,2z,0,0,0,0,0,0,0,2z,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
a9,a9,a9,a9,a9,a9,a9,a9,0,0,2q,0,0,0,0,0
0,0,0,0,0,a9,a9,ab,a4,0,0,0,0,0,2z,0
0,hw,hs,hr,a9,a9,0,a6,0,aa,0,0,0,0,0,0
a7,hx,hy,ht,0,a9,0,ab,a4,aa,0,0,0,0,0,0
2y,hu,hv,hq,2y,2y,2y,ab,2y,aa,0,0,0,0,0,0
a2,fi,3x,fj,a2,a2,a2,a2,a4,aa,0,0,0,0,0,0
9c,0,0,0,0,an,0,0,0,aa,0,0,0,2z,0,0
9c,0,0,0,0,0,0,0,0,aa,0,0,0,0,0,0
0,0,0,an,0,0,0,0,ac,0,2q,0,0,0,0,0
ap,ap,ap,ap,ap,ap,ap,ap,0,0,0,0,0,0,0,0
0,2q,0,0,0,0,0,0,0,0,0,0,0,2q,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,2q,0,0,0,0,0,0,0,0,0,0
NAME hall of history.2
EXT 0,9 1m 15,9 FX slide_l
EXT 0,10 1m 15,10 FX slide_l
PAL 3

ROOM 1o
2e,0,9c,0,2e,gh,2w,2x,2x,2h,i3,2h,0,0,fb,9c
2r,2h,0,2k,2r,3a,2x,2f,2i,i4,2f,0,0,fb,fa,0
2x,2d,2k,2s,2x,3a,ge,i5,2y,2f,84,84,84,fa,84,2k
2w,2v,2s,2x,2f,i2,2f,2i,2i,84,gf,8c,i1,84,2m,8g
0,2x,2f,2i,0,2y,2d,2e,84,84,8f,8e,8g,84,2m,2s
2y,2n,0,37,0,0,8f,0,2d,84,2v,8d,2s,84,2k,i3
2w,2t,2d,2e,0,34,2v,2r,8f,2h,fb,84,84,2m,8g,0
0,2w,2v,2r,2d,2e,0,0,2v,2h,fa,84,84,2k,2s,0
0,0,2x,2w,2v,2r,2d,0,2y,2d,2e,84,2m,8g,0,2m
0,0,0,0,2x,2w,2v,2h,0,8f,0,2h,2m,2s,0,2m
0,0,0,0,0,2x,2y,2h,0,2v,2r,2h,2m,2y,0,2k
3q,0,0,0,2w,2x,2y,2h,34,0,2y,2d,2k,2y,2m,2s
3p,3q,0,0,0,0,2x,2d,0,0,0,8f,8g,0,2k,2x
3p,3p,0,0,0,0,2x,2v,2d,0,0,2v,2s,2m,2s,2x
3r,3p,0,0,0,0,0,2w,2v,2d,0,0,2e,2k,2w,0
0,3r,3q,0,0,0,0,0,2w,2v,2d,2k,2r,2s,2x,0
NAME island6up.1
EXT 11,5 1j 11,7 FX tunnel
EXT 15,0 1p 1,15 FX tunnel
PAL 0

ROOM 1p
3p,3t,0,2x,2y,2y,8f,4v,8g,2y,0,0,2y,2y,3r,3p
3p,3q,0,0,2y,2f,8f,4v,8g,2j,2y,2x,2g,2y,2q,3p
3r,3p,0,0,2y,2h,2v,4v,2s,2m,2x,2f,2m,2y,0,3r
0,0,2x,0,2y,2d,84,2e,61,2k,ge,37,2m,2x,0,0
0,0,0,2y,2x,8f,74,2y,4v,8g,35,35,37,2j,2w,3s
0,0,2x,2f,2i,8f,gb,2y,4v,8g,8t,36,35,2m,2y,3r
0,2x,2f,35,i5,8f,gb,2y,4v,8g,8g,37,36,2k,2y,0
2x,2f,36,i5,2f,8f,gb,8e,4v,8g,8g,37,2k,2s,0,0
2y,2h,i6,2n,84,2v,gb,8d,4v,2s,gc,2m,2s,2x,0,2w
2x,2d,37,8f,2h,fb,75,84,84,2k,8g,2m,2x,0,0,0
0,2v,2h,2t,2h,fa,84,84,2k,8g,2s,2m,2w,0,2z,0
2x,2f,i4,2f,84,2e,2e,2k,8g,2s,36,2k,2y,0,0,0
2f,i5,2f,84,2k,2y,8e,8g,2s,37,2k,2s,2w,0,0,0
i6,2f,84,2m,8g,2r,8d,2s,35,2k,2s,2x,0,0,0,0
i3,2h,84,2k,2s,36,36,36,2k,2s,2x,0,2z,0,0,2x
2i,9c,2m,8g,37,35,2e,2k,2s,2x,2w,0,0,0,0,0
NAME island6up.2
EXT 1,15 1o 15,0 FX tunnel
EXT 7,8 1q 7,8 FX tunnel
EXT 7,0 1r 7,15 FX slide_u
PAL 0

ROOM 1q
0,gi,0,0,0,3s,3p,3p,3p,3q,0,0,0,0,0,0
0,0,0,3s,3p,3p,3t,2z,3r,3p,3q,3s,3p,0,gi,0
0,2q,0,3p,3t,0,a7,a7,a7,3r,3p,3p,3t,0,0,0
0,0,0,3p,0,a3,aa,0,ab,a4,3r,3p,3q,0,0,2q
0,0,0,3p,ab,0,aa,0,ab,0,aa,3p,3t,gi,0,0
0,3s,3p,3p,ab,2y,aa,2y,ab,2y,aa,3p,3q,0,0,0
0,3p,3p,3t,ab,a3,a2,a2,a2,a4,aa,3r,3p,0,0,0
0,3p,3p,0,ab,0,0,0,0,0,aa,0,3p,0,2q,0
0,3r,3p,3q,0,ae,0,5k,0,ac,0,3s,3p,0,0,0
0,0,3r,3p,3q,0,ap,ap,ap,0,3s,3p,3t,0,0,0
2z,0,0,3p,3p,3q,0,gi,2q,0,3p,3p,0,0,0,2z
0,0,0,3p,3t,3r,3p,3q,0,3s,3p,3p,0,0,0,0
0,0,0,3r,0,0,3r,3p,3p,3p,3p,3t,0,2q,0,gi
0,gi,0,0,0,0,0,3p,3p,3t,0,0,0,3s,3q,0
0,3s,3q,0,2z,0,0,3r,3p,0,0,0,0,3p,3p,0
3s,3p,3p,0,0,0,3s,3p,3t,0,0,3s,3p,3p,3p,3q
NAME cave1.4
EXT 7,8 1p 7,8 FX tunnel
PAL 3

ROOM 1r
0,3s,3p,3p,3t,0,0,3r,3p,3p,2z,3r,3p,3p,3p,3p
3p,3p,3t,2q,0,0,0,3s,3p,3t,0,0,0,3r,3p,3p
3p,3p,0,0,id,0,0,3p,3p,0,ic,ic,2q,0,0,3p
3p,3t,0,id,id,0,id,3p,0,0,ic,0,ic,0,0,3r
3t,0,0,id,0,0,id,in,ic,ic,0,ic,ic,0,2z,0
3q,0,0,id,id,id,ib,i9,ia,0,ic,0,0,0,0,3s
3p,0,0,0,id,0,id,i8,ic,ic,0,0,2q,0,3s,3p
3t,0,0,2q,0,id,ih,i8,ii,ic,0,0,0,3s,3p,3t
0,2z,0,0,0,2y,ig,i7,ij,2y,0,0,3s,3t,3p,0
0,0,0,0,0,2y,if,ik,ie,2y,2q,0,3p,3q,3r,3q
0,0,0,2z,0,0,8f,4v,8g,0,0,3s,3p,3t,0,0
0,0,0,0,0,0,8f,4v,8g,0,0,3r,3t,0,0,0
0,0,iu,0,0,0,8f,4v,8g,0,0,0,0,0,0,0
6q,ir,is,it,iv,6q,8f,4v,8g,6q,6q,io,ip,6q,iq,6q
0,2x,0,0,0,0,8f,4v,8g,0,0,0,0,2x,0,iw
0,0,0,0,2w,0,8f,4v,8g,0,2w,0,0,0,0,0
NAME volcano
ITM j 6,8
EXT 7,15 1p 7,0 FX slide_d
PAL 3

ROOM 1s
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5h
0,0,0,5w,5u,5u,5u,5u,5u,5u,5u,5u,5t,0,0,0
0,5i,5w,5v,ba,0,6m,6h,6i,6l,0,5z,5s,5t,0,0
0,0,5x,5y,bb,9z,j5,j3,j4,j8,9z,59,5z,5x,0,0
0,0,5x,ba,b8,a0,ki,k1,k2,ki,a0,58,5c,5x,0,0
0,0,5x,b8,kg,kg,bd,ka,kb,bd,kf,kh,58,5x,0,0
0,0,5x,k5,k5,k9,kf,k3,k4,kg,k8,k5,k5,5x,5h,0
0,0,5x,kg,kg,k6,k5,k5,k5,k5,k7,0,fb,5x,0,0
0,0,5x,fb,kc,kd,ke,j2,j1,kc,kd,ke,fa,5x,0,0
5h,0,5x,fa,kc,kd,ke,j2,j1,kc,kd,ke,kf,5x,0,0
0,0,5x,kg,kc,kd,ke,j2,j1,kc,kd,ke,0,5x,0,0
0,0,5s,5t,kg,kg,kg,j2,j1,0,kh,kf,5w,5v,0,5i
0,0,0,5s,5t,0,kf,j2,j1,kh,kh,5w,5v,0,0,0
0,0,5i,0,5s,5u,5u,5u,5u,5u,5u,5v,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5h
0,0,0,0,0,0,0,0,0,0,0,5i,0,0,0,0
NAME chapel.1
EXT 7,12 1d 4,12 FX tunnel
EXT 8,12 1d 5,12 FX tunnel
EXT 5,4 1t 5,11 FX tunnel
EXT 10,4 1t 10,11 FX tunnel
PAL 0

ROOM 1t
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,4x,4x,4x,4x,4x,4x,4x,4x,4x,4x,0,0,0
0,0,0,4x,5w,5u,5u,5u,5u,5u,5u,5t,4x,0,0,0
0,0,0,4x,5x,kj,kk,0,5h,0,5i,5x,4x,0,0,0
0,0,0,4x,5x,km,kl,5j,4g,4f,5j,5x,4x,0,0,0
0,0,0,4x,5x,kj,kk,5g,4h,4e,5g,5x,4x,0,0,0
0,0,0,4x,5x,kj,kk,b5,4x,4x,4x,5x,4x,0,0,0
0,0,0,4x,5x,kj,kk,4x,4x,b5,4x,5x,4x,0,0,0
0,0,0,4x,5x,4x,4x,4x,b5,4x,4x,5x,4x,0,0,0
0,0,0,4x,5x,4x,4x,b5,4x,4x,4x,5x,4x,0,0,0
0,0,0,4x,5x,4x,4x,4x,4x,b5,4x,5x,4x,0,0,0
0,0,0,4x,5x,3l,5w,5u,5u,5t,3l,5x,4x,0,0,0
0,0,0,4x,5s,5u,5v,4x,4x,5s,5u,5v,4x,0,0,0
0,0,0,4x,4x,4x,4x,4x,4x,4x,4x,4x,4x,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME chapel.2
EXT 5,11 1s 5,4 FX tunnel
EXT 10,11 1s 10,4 FX tunnel
EXT 5,5 1u 6,9 FX tunnel
EXT 6,5 1u 6,9 FX tunnel
PAL 0

ROOM 1u
0,0,0,0,5h,0,0,0,0,0,0,0,0,5i,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,5w,5u,5u,5u,5u,5u,5u,5t,0,5h,0,0
0,0,0,5w,5v,kr,ks,0,5h,kr,ks,5s,5t,0,0,0
0,0,5w,5v,bb,kq,kp,b0,b1,kq,kp,59,5s,5t,0,0
5h,0,5x,ba,b8,kn,4g,4f,az,kn,ko,5a,5c,5x,0,0
0,0,5x,b8,84,kz,4h,4e,ky,l1,kt,ku,58,5x,0,0
0,0,5x,l0,kc,kd,ke,l4,84,kx,kw,kv,84,5x,0,0
0,0,5x,84,l3,kt,ku,84,kc,kd,ke,bc,ky,5x,0,0
5i,0,5x,ky,l2,kw,l5,kx,l3,l1,84,bd,84,5x,0,5i
0,0,5x,84,4g,4f,84,l3,kx,kt,ku,ky,kz,5x,0,0
0,0,5s,5t,4h,4e,kx,bc,0,kw,kv,84,5w,5v,0,0
0,0,0,5s,5t,84,l0,bd,84,kx,l4,5w,5v,0,0,0
0,0,0,0,5s,5u,5u,5u,5u,5u,5u,5v,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,5h,0,0
0,0,0,0,0,0,5i,0,0,0,0,0,0,0,0,0
NAME chapel.3
ITM 4 9,12
EXT 6,9 1t 5,5 FX tunnel
EXT 6,9 1t 6,5 FX tunnel
EXT 8,5 1v 8,9 FX tunnel
PAL 0

ROOM 1v
0,2q,3s,3p,3p,3t,jo,jw,jw,ji,0,2q,0,0,0,0
0,0,3p,3p,3t,0,jn,jw,jw,jh,0,0,0,0,2q,0
0,3s,3p,3p,0,0,jr,jw,jw,js,0,0,0,0,0,0
3s,3p,3p,3t,0,jp,jq,l7,l6,jl,jk,2q,0,0,2q,0
3p,3t,0,0,2q,jo,jt,ju,jt,ju,ji,0,0,l0,0,3s
3p,0,2q,l0,0,jn,jw,jw,jw,jw,jh,0,0,0,0,3p
3p,kz,0,0,jj,jm,jy,jx,jy,jx,jg,jc,kz,0,3s,3p
3t,0,0,0,80,kr,ks,5h,0,kr,ks,7z,0,0,3p,3p
0,0,kz,2y,j0,kq,kp,b0,b1,kq,kp,iy,2y,l0,3p,3t
2q,0,2y,40,iz,kn,ko,ay,az,kn,ko,7y,42,3s,3p,0
0,0,2y,41,40,42,40,42,40,42,40,42,41,3p,3p,0
0,0,2y,3y,3z,3y,3z,3y,3z,3y,3z,3y,3z,3p,3t,0
0,0,0,5c,cn,cl,2y,cp,5i,cn,co,2y,7z,3t,0,0
6q,6q,6q,5c,0,cm,5h,6j,6k,0,cp,0,iy,6q,6q,6q
0,0,0,5z,5h,0,6m,6h,6i,6l,0,5i,iy,0,0,a
0,2x,0,5z,0,0,j5,j3,j4,j8,0,0,7z,0,0,0
NAME chapel.4
EXT 8,9 1u 8,5 FX tunnel
PAL 0

ROOM 1w
3p,3t,0,3s,3p,3p,3p,3t,0,0,0,0,0,0,0,0
3p,3s,3p,3p,3p,3t,0,0,0,2x,0,0,0,0,0,0
3p,3p,3t,0,2z,0,0,0,0,0,0,0,0,0,2w,0
3p,3t,0,0,0,0,0,0,0,0,0,2q,0,0,0,0
3p,0,2x,0,0,0,2w,0,0,0,0,0,0,0,0,0
3p,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
3t,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,2z,0,0,2w,0,0,0
0,0,2q,0,0,0,2x,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2x
0,0,0,0,0,2w,0,0,0,0,0,0,0,0,2y,2f
0,0,0,0,0,0,0,0,0,0,0,0,2w,2x,2f,0
0,0,0,0,0,0,0,2q,0,0,0,2y,2f,2i,0,33
0,0,0,0,0,0,0,0,0,0,2x,2f,0,33,32,9c
0,0,0,0,0,0,0,0,0,0,2x,2h,32,36,9c,35
NAME island6.5
EXT 15,14 1d 0,14 FX slide_r
EXT 14,15 1x 14,0 FX slide_d
PAL 0

ROOM 1x
0,0,0,0,0,0,0,0,0,2w,2y,2h,0,0,9c,0
0,0,0,0,0,0,0,0,0,2x,2f,0,0,0,0,2k
0,0,0,0,0,0,0,0,2w,2y,2d,l8,l9,2e,2k,2s
0,2q,0,0,2x,0,0,0,0,2w,2v,2d,2k,2r,2s,2x
0,0,0,0,0,0,0,0,0,0,2w,2v,2s,2w,2x,0
0,0,0,0,0,0,2q,0,0,0,0,0,0,2x,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,2z,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,2x,0,0,0,0,0,0,0
0,0,2w,0,0,0,0,0,0,0,0,0,2z,0,0,0
0,0,0,0,0,2x,0,0,0,0,0,0,2x,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
3q,0,0,0,0,0,0,0,2q,0,0,0,3s,3p,3q,0
3p,3q,0,0,0,0,0,0,0,0,2w,0,3p,3p,3p,0
3p,3p,3q,3s,3p,3p,3q,0,0,0,0,0,3r,3p,3t,0
3r,3p,3p,3p,3p,3p,3p,3p,3q,0,0,0,0,0,0,0
NAME island6.6
ITM m 13,1
EXT 14,0 1w 14,15 FX slide_u
PAL 0

ROOM 1y
0,a5,0,0,a5,ab,4v,aa,a6,0,0,0,a5,2z,0,a5
0,2q,0,0,aj,ai,4v,aa,a6,0,0,0,a5,0,0,0
0,0,0,0,al,ak,4v,aa,a6,0,0,2q,0,0,la,2q
0,a5,0,0,a5,ab,4v,aj,ai,0,0,0,a5,0,0,0
la,0,0,0,a5,ab,4v,al,ak,0,0,0,0,0,0,a5
0,a5,2z,0,aj,ai,4v,aa,a6,0,la,0,0,0,0,0
0,a5,0,0,al,ak,4v,aa,a6,0,0,0,a5,0,0,a5
2q,0,0,0,a5,ab,4v,aj,ai,0,0,0,2z,0,0,a5
0,0,0,0,a5,ab,4v,al,ak,0,0,0,0,la,0,0
0,a5,0,0,aj,ai,4v,aa,a6,0,0,0,a5,0,0,0
0,0,0,0,al,ak,4v,aa,a6,0,0,0,a5,0,2z,0
0,2z,0,0,a5,ab,4v,aj,ai,0,2q,0,0,0,0,0
0,a5,0,0,a5,ab,4v,al,ak,0,0,0,a5,0,0,0
0,a5,la,0,aj,ai,4v,aa,a6,0,la,0,0,0,0,a5
0,2q,0,0,al,ak,4v,aa,a6,0,0,0,0,2z,0,0
0,0,0,0,a5,ab,4v,aj,ai,0,0,0,a5,0,0,la
NAME final.1
EXT 6,0 19 6,8 FX tunnel
EXT 6,15 20 6,0 FX slide_d
PAL 0

ROOM 1z
0,0,la,0,2z,0,0,0,0,0,0,la,0,0,0,0
la,2z,0,0,0,0,0,0,0,2q,0,2z,0,la,2z,0
0,0,la,0,5w,5u,5u,5u,5u,5u,5t,0,0,0,0,0
0,0,2z,5w,5v,0,0,0,0,0,5s,5t,0,2q,la,2q
0,0,5w,5v,ba,0,0,0,0,0,5c,5s,5t,0,0,0
la,5w,5v,ba,ba,5g,0,0,0,5g,5c,5c,5s,5t,0,0
0,5x,ba,ba,li,lc,0,0,0,lc,5a,5c,5c,5x,0,la
0,5x,ba,li,lc,lc,0,0,0,lc,lc,5a,5c,5x,0,0
2z,5x,li,lc,0,lc,ld,lb,37,le,lc,lc,5a,5x,0,0
0,5x,lc,lc,35,le,3s,3p,3p,3q,lc,lc,lc,5x,0,2z
la,5x,lc,36,lc,ld,3p,3p,3p,3t,lc,lc,lc,5x,0,0
0,5x,lc,0,lc,ld,3r,3p,3t,lc,lc,lc,lc,5x,0,la
2q,5x,lc,lc,lc,lc,lc,lc,lc,lc,lc,lc,lc,5x,0,0
0,5s,5t,lc,lc,lf,lg,lg,lg,lh,lc,lc,5w,5v,2z,0
0,2z,5s,5t,lc,lc,lc,lc,lc,lc,lc,5w,5v,0,la,0
0,la,0,5s,5u,5t,lc,lc,lc,5w,5u,5v,0,0,0,0
NAME final.4
EXT 6,15 21 6,0 FX slide_d
EXT 7,15 21 7,0 FX slide_d
EXT 8,15 21 8,0 FX slide_d
PAL 0

ROOM 2a
3p,3p,3p,3t,nt,2y,nu,2y,gp,2y,2y,gp,3r,3p,3p,3p
3p,3p,3t,gi,2y,2f,2i,2i,2i,2i,2j,2y,0,3r,3p,3p
3p,3p,0,2y,2f,0,an,0,0,an,0,2j,2y,gp,0,3r
3p,3p,2y,2f,0,0,0,n8,n6,0,0,0,2j,2y,0,3s
3p,3t,2y,2h,0,0,c4,n7,n5,c4,0,0,2m,2y,gi,3r
3t,gi,2y,2h,an,0,c3,n3,n4,c3,0,an,2m,2y,0,nt
nu,0,gp,2h,0,0,0,nc,nb,0,0,0,2m,2y,gp,gi
gp,0,nt,2h,0,0,0,n9,na,0,0,0,2m,nu,0,0
gi,0,2y,2d,0,0,an,0,0,an,0,0,2k,2y,nt,gp
0,gp,0,8f,2d,0,0,o8,o8,0,0,2k,8g,0,0,3p
3q,0,0,2v,8f,2d,2e,2e,2e,2e,2k,8g,2s,0,gi,nt
3p,0,gi,0,2v,8f,2y,2y,2y,2y,8g,2s,nt,0,0,3s
3p,3q,0,0,gp,2v,2r,2r,2r,2r,2s,0,0,gp,0,3p
3p,3p,3q,nu,0,0,0,nt,0,3q,0,gp,0,0,3s,3p
3p,3p,3p,3p,3q,0,gp,0,3s,3p,0,gi,nt,3s,3p,3p
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME world.curse
EXT 7,9 24 1,6 FX wave
EXT 8,9 24 2,6 FX wave
PAL 4

ROOM 2c
2q,0,3s,3p,3t,0,0,nm,0,2z,0,3r,3p,0,0,2z
0,0,3p,3t,0,2z,0,ng,0,71,0,2z,3r,3p,3q,0
0,3s,3p,0,2q,nh,nh,ng,2y,nl,7e,0,0,2q,3p,2q
3s,3p,3t,0,0,ng,ni,nj,fc,7c,nl,0,2z,0,3p,0
3p,3t,2q,0,nm,ni,84,o4,o3,0,7c,71,0,0,3p,3q
3p,0,0,nt,ni,0,c4,o5,o6,c4,84,7c,2y,2q,3p,3p
3p,2z,3s,2y,no,84,c3,n3,n4,c3,84,2m,nu,0,3r,3p
3p,3p,3t,nu,no,0,84,nc,nb,0,84,86,2y,3q,2z,3p
3t,0,6o,nk,2d,84,84,n9,na,84,84,2k,nu,0,3r,3p
2q,2z,0,6n,8f,2d,0,84,84,84,2k,8g,0,2z,2q,3r
0,0,2q,0,2d,8f,2d,o7,o7,2k,8g,2k,ny,nx,nw,nv
ny,nx,nw,nv,2h,2d,8f,2y,2y,8g,2k,2m,0,nz,o0,0
2q,nz,o0,0,2d,2h,2h,0,0,2m,2m,2k,0,2z,0,2q
0,2z,0,2z,8f,2d,2h,0,0,2m,2k,2m,ny,nx,nw,nv
nq,nr,nq,nr,2d,8f,2h,0,84,2m,2m,2k,nq,o1,o2,nr
np,ns,np,ns,8f,2d,2h,84,84,2m,2k,2m,np,ns,np,ns
NAME world.bless
EXT 7,10 24 13,6 FX wave
EXT 8,10 24 14,6 FX wave
PAL 4

ROOM 2d
0,0,0,0,0,0,0,0,0,0,0,0,5h,0,0,0
0,0,0,0,0,0,5i,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,5h,0,0,0,5n,5g,5g,5o,0,0,0,0,0,0
0,0,0,0,0,5n,52,5h,0,5a,5o,0,0,0,0,0
0,0,0,0,0,54,54,5g,5g,5c,5c,0,0,0,0,0
0,0,0,0,0,54,51,40,42,58,5c,0,0,0,0,0
0,0,0,0,2y,oa,9v,41,41,9v,5c,0,0,0,0,0
0,0,0,0,0,ob,55,3y,3z,5d,5m,0,0,0,5i,0
0,0,0,0,0,0,5l,5f,5f,5m,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,5h,0,0,0,0,5i,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,5h,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,5i,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME tower.4
ITM 6 9,7
EXT 5,7 3 13,7 FX tunnel
PAL 0

ROOM 2e
2q,bn,bo,2z,0,2q,0,0,0,0,2z,0,0,bn,bo,0
bk,bm,bl,bj,0,0,0,2q,0,0,0,nt,bk,bs,br,bj
0,bh,bh,nt,nq,nr,nq,nr,nq,nr,nq,nr,0,bh,bh,2z
2z,93,93,nq,oh,ns,np,ns,np,ns,np,ns,oi,93,93,0
nq,93,93,nr,nu,nt,2f,2i,2i,2i,2j,nt,nt,93,93,nr
np,93,93,ns,2f,2i,0,od,oc,35,kh,2j,nu,93,93,ns
nu,93,93,2f,bc,0,c4,oe,of,c4,0,bc,2i,93,93,nt
nt,93,93,0,bd,40,c3,n3,n4,c3,42,bd,0,93,93,2j
2f,og,og,0,0,3y,42,nc,nb,40,3z,0,0,og,og,37
oj,ol,ol,ok,0,37,41,n9,na,41,0,kh,oj,ol,ol,ok
0,36,0,kg,0,0,3y,3x,3x,3z,0,0,0,kg,0,35
0,kf,0,36,0,0,0,0,0,0,36,0,0,0,0,0
0,0,35,0,0,kg,0,0,0,0,0,35,37,0,kf,0
0,0,kf,0,0,0,0,o8,o8,0,0,0,0,0,0,0
0,0,0,0,0,0,36,0,0,37,0,kf,0,35,0,36
36,0,0,kg,0,0,0,0,kh,0,0,0,0,0,0,0
NAME world.normal
EXT 7,13 24 7,3 FX wave
EXT 8,13 24 8,3 FX wave
PAL 4

ROOM 2f
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME end.1
PAL 4

ROOM 2g
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p,3p
NAME end.2
PAL 5

ROOM 2h
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,2q,2z,0,0,0,0,0,0,0
0,0,0,0,0,0,0,2z,2q,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME end.3
PAL 6

ROOM 2i
0,0,la,0,2z,0,0,0,0,0,0,la,0,0,0,0
la,2z,0,0,0,0,0,0,0,2q,0,2z,0,la,2z,0
0,0,la,0,5w,5u,5u,5u,5u,5u,5t,0,0,0,0,0
0,0,2z,5w,5v,0,0,0,0,0,5s,5t,0,2q,la,2q
0,0,5w,5v,ba,0,0,0,0,0,5c,5s,5t,0,0,0
la,5w,5v,ba,ba,5g,5g,5g,5g,5g,5c,5c,5s,5t,0,0
0,5x,ba,ba,li,lc,lc,lc,lc,lc,5a,5c,5c,5x,0,la
0,5x,ba,li,lc,lc,lc,lc,lc,lc,lc,5a,5c,5x,0,0
2z,5x,li,lc,lc,lc,ld,lb,37,le,lc,lc,5a,5x,0,0
0,5x,lc,lc,lc,le,3s,3p,3p,3q,lc,lc,lc,5x,0,2z
la,5x,lc,lc,lc,ld,3p,3p,3p,3t,lc,lc,lc,5x,0,0
0,5x,lc,lc,lc,om,3r,3p,3t,lc,lc,lc,lc,5x,0,la
2q,5x,lc,lc,lc,lc,lc,lc,lc,lc,lc,lc,lc,5x,0,0
0,5s,5t,lc,lc,lf,lg,lg,lg,lh,lc,lc,5w,5v,2z,0
0,2z,5s,5t,lc,lc,lc,lc,lc,lc,lc,5w,5v,0,la,0
0,la,0,5s,5u,5t,lc,lc,lc,5w,5u,5v,0,0,0,0
NAME end.bless
END 4w 6,15
END 4w 7,15
END 4w 8,15
PAL 0

ROOM 2j
0,0,la,0,2z,0,0,0,0,0,0,la,0,0,0,0
la,2z,0,0,0,0,0,0,0,2q,0,2z,0,la,2z,0
0,0,la,0,5w,5u,5u,5u,5u,5u,5t,0,0,0,0,0
0,0,2z,5w,5v,0,0,0,0,0,5s,5t,0,2q,la,2q
0,0,5w,5v,ba,0,0,0,0,0,5c,5s,5t,0,0,0
la,5w,5v,ba,ba,5g,5g,5g,5g,5g,5c,5c,5s,5t,0,0
0,5x,ba,ba,li,lc,lc,lc,lc,lc,5a,5c,5c,5x,0,la
0,5x,ba,li,lc,lc,lc,lc,lc,lc,lc,5a,5c,5x,0,0
2z,5x,li,lc,lc,lc,lo,lb,37,le,lc,lc,5a,5x,0,0
0,5x,lc,lc,lc,le,3s,3p,3p,3q,lc,lc,lc,5x,0,2z
la,5x,lc,lc,lc,ld,3p,3p,3p,3t,lc,lc,lc,5x,0,0
0,5x,lc,lc,lc,om,3r,3p,3t,lc,lc,lc,lc,5x,0,la
2q,5x,lc,lc,lc,lc,lc,lc,lc,lc,lc,lc,lc,5x,0,0
0,5s,5t,lc,lc,lf,lg,lg,lg,lh,lc,lc,5w,5v,2z,0
0,2z,5s,5t,lc,lc,lc,lc,lc,lc,lc,5w,5v,0,la,0
0,la,0,5s,5u,5t,lc,lc,lc,5w,5u,5v,0,0,0,0
NAME end.curse
END 4t 7,15
END 4u 8,15
END 4v 6,15
PAL 0

ROOM 2k
0,0,la,0,2z,0,0,0,0,0,0,la,0,0,0,0
la,2z,0,0,0,0,0,0,0,2q,0,2z,0,la,2z,0
0,0,la,0,5w,5u,5u,5u,5u,5u,5t,0,0,0,0,0
0,0,2z,5w,5v,0,0,0,0,0,5s,5t,0,2q,la,2q
0,0,5w,5v,ba,0,0,0,0,0,5c,5s,5t,0,0,0
la,5w,5v,ba,ba,5g,5g,5g,5g,5g,5c,5c,5s,5t,0,0
0,5x,ba,ba,li,lc,lc,lc,lc,lc,5a,5c,5c,5x,0,la
0,5x,ba,li,lc,lc,lc,lc,lc,lc,lc,5a,5c,5x,0,0
2z,5x,li,lc,lc,lc,lo,lb,37,le,lc,lc,5a,5x,0,0
0,5x,lc,lc,lc,le,3s,3p,3p,3q,lc,lc,lc,5x,0,2z
la,5x,lc,lc,lc,ld,3p,3p,3p,3t,lc,lc,lc,5x,0,0
0,5x,lc,lc,lc,om,3r,3p,3t,lc,lc,lc,lc,5x,0,la
2q,5x,lc,lc,lc,lc,lc,lc,lc,lc,lc,lc,lc,5x,0,0
0,5s,5t,lc,lc,lf,lg,lg,lg,lh,lc,lc,5w,5v,2z,0
0,2z,5s,5t,lc,lc,lc,lc,lc,lc,lc,5w,5v,0,la,0
0,la,0,5s,5u,5t,lc,lc,lc,5w,5u,5v,0,0,0,0
NAME end.normal
END 4x 6,15
END 4x 7,15
END 4x 8,15
PAL 0

ROOM 2l
3s,3p,3p,3t,0,0,0,0,0,2z,0,0,0,0,0,0
3p,3p,3t,0,0,0,0,0,0,0,0,2x,0,0,0,0
3p,3t,0,2w,0,0,0,2q,0,0,0,0,0,0,2z,0
3p,0,0,0,0,0,0,0,0,0,2z,0,0,0,0,0
3t,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,2z,0,oo,82,83,2y,0,0,0,0,0,2w,2q,0
0,0,2y,2y,80,2y,7z,2j,2x,2y,0,0,0,0,0,0
0,2x,2f,2i,7w,7x,7y,0,2i,2j,2y,2x,0,0,0,0
0,2y,2d,84,3l,0,0,84,85,on,2l,2y,0,0,0,0
0,2w,2v,2d,85,0,84,2k,2r,3a,2u,2w,0,0,0,0
0,0,2w,2v,2r,2d,2k,2s,2x,3a,2x,0,0,0,2x,0
0,0,2q,2x,2w,2v,2s,2w,2y,3b,2y,0,0,0,0,0
0,0,0,0,0,0,2x,0,0,3c,3m,0,0,2z,0,3s
0,0,0,0,0,0,2q,0,0,0,3o,0,0,0,0,3p
0,2z,0,2x,0,0,0,0,0,0,0,0,0,0,3s,3p
0,0,0,0,0,0,0,0,2z,0,0,0,0,3s,3p,3p
NAME start.1
EXT 4,7 2m 6,9 FX tunnel
EXT 9,11 0 7,3 FX wave DLG 50
PAL 0

ROOM 2m
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,5n,5g,5g,5o,0,0,0,0,0,0
0,0,0,0,0,5n,52,5i,5h,5a,5o,0,0,0,0,0
0,0,0,0,0,54,57,5g,5g,59,5c,0,0,0,0,0
0,0,0,0,0,54,51,4x,f4,5a,5c,0,0,0,0,0
0,0,0,0,0,54,5k,4x,f5,f6,5c,0,0,0,0,0
0,0,0,0,0,5l,5f,5f,5f,5f,5m,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME start.2
EXT 6,9 2l 4,7 FX tunnel
PAL 0

TIL 10
11111111
11111111
11111111
11111110
11111110
11111100
01111100
00110000

TIL 11
11111100
11110000
11111000
11111000
11111000
11110000
11100000
10000000

TIL 12
00011000
00111001
01111111
11111111
11111111
11111111
11111111
11111110

TIL 13
00000000
00000000
00000000
00000000
00000000
00000010
00000100
00001100

TIL 14
00000000
00000000
00000000
00000010
00000100
00011100
00111000
01111000

TIL 15
00011111
00111111
00111110
00011000
00000000
00000000
00000000
00000000

TIL 16
00000000
00000000
00000000
00000001
00000011
00001111
00011111
00011111

TIL 17
11110000
11110000
11110000
11110000
11100000
11000000
10000000
00000000

TIL 18
00000000
00001000
00011000
01111000
11111100
11111100
11111100
11111000

TIL 19
00000000
00000000
00000000
00000001
00000011
00011111
00111111
01111111

TIL 20
00000000
00000000
10000000
10000000
11000000
11100000
11110000
11110000

TIL 21
00011000
00000000
00000000
00000001
00000001
00000011
00001111
00011111

TIL 22
00000000
00000000
00000000
00011000
00111100
01111100
01101100
00110000

TIL 23
11100000
11111100
11111110
01111110
01111110
00011110
00001001
00000000

TIL 24
00011000
00001000
00000000
00100000
01100000
11000000
11000000
11100000

TIL 25
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000011
WAL false

TIL 26
00001111
00011111
00111110
01111100
01110000
00100100
00001000
00000000

TIL 27
00000000
01000000
00110000
00110000
00011000
00011000
00011000
00110000

TIL 28
00000000
00000010
00001110
00111100
01111110
00111100
00010000
00000000

TIL 29
00000000
00000000
00001000
00001000
00000000
00000000
00001000
00000000

TIL 32
01111110
00000000
01111110
00000000
01111110
00000000
00111100
00000000

TIL 33
00000000
00000000
00000000
00000000
01000000
01100000
10000000
10000000
NAME flower

TIL 34
00000000
00000000
00000000
00000000
00000010
00000110
00000001
00000001
>
00000000
00000000
00000000
00000000
00000010
00000110
00000001
00000001
NAME flower

TIL 35
00100000
01100010
00010011
00010100
01000100
11000000
00100000
00100000
NAME flower

TIL 36
00000100
00000110
01001000
11001000
00100000
00100000
00000000
00000000
NAME flower

TIL 37
00000000
00000000
00000000
00001000
00001100
00010000
00010000
00000000
>
00000000
00000000
00000000
00001000
00001100
00010000
00010000
00000000
NAME flower

TIL 38
00000000
00000000
00000000
00000000
00000000
00000001
00000110
11111000
>
00000000
00000000
00000000
00000000
00000000
00000001
00000110
11111000
NAME rope

TIL 39
01110110
00000000
01011010
01011010
00000000
00000000
01111110
10000001
NAME bridge

TIL 40
00000000
11111111
10000000
10111111
10100000
10101111
10101000
10101011
NAME tiles

TIL 41
10101010
10101010
10101010
10101010
10101010
10101010
10101010
10101010
NAME tiles

TIL 42
00000000
11111110
00000010
11111010
00001010
11101010
00101010
10101010
NAME tiles

TIL 43
10000001
10000000
01000011
00110000
01100111
01000000
01001111
01000000
WAL false

TIL 44
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL 45
00000000
00000000
00000111
00011000
00100000
01000000
10000000
10000000
WAL true

TIL 46
00000000
00000000
11100000
00011000
00000100
00000010
00000001
00000001
WAL true

TIL 47
10000001
00000001
11000010
00001100
11100110
00000010
11110010
00000010

TIL 48
00000001
11111111
00000000
11111111
00000000
11111111
00000000
11111111

TIL 49
10000000
11111111
10000000
10111111
10100000
10101111
10101000
10101011

TIL 50
11100000
11000000
10100000
00000000
00000000
00000000
00000000
10000000
>
11000000
11100000
01000000
00000000
00000000
00000000
00000000
10000000
WAL true

TIL 51
00000010
00000010
01100010
00000010
00011010
00000010
00000010
11111110
WAL true

TIL 52
00000010
00000010
00000010
00000010
00000010
00000010
00000010
11111110
WAL true

TIL 54
00000010
00000010
00000010
00000010
00000010
00000010
00000010
00000010
WAL true

TIL 55
00000000
11111110
00000010
00000010
00000010
00000010
00000010
00000010
WAL true

TIL 57
00000010
00000010
00100010
00000010
00100010
01110010
00100010
00000010
>
00000010
00000010
00000010
00100010
00100010
01110010
00100010
00000010
WAL true

TIL 58
10000000
10000110
10000000
10000000
10110000
10000000
10000000
11111111
WAL true

TIL 59
10000000
10000000
10001000
10000000
10001000
10011100
10001000
10000000
>
10000000
10000000
10000000
10001000
10001000
10011100
10001000
10000000
WAL true

TIL 61
00000000
00000000
01000000
01000010
01111110
01000010
01000010
01000010
NAME ladder

TIL 62
01111110
01000010
11111111
00000000
00000000
11111111
10101010
00101000

TIL 63
00000000
00000000
11111000
00001000
00010000
11100000
01000000
00000000

TIL 64
00000000
00000000
00000000
00000000
00000000
00110000
00101000
00100100

TIL 65
00100100
00100100
00101000
00110000
00000000
00000000
00000000
00000000

TIL 66
00000000
00000000
00001111
00010000
00100000
00111111
00000000
00000000

TIL 67
00000011
00000111
00001111
00001110
00011110
00111100
00111100
01111100

TIL 68
00100000
01110100
10101100
11011000
01110000
01100000
11000000
11000000
>
00000000
01110100
10101100
11011000
01110000
01100000
11000000
11000000

TIL 69
11000000
10000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL 70
00000110
00011001
11101111
00001001
00001001
00000110
00000000
00000000
>
00000000
00000110
11111001
00001111
00001001
00001001
00000110
00000000
WAL true

TIL 71
00000000
00100000
00111000
00100111
00100001
00111001
00100111
00100000
>
00000000
00111111
00100001
00100001
00111111
00100000
00100000
00100000
NAME flag
WAL true

TIL 72
00111100
01000010
10000001
10000001
10000001
10000001
11000011
10111101
NAME isl

TIL 73
10000001
10000001
10000001
10000001
10000001
01000010
00111100
00000000
NAME isl
WAL true

TIL 74
10000001
10000001
10000001
10000001
10000001
11000001
10100011
10011101
NAME isl

TIL 75
10000001
10000001
10000001
10000001
01000001
00100010
00011100
00000000
NAME isl
WAL true

TIL 76
00101100
00110100
00101100
00110100
00101100
01111110
00111100
00000000
>
00011000
00101100
00110100
00101100
00110100
00101100
01111110
00000000
NAME buoy

TIL 77
00000000
00000000
00000000
00011000
00100100
00100100
00011000
00011000
>
00000000
00000000
00000000
00000000
00011000
00100100
00100100
00011000
NAME buoy

TIL 80
01000000
01000000
01011000
01000000
01000110
01000000
01011000
01000000
WAL true

TIL 81
00000001
00000001
00000001
00000001
00011111
00100100
01001001
11111111
WAL true

TIL 82
00000000
00000000
00000000
00000000
11111111
10100101
00100100
11111111
WAL true

TIL 83
00000000
11111110
01000100
01011100
11000100
00111100
10000010
11111111
WAL true

TIL 84
00000000
00100000
00000100
00000000
00010000
00000010
01000000
00000000
NAME sand

TIL 85
00000000
00100000
00000100
00000000
00010000
00000010
00000000
11111111
NAME sand

TIL 86
00000001
00100001
00000101
00000001
00010001
00000001
01000001
00000001
NAME sand

TIL 87
00000000
01111111
01010101
01010101
01010101
01010101
01111111
00000000

TIL 88
00001101
00001100
00001100
00001100
00001000
00001111
00000000
11111111
WAL true

TIL 89
00110000
00110000
00110000
00110000
00010000
11110000
00000000
11111111
WAL true

TIL 90
10000000
01000000
01000000
01000000
01000000
01000000
01000000
10000000
NAME bridge

TIL 92
01100110
01100110
01100110
01100110
01100110
01100110
01100110
11111111
NAME museum

TIL 93
01100110
01100110
01100110
01100110
01100110
01100110
01100110
01100110
NAME museum
WAL true

TIL 94
00000000
00000000
00000000
00000000
00000000
00000011
00011110
11111111

TIL 95
00000000
00000000
00000000
00000000
00000000
11000000
01111000
11111111

TIL 96
00000000
00000000
11000000
01110000
00011110
00000011
00000000
11111111

TIL 97
00000000
00000000
00000011
00001110
01111000
11000000
00000000
11111111

TIL 98
01101000
01101000
01101000
01101010
01101000
01101010
01101010
11111111

TIL 99
00010110
00010110
00010110
00010110
00010110
00010110
10010110
11111111

TIL a
00000000
00000000
00000000
00110000
00000000
00000000
00000100
00000000
>
00000000
00000000
00000000
01100000
00000000
00000000
00000101
00000000
NAME waves2

TIL l
00000000
00000000
00000000
01111000
11111100
11111110
11111111
01111111

TIL m
00000000
00000000
00000000
00000000
00000000
00000000
11000000
11111000

TIL n
11111100
11111111
11111111
11111111
01111111
00111111
00011111
10011111

TIL o
00111111
00011111
00000111
10000011
11000000
11100000
11000000
00000001

TIL p
00111000
11111100
11111110
11111110
11111100
11110000
11000000
11100000

TIL q
11110000
11110000
11110000
11111000
11111100
11111110
01111111
00111110

TIL r
00011111
00001111
00001111
00000111
00000011
00000000
00000000
00000000

TIL s
00000011
00000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL t
00000000
00000000
00000001
00000011
00000011
00000001
00000000
00000000

TIL u
01111111
01111111
00111111
01111111
11111111
11111111
11111111
11111111

TIL v
11110000
11110000
11100000
11000000
10000000
00000011
00111111
01111111

TIL w
01111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111

TIL x
11111100
01110001
01100111
00001111
00111111
01111111
00111111
00001111

TIL y
00000000
00000010
00001100
00111000
01111000
00110000
00000000
00000000

TIL z
00000011
00000001
00000001
00000001
00000001
00000000
00000000
00000000

TIL 1a
00111100
00011000
00001000
00000000
00000000
00000000
00000000
00000000

TIL 1b
00010000
00111110
01111111
01111111
11111111
11111110
01111000
00110000

TIL 1c
00001100
00011110
00000110
11100011
11110000
11000000
00000000
00000000

TIL 1d
00000111
00011000
00100001
01000000
01000000
10000000
10000000
10100000
>
00000111
00011000
00100001
01000000
01000000
10000000
10000000
10100001

TIL 1e
11100000
00011000
10000100
10000010
00000010
00000001
00000001
10001101
>
11100000
00011000
10000100
10000010
00000010
00000001
00000001
00001101

TIL 1f
10110001
10000000
10000000
11000000
01000001
01100001
00111000
00011111
>
10110000
10000000
10000000
11000000
01000001
01100001
00111000
00011111

TIL 1g
00000101
00000001
00000001
00000011
00000010
10000110
00011100
11111000
>
10000101
00000001
00000001
00000011
00000010
10000110
00011100
11111000

TIL 1h
11111000
00000000
01110000
00000000
00000000
00000000
00000000
00000000

TIL 1i
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01111111

TIL 1j
00011111
00000000
00001110
00000000
00000000
00000000
00000000
00000000

TIL 1k
00000000
00000000
00000000
00000000
00000000
00000000
00000000
11111110

TIL 1l
11100000
10000000
10000000
10000000
10000000
10000000
10000000
00000000

TIL 1m
00000111
00000001
00000001
00000001
00000001
00000000
00000000
00000000

TIL 1n
00000000
00000001
00000001
00000001
00000001
00000001
00000001
00000001

TIL 1o
00000000
00000000
00000000
10000000
10000000
10000000
10000000
10000000

TIL 1p
00111111
11100100
11111111
11000000
00000000
00000000
11111111
11111111
WAL false

TIL 1q
11111100
10010111
11111111
00000011
00000000
00000000
11111111
11111111
WAL false

TIL 1r
00000000
00000000
10000000
11000000
11111111
00000000
11111111
11111111
WAL false

TIL 1s
00000000
00000000
00000001
00000011
11111111
00000000
11111111
11111111
WAL false

TIL 1t
00000000
00000000
00000000
00000000
11111111
00000000
11111111
11111111
WAL false

TIL 1u
01100000
00111100
00111000
00010000
11111111
00000000
11111111
11111111
WAL false

TIL 1v
00000000
00000000
00001000
00001000
00110110
00001000
00001000
00100000

TIL 1w
00001111
00000111
00000111
00000011
00000011
00000011
00000011
00000001

TIL 1x
11110000
11100000
11000000
11000000
10000000
00000000
00000000
00000000

TIL 1y
00000001
00000001
00000000
00000000
00000000
00000000
00000000
00000000

TIL 1z
11110000
11111001
11111110
11111110
11111100
11111100
11111000
11110000

TIL 2a
00000000
00000000
00001000
00001000
00110110
00001000
00001000
00000000

TIL 2b
00000000
00000000
00000000
00000000
00100110
00000000
00000000
00000000

TIL 2c
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111

TIL 2d
10000000
10000000
10000000
10000000
11000000
10110000
10001100
10000011
NAME isl

TIL 2e
00000000
00000000
00000000
00000000
00000000
00000000
00000000
11111111
NAME isl

TIL 2f
00011111
00100000
01000000
01000000
01000000
10000000
10000000
10000000
NAME isl

TIL 2g
00011100
00100010
01000010
10000010
10000001
10000001
10000001
10000001
NAME isl

TIL 2h
10000000
10000000
10000000
10000000
10000000
10000000
10000000
10000000
NAME isl

TIL 2i
11111111
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME isl

TIL 2j
10000000
01111100
00000010
00000010
00000010
00000001
00000001
00000001
NAME isl

TIL 2k
00000001
00000001
00000001
00000001
00000011
00001101
00110001
11000001
NAME isl

TIL 2l
11100000
00011100
00000010
00000001
00000001
00000001
00000011
11111101
NAME isl

TIL 2m
00000001
00000001
00000001
00000001
00000001
00000001
00000001
00000001
NAME isl

TIL 2n
00001111
00110000
01000000
10000000
10000000
10000000
11000000
10111111
NAME isl

TIL 2q
00000000
00000000
00000000
00000000
00010000
00000000
00000000
00000000
>
00000000
00000000
00000000
00010000
00101000
00010000
00000000
00000000
NAME sparkle1

TIL 2r
00000000
00000000
00000000
00000000
00000000
00000000
11111111
00000000
NAME isl
WAL true

TIL 2s
00000001
00000001
00000001
00000010
00001100
00110000
11000000
00000000
NAME isl
WAL true

TIL 2t
10000000
10000000
10000000
10000000
10000000
01000000
00111111
00000000
NAME isl
WAL true

TIL 2u
00000001
00000001
00000001
00000001
00000001
00000010
11111100
00000000
NAME isl
WAL true

TIL 2v
10000000
10000000
10000000
01000000
00110000
00001100
00000011
00000000
NAME isl
WAL true

TIL 2w
00000000
00000000
00000000
00110000
00000000
00000000
00000100
00000000
>
00000000
00000000
00000000
01100000
00000000
00000000
00000101
00000000
NAME waves1
WAL true

TIL 2x
00000000
00001110
00000000
00000000
01100000
00000000
00000000
00000000
>
00000000
00000110
00000000
00000000
01010000
00000000
00000000
00000000
NAME waves1
WAL true

TIL 2y
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME blank
WAL true

TIL 2z
00000000
00000000
00000000
00010000
00101000
00010000
00000000
00000000
>
00000000
00000000
00000000
00000000
00010000
00000000
00000000
00000000
NAME sparkle2

TIL 3a
11111111
10000001
11111111
10000001
11111111
10000001
11111111
10000001
NAME bridge

TIL 3b
11111111
10000001
11111111
10000001
11111111
10000001
11111111
01000010
NAME bridge

TIL 3c
01000010
01000010
00000000
01000010
00000000
00000000
00000000
00000000
>
01000010
01000010
00000000
00000000
01000010
00000000
00000000
00000000
NAME bridge
WAL true

TIL 3d
10010000
10111000
10111100
10111100
10111100
01111100
00111100
00001111

TIL 3e
00000001
00000001
00000001
00000001
00000001
00000010
00001100
11110000

TIL 3f
10011100
10000000
10000000
10000000
10000000
11000000
10010000
10000010
WAL false

TIL 3g
00000001
00000001
00000001
00000001
00000001
00000011
00001001
01000001
WAL true

TIL 3h
00000100
00011111
00111111
11111101
11111101
11111001
11110001
10000001

TIL 3i
00000000
00000000
00000000
00000000
00000011
00011111
01111111
11111111

TIL 3j
10000000
10000000
10000000
10000000
10000000
11000000
10010000
10000010
WAL true

TIL 3k
00000000
00000000
00000000
00000000
00001000
00011000
00001100
00001110
>
00000000
00000000
00000000
00000000
00001000
00011010
00001100
00001110

TIL 3l
00000000
00111010
01111010
00000000
01101110
01101110
00000000
01110110
NAME path2

TIL 3m
00100000
00110000
00111000
00111100
00111110
00110000
11111111
01111110
>
00000000
00100000
00110000
00111000
00111100
00111110
00110000
11111111
NAME boat

TIL 3o
00000000
00000000
00000000
00110000
00000000
00000000
00000100
00000000
>
01111110
00000000
00000000
01100000
00000000
00000000
00000101
00000000
NAME boat2
WAL true

TIL 3p
11001100
00010001
01100110
10001000
00110011
01000100
10011001
00100010
>
00100010
11001100
00010001
01100110
10001000
00110011
01000100
10011001
NAME sea1
WAL true

TIL 3q
00000000
00000000
01000000
10000000
00110000
01000000
10011000
00100010
>
00000000
10000000
00000000
01100000
10000000
00110000
01000100
10011000
NAME sea2
WAL true

TIL 3r
01001100
00010001
00000110
00001000
00000011
00000000
00000001
00000000
>
00100010
00001100
00010001
00000110
00000000
00000011
00000000
00000000
NAME sea3
WAL true

TIL 3s
00000000
00000001
00000010
00000000
00000011
00000100
00011001
00100010
>
00000000
00000000
00000001
00000110
00001000
00010011
00000100
00011001
NAME sea4
WAL true

TIL 3t
11001100
00010000
01100000
10000000
00100000
01000000
10000000
00000000
>
00100010
11001100
00010000
01100000
10000000
00000000
00000000
00000000
NAME sea5
WAL true

TIL 3u
00000000
00000000
00000000
00111110
00111110
00011100
00000000
00000000
>
00000000
00000000
00000000
00000000
00111110
00111110
00011100
00000000

TIL 3v
11100000
00011100
00000010
00000010
00000010
00000010
01111110
10000001

TIL 3w
00000000
00000000
01000010
11000011
00100100
00100100
00000000
00000000

TIL 3x
00000000
11111111
00000000
11111111
00000000
11111111
00000000
11111111
NAME tiles

TIL 3y
10101010
10101011
10101000
10101111
10100000
10111111
10000000
11111111
NAME tiles

TIL 3z
10101010
10101010
00101010
11101010
00001010
11111010
00000010
11111110
NAME tiles

TIL 4e
11111110
10101010
10101010
11111110
01010010
01010010
11111110
00001100
WAL true

TIL 4f
00000000
11111100
00000110
10101010
10101010
11111110
01010010
01010010
WAL true

TIL 4g
00000000
00111111
01110000
01101010
01101010
01111111
01100101
01100101
WAL true

TIL 4h
01111111
01101010
01101010
01111111
01100101
01100101
01111111
00110000
WAL true

TIL 4i
01000010
01000010
01000010
01000110
01000000
01111111
01111111
00011000
WAL true

TIL 4j
01000010
01000010
01000010
01100010
00000010
11111110
11111110
00011000
WAL true

TIL 4k
11100010
11110010
11010010
11010010
11010010
11010010
11010010
11000010
WAL true

TIL 4l
01000111
01001111
01001011
01001011
01001011
01001011
01000011
01000010
WAL true

TIL 4m
00000000
11111110
00000010
10000010
11000010
11000010
11000010
10000010
WAL true

TIL 4n
00000000
01111111
01000000
01000001
01000011
01000011
01000011
01000001
WAL true

TIL 4q
00000000
00011110
00010000
00011100
00010000
00010000
00000000
00000000

TIL 4r
00000000
00110000
01001000
00010000
00100000
01111000
00000000
00000000

TIL 4s
00000000
01111110
01000010
00111111
00100001
01111111
01000010
01111110
WAL true

TIL 4t
00000000
00100000
01100000
00100000
00100000
01110000
00000000
00000000

TIL 4v
01111110
01000010
01000010
01000010
01111110
01000010
01000010
01000010
NAME ladder

TIL 4x
00000000
00100010
00000000
10001000
00000000
00100010
00000000
10001000

TIL 4y
00000000
01111110
01000010
01011010
01000010
01011010
01000010
01111110
WAL true

TIL 4z
00000111
00000011
00000101
00000000
00000000
00000000
00000000
11111111
>
00000011
00000111
00000010
00000000
00000000
00000000
00000000
11111111
WAL true

TIL 5a
10000000
10000000
10000000
10000000
10000000
10000000
10000000
11111111
WAL true

TIL 5c
10000000
10000000
10000000
10000000
10000000
10000000
10000000
10000000
WAL true

TIL 5d
00000000
11111111
10000000
10000000
10000000
10000000
10000000
10000000
WAL true

TIL 5f
00000000
11111111
00000000
00000000
00000000
00000000
00000000
00000000
WAL true

TIL 5g
00000000
00000000
00000000
00000000
00000000
00000000
00000000
11111111
WAL true

TIL 5h
00000000
00000000
00000000
01100000
00000000
00000000
00000110
00000000
NAME brick
WAL true

TIL 5i
00000000
00000000
00001100
00000000
00000000
00110000
00000000
00000000
NAME brick
WAL true

TIL 5j
00000000
00000000
00010000
00000000
00010000
00111000
00010000
00000000
>
00000000
00000000
00000000
00010000
00010000
00111000
00010000
00000000
WAL true

TIL 5k
00000000
00000000
00000000
00000010
00000000
00100010
10101010
10101010
>
00000000
00000000
00000000
00000000
00100010
10000010
10100010
10101010

TIL 5l
00000010
00000011
00000000
00000000
00000000
00000000
00000000
00000000

TIL 5m
10000000
10000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL 5n
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000011
WAL true

TIL 5o
00000000
00000000
00000000
00000000
00000000
00000000
00000000
10000000

TIL 5p
00100100
01111110
11100111
01000010
01000010
11100111
01111110
00100100

TIL 5q
00000000
00000000
11111111
00000000
00000000
11111111
00000000
00000000

TIL 5r
00100100
00100100
00100100
00100100
00100100
00100100
00100100
00100100

TIL 5s
10000001
10000000
10000000
10000000
10000000
10000000
10000000
11111111
WAL true

TIL 5t
11111111
00000001
00000001
00000001
00000001
00000001
00000001
10000001
WAL true

TIL 5u
11111111
00000000
00000000
00000000
00000000
00000000
00000000
11111111
WAL true

TIL 5v
10000001
00000001
00000001
00000001
00000001
00000001
00000001
11111111
WAL true

TIL 5w
11111111
10000000
10000000
10000000
10000000
10000000
10000000
10000001
WAL true

TIL 5x
10000001
10000001
10000001
10000001
10000001
10000001
10000001
10000001
WAL true

TIL 5y
00000001
00000001
00000001
00011001
00000001
00000001
01100001
00000001

TIL 5z
10000000
10000000
10110000
10000000
10000000
10000000
10000110
10000000

TIL 6a
00000000
00001000
00000110
00000011
00000000
00000000
00000000
00000001

TIL 6b
00000000
00000000
00000000
00000000
01000000
11000000
01100000
01110000
>
00000000
00000000
00000000
01000000
11010000
01100000
01110000
00100000

TIL 6c
00101000
00100000
00100000
00000000
00000000
00000000
00000000
00000000
WAL true

TIL 6d
00000000
00000000
11111111
00000000
00000000
11111111
00101010
00100010

TIL 6e
00100010
00000010
00000000
00000000
00000000
00000000
00000000
00000000
WAL true

TIL 6f
00000000
00000000
11111111
00000000
00000000
11111111
01010100
00010100

TIL 6g
00010100
00010000
00010000
00000000
00000000
00000000
00000000
00000000
WAL true

TIL 6h
00100011
01001100
10010000
00100001
01001001
01000100
10000001
10011011

TIL 6i
11000100
00110010
00001001
10000100
10010010
00100010
10000001
11011001

TIL 6j
00000000
00000000
00000000
00000000
00000000
00000000
00000111
00011000

TIL 6k
00000000
00000000
00000000
00000000
00000000
00000000
11100000
00011000

TIL 6l
00000000
00000000
00000000
10000000
10000000
01000000
01000000
01000000

TIL 6m
00000000
00000000
00000000
00000001
00000001
00000010
00000010
00000010

TIL 6n
11000000
11100000
11111000
01111111
00111111
00001111
00000011
00000000
WAL false

TIL 6o
00000000
00000000
00000000
00000000
10000000
01000000
00111111
00000011

TIL 6p
00000000
00000000
00000000
10000000
01000000
10010000
01100000
11000000

TIL 6q
00000000
00000000
00000000
00000000
00000000
00000000
00000000
11010110
>
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01101010
NAME sea

TIL 6r
01000100
01000000
01111011
01000100
01010101
01000100
00111011
00000000
>
01000000
01111011
01000100
01010101
01000100
00111011
00000000
00000000
WAL true

TIL 6s
00000100
00000000
10111011
01000100
01010101
01000100
10111011
00000000
>
00000000
10111011
01000100
01010101
01000100
10111011
00000000
00000000
WAL true

TIL 6t
01000100
00000110
10111101
01000100
01010100
01000100
10111000
00000000
>
00000110
10111101
01000100
01010100
01000100
10111000
00000000
00000000
WAL true

TIL 6u
01000100
00000100
01000100
00000100
01000100
01000100
00000100
01000100
>
00000100
01000100
00000100
01000100
01000100
00000100
01000100
01000100

TIL 6v
00000100
01000000
00000100
01000000
01000100
00000100
01000000
00000100
>
01000000
00000100
01000000
01000100
00000100
01000000
00000100
00000100

TIL 6w
00000000
00000000
00000000
00000000
10111000
01000100
00000100
01000100
>
00000000
00000000
00000000
10111000
01000100
00000100
01000100
01000100

TIL 6x
00000000
00000000
00000000
00000000
10111011
01000100
00000000
01000100
>
00000000
00000000
00000000
10111011
01000100
00000000
01000100
00000100

TIL 6y
01000100
01000000
01000100
01000000
01000100
01000100
01000000
01000100
>
01000000
01000100
01000000
01000100
01000100
01000000
01000100
01000100

TIL 6z
00100000
00100000
00100000
00100000
00111011
01000100
01000000
01000100
>
00100000
00100000
00100000
00111011
01000100
01000000
01000100
01000100

TIL 7a
00100000
00100000
00111000
00100111
00100001
00111001
00100111
00100000
>
00100000
00111111
00100001
00100001
00111111
00100000
00100000
00100000
NAME flag
WAL true

TIL 7c
10100000
01111100
00100010
00100010
00100010
00100001
00000001
00000001
NAME flag

TIL 7e
00000000
00100000
00111000
00111111
00111111
00111111
00100111
00100000
>
00000000
00111111
00111111
00111111
00111111
00100000
00100000
00100000
NAME flag
WAL true

TIL 7h
11111111
01010101
01010101
01010101
01010101
01010101
01010101
11111111
NAME bridge

TIL 7i
00111111
01010101
01010101
01010101
01010101
01010101
01010101
00111111
NAME bridge

TIL 7j
10000000
01000000
01000001
01000111
01000111
01000001
01000001
10000000
>
10000000
01000000
01000111
01000111
01000001
01000001
01000001
10000000
NAME bridge

TIL 7k
00010000
00010000
00010000
00000000
00010000
00000000
00000000
00000000
>
00010000
00010000
00010000
00010000
00000000
00000000
00000000
00000000
NAME bridge
WAL true

TIL 7l
00111001
00111001
00100001
00100001
00100011
00001101
00110001
11000001
>
00100001
00111001
00111001
00100001
00100011
00001101
00110001
11000001

TIL 7m
10011100
10011100
10000100
10000100
11000100
10110000
10001100
10000011
>
10000100
10011100
10011100
10000100
11000100
10110000
10001100
10000011

TIL 7n
00001111
00110000
01000111
10000111
10000100
10000100
11000000
10111111
>
00001111
00110000
01000100
10000111
10000111
10000100
11000000
10111111

TIL 7o
10000000
10000000
10000000
10000000
10000000
10000000
11111111
10000000
NAME bridge

TIL 7p
01110110
00000000
01011010
01011010
00000000
00000000
11111110
00000011
NAME bridge

TIL 7q
11111111
10000000
11111111
10000000
11111111
10000000
11111111
10000000
NAME bridge

TIL 7r
11111110
00000010
11111110
00000010
11111110
00000010
11111110
00000010
NAME bridge

TIL 7s
11111110
00000010
11111110
00000010
11111110
00000010
11111110
00010000
NAME bridge

TIL 7t
11111111
10000000
11111111
10000000
11111111
10000000
11111111
00010000
NAME bridge

TIL 7u
00010000
00010000
00010000
00000000
00010000
00000000
00000000
00000000
>
00010000
00010000
00010000
00010000
00000000
00000000
00000000
00000000
NAME bridge
WAL true

TIL 7v
00100000
00100000
00100000
00100000
00100000
00000000
00000000
00000000

TIL 7w
01000000
01011000
01011110
01011110
01011110
01011110
01011110
00111111

TIL 7x
00000000
00110000
00000000
00000110
00000000
01100000
00000000
11111111
WAL false

TIL 7y
00000010
00011010
00000010
01100010
00000010
00011010
00000010
11111100
WAL false

TIL 7z
00000010
00000010
01100010
00000010
00011010
00000010
01100010
00000010
WAL true

TIL 8a
00000000
00000000
00000000
00000011
00000111
00001110
00001110
00001100

TIL 8b
00000000
00000000
00000000
11000000
11100000
01110000
01110000
00110000

TIL 8c
11111111
00000000
00000000
00000000
00000000
00000000
00000000
11111111
NAME isl
WAL true

TIL 8d
01111110
01111110
01111110
01111110
01111110
01111110
11111111
00000000
NAME cave

TIL 8e
00000000
00000000
00000000
00111100
01111110
01111110
01111110
01111110
NAME cave
WAL true

TIL 8f
10000000
10000000
10000000
10000000
10000000
10000000
10000000
10000000
NAME islwall
WAL true

TIL 8g
00000001
00000001
00000001
00000001
00000001
00000001
00000001
00000001
NAME islwall
WAL true

TIL 8h
00000101
00000110
00000100
00000100
00000100
00001110
00000000
00000000

TIL 8i
01010000
00110000
00010000
00010000
00010000
00111000
00000000
00000000

TIL 8j
10100000
01101100
00100010
00010010
00010010
00110001
01010001
10010001
WAL true

TIL 8k
11111010
00000011
00000010
00000100
00000100
00000110
00000101
00000100
WAL true

TIL 8l
00000100
00000010
00000001
00000000
00000000
00000001
00000010
00000011
>
00000111
00000011
00000001
00000000
00000000
00000001
00000010
00000011

TIL 8m
11110000
11100000
11000000
00000000
10000000
01000000
00100000
01100000
>
10010000
10100000
11000000
00000000
10000000
01000000
00100000
01100000

TIL 8n
00000000
00000000
00000000
00000000
00000001
00000011
00000111
00000111
>
00000000
00000000
00000000
00000000
00000001
00000010
00000100
00000111

TIL 8o
00000000
00000000
00000000
00000000
11000000
10100000
10010000
01110000
>
00000000
00000000
00000000
00000000
11000000
11100000
11110000
01110000

TIL 8p
10100000
01100000
00100000
00010000
00010000
00110000
01010000
10010000
WAL true

TIL 8q
00000010
00000011
00000010
00000100
00000100
00000110
00000101
00000100
WAL true

TIL 8r
11110101
00000110
00000100
00000100
00000100
00001110
00000000
11111111

TIL 8s
01010111
00110000
00010000
00010000
00010000
00111000
00000000
11111111

TIL 8t
10000000
01111100
00000010
00000010
00000010
00000001
00000001
00000001
NAME islwall
WAL true

TIL 8u
01110110
00000000
01011010
01011010
00000000
01110110
01110110
00000000
NAME path1

TIL 8v
01101110
01101110
00000000
00110100
00110100
00000000
00000000
00000000
NAME path2

TIL 8w
00111010
01111010
00000000
01110110
01110110
00000000
00000000
11111111

TIL 8x
10000000
10000000
10000000
10000000
11000000
10110000
10001100
10000011
NAME islwall
WAL true

TIL 8y
10011111
00100000
01000000
01000000
01000000
10000000
10000000
10000000
NAME islwall
WAL true

TIL 8z
00000011
00000101
00000101
00000101
00000101
00000101
00000101
00000011
NAME bridge

TIL 9a
01100110
01100110
11100110
00010110
11001110
00100110
00010110
00010110
NAME museum
WAL true

TIL 9b
01100110
01100110
01100111
01101000
01110011
01100100
01101000
01101000
NAME museum
WAL true

TIL 9c
00000000
00000000
00110100
00000100
00100000
00101100
00000000
00000000
>
00000000
00000000
00101100
00100000
00000100
00110100
00000000
00000000
NAME door

TIL 9d
00101000
00100010
00101000
00101010
00111111
01100000
01111111
00000000
NAME statue

TIL 9e
00010100
01000100
00010100
01010100
11111100
00000110
11111110
00000000
NAME statue

TIL 9f
00000101
00011100
00000100
00001100
00000100
00000100
00000100
00000100
NAME statue

TIL 9g
00100000
00100000
00100000
00100000
00100000
00100000
00100000
10100000
NAME statue

TIL 9h
00010000
00100000
00111100
00100000
00111000
00100000
00110000
00100000
NAME statue
WAL true

TIL 9i
00001000
00000100
00000100
00000100
00000100
00000100
00000100
00000100
NAME statue
WAL true

TIL 9j
00000000
10000000
01000000
00100000
10100000
00100000
10100000
00110000
NAME statue
WAL true

TIL 9k
00000000
00000001
00000010
00000100
00000101
00000100
00000101
00001100
NAME statue
WAL true

TIL 9m
01000000
01000000
01000000
01000000
01000000
01000000
01000000
01000000

TIL 9n
00000000
00000000
00000000
00001111
00010000
00100000
01001000
01010100
WAL true

TIL 9o
01000000
11100000
10100000
11100000
00010000
00001000
00000100
00000100
WAL true

TIL 9p
01100100
00000100
00001100
00000100
00011100
00000100
11111000
00000000
>
01100100
00000100
00011100
00000100
00001100
00000100
11111000
00000000
WAL false

TIL 9q
01010100
01010100
01010100
01010100
01011100
01000000
00111111
00000000
WAL false

TIL 9r
01100100
10110100
10010100
01100100
00000100
01100100
10010100
11010100
>
01100100
11010100
10010100
01100100
00000100
01100100
10010100
10110100
WAL true

TIL 9s
00000000
11111110
10100010
11111110
00000000
00000000
11111111
00000000
>
00000000
11111110
10001010
11111110
00000000
00000000
11111111
00000000
WAL false

TIL 9t
01001000
01000000
01001100
10010110
00010010
00001100
00000000
00000000
>
01001000
01000000
01001100
10011010
00010010
00001100
00000000
00000000
WAL true

TIL 9u
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL 9v
00000000
11111110
10000010
10111010
10101010
10111010
10000010
11111110
NAME tiles

TIL 9w
01000000
01000000
01000000
01000000
01000000
01000000
01000000
01011111

TIL 9x
11111111
10000000
10101010
10010101
10101010
10000000
11111111
01000010

TIL 9y
11111111
00000001
10101001
01010101
10101001
00000001
11111111
00000000

TIL 9z
00000000
00000000
00000000
00000000
00000000
00000000
00111100
01111110
NAME door
WAL true

TIL a0
01111110
01111110
01111110
01111110
01111110
01111110
01111110
01111110
NAME door

TIL a2
10101110
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME cave

TIL a3
00000001
00000000
00000100
00001000
00000000
00100000
01000000
10000000
NAME cave

TIL a4
00000000
01000000
00000000
00010000
00001000
00000100
00000000
00000001
NAME cave

TIL a5
10000000
00000000
10000000
00000000
10000000
00000000
10000000
10000000
NAME cave

TIL a6
00000001
00000000
00000001
00000001
00000000
00000001
00000001
00000000
NAME cave

TIL a7
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01101011
NAME cave

TIL a9
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01101011
NAME cavewall
WAL true

TIL aa
10000000
00000000
10000000
00000000
10000000
00000000
10000000
10000000
NAME cavewall
WAL true

TIL ab
00000001
00000000
00000001
00000001
00000000
00000001
00000001
00000000
NAME cavewall
WAL true

TIL ac
00000001
00000000
00000100
00001000
00000000
00100000
01000000
10000000
NAME cavewall
WAL true

TIL ad
10000000
01000000
00110000
00001111
00000001
00000010
00001010
00000010
>
10000000
01000000
00110000
00001111
00000001
00000010
00000010
00000010
NAME cave

TIL ae
00000000
01000000
00000000
00010000
00001000
00000100
00000000
00000001
NAME cavewall
WAL true

TIL af
00000001
00000010
00001100
11110000
10000000
11000000
01010000
01000000
>
00000001
00000010
00001100
11110000
10000000
11000000
01000000
01000000
NAME cave

TIL ag
00000001
00000000
00000100
00000000
00000000
00000000
00000000
00000000
>
00000001
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME cave
WAL true

TIL ah
10000000
00000000
01000000
00000000
00000000
00000000
00000000
00000000
>
10000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME cave
WAL true

TIL ai
00000000
00000010
00001100
11110001
10000000
11000001
01010001
01000000
>
00000000
00000010
00001100
11110001
10000000
11000001
01000001
01000000
NAME cave
WAL true

TIL aj
00000000
01000000
00110000
00001111
10000001
00000010
10001010
10000010
>
00000000
01000000
00110000
00001111
10000001
00000010
10000010
10000010
NAME cave
WAL true

TIL ak
10000001
00000000
01000001
00000001
00000000
00000001
00000001
00000000
>
10000001
00000000
00000001
00000001
00000000
00000001
00000001
00000000
NAME cave
WAL true

TIL al
10000001
00000000
10000010
00000000
10000000
00000000
10000000
10000000
>
10000001
00000000
10000000
00000000
10000000
00000000
10000000
10000000
NAME cave
WAL true

TIL am
10000000
00000000
01000000
00000000
00000000
00000000
00111100
01111110
>
10000000
00000000
00000000
00000000
00000000
00000000
00111100
01111110
NAME cave
WAL true

TIL an
00000000
00000000
00000000
00010000
00101000
01000100
00000000
00000000
NAME cave

TIL ao
10000001
01000010
00111100
00000000
00000000
00000000
00000000
00000000
NAME cave

TIL ap
10101110
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME cavewall
WAL true

TIL aq
11111110
11111110
11111110
10011110
11011110
10010000
11000110
11011111
WAL true

TIL ar
11111111
11111111
11111111
11111001
10000011
00101011
11111001
10100011
WAL true

TIL as
11000000
11101111
10001100
11011001
11011101
11000100
11110110
11111111
WAL true

TIL at
00110111
01111111
00101011
10100001
10001101
11100001
11000111
11110111
>
00110111
01111111
00101011
10100001
10001101
11100001
11000111
11111111
WAL true

TIL au
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
NAME dark
WAL true

TIL av
00000001
00000011
00000111
00001111
00011111
00111111
01111111
11111111
NAME dark
WAL true

TIL aw
00000000
10000000
11000000
11100000
11110000
11111000
11111100
11111110
NAME dark
WAL true

TIL ax
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
NAME dark

TIL ay
01001010
01001110
01000000
01000000
01110000
01000000
01111000
01000000

TIL az
10101001
10111001
10000001
10000001
10000001
10000001
10000001
10000001

TIL b0
00011111
00100000
01000000
01000000
01000000
01000000
01000000
01000000
WAL true

TIL b1
11111100
10000010
10000001
10000001
10000001
10000001
10000001
10000001
WAL true

TIL b2
11111111
01111111
00111111
00011111
00001111
00000111
00000011
00000001
NAME dark
WAL true

TIL b3
11111110
11111100
11111000
11110000
11100000
11000000
10000000
00000000
NAME dark
WAL true

TIL b4
11111111
11111111
11111111
11111111
11101111
11000111
10000011
00000001
NAME dark
WAL false

TIL b5
00000000
00000010
01000111
11100111
11100010
01000010
01000100
00100000
NAME mushroom

TIL b8
00000001
00000001
00110001
00000001
00001101
00000001
00000001
11111111
WAL true

TIL ba
00000001
00000001
00000001
00000001
00000001
00000001
00000001
00000001
WAL true

TIL bb
00000001
00000001
00010001
00000001
00010001
00111001
00010001
00000001
>
00000001
00000001
00000001
00010001
00010001
00111001
00010001
00000001
WAL true

TIL bc
00000000
00000000
00010000
00000000
00010000
00111000
00010000
00010000
>
00000000
00000000
00000000
00010000
00010000
00111000
00010000
00010000
WAL false

TIL bd
00010000
00010000
00010000
00010000
00010000
00111000
00101000
00000000
WAL false

TIL be
00000000
01111110
10000001
10011001
10011001
10110101
10111101
01111110

TIL bf
00000000
00000000
01000000
01100000
01100100
01100110
01100110
01100110
NAME museum
WAL true

TIL bg
00000000
00000000
00000000
00000000
00000000
01000000
01100000
01100100
NAME museum
WAL true

TIL bh
11111111
01100110
01100110
01100110
01100110
01100110
01100110
01100110
NAME museum
WAL true

TIL bi
00000000
00000000
00000000
00000000
00000000
11111111
00000000
00000000
NAME museum

TIL bj
00000000
00000000
00000000
00000000
00000000
11000000
01000000
10000000
NAME museum

TIL bk
00000000
00000000
00000000
00000000
00000000
00000011
00000010
00000001
NAME museum

TIL bl
11000000
01100000
00110000
00010000
00011000
11111111
00000000
00000000
NAME museum

TIL bm
00000011
00000011
00000010
00000110
00011100
11111111
00000000
00000000
NAME museum

TIL bn
00000001
00000011
00100011
00100001
00111111
00011111
00000111
00000011
NAME museum

TIL bo
10000000
11000100
11000100
10000100
11111100
11111000
11100000
11000000
NAME museum

TIL bp
01111110
01111110
00100100
10100100
00000000
11111111
00000000
11111111
NAME museum

TIL bq
00000000
11111111
00000000
01111110
01111110
00100100
00100100
10000001
NAME museum

TIL br
11000000
11000000
01000000
01100000
00111000
11111111
00000000
00000000
NAME museum

TIL bs
00000011
00000110
00001100
00001000
00011000
11111111
00000000
00000000
NAME museum

TIL bt
00000100
00000001
11111111
10000000
01000000
00111100
00100000
01111111
>
00000001
00000010
11111111
10000000
01000000
00111100
00100000
01111111
WAL true

TIL bu
01000100
00000100
11111111
00000000
00000000
00000000
00000000
11111111
>
00000100
10000100
11111111
00000000
00000000
00000000
00000000
11111111
WAL true

TIL bv
10000000
01000000
11111111
00000001
00000010
00111100
00000100
11111110
>
00100000
10000000
11111111
00000001
00000010
00111100
00000100
11111110
WAL true

TIL bw
00100000
00100001
11111111
00000000
00000000
00000000
00000000
11111111
>
00100010
00100000
11111111
00000000
00000000
00000000
00000000
11111111
WAL true

TIL bx
01000100
01000000
01000100
01001010
11111111
00000001
00000010
11111100
>
01000000
01000100
01010001
01000100
11111111
00000001
00000010
11111100
WAL false

TIL by
00100010
00000010
00100010
01010010
11111111
10000000
01000000
00111111
>
00000010
00100010
10001010
00100010
11111111
10000000
01000000
00111111

TIL bz
00000000
00000010
00000000
11111000
00001100
00001000
00010100
11100000
>
00000010
00000101
00000010
11111100
00001000
00001100
00010000
11100100

TIL c0
00100000
01010000
00100000
00011111
00110000
00010000
00101000
00000111
>
00000000
00100000
00000000
00011111
00010000
00110000
00001000
00100111

TIL c1
00000000
00000000
00000000
00000010
10000101
00000010
10010000
00000000
>
00000000
00000000
00000000
00000000
00000010
10010000
00101000
10010000

TIL c2
00000000
00000000
00000000
00000000
00001000
01000001
10100000
01000001
>
00000000
00000000
00000000
00001000
00010101
00001000
01000001
00000000

TIL c3
01000010
01011010
01000010
00100100
00011000
00100100
00100100
01111110
WAL true

TIL c4
00000000
00001000
00001100
01010000
11010010
00101011
01010100
11111111

TIL c5
00000000
00000000
00000000
00000000
10001000
10101000
10101010
00000000
NAME grass
WAL true

TIL c6
00000000
00000000
00000000
00000000
00010000
01010001
01010101
00000000
NAME grass
WAL true

TIL c7
00000000
00000000
00000000
00000000
00100000
10100010
10101010
00000000
NAME grass
WAL true

TIL c8
00000000
00001000
00000000
00001000
00001000
00011100
00100110
00000010

TIL c9
00000010
00100110
00011100
00000000
00000000
00000000
00000000
00000000

TIL ca
00000000
00001000
00000000
00001000
00001000
00001000
00000000
00001000

TIL cc
11111111
00000010
11111010
00001010
00001010
11111010
00000010
11111110
NAME museum
WAL true

TIL cd
01101111
01101111
01100111
00110011
00011001
00001101
00001101
00000111

TIL ce
11111010
11111010
11110110
11101100
11011000
11010000
11010000
11100000

TIL cf
11000000
11110000
00001000
11110100
11111010
11111110
11111110
11111110

TIL cg
00000011
00001111
00011000
00110011
01100111
01101111
01101111
01101111

TIL ch
00000100
00011000
00100000
00111000
00011100
00000100
00000100
00000100

TIL ci
00100000
00100000
00100000
00011000
00000100
00011100
00111000
00100000

TIL cj
00011100
00100010
00101010
00100010
01001100
10011000
00110000
00100000

TIL ck
00000000
01010000
00100000
01010000
00001000
00000111
00000100
00000100

TIL cl
01100110
01100110
01100110
01100110
01100110
01100100
01100000
01100000
NAME vine
WAL true

TIL cm
01100000
01100000
01100000
01100000
00100000
00000000
00000000
00000000
WAL true

TIL cn
00110110
00110110
00110110
00110110
00110100
00110000
00010000
00000000
WAL true

TIL co
01100011
01100011
01100011
01100011
01100011
01000011
00000011
00000011
WAL true

TIL cp
00000011
00000011
00000011
00000011
00000011
00000001
00000000
00000000
WAL true

TIL cq
01010000
01110000
01010000
01010000
01110000
01010000
01110000
01110000
NAME museum

TIL cr
00000101
00000111
00000101
00000101
00000111
00000101
00000111
00000111
NAME museum

TIL cs
01010000
01010000
01010000
01010000
01010000
01010000
01010000
01010000
NAME museum
WAL true

TIL ct
00000101
00000101
00000101
00000101
00000101
00000101
00000101
00000101
NAME museum
WAL true

TIL cu
00000000
11111111
00001011
11111111
00000000
11111111
00000001
11111111
NAME museum

TIL cv
00000000
01111111
01101000
01111111
00000000
01111111
01000000
01111111
NAME museum

TIL cw
00000000
01111111
01000001
01011101
01010101
01011101
01000001
01111111
NAME museum
WAL true

TIL cx
01010100
01010010
01010010
01010001
01011111
10000000
10011111
01100000

TIL cy
10101010
10011010
01001010
00101010
11111010
00000001
11111001
00000110

TIL cz
01100000
10011111
10000000
01011111
01010100
01010010
01011010
01011001

TIL d0
00000110
11111001
00000001
11111010
10001010
10001010
01001010
00101010

TIL d1
00000101
00000111
11000101
00000101
11100111
00000101
11110111
00000111
NAME museum

TIL d2
01010000
01110000
01010001
01010000
01110011
01010000
01110111
01110000
NAME museum

TIL d3
00000000
00000000
00100000
00000000
00000000
00000000
00000010
00000000
NAME museum

TIL d4
00000000
11111111
00000000
11111111
10100100
10010010
01001010
00101001

TIL d5
10100100
10010010
01001010
00101001
11111111
00000000
11111111
00000000

TIL d6
01010100
01010010
01011010
01011001
01010100
01010010
01011010
01011001

TIL d7
10101010
10011010
01001010
00101010
10101010
10011010
01001010
00101010

TIL d8
10100100
10010010
01001010
00101001
10100100
10010010
01001010
00101001

TIL d9
11111111
01100000
01101111
01101000
01101000
01101111
01100000
01111111
NAME museum
WAL true

TIL da
00000000
01111111
01000000
01000000
01111111
01111111
00010000
11000111
NAME museum

TIL db
00000000
11111111
00000000
00000000
11111111
11111111
00000000
11111111
NAME museum

TIL dc
00000000
11111110
00000010
00000010
11111110
11111110
00001000
11100011
NAME museum

TIL dd
00000000
00000000
00011100
00100010
01001001
00100010
00011100
00000000
NAME museum

TIL de
00110010
00001100
00001011
11101000
00011100
00100011
00100000
01000000

TIL df
01010010
00101100
11011000
00101000
00010100
10100010
01110000
01001110

TIL dg
00000000
00000000
00000100
00001000
00010000
11010001
00110010
10011100

TIL dh
00000000
00000000
00000000
00000001
00110010
00001010
00000111
01000010

TIL di
11000000
01000000
01000000
01000000
01000000
01000000
01100000
01110000

TIL dj
00000011
00000110
00000100
00000100
00000100
00000100
00000110
00000111

TIL dk
11000000
11100000
11000000
10000000
10000000
10000000
10000000
10000000

TIL dl
00000000
00000000
00000000
00000001
00000011
00000010
00000011
00000011

TIL do
00000000
01110100
00000000
00011000
00000000
00000000
00000000
00000000
>
00000000
01011100
00000000
00101000
00000000
00000000
00000000
00000000
NAME museum
WAL true

TIL dp
00000000
00000000
00111000
01000100
10010010
01000100
00111000
00000000
NAME museum

TIL dq
00000000
10101110
10101010
10101010
01001010
01001010
01001110
00000000

TIL dr
00000000
10100010
10100010
10100011
10100010
10100010
11100010
00000000

TIL ds
00000000
10010010
10101010
10111010
10101010
10101010
10101001
00000000

TIL dt
00000000
10110001
10100001
10110001
10100001
10100001
00110001
00000000

TIL du
00000000
00011101
11010100
01010100
01010100
01010100
01011100
00000000

TIL dv
00000000
11010101
10010100
10011100
10010100
10010100
10010101
00000000

TIL dw
00000000
11010000
10011101
10010101
10010101
10010101
11010100
00000000

TIL dx
00000000
11000000
00000000
01000000
01000000
01000000
11000000
00000000

TIL dy
00000000
00000000
00111111
01101010
01111111
01000000
00000000
11111111

TIL dz
00000000
00000000
11111100
01010110
11111110
00000010
00000000
11111111

TIL e0
00100100
00110100
00100101
10100000
00100100
00001100
00100100
00000000

TIL e1
00100100
00100001
10100100
01000001
00100110
10101001
01010010
00100100

TIL e2
00100000
01000110
10010111
00000011
10011011
00011010
00110000
00110000

TIL e3
00000000
00000000
10001000
01110111
00100010
00110001
00010000
00000000

TIL e4
00000000
00000000
00000000
10001000
01110111
00100000
00011000
00000100

TIL e5
00001000
00001001
11010000
11000000
01100110
01100110
01000011
00010011

TIL e6
00101110
00000100
00000100
11111110
11101001
10000001
00100000
11000000

TIL e7
11000000
01000010
01100000
01111000
10001100
00001010
00000011
00001001

TIL e8
00000000
11100000
11000001
11100000
11000000
11000000
11000000
11000001

TIL e9
00000000
00000000
00000000
00000001
00000011
00001111
01011111
00000111

TIL ea
00110000
01001110
00100011
10010001
01100000
01000010
00100001
00010100

TIL eb
00000000
00001100
00010110
00000010
00010110
01001100
00000000
00000000

TIL ec
00000010
00000110
00001100
00001110
00111101
01100111
00111000
00001111

TIL ed
01000000
01100000
00110000
01110000
10111100
11100110
00011100
11110000

TIL ee
00000000
00000000
00000000
00000001
00000011
00000010
00000010
00000001

TIL ef
00000000
10000000
10000000
10000000
11000000
01000000
01000000
10000000

TIL eg
11000000
11100000
01110000
00111000
00011000
00110000
01100000
01110000

TIL eh
00000011
00000111
00001110
00001100
00011000
00011000
00110000
00111000

TIL ei
00010100
11101100
00001100
11001100
11111100
11111000
11110000
11100000

TIL ej
00010101
00011011
00011000
00011100
00001111
00000111
00000111
00000011

TIL ek
11100000
10010000
10001000
01010100
01001100
00100100
10000100
01111000

TIL el
00000011
00000100
00001000
00010110
00010001
00011100
00010010
00001010

TIL en
01011001
00111001
01111001
01101000
01001000
01001000
01001000
01101100
WAL true

TIL eo
00111000
01100000
00111001
00111001
01111101
00111101
01011111
00111001

TIL ep
00001110
00011000
10001110
01001110
00101111
00101111
00100111
00101111

TIL eq
00100110
01001110
10011110
00011010
00010010
00010010
00010010
00011011
WAL true

TIL er
10000010
11111110
10100010
10111110
10100010
11111110
10000010
11111111
NAME museum

TIL es
00000000
00000000
00000000
00000000
00000000
00000000
11111110
11111110
NAME museum
WAL true

TIL et
10001000
10101010
10001000
11111111
10001000
10101010
10001000
11111111

TIL eu
10000000
10110000
10000000
10101000
10000000
10110000
10000000
10101000
>
10000000
10101000
10000000
10110000
10000000
10101000
10000000
10110000

TIL ev
00000000
01010101
01000100
00010001
00000000
00000000
00000000
00000000
>
00000000
01010101
00010001
01000100
00000000
00000000
00000000
00000000

TIL ew
00000000
00001010
00000000
00000110
00000000
00001010
00000000
00000110
>
00000000
00000110
00000000
00001010
00000000
00000110
00000000
00001010

TIL ex
00100000
01111111
00110001
00110001
00100001
00100011
01100000
00000000

TIL ey
00001000
11111100
00011000
00011000
00001000
10001000
00001100
00000000

TIL ez
00000000
11111000
00001000
00101000
00001000
01001000
00001000
01101011
WAL true

TIL f0
00000001
00111111
00100000
00101000
00101101
00100000
00100011
10100001
WAL true

TIL f1
00000000
00111000
01010100
01100100
01111100
01000100
01000100
00111000

TIL f2
00000000
00111100
01000010
10001010
10100010
10001100
01110000
00000000

TIL f4
00000000
10000010
10111010
11000110
10000010
10111010
11000110
10000010
WAL true

TIL f5
10000010
10000010
10000010
10000010
10111010
11111110
11111110
10000010
WAL true

TIL f6
00000000
00000000
11111110
10000010
10000010
11111110
01111100
01000100

TIL f7
00000000
00000000
00000010
00111110
11100010
11100010
00111110
00000010

TIL f8
00110000
00110000
01111000
01001000
01001000
01001000
11111100
00000000

TIL f9
00000000
10000000
11111000
10001110
10001110
11111000
10000000
00000000

TIL fa
00111000
11010110
00010000
00111000
11010110
00010000
00010000
00000000
NAME tree
WAL true

TIL fb
00000000
00010000
00111000
01010100
00010000
00111000
11010110
00010000
NAME tree
WAL true

TIL fc
11111111
00000000
00000100
00000000
00010000
00000010
01000000
00000000
NAME sand

TIL fd
11101001
01000001
01000001
00000001
00000000
01000000
01000001
11100011
NAME bridge

TIL fe
00001000
00010001
00010000
00100011
00100000
01000111
01000000
11111111
WAL true

TIL ff
00100000
00010000
00010000
10001000
00001000
11000100
00000100
11111110
WAL true

TIL fg
00000000
00000010
00000001
00000010
00000010
00000100
00000100
00001000

TIL fh
01000000
10000000
00000000
10000000
10000000
01000000
01000000
00100000

TIL fi
00000000
11111111
01000000
11011111
01010000
11011111
01000000
11111111

TIL fj
00000000
11111110
00000100
11110110
00010100
11110110
00000100
11111110

TIL fk
00000000
00010100
00001000
00011100
00110110
01101011
00111110
00000000
>
00000000
00010100
00001000
00011100
00110110
01101011
00111110
00000000

TIL fl
00000000
11011000
00100100
00100010
00000010
00100010
11111100
00000000

TIL fm
00000000
00011101
00100010
01000010
01000010
01000000
00111111
00000000

TIL fn
00000000
00111000
01000100
01101100
01111100
01000100
01000100
00111000

TIL fo
00001000
00010001
00010000
00100001
00100010
01000100
01001000
11110000
WAL false

TIL fp
00100000
00010000
00010000
00001000
10001000
10000100
10000100
01111110
WAL true

TIL fq
11000000
01000000
01000000
11000000
01000000
01000000
11000000
01000000

TIL fr
00000000
11111111
00000000
11111111
00000000
11111111
00000000
11111111
NAME tileswall
WAL true

TIL fs
10101010
10101011
10101000
10101111
10100000
10111111
10000000
11111111
NAME tileswall
WAL true

TIL ft
10101010
10101010
00101010
11101010
00001010
11111010
00000010
11111110
NAME tileswall
WAL true

TIL fu
00000000
11111111
10000000
10111111
10100000
10101111
10101000
10101011
NAME tileswall
WAL true

TIL fv
10101010
10101010
10101010
10101010
10101010
10101010
10101010
10101010
NAME tileswall
WAL true

TIL fw
00000000
11111110
00000010
11111010
00001010
11101010
00101010
10101010
NAME tileswall
WAL true

TIL fx
00000000
11111110
10000010
10111010
10101010
10111010
10000010
11111110
NAME tileswall
WAL true

TIL fy
01000000
01011111
11010101
01011111
01000000
11011111
01010000
11011111
>
01000000
01011111
11010111
01011111
01000000
11011111
01010000
11011111

TIL fz
11100000
11001111
01010000
01011111
11000000
01011111
01010000
11011111
WAL true

TIL g0
00000000
00100000
00000000
00000111
00001111
00011000
00110011
00100111
WAL true

TIL g1
00000100
11110100
00010111
11110100
00000100
11110111
00010100
11110111
WAL false

TIL g2
00001111
11100111
00010100
11110100
00000111
11110100
00010100
11110111
WAL true

TIL g3
00000000
00100000
00000100
11000000
11100000
00110010
10011000
11001000
WAL true

TIL g4
10101010
10101010
10101011
10101010
10101010
10101011
10101010
10101011
WAL true

TIL g5
10101011
10101011
10101010
10101010
10101011
10101010
10101010
10101011
WAL true

TIL g6
11111111
10000000
10000100
10000000
10010000
10000010
10000000
10000000
NAME sand

TIL g7
10000000
00100000
00000100
00000000
00010000
00000010
01000000
00000000
NAME sand

TIL g8
00000000
01111111
01000001
01111111
00000000
01111111
01000001
01111111

TIL g9
00000000
00100000
00000100
00000000
00010000
00000010
01000000
00000000
NAME sandwall
WAL true

TIL ga
00000000
00100000
01101000
11101100
11101110
11111111
00000000
00000000
WAL true

TIL gb
10000001
10000001
10000001
10000001
10000001
10000001
10000001
10000001
NAME isl
WAL true

TIL gc
00000001
00000001
00000001
00000001
00000011
00001101
00110001
11000001
NAME islwall
WAL true

TIL gd
00011111
00100000
01000000
01000000
01000000
10000000
10000000
10000000
NAME islwall
WAL true

TIL ge
11111111
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME islwall
WAL true

TIL gf
00001111
00110000
01000000
10000000
10000000
10000000
11000000
10111111
NAME islwall
WAL true

TIL gg
01111110
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME bridge

TIL gh
00000001
00000001
00000001
00000001
01111111
10000001
11111111
10000001
NAME bridge

TIL gi
00000000
01001000
01001000
00100100
00100100
01001000
01001000
00000000
>
00000000
00100100
00100100
01001000
01001000
00100100
00100100
00000000
NAME steam

TIL gj
00000000
00001000
00010100
00011100
00010100
00100010
00100010
00100010
WAL true

TIL gk
00000000
00000000
00000000
00011000
00011100
00011100
00001000
00000000
>
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL gl
00000000
00000000
01000000
01000010
01111110
01000010
01000010
01000010
NAME ladder
WAL true

TIL gm
00011100
00100010
01001000
01010100
01000100
00111000
00000000
00111100
WAL true

TIL gn
11111111
00000000
00000000
00000000
00000000
00000000
00000000
11111111
NAME isl
WAL false

TIL go
10000001
10000001
10000001
10000001
10000001
10000001
10000001
10000001
NAME isl
WAL false

TIL gp
00000000
00000000
00000100
00000000
00100000
01010000
00000000
00000000
>
00000000
00000100
00001010
00000000
00000000
00100000
00000000
00000000
NAME magma
WAL true

TIL gq
01111110
01000010
01000010
01000010
01000010
00000000
00000000
11111111

TIL gr
00010000
00010000
00010000
00010000
00010000
00100000
11000000
00000000
WAL true

TIL gs
00001000
00001000
00001000
00001000
00001000
00000100
00000011
00000000
WAL true

TIL gt
00011100
00100010
01001000
01010100
01000100
00111000
00000000
00000000
NAME spiral

TIL gu
00000000
11100000
11110000
00011000
00001100
11000110
01100000
00110000
WAL false

TIL gv
00000000
00001111
00111111
00111000
01110000
11100011
11000110
11001100
WAL false

TIL gw
11001100
11001100
11000111
11100000
11100000
01111111
00111111
00000000

TIL gx
10011000
10011000
00011000
00111000
11111000
11110000
00000000
00000000

TIL gy
11101001
01000001
01000001
00000001
00000000
01000000
01000001
11100011
NAME bridge
WAL true

TIL gz
00111011
10111011
10011011
00000011
00000001
10000000
01101011
00000000
WAL true

TIL h0
11011111
11011111
11011111
10001110
00000000
00000000
11010111
00000000
WAL true

TIL h1
01111001
01111001
01111001
01110001
00000000
00000001
11010110
00000000
WAL true

TIL h2
10000000
10000000
00011001
10010000
10010011
00111011
10111011
10111011

TIL h3
01111101
00000100
00110101
00110001
01111000
01011001
01111000
01111001

TIL h4
11010110
00000001
00000001
01001000
01001001
00110000
00110001
01111001

TIL h5
10110010
00000000
00100000
00100000
01110000
00100000
11111000
11111000

TIL h6
01010110
10000000
10011100
00110010
10100000
00110010
10011100
10000000

TIL h7
11100000
00101110
10100100
10001011
10010101
11011111
11011111
11011111

TIL h8
01010110
10000000
10010001
00000000
10001000
00000000
10000010
10000010

TIL h9
11010110
00000001
00000001
00100000
00000001
00001000
00010101
00001001

TIL ha
10110010
00000000
00010000
00000000
10000100
01001010
01000100
00100000

TIL hb
00000001
01000000
00000001
00001001
00010100
10001001
00000000
00011001

TIL hc
00011001
11001101
11001101
01101101
01100000
00000001
11010110
00000000
WAL true

TIL hd
00011001
10011011
10110011
00110011
00110000
10000000
01101011
00000000
WAL true

TIL he
10000001
10010000
00101000
10010000
10000100
00001010
10100100
10000001

TIL hf
10000000
00001000
10010100
00101010
00011100
00000000
11010111
00000000
WAL true

TIL hg
00010010
10010101
10010010
01001000
00101000
00101000
00011000
10001000

TIL hh
01010110
10000000
10000000
00000000
10000000
00000000
10000000
10000000

TIL hi
10000000
10000000
00000000
10000000
10000001
00000001
10010101
10010101

TIL hj
01011100
00000010
10101010
00000010
11111110
00000000
11010111
00000000
WAL true

TIL hk
00011111
10100000
10101010
00100000
00111111
10000000
01101011
00000000
WAL true

TIL hl
00000001
00000001
00001001
10101001
11111100
00000001
11010110
00000000
WAL true

TIL hm
01001001
00100100
00000001
00000001
00000000
00000001
00000000
00000001

TIL hn
11010110
00000001
00000001
11000000
11100001
11100000
11111001
11111101

TIL ho
10110010
00000000
00000000
01000000
10100001
01000011
01000111
01001111

TIL hp
10100010
10100001
10100000
10100000
00010000
01010000
00010100
01010100

TIL hq
00001101
01010001
00100001
10111101
00000000
00000001
11010110
00000000
WAL true

TIL hr
11010110
00000001
00001001
00011100
10001001
01011100
01001001
01011101

TIL hs
10110010
00000000
00000000
11111111
00000000
00000000
01000001
00111110

TIL ht
01000001
10000000
00000001
00000001
00000000
00011001
11100000
10000001

TIL hu
00110101
10011000
10001001
00110110
00000000
10000000
01101011
00000000
WAL true

TIL hv
01010101
10001010
00100100
11011010
00000000
00000000
11010111
00000000
WAL true

TIL hw
01010110
10000000
10000000
00000111
10000010
00000001
10000001
10000001

TIL hx
10000001
10000010
00000100
10001111
10000000
00000000
10111111
10101000

TIL hy
00000000
00000000
00000001
11111110
01101000
01001000
11111111
10001000

TIL hz
00000011
00000101
00000101
00000101
00000101
00000101
00000101
00000011
NAME bridge
WAL true

TIL i0
10000000
01000000
01000000
01000000
01000000
01000000
01000000
10000000
NAME bridge
WAL true

TIL i1
11100000
00011100
00000010
00000001
00000001
00000001
00000011
11111101
NAME islwall
WAL true

TIL i2
01111110
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME bridgewall
WAL true

TIL i3
00000000
00000000
00110100
00000100
00100000
00101100
00000000
00000000
>
00000000
00000000
00101100
00100000
00000100
00110100
00000000
00000000
NAME doorwall
WAL true

TIL i4
00000000
00000000
00000000
00001000
00001100
00010000
00010000
00000000
>
00000000
00000000
00000000
00001000
00001100
00010000
00010000
00000000
NAME flowerwall
WAL true

TIL i5
00000100
00000110
01001000
11001000
00100000
00100000
00000000
00000000
NAME flowerwall
WAL true

TIL i6
00100000
01100010
00010011
00010100
01000100
11000000
00100000
00100000
NAME flowerwall
WAL true

TIL i7
10101010
10100010
10101010
10000010
10101010
10000010
01000100
00111000
>
10000010
10101010
10100010
10101010
10001010
10000010
01000100
00111000
WAL true

TIL i8
10000010
10101010
10001010
10100010
10101010
10000010
10001010
10000010
>
10001010
10000010
10101010
10101010
10000010
10101010
10001010
10100010
WAL true

TIL i9
10000011
01000100
00111001
10000000
01000100
00001001
10100010
10001010
>
00000000
10000011
01000100
00111001
10000000
00100100
00000001
10101010

TIL ia
11000000
00100000
10010000
00001000
00101000
10001000
01110000
00000000
>
00000000
11000000
00100000
00010000
01001000
00101000
10001000
01110000

TIL ib
00000111
00001000
00010001
00100100
00100000
00100011
00011100
00000000
>
00000000
00000111
00001000
00010011
00100000
00101000
00100011
00011100

TIL ic
00000000
00000000
00001000
00000010
00100100
01000000
00000000
00000000
>
00000010
00000000
00000001
00010010
00100000
00000000
00000000
00000000
WAL true

TIL id
00000000
00000000
00100000
10000000
01001000
00000100
00000000
00000000
>
10000000
00000000
00000000
10010000
00001000
00000000
00000000
00000000
WAL true

TIL ie
10010101
00100101
11000101
00011001
01100011
10001101
00110001
11000001

TIL if
10101001
10100100
10100011
10011000
11000110
10110001
10001100
10000011

TIL ig
10101010
10101010
10000000
10110110
10101010
10011100
10000000
10101010

TIL ih
00000010
00001100
00110000
01000110
10011000
10100010
10100100
10101000

TIL ii
11000000
00110000
10001100
01100010
00011001
11000101
00100101
10010101

TIL ij
10010101
01010101
01010101
01010101
01010101
01010101
01010101
01010101

TIL ik
10000001
00011110
01000000
01000010
01111110
01000010
01000010
01000010

TIL il
11111000
11111000
11110000
01111000
01111100
01111100
00111000
00010000

TIL im
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL in
11001100
00010001
01100110
00001000
00110010
00000100
00001000
00000000
>
00100010
11001100
00010001
01100110
00001000
00010000
00000000
00000000
WAL true

TIL io
00000000
00000000
00000000
00000000
00111000
01111100
11111111
11111111

TIL ip
00000000
00000000
00110000
11111100
01001000
01001000
11111110
11111111

TIL iq
00000000
00001100
00011100
00010100
00010100
00011100
00111110
01111110

TIL ir
00011100
01111111
00101010
00101010
00101010
01111111
01111111
11111111

TIL is
00001000
00001000
00010100
00011110
00111111
10111111
11111111
11111111

TIL it
00000000
00000000
00000000
00000000
00000000
10000000
11111100
11111110

TIL iu
00000000
00000000
00000000
00000000
00000000
00000000
00001000
00011100
>
00000000
00000000
00000000
00000000
00000000
00000000
00001000
00010100

TIL iv
00000000
00000000
00010000
00101000
00101000
00101000
00111000
01111100

TIL iw
00000000
00000000
00000000
00000000
01111000
01001000
01111000
00000000
>
00000000
00000000
00000000
00000000
00000000
01111000
01001000
01111000

TIL ix
00000000
00001110
00000000
00000000
01100000
00000000
00000000
00000000
>
00000000
00000110
00000000
00000000
01010000
00000000
00000000
00000000
NAME waves2
WAL false

TIL iy
00000010
00000010
00000010
00000010
00000010
00000010
00000010
00000010
WAL true

TIL iz
01000000
01000000
01000000
01000000
01000000
01000000
01000000
00111111

TIL j0
01000000
01000000
01000000
01000000
01000000
01000000
01000000
01000000
WAL true

TIL j1
11110110
00000000
11011010
11011010
00000000
10110110
10110110
00000000
NAME path

TIL j2
01110110
00000000
01011011
01011011
00000000
01110111
01110111
00000000
NAME path

TIL j3
10011011
10000001
01000100
01001001
00100001
10010000
01001100
00100011

TIL j4
11011001
10000001
00100010
10010010
10000100
00001001
00110010
11000100

TIL j5
00000010
00000010
00000010
00000001
00000001
00000000
00000000
00000000
WAL true

TIL j6
00011000
11100000
00000000
00000000
00000000
00000000
00000000
00000000

TIL j7
00011000
00000111
00000000
00000000
00000000
00000000
00000000
00000000

TIL j8
01000000
01000000
01000000
10000000
10000000
00000000
00000000
00000000
WAL true

TIL j9
01000000
01000000
01000000
01000000
01000000
01111111
10000000
11111111

TIL ja
00010000
00010111
00010000
00010111
00010011
11111111
00000000
11111111

TIL jb
00000010
00000010
00000010
00000010
00000010
11111110
00000001
11111111

TIL jc
00000000
00000000
00000000
00000000
00000000
11111110
00000001
11111111

TIL jd
00001000
11101000
00001000
11101000
11001000
11111111
00000000
11111111

TIL je
00000000
11100000
00110000
11011000
00001000
11101000
00001000
11101000

TIL jf
00000000
00000111
00001100
00011011
00010000
00010111
00010000
00010111

TIL jg
00001000
10100110
00000100
00000100
00000100
11111111
00000000
11111111

TIL jh
00100000
10011000
00010000
00010000
00010000
11001100
00001000
00001000

TIL ji
10000000
01100000
01000000
01000000
01000000
00110000
00100000
00100000

TIL jj
00000000
00000000
00000000
00000000
00000000
01111111
10000000
11111111

TIL jk
00000000
10000000
00000000
00000000
00000000
11000000
10000000
10000000

TIL jl
00000010
11001001
00000001
00000001
11000001
00100100
00010000
10010000

TIL jm
00010000
01100110
00100000
00100000
00100000
11111111
00000000
11111111

TIL jn
00000100
00011001
00001000
00001000
00001000
00110011
00010000
00010000

TIL jo
00000001
00000110
00000010
00000010
00000010
00001100
00000100
00000100

TIL jp
00000000
00000001
00000000
00000000
00000000
00000011
00000001
00000001

TIL jq
01000000
10011010
10000000
10000000
10000011
00100100
00001000
00001001

TIL jr
00010000
01100101
00100000
00100000
00100000
11001101
01000000
01000000

TIL js
00001000
01100110
00000100
00000100
00000100
11010011
00000010
00000010

TIL jt
00001000
01101000
00000100
00000011
00000000
11001010
00000000
00000000

TIL ju
10010000
00010010
00100000
11000000
00000000
01100110
00000000
00000000

TIL jw
00000000
10110010
00000000
00000000
00000000
00110010
00000000
00000000

TIL jx
00000000
11010010
00000000
00000000
00000000
11111111
00000000
11111111

TIL jy
00000000
01011010
00000000
00000000
00000000
11111111
00000000
11111111

TIL jz
11101000
10101000
11101000
11101000
11001000
11111111
00000000
11111111
>
11101000
11101000
11101000
11101000
11001000
11111111
00000000
11111111

TIL k0
00010111
00010111
00010110
00010111
00010011
11111111
00000000
11111111
>
00010111
00010111
00010111
00010111
00010011
11111111
00000000
11111111

TIL k1
00100010
00100010
00000000
00100010
00000000
00000010
00000000
00000000
>
00100010
00000010
00100000
00000010
00000010
00000000
00000000
00000000
WAL true

TIL k2
01000100
01000100
00000000
00000100
01000000
00000000
00000000
00000000
>
01000100
01000000
00000100
01000000
00000100
01000000
00000000
00000000
WAL true

TIL k3
11110011
10010010
10010010
10011111
10000000
11111111
11111111
00110000
WAL true

TIL k4
11001111
01001001
01001001
11111001
00000001
11111111
11111111
00001100
WAL true

TIL k5
00000000
00000000
11111111
00000000
11111111
00000000
11111111
00000000

TIL k6
01010100
01010010
01001001
00100100
00010011
00001000
00000111
00000000

TIL k7
00101010
01001010
10010010
00100100
11001000
00010000
11100000
00000000

TIL k8
00000000
00000000
00000111
00001000
00010011
00100100
00101001
00101010

TIL k9
00000000
00000000
11100000
00010000
11001000
00100100
10010100
01010100

TIL ka
00000000
00010000
00101000
00010010
00000101
01000010
00000000
00001100
>
00000000
00000000
00010000
00000000
01000010
10100000
01000000
00001100

TIL kb
00000000
00010000
00101000
00010000
00000010
01000000
00000000
00110000
>
00000000
00000000
00010000
00000010
01000101
10100010
01000000
00110000

TIL kc
00000000
01000000
01111111
01000000
01000000
01111111
01111111
01000000

TIL kd
00000000
00000000
11111111
00000000
00000000
11111111
11111111
00000000

TIL ke
00000000
00000010
11111110
00000010
00000010
11111110
11111110
00000010

TIL kf
00000000
00000000
00000000
00000000
10001000
10101000
10101010
00000000
NAME grass
WAL false

TIL kg
00000000
00000000
00000000
00000000
00010000
01010001
01010101
00000000
NAME grass
WAL false

TIL kh
00000000
00000000
00000000
00000000
00100000
10100010
10101010
00000000
NAME grass
WAL false

TIL ki
00000000
00000000
00010000
00000000
00010000
00111000
00010000
00010000
>
00000000
00000000
00000000
00010000
00010000
00111000
00010000
00010000
WAL true

TIL kj
01000000
01000000
01111111
01111111
01000000
01000000
01111111
01111111
NAME stairs

TIL kk
00000010
00000010
11111110
11111110
00000010
00000010
11111110
11111110
NAME stairs

TIL kl
00000010
00000010
11111110
11111110
00000010
00000010
11111110
11111110
WAL true

TIL km
01000000
01000000
01111111
01111111
01000000
01000000
01111111
01111111
WAL true

TIL kn
01011111
01010000
01011111
01010000
01011111
01000000
01111111
00000000
WAL true

TIL ko
11111010
00001010
11111010
00001010
11111010
00000010
11111110
00000000
WAL true

TIL kp
11110100
00010100
11110010
00001010
11111010
00001010
11111010
00001010

TIL kq
00101111
00101000
01001111
01010000
01011111
01010000
01011111
01010000

TIL kr
00000000
00000000
00000111
00001000
00010011
00100100
00101111
00101000

TIL ks
00000000
00000000
11100000
00010000
11001000
00100100
11110100
00010100

TIL kt
00000000
00000000
01111111
01000000
01000000
01111111
01111111
00101010
WAL true

TIL ku
00000000
00000000
11111100
00000100
00000100
11111100
11111100
10101000
WAL true

TIL kv
10101000
10101000
10101000
10101000
10101100
11111100
00000000
00000000
WAL false

TIL kw
00101010
00101010
00101010
00101010
01101010
01111111
00000000
00000000
WAL false

TIL kx
00000000
00001100
00100010
01000000
01000100
00001000
00001000
00000000

TIL ky
00000000
01100000
00010000
00000100
00000010
00010010
01100000
00000000

TIL kz
00000000
00000000
00010000
00110000
00011000
00011100
00001000
00000000
>
00000000
00000000
00010000
00110100
00011000
00011100
00001000
00000000

TIL l0
00000000
00000000
00001000
00101100
00011000
00111000
00010000
00000000
>
00000000
00000000
00001000
00001100
00011000
00111000
00010000
00000000

TIL l1
00000000
00000000
00000000
00100000
01100000
00110000
00111000
00010000

TIL l2
00000000
00000000
00000100
00000110
00001100
00011100
00001000
00000000

TIL l3
00000000
00000000
00000000
01101100
01010100
00111000
00000000
00000000

TIL l4
00000000
00000000
00111100
00100100
00111100
00100100
00111100
00000000

TIL l5
00000000
00000000
10000000
10100000
10101100
11111100
00000000
00000000
WAL false

TIL l6
00000000
10011010
00000000
00000000
00000011
00100100
00001000
00001001

TIL l7
00000000
11001011
00000000
00000000
11000000
00100101
00010000
10010000

TIL l8
00000000
01111111
00000000
00111111
00000000
00001111
00000000
00000011

TIL l9
00000000
11111100
00000000
11111000
00000000
11100000
00000000
10000000

TIL la
00000000
00010000
00010000
00000010
00010000
00000010
00000000
00000010
>
00000000
00010000
00000000
00000010
00010010
00010000
00000010
00000000
NAME cave

TIL lb
00001100
00010001
01100110
10001000
00110011
01000100
10011001
00100010
>
00000010
00001100
00010001
01100110
10001000
00110011
01000100
10011001
WAL true

TIL lc
00001000
00010100
00100010
01000001
10000000
01000001
00100010
00010100

TIL ld
00000000
00000000
00000000
00000000
10000000
00000000
00000000
00000000

TIL le
00001000
00000010
00100011
01100100
00010100
00010000
00000000
00000000

TIL lf
00000000
01111111
01000000
01000000
01111111
01111111
00010000
00000000

TIL lg
00000000
11111111
00000000
00000000
11111111
11111111
00000000
00000000

TIL lh
00000000
11111110
00000010
00000010
11111110
11111110
00001000
00000000

TIL li
00000001
00000001
00000001
00000001
00000001
00000001
00000001
11111111
WAL true

TIL lj
11111111
00000001
00000001
00000001
00000001
00000001
00000001
11111111

TIL lk
11111111
10000000
10000000
10000000
10000000
10000000
10000000
11111111
WAL true

TIL lm
10000100
10000100
10000100
10000100
10000100
10000100
10000100
10000111

TIL ln
00001000
00000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL lo
00001000
00000000
00000000
00000000
10000000
00000000
00000000
00000000

TIL lp
10000000
10000000
10000111
10011000
00100000
01000000
10000000
10000000
WAL true

TIL lq
01000000
01000000
01000000
01000000
01000000
01000000
01000000
11010110
>
01000000
01000000
01000000
01000000
01000000
01000000
01000000
01101010

TIL lr
00000010
00000010
00000010
00000010
00000010
00000010
00000010
11010110
>
00000010
00000010
00000010
00000010
00000010
00000010
00000010
01101010

TIL ls
01000000
01000000
01000000
01000000
01000000
01000000
01000000
01000000
WAL true

TIL lt
00000010
00000010
00000010
00000010
00000010
00000010
00000010
00000010
WAL true

TIL lu
00011000
00000101
00000100
00000101
00011000
00100000
01000000
01000000

TIL lv
00010000
00100000
01000000
01000000
01000000
01000000
01000000
00100000

TIL lw
00011000
10100000
00100000
10100000
00011000
00000100
00000010
00000010

TIL lx
00001000
00000100
00000010
00000010
00000010
00000010
00000010
00000100

TIL ly
00000000
00000000
00000000
00000000
00000000
10000000
01100000
00010000

TIL lz
00000000
00000000
00000000
00000000
00000000
00000001
00000110
00001000

TIL m0
00000001
00000011
00000010
00011111
01100000
10000000
00000000
00000000

TIL m1
10000000
11000000
01000000
11111000
00000110
00000001
00000000
00000000

TIL m2
11110000
00001111
11110001
00001111
11110001
00001111
00000000
00000000
>
00001111
11110001
00001111
11110001
00001111
11110000
00000000
00000000

TIL m3
00000001
00000001
00000001
00000001
00000001
00000001
00000001
00000001

TIL m4
00000000
00000000
00000000
00000000
00000000
00000001
00000010
00000001

TIL m5
00000000
00000000
00000000
00000000
00000000
00000000
10000000
00000000

TIL m6
00000000
00011100
00100010
01000001
01011101
01001001
00100010
00011100

TIL m7
00000000
10110110
00000000
10110110
00000000
00000000
00000000
00000000

TIL m8
10000001
00000001
11000010
00001100
11100110
00000010
11110000
00000110
>
10000001
00000001
11000010
00001100
11100110
00000010
11110000
00000010

TIL m9
10000001
10000000
01000011
00110000
01100111
01000000
00001111
11000000
>
10000001
10000000
01000011
00110000
01100111
01000000
00001111
01100000

TIL ma
10011011
10000001
01000100
01001001
00100001
00010000
00001100
00000011

TIL mb
11011001
10000001
00100010
10010010
10000100
00001000
00110000
11000000

TIL mc
11000000
00110000
00001000
10000100
10010010
00100010
10000001
11011001

TIL md
00000011
00001100
00010000
00100001
01001001
01000100
10000001
10011011

TIL me
00011100
00111110
01000111
00000011
00000011
01000111
00111110
00011100

TIL mf
00000000
00000000
00000111
00011000
00100011
01000000
10011111
10000000
WAL true

TIL mg
00000000
00000000
11100000
00011000
11000100
00000010
11111001
00000001
WAL true

TIL mh
10111111
10000000
01000111
00110000
01100111
01000000
01011111
01000000
WAL false

TIL mi
11111101
00000001
11100010
00001100
11100110
00000010
11111010
00000010

TIL mj
00000100
00011100
00000100
00001100
00000100
00000100
00000100
00000100

TIL mk
00100000
00100000
00100000
00100000
00100000
00100000
00100000
00100000

TIL ml
00000000
00000001
00000010
00000100
00000101
00000100
00000101
00001100
WAL true

TIL mm
00000000
00000001
00000010
00000100
00000100
00000100
00000100
00001100
WAL true

TIL mn
00000010
00000010
00000010
00001100
00010000
00001110
00000100
00001100
WAL true

TIL mo
00000000
00000001
00000010
00000100
00000111
00000111
00000111
00001100
WAL true

TIL mp
00111000
00001001
00001110
00000100
00000101
00000100
00000100
00001100
WAL true

TIL mq
00000000
10000000
01000000
00100000
01100000
10100000
01100000
00110000
WAL true

TIL mr
00000000
10000000
01000000
00100000
00100000
00100000
00100000
00110000
WAL true

TIL ms
00011100
10010000
01110000
00100000
10100000
00100000
00100000
00110000
WAL true

TIL mt
00000000
10000000
01000000
00100000
11100000
11100000
11100000
10110000
WAL true

TIL mu
01000000
01000000
01000000
00110000
00001000
01110000
00100000
00110000
WAL true

TIL mv
00010000
00100000
00111100
00100000
00110111
00100101
00110111
00100010
WAL true

TIL mw
00001000
00000100
00000100
00000100
00000100
10000100
00000100
00000100
WAL true

TIL mx
00100000
00100010
00100000
00100010
00100000
00100000
00100000
00100000

TIL my
00000000
00000000
00000000
00000000
00000001
00000010
00000010
01011010

TIL mz
00000000
00000000
00000000
00000000
10000000
01000000
01000000
01001011

TIL n0
10101110
00000000
00000000
00000000
00100000
00010000
00010000
00010011

TIL n1
10101110
00000000
00000000
00000000
00000000
00000100
00001000
01001001

TIL n2
10101110
00000000
00000000
00000000
00000000
00000000
00000000
01101011
NAME cave
WAL true

TIL n3
01001101
01000000
01001111
01000000
01000000
01111111
10000000
11111111
WAL true

TIL n4
11010010
00000010
01010010
00000010
00000010
11111110
00000001
11111111
WAL true

TIL n5
10000010
01000010
01000010
10000010
00000010
00000010
10110010
00000010
WAL true

TIL n6
00000000
00000000
11110000
00001000
00000100
00000010
11000010
00100010
WAL true

TIL n7
01000100
01000101
01000100
01000011
01000000
01000000
01001011
01000000
WAL true

TIL n8
00000000
00000000
00001111
00010000
00100000
01000000
01000001
01000010
WAL true

TIL n9
01000100
01000011
01000000
01000000
01000000
01111111
01111111
00011000
WAL true

TIL na
00000010
10000010
00000010
00000010
00000010
11111110
11111110
00011000
WAL true

TIL nb
00000000
11111110
00000010
00000010
10000010
01000010
11000010
11000010
WAL true

TIL nc
00000000
01111111
01000000
01000000
01000011
01000100
01000101
01000101
WAL true

TIL nd
00000000
00000000
00000000
00010001
01000100
01010101
00000000
01111111
>
00000000
00000000
00000000
01000100
00010001
01010101
00000000
01111111

TIL nf
11111111
00100000
00100000
00100000
00100000
00000000
00000000
00000000

TIL ng
00000100
00000100
00011100
11100100
10000100
10011100
11100100
00000100
>
00000100
11111100
10000100
10000100
11111100
00000100
00000100
00000100
NAME flag
WAL true

TIL nh
00000000
00000100
00011100
11100100
10000100
10011100
11100100
00000100
>
00000000
11111100
10000100
10000100
11111100
00000100
00000100
00000100
NAME flag
WAL true

TIL ni
00011111
00100100
01000100
01000100
01000100
10000000
10000000
10000000

TIL nj
11111111
00000100
00000100
00000100
00000100
00000000
00000000
00000000

TIL nk
00000000
00000000
00000000
00000000
00000000
00010000
01100000
11000000
WAL true

TIL nl
00100000
00100000
00111000
00111111
00111111
00111111
00100111
00100000
>
00100000
00111111
00111111
00111111
00111111
00100000
00100000
00100000
NAME flag
WAL true

TIL nm
00000000
00000100
00011100
11111100
11111100
11111100
11100100
00000100
>
00000000
11111100
11111100
11111100
11111100
00000100
00000100
00000100
NAME flag
WAL true

TIL nn
00000100
00000100
00011100
11111100
11111100
11111100
11100100
00000100
>
00000100
11111100
11111100
11111100
11111100
00000100
00000100
00000100
NAME flag
WAL true

TIL no
10000000
10100000
10000100
10000000
10010000
10000010
10000000
10000000
NAME sand

TIL np
00000100
10001000
01010000
00100000
01000000
10000000
00000000
00000000
WAL true

TIL nq
00000000
00000000
00000000
00000000
00000000
00000000
00000001
00000010
WAL true

TIL nr
00000000
00000000
00000000
00000000
00100000
01010000
10001000
00000100
WAL true

TIL ns
10001010
01110001
00000000
00000000
00000000
00000000
00000000
00000000
WAL true

TIL nt
00000000
00000000
00000000
00010000
00101000
00010000
00000000
00000000
>
00000000
00000000
00000000
00000000
00010000
00000000
00000000
00000000
NAME sparklewall
WAL true

TIL nu
00000000
00000000
00000000
00000000
00010000
00000000
00000000
00000000
>
00000000
00000000
00000000
00010000
00101000
00010000
00000000
00000000
NAME sparklewall
WAL true

TIL nv
00000001
00000010
00001100
00110000
11000000
00000000
00000000
00000000

TIL nw
00000000
00000000
00000000
00000000
00000001
00001110
11110000
01000000

TIL nx
00000000
00000000
00000000
00000000
10000000
01110000
00001111
00000010

TIL ny
10000000
01000000
00110000
00001100
00000011
00000000
00000000
00000000

TIL nz
00000010
00000010
00000010
00000011
00000000
00000000
00000000
00000000
>
00000010
00000001
00000001
00000001
00000000
00000000
00000000
00000000

TIL o0
01000000
01000000
01000000
11000000
00000000
00000000
00000000
00000000
>
01000000
00100000
00100000
11100000
00000000
00000000
00000000
00000000

TIL o1
00000010
00000010
00000010
00000011
00100000
01010000
10001000
00000100
>
00000010
00000001
00000001
00000001
00100000
01010000
10001000
00000100

TIL o2
01000000
01000000
01000000
11000000
00000000
00000000
00000001
00000010
>
01000000
00100000
00100000
11100000
00000000
00000000
00000001
00000010

TIL o3
00000000
00000000
11110000
00001000
00000100
11000010
00100010
10010010
WAL true

TIL o4
00000000
00000000
00001111
00010000
00100000
01000011
01000100
01001001
WAL true

TIL o5
01001001
01000100
01000011
01000000
01000000
01000000
01001011
01000000
WAL true

TIL o6
10010010
00100010
11000010
00000010
00000010
00000010
10110010
00000010
WAL true

TIL o7
10101010
00000000
01010101
00000000
10101010
00000000
00000000
11111111

TIL o8
10101010
00000000
01010101
00000000
10101010
00000000
01010101
00000000

TIL o9
10000000
10000000
10000000
01000000
00110100
01000000
10000000
10000000

TIL oa
00000010
00000010
00000010
00001100
10110000
00001100
00000010
00000010

TIL ob
00000010
00000011
00000000
00000000
00000000
00000000
00000000
00000000
WAL true

TIL oc
00000000
00000000
11110000
00001000
01000100
10100010
01000010
00010010
WAL true

TIL od
00000000
00000000
00001111
00010000
00100000
01000100
01001010
01000100
WAL true

TIL oe
01010001
01000010
01000001
01001000
01000000
01000000
01001011
01000000
WAL true

TIL of
00101010
10010010
00000010
01000010
00000010
00000010
10110010
00000010
WAL true

TIL og
01100110
01100110
01100110
01100110
01100110
01100110
01100110
11111111
NAME museum
WAL true

TIL oh
00000100
00001000
00010000
00100000
00000000
10000000
00000000
00000000
WAL true

TIL oi
00000000
10000000
01000000
00100000
00010000
00000000
00000100
00000000
WAL true

TIL oj
00000001
00000010
00000011
00000000
00000000
00000000
00000000
00000000
NAME museum

TIL ok
10000000
01000000
11000000
00000000
00000000
00000000
00000000
00000000
NAME museum

TIL ol
00000000
00000000
11111111
00000000
00000000
00000000
00000000
00000000
NAME museum

TIL om
00000000
00000000
01111111
01000001
01011101
01000001
01111111
01111111

TIL on
00000000
00000000
00000000
00000000
00000000
00000000
01111110
10000001
NAME bridge

TIL oo
00000000
00000000
00000000
00000000
00011111
00100100
01001001
11111111
WAL true

SPR 10
10011110
10011110
10010010
10011110
11000000
10110000
10001100
10000011
DLG u
POS 8 10,3

SPR 11
00111100
01000010
11111111
01011010
11000011
01111110
11000011
11111111
POS 8 9,1

SPR 12
00000000
00000000
00000000
00000000
00011100
00011100
00010000
00010000
>
00000000
00000000
00000000
00000000
00010000
00011100
00011100
00010000
POS 8 9,0

SPR 13
10111001
00111000
01111101
11111100
01111101
00101000
00101011
10000000
DLG v
POS 9 9,6

SPR 14
00000000
00000000
00011111
00100000
00000000
00100000
00000000
00100000
>
00000000
00000000
00111111
00000000
00100000
00000000
00100000
00000000
POS 9 8,6

SPR 15
00000000
00100000
00000000
00100000
10001000
00000000
01110000
00000000
>
00100000
00000000
00100000
00000000
01010000
00100000
00000000
00000000
DLG w
POS 9 8,7

SPR 16
00000000
00011000
11111111
01100010
01000010
01100110
00111100
00000000
DLG x
POS 9 13,2

SPR 17
00000000
11111011
00000011
11110110
00000110
10011110
00100000
10001010
DLG 11
POS a 9,7

SPR 18
00000000
11111000
00000010
00100111
01110101
01010111
01110000
00000010
DLG 10
POS a 10,8

SPR 19
00010010
10111010
00101010
00111000
00000100
01101110
00001010
01101110
POS a 10,9

SPR 20
00000000
11101110
10000010
10011111
10001110
10101010
10000000
11111100
DLG 1i
POS n 10,8

SPR 21
00000000
00011100
00010000
00111110
00011100
00010100
00000000
00000000
DLG 1l
POS p 9,3

SPR 22
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 1m
POS q 9,12

SPR 23
01111110
01000010
01010010
01000010
01011010
01000010
01111110
01000010
>
01111110
01000010
01000010
01000010
01011010
01000010
01111110
01000010
DLG 1n
POS q 10,12

SPR 27
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 1s
POS s 11,12

SPR 28
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 1t
POS u 4,12

SPR 29
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 1u
POS u 14,12

SPR 30
00100000
01111110
01111110
01010110
01101010
01010110
01111110
00100100
>
00100000
01111110
01111110
01101010
01010110
01101010
01111110
00100100
DLG 28
POS 10 14,6

SPR 31
00100000
01111110
01111110
01010110
01101010
01010110
01111110
00100100
>
00100000
01111110
01111110
01101010
01010110
01101010
01111110
00100100
DLG 29
POS 10 14,11

SPR 32
00100000
01111110
01111110
01010110
01101010
01010110
01111110
00100100
>
00100000
01111110
01111110
01101010
01010110
01101010
01111110
00100100
DLG 2a
POS 10 3,8

SPR 33
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 2b
POS 11 14,12

SPR 34
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 2c
POS 11 5,12

SPR 35
00000000
01111100
01111100
01000100
01111100
00010000
00010000
10111011
DLG 2d
POS w 6,12

SPR 36
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 2e
POS 12 10,12

SPR 37
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 2f
POS 12 5,12

SPR 38
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 2g
POS 13 2,12

SPR 39
10000010
10011010
10011000
10111100
10111100
10111100
10100100
10000000
DLG 2h
POS 10 13,7

SPR 40
00000000
00110001
01001010
00000000
00110001
01001010
00000000
00000000
POS 1n 5,9

SPR 41
00000000
10000000
01000000
00000000
10000000
01011000
00000110
00000001
POS 1n 6,9

SPR 42
00011100
00111110
00101010
00111110
00011100
00000000
00000000
00000000
DLG 39
POS 1n 5,10

SPR 43
00100010
01100100
00011000
00001000
00000100
00000000
00000000
00000000
DLG 3a
POS 1n 6,10

SPR 44
00000000
00000000
01111110
01000010
01011010
01000010
01111110
00000000
DLG 3b
POS 1n 4,9

SPR 45
00011100
00111100
00010100
01011110
01111110
01011100
01010100
00000000
DLG 3e
POS 1o 12,1

SPR 46
00111000
00111100
00101000
01111010
01111110
00111010
00101010
00000000
DLG 3f
POS 1p 6,3

SPR 47
00000000
00000010
01000011
11011100
00111110
00011100
00100010
00000000
>
00000000
01000000
11000010
00111011
01111100
00111000
01000100
00000000
DLG 3g
POS 1q 7,6

SPR 48
00000000
00000000
00000000
00000000
00000000
00000000
00101010
00011100
>
00000000
00000000
00000000
00000000
00000000
00000000
01010100
00111000
POS 1q 7,5

SPR 49
00000000
00000010
01000011
11011100
00111110
00011100
00100010
00000000
>
00000000
01000000
11000010
00111011
01111100
00111000
01000100
00000000
DLG 3h
POS 1q 5,7

SPR 50
10000000
10000011
10000010
10000010
10111100
10100001
10111100
10000010
POS 1x 11,0

SPR 51
01111110
01000010
00111100
00010100
00111100
00111100
00111100
00100100
>
00000000
01111110
01000010
00111100
00010100
00111100
00111100
00100100
DLG 3x
POS 1x 14,1

SPR 52
00000000
00011100
00010110
01111110
00011010
00000110
00011100
00010100
DLG 40
POS d 13,7

SPR 53
01000100
01000100
01000100
00100100
01100011
10000000
10000000
00000010
POS 1z 7,5

SPR 54
00000001
00000001
00000100
00001010
00000100
00100000
00000000
00000000
>
00000001
00000001
00000000
00000100
00100000
01010000
00100000
00000000
POS 1z 6,6

SPR 55
00100001
00001100
10010010
01010010
00011110
01010010
01001100
01000000
POS 1z 7,6

SPR 56
00000000
00000010
00000000
00100000
00001000
10010100
01001000
01000011
>
00000010
00000101
00100010
01010000
00100000
10001000
01000000
01000011
POS 1z 8,5

SPR 57
01000000
01000000
10000100
00001010
00000100
00000000
10000000
10000000
>
01000000
01000000
10000000
00000100
00000000
00000000
10000000
10010000
POS 1z 8,6

SPR 58
00101010
00101010
00110001
00110001
00110101
00110001
01100100
00001010
>
00101010
00101010
00110001
00110101
00110001
00110101
01100000
00000100
POS 1z 7,7

SPR 59
10010000
10000000
10000100
00001010
10000100
10000000
11001000
00000000
>
10101000
10010000
10000000
00000100
10000000
10001000
11010100
00001000
POS 1z 8,7

SPR 60
00101101
00111101
00011100
00111100
00101100
00100100
00100110
00000000
DLG 42
POS 1z 11,11

SPR 61
00000000
00000000
01111111
01000001
01011101
01000001
01111111
01111111
DLG 4a
POS 1z 5,11

SPR 62
00000000
01111110
01000010
01011010
01000010
01111110
00000000
11010101
DLG 4b
POS 20 10,5

SPR 63
11001100
00010001
01100110
10001000
00110011
01000100
10011001
00100010
>
00100010
11001100
00010001
01100110
10001000
00110011
01000100
10011001
DLG 4c
POS 1z 7,11

SPR 64
00111000
00001000
00111000
01111100
01111100
00111000
00101000
00000000
DLG 4d
POS 20 13,7

SPR 65
00000000
00111000
01101000
01111110
01100000
01011000
00111000
00101000
DLG 4e
POS d 11,7

SPR 66
11001100
00010001
01100110
10001000
00110011
01000100
10011001
00100010
>
00100010
11001100
00010001
01100110
10001000
00110011
01000100
10011001
DLG 4f
POS 26 5,14

SPR 67
00000000
00111000
00100000
00111000
01111100
01111100
00111000
00101000
DLG 4g
POS 21 6,5

SPR 69
10111001
00111000
01111101
11111100
01111101
00101000
00101011
10000000
DLG 4h
POS 25 7,9

SPR 70
00000000
00000000
00000100
00001010
00000100
00000000
00001000
11000000
>
00000000
00000000
00000000
00000100
00000000
00001000
00010100
11001000
POS 2i 6,5

SPR 71
00000000
00000000
00000100
00001010
00000100
00000000
00001000
11000000
>
00000000
00000000
00000000
00000100
00000000
00001000
00010100
11001000
POS 2j 6,5

SPR 72
00000000
11111111
10000000
10010011
10101000
10010011
10000000
10101011
>
00000000
11100011
00001000
01111011
00101000
10111101
10100000
10001011
DLG 4r
POS 2e 9,8

SPR 73
01000100
01000100
01000100
00100100
01100011
10000000
10000000
00000010
POS 2k 7,5

SPR 74
00000001
00000001
00000100
00001010
00000100
00100000
00000000
00000000
>
00000001
00000001
00000000
00000100
00100000
01010000
00100000
00000000
POS 2k 6,6

SPR 75
00100001
00001100
10010010
01010010
00011110
01010010
01001100
01000000
POS 2k 7,6

SPR 76
00000000
00000010
00000000
00100000
00001000
10010100
01001000
01000011
>
00000010
00000101
00100010
01010000
00100000
10001000
01000000
01000011
POS 2k 8,5

SPR 77
01000000
01000000
10000100
00001010
00000100
00000000
10000000
10000000
>
01000000
01000000
10000000
00000100
00000000
00000000
10000000
10010000
POS 2k 8,6

SPR 78
00101010
00101010
00110001
00110001
00110101
00110001
01100100
00001010
>
00101010
00101010
00110001
00110101
00110001
00110101
01100000
00000100
POS 2k 7,7

SPR 79
10010000
10000000
10000100
00001010
10000100
10000000
11001000
00000000
>
10101000
10010000
10000000
00000100
10000000
10001000
11010100
00001000
POS 2k 8,7

SPR A
00000000
00111000
01000100
01011100
01011100
01000000
00111100
00000000
POS 2l 6,8

SPR f
00000000
00000000
00111100
01000010
01011010
01000010
01010010
01000010
DLG 3
POS 1 3,3

SPR g
00100000
00110000
00111000
00111100
00111110
00110000
11111111
01111110
>
00000000
00100000
00110000
00111000
00111100
00111110
00110000
11111111
DLG 4i
POS 25 9,10

SPR h
00000000
01111110
01000010
01111111
00100001
01111111
01000010
01111110
DLG 6
POS 4 4,5

SPR i
00000000
01111110
01000010
01011010
01000010
01010010
01000010
01111110
DLG 5
POS 3 9,8

SPR j
00000000
01111110
01000010
01111111
00100001
01111111
01000010
01111110
DLG 7
POS 4 8,12

SPR k
00000000
01111110
01000010
01111111
00100001
01111111
01000010
01111110
DLG 8
POS 4 12,7

SPR l
00000000
00111000
00010000
00111000
01100100
01000100
00111000
00000000
>
00000000
00111000
00010000
00111000
01010100
01100100
00111000
00000000
DLG 9
POS 4 12,9

SPR m
00000000
00110000
01001000
01111000
01001000
01101000
01001011
00110011
DLG a
POS 4 6,7

SPR n
00000000
00000000
01111100
10100010
00100110
00111110
10011100
10100010
>
00000000
00000000
01111100
10100010
00110010
10111110
10011100
10100010
POS 4 7,7

SPR o
00000000
00111000
00010000
00111000
01100100
01000100
00111000
00000000
>
00000000
00111000
00010000
00111000
01010100
01100100
00111000
00000000
DLG b
POS 4 3,6

SPR p
00000000
00111000
00010000
00111000
01100100
01000100
00111000
00000000
>
00000000
00111000
00010000
00111000
01010100
01100100
00111000
00000000
DLG c
POS 4 11,7

SPR q
00000000
00111000
00010000
00111000
01100100
01000100
00111000
00000000
>
00000000
00111000
00010000
00111000
01010100
01100100
00111000
00000000
DLG d
POS 4 8,5

SPR r
00000000
00000000
00111100
01000010
01111110
01111110
01111110
00111100
DLG e
POS 4 10,4

SPR s
00000000
00000000
00000000
00000000
00010000
00000000
00000100
00000000
>
00000000
00000000
00000000
00000000
00001000
00000000
00010000
00000100

SPR t
00000000
00011000
11100111
00100100
00011000
11111111
00101010
00100010
DLG f
POS 5 3,8

SPR u
00001000
00011000
11111111
00111100
00011000
11111111
00101010
00100010
>
00000000
00011000
11111111
00111100
00011000
11111111
00101010
00100010
DLG h
POS 6 3,8

SPR v
00000000
00000000
00000000
00000000
00000100
00000110
00001100
00011100
>
00000000
00000000
00000000
00000100
00010110
00001100
00011100
00001000
DLG i
POS 6 3,7

SPR w
00000000
00000000
00000000
00000000
00000100
00000110
00001100
00011100
>
00000000
00000000
00000000
00000100
00010110
00001100
00011100
00001000
POS 5 0,5

SPR x
00000000
00000000
00000000
10000010
01111100
10000010
00000000
00000000
>
00000000
00000000
10000010
01111100
10000010
00000000
00000000
00000000
DLG r
POS 7 8,6

SPR y
00000000
00011100
00111110
00101010
00111110
00011100
00000000
00000000
>
00011100
00111110
00101010
00111110
00011100
00000000
00000000
00000000
DLG s
POS 7 9,7

SPR z
00000000
00110110
01001001
00110110
01001001
00110110
01000001
00000000
>
00110110
01001001
00110110
01001001
00110110
01000001
00000000
00000000
DLG q
POS 7 9,6

SPR 1a
00000000
00100111
01110000
01010010
01010111
01110101
00000101
11100111
DLG z
POS a 9,9

SPR 1b
11000111
10000000
10010001
10111100
10100101
10100100
10011001
10000000
DLG y
POS 9 9,5

SPR 1c
00011100
00000100
00111110
00011100
00010100
00000000
00000000
00000000
>
00011100
00000100
00111110
00011100
00010100
00000000
00000000
00000000
DLG 13
POS c 8,8

SPR 1d
00101100
00111100
00111000
00111100
00110100
00100101
01100101
00000001
POS b 7,12

SPR 1e
00000000
00000000
00011000
00111100
10111100
10111001
10011001
11111111
POS b 7,11

SPR 1f
01101000
01111000
00111000
01111000
01011000
01001000
01001100
00000000
POS b 8,13

SPR 1g
00000000
00000000
00110000
01111000
01111000
00111010
00110010
11111110
POS b 8,12

SPR 1h
01111110
01000010
01011010
01000010
01111110
00000000
00000000
11111111
DLG 14
POS f 8,6

SPR 1i
00000000
00000000
00010000
01111010
00111010
01111110
00010000
00000000
DLG 15
POS h 5,9

SPR 1j
00000000
00000000
00001000
01011110
01011100
01111110
00001000
00000000
DLG 16
POS h 2,10

SPR 1k
00000000
00000000
00000000
10100000
10101100
11111101
00000000
00000000
DLG 17
POS h 4,10

SPR 1l
10101110
00000000
00011100
00000100
00111110
00011100
00010100
00000000
>
10101110
00000000
00000000
00011100
00000100
00111110
00011100
00010100
DLG 18
POS j 15,8

SPR 1m
11111111
11101111
10000011
11010111
11000111
11101111
11000111
11111111
POS l 12,7

SPR 1n
11111111
11000111
11011111
10000011
11000111
11010111
11111111
11111111
>
11111111
11000111
11110111
10000011
11000111
11010111
11111111
11111111
DLG 19
POS l 13,7

SPR 1o
01100011
00100010
00111010
00100010
00100110
00100000
01000000
11111111
POS o 7,9

SPR 1p
11001100
01001000
01011000
01001000
01001000
01101000
00000100
11111110
POS o 8,9

SPR 1q
11001000
10001000
11000010
11111100
11100000
11001000
11001000
11011100
>
11001000
10001000
11000010
11111100
11100000
11001000
11001000
11011100
DLG 1g
POS o 8,8

SPR 1r
00100011
00100001
00100111
00101111
00101011
00101001
00101001
01110101
POS o 7,8

SPR 1s
10101010
10101010
00100000
11100111
00001000
10010001
00100011
10100011
POS o 7,7

SPR 1t
00000000
11111111
00000000
11001111
00100000
10010011
11001000
11001011
POS o 8,7

SPR 1u
00000000
00000000
00001000
01011110
01011100
01111110
00001000
00000000
DLG 1a
POS o 3,10

SPR 1v
00000000
00000000
00001000
01011110
01011100
01111110
00001000
00000000
DLG 1b
POS o 6,12

SPR 1w
00000000
00000000
00000000
01010000
01010100
01111101
00000000
00000000
DLG 1c
POS o 6,5

SPR 1x
00000000
00000000
00010000
01111010
00111010
01111110
00010000
00000000
DLG 1d
POS o 12,9

SPR 1y
00000000
00000000
00000000
00001010
00111010
10111110
00000000
00000000
DLG 1e
POS o 9,13

SPR 1z
10000000
01000000
01001110
00100010
00111111
00101010
00101010
00000000
DLG 1f
POS m 11,12

SPR 2a
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 1v
POS v 5,12

SPR 2b
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 1w
POS w 11,5

SPR 2c
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 1x
POS w 4,5

SPR 2d
10000000
10000000
10000000
10000000
10001001
10110110
10000000
11111111
>
10000000
10000000
10000000
10000000
10100100
10011011
10000000
11111111
POS x 6,8

SPR 2e
00001000
00010000
00100000
00000000
00100100
11011011
00000000
11111111
>
00001000
00010000
00100000
00000000
10010010
01101101
00000000
11111111
POS x 7,8

SPR 2f
00000100
00001000
00001000
00000000
10010010
01101101
00000000
11111111
>
00000100
00001000
00001000
00000000
01001001
10110110
00000000
11111111
POS x 8,8

SPR 2g
01111101
01111101
00111101
00000001
01001001
10110101
00000001
11111111
>
01111101
01111101
00111101
00000001
00100101
11011001
00000001
11111111
POS x 9,8

SPR 2h
00000000
11111111
00000000
00000000
00000000
00001100
00011100
00011100
POS x 8,6

SPR 2i
00000000
11111111
00000001
00000001
00000001
00000001
00000001
00000001
POS x 9,6

SPR 2j
00000001
00000001
00000101
00000001
00000101
00001101
00001101
00111101
POS x 9,7

SPR 2k
10000000
10000000
10000000
10000000
10000111
10111111
10111010
10010000
POS x 6,7

SPR 2l
00000000
11111111
10000000
10000000
10000011
10000111
10011111
10000000
POS x 6,6

SPR 2m
00000000
11111111
00000000
00000000
00000000
11000000
11110100
00000000
POS x 7,6

SPR 2n
00000000
00000000
00000000
00001111
11111110
11111000
00110000
00010000
POS x 7,7

SPR 2o
00010100
00011100
11111110
11100110
00000110
00000110
00001100
00101100
POS x 8,7

SPR 2q
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 20
POS y 11,10

SPR 2r
00000000
01111100
01111100
01000100
01111100
00010000
00010000
00111000
DLG 21
POS y 4,10

SPR 2s
00111110
00111110
00111110
00111110
00100010
00100010
00000000
00000000
POS 19 11,3

SPR 2t
00000000
00011100
00010000
00011100
00111110
01111111
01111111
01111111
DLG 2o
POS 19 11,2

SPR 2u
00100000
01111110
01111110
01010110
01101010
01010110
01111110
00100100
>
00100000
01111110
01111110
01101010
01010110
01101010
01111110
00100100
DLG 22
POS z 2,5

SPR 2v
00100000
01111110
01111110
01010110
01101010
01010110
01111110
00100100
>
00100000
01111110
01111110
01101010
01010110
01101010
01111110
00100100
DLG 23
POS z 8,11

SPR 2w
00100000
01111110
01111110
01010110
01101010
01010110
01111110
00100100
>
00100000
01111110
01111110
01101010
01010110
01101010
01111110
00100100
DLG 24
POS z 10,5

SPR 2x
00100000
01111110
01111110
01010110
01101010
01010110
01111110
00100100
>
00100000
01111110
01111110
01101010
01010110
01101010
01111110
00100100
DLG 25
POS 10 4,4

SPR 2y
00100000
01111110
01111110
01010110
01101010
01010110
01111110
00100100
>
00100000
01111110
01111110
01101010
01010110
01101010
01111110
00100100
DLG 26
POS 10 6,10

SPR 2z
00100000
01111110
01111110
01010110
01101010
01010110
01111110
00100100
>
00100000
01111110
01111110
01101010
01010110
01101010
01111110
00100100
DLG 27
POS 10 9,6

SPR 3a
00001000
01111110
11111111
01000010
01101010
01000010
00111100
01000010
DLG 2i
POS 14 9,9

SPR 3b
01111110
01000010
01111110
01000010
01111110
01000010
11000110
00000000
POS 14 9,10

SPR 3c
00111100
01111110
00100100
00100100
01111110
10111101
00111100
00100100
>
00000000
00111100
01111110
00100100
11100111
00111100
00111100
00100100
DLG 2k
POS 16 10,4

SPR 3d
00111100
01111110
00100100
00100100
01111110
10111101
00111100
00100100
>
00000000
00111100
01111110
00100100
11100111
00111100
00111100
00100100
DLG 2l
POS 18 7,10

SPR 3e
00111100
01111110
00100100
00100100
01111110
10111101
00111100
00100101
>
00000000
00111100
01111110
00100100
11100111
00111100
00111100
00100101
DLG 2m
POS 1a 9,4

SPR 3f
00000000
00000000
00010010
11111111
01110011
01110011
11111111
00110010
DLG 2p
POS 19 12,3

SPR 3g
00010000
00001000
00100000
00000101
00001000
00100000
00000000
00000000
DLG 2q
POS 19 12,4

SPR 3h
00111100
01111110
00100100
00100100
01111110
10111101
00111100
00100100
>
00000000
00111100
01111110
00100100
11100111
00111100
00111100
00100100
DLG 2r
POS 15 4,5

SPR 3i
00000000
00000010
01000011
11011100
00111110
00011100
00100010
00000000
>
00000000
01000000
11000010
00111011
01111100
00111000
01000100
00000000
DLG 2x
POS 1h 8,8

SPR 3j
00111000
00111100
00101000
01111010
01111110
00111010
00101010
00000000
DLG 2y
POS 1e 6,3

SPR 3k
00011100
00111100
00010100
01011110
01111110
01011100
01010100
00000000
DLG 2z
POS 1i 3,1

SPR 3l
00000011
00000100
00001111
00000101
00001100
00000111
00001100
00001111
POS 1k 7,8

SPR 3m
11000000
00100000
11110000
10100000
00110000
11100000
00110000
11110000
POS 1k 8,8

SPR 3n
00011100
00100010
01000010
10000001
10111101
10111101
10100101
10111101
DLG 30
POS 1k 9,9

SPR 3o
00000000
00000010
01000011
11011100
00111110
00000000
00000000
00000000
>
00000000
01000000
11000010
00111011
01111100
00000000
00000000
00000000
DLG 35
POS 1k 3,2

SPR 3p
00000000
00000010
01000011
11011100
00111110
00000000
00000000
00000000
>
00000000
01000000
11000010
00111011
01111100
00000000
00000000
00000000
DLG 34
POS 1k 12,8

SPR 3q
00000000
00000010
01000011
11011100
00111110
00000000
00000000
00000000
>
00000000
01000000
11000010
00111011
01111100
00000000
00000000
00000000
DLG 33
POS 1k 2,13

SPR 3r
00000000
00000010
01000011
11011100
00111110
00000000
00000000
00000000
>
00000000
01000000
11000010
00111011
01111100
00000000
00000000
00000000
DLG 32
POS 1k 7,5

SPR 3s
00000000
00000010
01000011
11011100
00111110
00000000
00000000
00000000
>
00000000
01000000
11000010
00111011
01111100
00000000
00000000
00000000
DLG 31
POS 1k 13,13

SPR 3t
00000000
00000000
01111110
01000010
01011010
01000010
01111110
00000000
DLG 36
POS 1m 4,7

SPR 3u
10101110
00000000
01111110
01000010
01011010
01000010
01111110
00000000
DLG 37
POS 1m 8,7

SPR 3v
00000000
00000000
01111110
01000010
01011010
01000010
01111110
00000000
DLG 38
POS 1m 12,7

SPR 3w
00100000
01000000
01000000
01000100
01001000
00110000
00001000
00000111
DLG 3c
POS 1n 5,8

SPR 3x
00011000
00101000
00000100
00000100
01000100
00111000
11100000
00000000
DLG 3d
POS 1n 6,8

SPR 3y
00000000
00000000
00000000
00000000
11000000
00100000
00100000
00010000
POS 1n 6,7

SPR 3z
00000000
00000000
00000000
00000000
00000000
00000001
00001110
00010000
POS 1n 5,7

SPR 4b
00000000
00000010
01000011
11011100
00111110
00011100
00100010
00000000
>
00000000
01000000
11000010
00111011
01111100
00111000
01000100
00000000
DLG 3j
POS 1q 6,8

SPR 4c
00000000
00000010
01000011
11011100
00111110
00011100
00100010
00000000
>
00000000
01000000
11000010
00111011
01111100
00111000
01000100
00000000
DLG 3k
POS 1q 8,8

SPR 4d
00000000
00000010
01000011
11011100
00111110
00011100
00100010
00000000
>
00000000
01000000
11000010
00111011
01111100
00111000
01000100
00000000
DLG 3l
POS 1q 9,7

SPR 4e
10011101
00111101
00010100
01011110
01111110
01011100
01010101
00000001
DLG 3m
POS 1r 8,8

SPR 4f
00000000
00000000
00000000
00000100
00001100
00000110
00000111
00000010
>
00000000
00000000
00000100
00001101
00000110
00000111
00000010
00000000
POS 1r 6,4

SPR 4g
00000100
00100110
01100100
00111100
00100100
01111110
00111100
00100100
>
00100000
01100100
00100110
00111100
00100100
01111110
00111100
00100100
DLG 3p
POS 1k 12,5

SPR 4h
11111011
11111000
11110000
11100000
11001000
00000100
10000000
10000000
>
11111001
11111000
11110000
11100000
11001000
00000000
00000000
10000000
POS 1r 6,1

SPR 4i
10000000
10000000
00000100
11001000
11100000
11110000
11111000
11111011
>
10000000
00000000
00000000
11001000
11100000
11110000
11111000
11111001
POS 1r 6,0

SPR 4j
00000001
00000001
00100000
00010011
00000111
00001111
00011111
11011111
>
00000001
00000000
00000000
00010011
00000111
00001111
00011111
10011111
POS 1r 5,0

SPR 4k
11011111
00011111
00001111
00000111
00010011
00100000
00000001
00000001
>
10011111
00011111
00001111
00000111
00010011
00000000
00000000
00000001
POS 1r 5,1

SPR 4l
11011111
00011111
00001111
00000111
00010011
00100000
00000001
00000001
>
10011111
00011111
00001111
00000111
00010011
00000000
00000000
00000001
POS 5 5,0

SPR 4m
11111011
11111000
11110000
11100000
11001000
00000100
10000000
10000000
>
11111001
11111000
11110000
11100000
11001000
00000000
00000000
10000000
POS 5 6,0

SPR 4n
11011111
00011111
00001111
00000111
00010011
00100000
00000001
00000001
>
10011111
00011111
00001111
00000111
00010011
00000000
00000000
00000001
POS 6 5,0

SPR 4o
11111011
11111000
11110000
11100000
11001000
00000100
10000000
10000000
>
11111001
11111000
11110000
11100000
11001000
00000000
00000000
10000000
POS 6 6,0

SPR 4p
11111011
11111000
11110000
11100000
11001000
00000100
10000000
10000000
>
11111001
11111000
11110000
11100000
11001000
00000000
00000000
10000000
POS 1v 13,0

SPR 4q
11011111
00011111
00001111
00000111
00010011
00100000
00000001
00000001
>
10011111
00011111
00001111
00000111
00010011
00000000
00000000
00000001
POS 1v 12,0

SPR 4r
10000010
10011010
00011000
00110000
00110000
01111100
00111000
10000010
DLG 3q
POS 1v 12,10

SPR 4s
00000000
00000000
00111100
01000010
01011010
01000010
01010010
01000010
DLG 3r
POS 1w 12,14

SPR 4t
00011100
00011100
00010000
00010000
00111100
01000010
01011010
01000010
>
00010000
00011100
00011100
00010000
00111100
01000010
01011010
01000010
DLG 3s
POS 1w 14,13

SPR 4u
00000000
00011000
00100100
01000100
01010010
01000010
01011010
01000010
DLG 3t
POS 1d 11,6

SPR 4v
00000000
00000000
00111100
01000010
01011010
01000010
01010010
01000010
DLG 3u
POS 1d 9,9

SPR 4w
00111100
01100110
01111110
01000010
01011010
01000010
01001010
01000010
DLG 3v
POS 1d 10,7

SPR 4x
00000010
00000100
00000111
00111100
00100111
00100000
00111111
00111111
DLG 3y
POS 1x 11,1

SPR 4y
10000000
01000000
01000000
01111000
11001000
00001000
11111000
11111000
DLG 3z
POS 1x 12,1

SPR 4z
00000000
10000000
10000000
10000000
01111000
00001000
01111000
10000000
POS 1x 12,0

SPR 5a
00000000
00100000
00000100
00001010
00000100
01000000
00000000
00111000
>
00100000
01010000
00100000
00000100
01000000
10100000
01000000
00111000
POS 1z 7,4

SPR 5b
00001000
00010100
00001000
00000000
01000100
00001010
00000100
00000000
>
00000000
00001000
00000000
01000000
10100000
01000100
00000000
00000000
POS 1z 6,7

SPR 5c
00000000
00000000
00000100
00001010
00000100
00000000
00001000
11000000
>
00000000
00000000
00000000
00000100
00000000
00001000
00010100
11001000
POS 1z 6,5

SPR 5g
00000001
00000001
00001001
00000000
00000001
00100001
01010000
00100001
>
00000001
00001001
00010100
00001001
00000000
00000001
00100001
00000000

SPR 5t
00000000
00000000
00011000
00111100
00111100
10011100
10011000
11111111
DLG 49
POS 1z 10,8

SPR 5u
10110100
10111100
00111000
00111100
00110100
00100100
01100100
00000000
DLG 48
POS 1z 4,9

SPR 5v
00000000
00000000
00011000
00111100
00111100
00111001
00011001
11111111
DLG 47
POS 1z 4,8

SPR 5w
00101101
00111101
00011100
00111100
00101100
00100100
00100110
00000000
DLG 45
POS 1z 10,9

SPR 5x
00000000
00000000
00011000
00111100
00111100
00111001
00011001
11111111
DLG 46
POS 1z 3,10

SPR 5y
10110100
10111100
00111000
00111100
00110100
00100100
01100100
00000000
DLG 44
POS 1z 3,11

SPR 5z
00000000
00000000
00011000
00111100
00111100
10011100
10011000
11111111
DLG 43
POS 1z 11,10

SPR 6a
00000000
00000000
00011111
00100000
00000000
00100000
00000000
00100000
>
00000000
00000000
00111111
00000000
00100000
00000000
00100000
00000000
POS 25 6,9

SPR 6b
00000000
00100000
00000000
00100000
10001000
00000000
01110000
00000000
>
00100000
00000000
00100000
00000000
01010000
00100000
00000000
00000000
POS 25 6,10

SPR 6c
00000000
11000000
00011010
00111010
01111100
00000000
00101010
10101010
>
00000000
11000000
00011001
00111010
01111100
00000000
00101010
10101010
DLG 4l
POS 2d 8,6

SPR 6d
00000000
00000000
00000000
00010000
00101000
00010000
00000000
00000000
>
00000000
00000000
00001000
01111000
00101000
00111100
00100000
00000000
DLG 4m
POS 2c 9,7

SPR 6e
00000000
00000000
00111100
01000010
01011010
01011010
01011100
00000000
DLG 4n
POS 2i 6,12

SPR 6f
00000000
00000000
00000000
00010000
00101000
00010000
00000000
00000000
>
00000000
00000000
00001000
01111000
00101000
00111100
00100000
00000000
DLG 4o
POS 2a 9,6

SPR 6g
00000000
00000000
00111100
01000010
01011010
01011010
01011100
00010000
DLG 4p
POS 2j 10,10

SPR 6h
00001000
00101000
00010100
01000100
00010000
00000000
00000000
00000000
DLG 4q
POS 2j 10,11

SPR 6i
01000100
01000100
01000100
00100100
01100011
10000000
10000000
00000010
POS 2i 7,5

SPR 6j
01000100
01000100
01000100
00100100
01100011
10000000
10000000
00000010
POS 2j 7,5

SPR 6k
00000001
00000001
00000100
00001010
00000100
00100000
00000000
00000000
>
00000001
00000001
00000000
00000100
00100000
01010000
00100000
00000000
POS 2i 6,6

SPR 6l
00000001
00000001
00000100
00001010
00000100
00100000
00000000
00000000
>
00000001
00000001
00000000
00000100
00100000
01010000
00100000
00000000
POS 2j 6,6

SPR 6m
00100001
00001100
10010010
01010010
00011110
01010010
01001100
01000000
POS 2i 7,6

SPR 6n
00100001
00001100
10010010
01010010
00011110
01010010
01001100
01000000
POS 2j 7,6

SPR 6o
00000000
00000010
00000000
00100000
00001000
10010100
01001000
01000011
>
00000010
00000101
00100010
01010000
00100000
10001000
01000000
01000011
POS 2i 8,5

SPR 6p
00000000
00000010
00000000
00100000
00001000
10010100
01001000
01000011
>
00000010
00000101
00100010
01010000
00100000
10001000
01000000
01000011
POS 2j 8,5

SPR 6q
01000000
01000000
10000100
00001010
00000100
00000000
10000000
10000000
>
01000000
01000000
10000000
00000100
00000000
00000000
10000000
10010000
POS 2i 8,6

SPR 6r
01000000
01000000
10000100
00001010
00000100
00000000
10000000
10000000
>
01000000
01000000
10000000
00000100
00000000
00000000
10000000
10010000
POS 2j 8,6

SPR 6s
00101010
00101010
00110001
00110001
00110101
00110001
01100100
00001010
>
00101010
00101010
00110001
00110101
00110001
00110101
01100000
00000100
POS 2i 7,7

SPR 6t
00101010
00101010
00110001
00110001
00110101
00110001
01100100
00001010
>
00101010
00101010
00110001
00110101
00110001
00110101
01100000
00000100
POS 2j 7,7

SPR 6u
10010000
10000000
10000100
00001010
10000100
10000000
11001000
00000000
>
10101000
10010000
10000000
00000100
10000000
10001000
11010100
00001000
POS 2i 8,7

SPR 6v
10010000
10000000
10000100
00001010
10000100
10000000
11001000
00000000
>
10101000
10010000
10000000
00000100
10000000
10001000
11010100
00001000
POS 2j 8,7

SPR 6w
00000000
00100000
00000100
00001010
00000100
01000000
00000000
00111000
>
00100000
01010000
00100000
00000100
01000000
10100000
01000000
00111000
POS 2i 7,4

SPR 6x
00000000
00100000
00000100
00001010
00000100
01000000
00000000
00111000
>
00100000
01010000
00100000
00000100
01000000
10100000
01000000
00111000
POS 2j 7,4

SPR 6y
00001000
00010100
00001000
00000000
01000100
00001010
00000100
00000000
>
00000000
00001000
00000000
01000000
10100000
01000100
00000000
00000000
POS 2i 6,7

SPR 6z
00001000
00010100
00001000
00000000
01000100
00001010
00000100
00000000
>
00000000
00001000
00000000
01000000
10100000
01000100
00000000
00000000
POS 2j 6,7

SPR 7a
00000000
00100000
00000100
00001010
00000100
01000000
00000000
00111000
>
00100000
01010000
00100000
00000100
01000000
10100000
01000000
00111000
POS 2k 7,4

SPR 7b
00001000
00010100
00001000
00000000
01000100
00001010
00000100
00000000
>
00000000
00001000
00000000
01000000
10100000
01000100
00000000
00000000
POS 2k 6,7

SPR 7c
00000000
00000000
00000100
00001010
00000100
00000000
00001000
11000000
>
00000000
00000000
00000000
00000100
00000000
00001000
00010100
11001000
POS 2k 6,5

SPR 7d
00000000
00111000
01000100
01011100
01011100
01000000
00111100
00000000
DLG 4s
POS 2k 6,12

SPR 7e
00000000
00000000
01010010
01110010
00111100
00111100
00100100
00000000
DLG 4z
POS 2m 7,8

SPR 7f
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000

ITM 0
10000000
01111100
00000010
11111010
10000010
00000001
01111101
01000001
NAME rods
DLG 1

ITM 1
00001000
00011100
00111110
00101010
10111110
01011100
00111111
00000011
>
00000000
00011100
00111110
00101010
10111110
01011100
00111111
00000011

ITM 2
00011100
00111110
11101011
00111110
00011100
11111111
01010100
00010100
NAME skull
DLG g

ITM 4
00000000
01111100
01000010
01011010
01000010
01000010
01111110
00000000
NAME seed
DLG j

ITM 5
00000000
00011000
00011000
00111100
00101100
00101100
00111100
00000000
>
00011000
00011000
00111100
00101100
00101100
00111100
00000000
00000000
NAME message
DLG t

ITM 6
00000000
00000000
00011000
00101100
00110100
00011000
00000000
00000000
NAME tokens
DLG 1h

ITM 7
00000000
00000000
00001000
00011100
00001000
00000000
00000000
00000000
NAME blessing

ITM 8
00010000
00111000
11101110
10111010
10000010
11111110
01111100
01000100
NAME whiskey
DLG 12

ITM 9
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME talk to drunk

ITM a
00000000
00111000
00101000
00111000
00010000
00011000
00010000
00011000
NAME key

ITM b
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME unlock tunnel

ITM c
00000000
00000000
00000000
01111100
01000100
01111100
00000000
00000000
NAME ticket

ITM d
00000000
11111111
00000000
10111011
00111000
10101011
00111000
10000011
NAME keycard
DLG 1z

ITM e
01110001
00100000
00100001
00100001
01110000
01010101
00100001
10001000
NAME shovel1
DLG 2n

ITM f
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME talk to nixon

ITM g
00000000
00111100
00100100
01100110
00111100
00100110
00111110
00000000
NAME idol

ITM h
00000000
11000000
00011100
01100010
01000110
01111110
00000000
11111110
NAME half1
DLG 2s

ITM i
00000000
00000000
00001000
00010100
00001000
00000000
00000000
00000000
NAME curse

ITM j
10000010
10011000
10010100
10110110
10101010
10011100
10000000
10101010
>
10000010
10011000
10010100
10110110
10101010
10011100
10000000
10101010
NAME half2
DLG 3n

ITM k
00000000
00000000
00111000
01010100
01001100
01000100
00111000
00000000
>
00000000
00000000
00000000
00111000
01010100
01001100
01000100
00111000
NAME coconut
DLG 3o

ITM l
00000000
00000000
00111100
00100100
00100100
00100100
00111100
00000000
NAME glyphfull

ITM m
01110000
00100000
00100000
00100000
01110000
01010100
00100000
10001000
NAME shovel2
DLG 3w

DLG 1
You picked up the divining rods.
NAME tea dialog

DLG 3
"""
Here lies Melchior
First of the dead
His final words carved here in stone...
{shk}"It'll happen to you too!"{shk}
"""
NAME sprite f dialog

DLG 4
You walk through the doorway
NAME exit narration 1

DLG 5
"""
A sandstone tablet.

"My work here is done. I leave behind the blueprint of man.
Do with it what thou wilt."
"""
NAME sprite i dialog

DLG 6
"""
Dusty diaries are piled here. 

They tell the story of a lord who secluded himself on a lone island, determined to recreate the origin of life.
"From the archipelago originated all of mankind. What is so special about this place?"
"""
NAME sprite h dialog

DLG 7
"""
Worn diaries are piled here.

The lord searched for clues for decades, growing old. Finally, he found the secret of the origin of life.
"After all these years... the answer was ----r al along."
(A word is scratched out.)
"""
NAME sprite j dialog

DLG 8
"""
Ripped diaries are piled here.

The lord had created a man. He returned to his kingdom, only to find it ransacked by barbarians long ago.
Despondent, he came back to the archipelago to die.
"This is my last entry. I leave my progeny to rule this archipelago!"

The rest is blank.
"""
NAME sprite k dialog

DLG 9
Percolating mercury.
NAME sprite l dialog

DLG 10
Empty flasks.
NAME sprite 18 dialog

DLG 11
"""
{
  - {item "8"} == 1 ?
    {wvy}huh... wuzzat... whiskey?{wvy}
    
    {wvy}give me it... I pay you...{wvy}
    
    You gave him the flask of whiskey.
    He gave you a prayer token.
    
    {wvy}*hic*{wvy}
    {item "8" {{item "8"} - 1}}
    {item "6" {{item "6"} + 1}}
  - else ?
    He's in a drunken stupor.
    {item "9" 1}
}
"""
NAME sprite 17 dialog

DLG 12
You picked up a flask of whiskey.
NAME item 8 dialog

DLG 13
"""
{sequence
  - I tend to the windmills.
    
    They connect to the generators down below, and keep the lights on in the caves.
  - Anything for my master!
}
"""
NAME sprite 1c dialog

DLG 14
"""
UP:
Windmill access
DOWN:
Throneroom
"""
NAME sprite 1h dialog

DLG 15
It's inactive.
NAME sprite 1i dialog

DLG 16
It's inactive.
NAME sprite 1j dialog

DLG 17
It's broken apart.
NAME sprite 1k dialog

DLG 18
"""
The lights down below are all busted, sorry.
Instead of fixing them, we made a map of the lower cave.
You can find it to my right. Sorry for the inconvenience.
"""
NAME sprite 1l dialog

DLG 19
"""
I got lost trying to find the throneroom.
My lantern ran out of oil!
"""
NAME sprite 1n dialog

DLG 20
"""
"Water in the Silent Years"
A premiere exhibition
"""
NAME sprite 2q dialog

DLG 21
Modern Wing
NAME sprite 2r dialog

DLG 22
The television shows a deer on a frozen river.
NAME sprite 2u dialog

DLG 23
The television shows a man walking through a city in the sweltering heat. He flashes once, and is gone.
NAME sprite 2v dialog

DLG 24
The television shows a panoramic shot of white bluffs, overlooking the sea.
NAME sprite 2w dialog

DLG 25
The television shows a neon sign flickering in the dark. The sign says "Open 24/7".
NAME sprite 2x dialog

DLG 26
The television shows two disembodied hands desperately grasping for something. The background is pitch black.
NAME sprite 2y dialog

DLG 27
"""
The television shows a live feed of the room you're currently in.
You can feel a camera looking at you.
"""
NAME sprite 2z dialog

DLG 28
The television shows static, with intermittent bursts of opera singing. 
NAME sprite 30 dialog

DLG 29
No problem.
NAME sprite 31 dialog

DLG 30
"""
{
  - {item "6"} >= 1 ?
    There's an offering box in front of the Spiral Shrine.
    You drop a prayer token in and think deep thoughts.
    You received 1 curse.
    {item "i" {{item "i"} + 1}}
    {item "6" {{item "6"} - 1}}
  - else ?
    There's an offering box in front of the Spiral Shrine.
}
"""
NAME sprite 3n dialog

DLG 31
It's a magma crab.
NAME sprite 3s dialog

DLG 32
It's a magma crab.
NAME sprite 3r dialog

DLG 33
It's a magma crab.
NAME sprite 3q dialog

DLG 34
It's a magma crab.
NAME sprite 3p dialog

DLG 35
It's a magma crab.
NAME sprite 3o dialog

DLG 36
"""
The First Age
--
There was no life on Earth. Everything was sea. Six Lords arrived from a higher plane, beyond our consciousness. 
From the waters, they brought forth all plants and animals. The final animal created was Man.
"""
NAME sprite 3t dialog

DLG 37
"""
The Second Age
--
With the creation of Man, the lords fell to ruin, their bodies forming the islands of Archipelago Casanova. The first race of man inherited the secrets of the lords, preserving their image in art and ritual. The Lords' secrets were used by Man to create life itself.
"""
NAME sprite 3u dialog

DLG 38
"""
The Third Age
--
Over thousands of years, the first race of Man faded away. Their traditions and secrets were buried with them. The descendants of this race, far removed from their ancestors, returned to Archipelago Casanova on a holy mission, determined to rediscover the secrets of life. But even they slowly disappeared, leaving behind their tomes of knowledge and their grand buildings.
"""
NAME sprite 3v dialog

DLG 39
An ancient skull.
NAME sprite 42 dialog

DLG 40
"""
{cycle
  - Ha-ha-ha
  - Hee-hee-hee
  - Ho-ho-ho
}
"""
NAME sprite 52 dialog

DLG 41
"""
{
  - {item "0"} >= 1 ?
    {property locked true}
    Your divining rods are spinning wildly!
    The earth below this spot seems to be hollow.
    {
      - {item "m"} >= 1 ?
        You use the shovel to dig down.
        {property locked false}
      - else ?
        {
          - {item "e"} >= 1 ?
            You use the shovel to dig down.
            {property locked false}
          - else ?
            You something a something to dig with...
        }
    }
  - else ?
    {property locked true}
}
"""
NAME locked exit 6

DLG 42
A tribesman, calcified in place.
NAME sprite 60 dialog

DLG 43
A tribesman, calcified in place.
NAME sprite 5z dialog

DLG 44
A tribesman, calcified in place.
NAME sprite 5y dialog

DLG 45
A tribesman, calcified in place.
NAME sprite 5w dialog

DLG 46
A tribesman, calcified in place.
NAME sprite 5x dialog

DLG 47
A tribesman, calcified in place.
NAME sprite 5v dialog

DLG 48
A tribesman, calcified in place.
NAME sprite 5u dialog

DLG 49
A tribesman, calcified in place.
NAME sprite 5t dialog

DLG 50
"""
Bored by your simple life as a fisherman, you embark to the fabled Archipelago Casanova.

In legend, it is said that the archipelago holds the secrets of the Gods, the secrets of life itself.
"""
NAME exit narration 2

DLG a
Alchemy tools. A distillation retort drips into a petri dish.
NAME sprite m dialog

DLG b
Liquid iron.
NAME sprite o dialog

DLG c
Crystal clear salt water.
NAME sprite p dialog

DLG d
Molten gold.
NAME sprite q dialog

DLG e
Dead flowers fermenting in a cauldron.
NAME sprite r dialog

DLG f
"""
{
  - {item "4"} == 0 ?
    There's an empty dish. There are a few seeds at the bottom.
  - else ?
    {exit "6" 4 8 "wave"}
    You put the seeds in the dish.
    
    The bird flew down with the skull.
}
"""
NAME sprite t dialog

DLG g
You picked up the Lord's Skull.
NAME item 2 dialog

DLG h
The dish is full.
NAME sprite u dialog

DLG i
chirp
NAME sprite v dialog

DLG j
You picked up the bag of bird seed.
NAME item 4 dialog

DLG o
"""
{
  - {item "2"} == 0 ?
    {property locked false}
  - else ?
    {property locked true}
}
"""
NAME skullswitch1

DLG p
"""
{
  - {item "2"} >= 1 ?
    {property locked false}
  - else ?
    {property locked true}
}
"""
NAME skullswitch2

DLG q
A ribcage.
NAME sprite z dialog

DLG r
A femur.
NAME sprite x dialog

DLG s
Some poor guy's skull.
NAME sprite y dialog

DLG t
"""
You picked up the message in a bottle, never delivered.
The message reads...

"SOS SEND HELP SOS! LOST FOREVER IN ARCHIPELAGO CASANOVA!"
"""
NAME message dialog

DLG u
"""
{
  - {item "6"} >= 1 ?
    There's an offering box in front of the Flag Shrine.
    You drop a prayer token in and think deep thoughts.
    You received 1 blessing.
    {item "7" {{item "7"} + 1}}
    {item "6" {{item "6"} - 1}}
  - else ?
    There's an offering box in front of the Flag Shrine.
}
"""
NAME sprite 10 dialog

DLG v
"""
{
  - {item "9"} == 1 ?
    {sequence
      - Ye must've talked to that layabout in the shrine.
        He seems like a fine fellow. But although we live on the same island, we seldom talk.
        
        Why? Due to his constant boozing, of course.
        Me and him lead very different lives. I'm out on the pier while he's in his holy place.
      - The shrine is dedicated to one of the six ancient deities.
        This Archipelago is said to be made up of the corpses of those ancient lords. Six islands, six creators. You know how it is.
        How much of that is real, it's hard to say. Here, what's real doesn't mean much.
        
        But I'm getting ahead of myself. I'll return to fishing.
      - Good day to ye, guv'nor.
    }
  - else ?
    Can't help ye, guv'nor. Alls I know is fishing.
}
"""
NAME sprite 13 dialog

DLG w
Nothin's biting.
NAME sprite 15 dialog

DLG x
"""
{sequence
  - A garbage bin.
    
    You see fish skeletons and empty bottles.
    At the bottom is a prayer token.
    
    You pick it up.
    {item "6" {{item "6"} + 1}}
  - There's nothing more of interest in the garbage bin.
}
"""
NAME sprite 16 dialog

DLG y
A bucket full of bait & dead fish.
NAME sprite 1b dialog

DLG z
Empty bottles.
NAME sprite 1a dialog

DLG 1a
It's inactive.
NAME sprite 1u dialog

DLG 1b
It's inactive.
NAME sprite 1v dialog

DLG 1c
It's broken apart.
NAME sprite 1w dialog

DLG 1d
It's inactive.
NAME sprite 1x dialog

DLG 1e
It's broken apart.
NAME sprite 1y dialog

DLG 1f
"""
If it wasn't so misty, I'd be able to catch a few cave fish!
All I've caught is washed up junk.
"""
NAME sprite 1z dialog

DLG 1g
"""
{
  - {item "2"} == 0 ?
    {sequence
      - {item "b" {{item "b"} + 1}}
        {wvy}Life is the Lord's greatest comedy...{wvy}
        {wvy}as well as His greatest tragedy!{wvy}
        
        You're onto something, man. Not many adventurers find their way down here. You know what you're doing. I like it!
        I am Life. Life that never should have existed.
        Using the spiraling riddles of Archipelago Casanova, my Lord created me, just as his Lords created him.
        Except, my Lord was but a man. His Lords were gods.
        What does that make me? Certainly not a man.
        This is why I call myself {wvy}Life itself!{wvy}
        Unlike my Lord, I have failed. It's something I must accept.
        These machines, my creations, have no true life to them. I will never be a Lord.
        
        But perhaps...
        You, adventurer...
        You can become a lord. Create life, as my master did for me.
        Archipelago Casanova's secret lies within its forest.
        My Lord... he sealed it off long ago, with a lock of silver.
        I hold the key to that lock. I'll gladly give it to you, if you do for me but one thing.
        
        Bring me a memento of my Lord...
        I don't care what it is.
        Anything to remind me of him. It's been so long since I've been on the surface.
        
        Bring me a memento. The secret to life will be yours.
      - Find a memento of my Lord, and bring it to me.
        By the way, I just had my guys unblock the service tunnel.
        Don't worry man, I got your back.
    }
  - else ?
    {sequence
      - {item "a" {{item "a"} + 1}}
        {item "b" {{item "b"} + 1}}
        My Lord's skull... a gruesome reminder of the fate that awaits us all.
        
        Kidding! No need to get morbid.
        Anyway...
        Visit the woods of the ancients. Unlock the silver gate. Partake in the wonders of Archipelago Casanova.
        I'll send one of my creations to meet you there.
        Life gave you the Silver Key.
      - I'll see you there, adventurer.
    }
}
"""
NAME sprite 1q dialog

DLG 1h
You picked up a prayer token.
NAME tokens dialog

DLG 1i
Master's down below. You are welcome in his dominion.
NAME sprite 20 dialog

DLG 1j
"""
{
  - {item "b"} >= 1 ?
    {property locked false}
  - else ?
    {property locked true}
    The tunnel is blocked off.
}
"""
NAME locked exit 1

DLG 1k
"""
{
  - {item "b"} >= 1 ?
    {property locked false}
  - else ?
    {property locked true}
    The tunnel is blocked off.
}
"""
NAME locked exit 2

DLG 1l
"""
{sequence
  - Yeah, I respect the master, but I've seen what he does when he's frustrated.
    
    Make no mistake: we're expendable. Cheap machines.
    He'll destroy us on a dime; he knows he can always make more.
  - Oh yeah, that's why I'm hiding in this little closet.
}
"""
NAME sprite 21 dialog

DLG 1m
Museum entrance fee: 1 prayer token.
NAME sprite 22 dialog

DLG 1n
"""
{
  - {item "c"} == 0 ?
    {
      - {item "6"} >= 1 ?
        You inserted a prayer token into the machine, and got 1 ticket.
        Nice!
        {item "c" {{item "c"} + 1}}
        {item "6" {{item "6"} - 1}}
      - else ?
        This machine has a slot for prayer tokens.
    }
  - else ?
    You already have a ticket.
}
"""
NAME sprite 23 dialog

DLG 1p
"""
{
  - {item "c"} >= 1 ?
    {property locked false}
  - else ?
    {property locked true}
    You can't get in without a ticket.
}
"""
NAME locked exit 3

DLG 1s
Modern Wing
NAME sprite 27 dialog

DLG 1t
"Joostmeyer III"
NAME sprite 28 dialog

DLG 1u
"Limbus Ibiza"
NAME sprite 29 dialog

DLG 1v
"Martha's Dream"
NAME sprite 2a dialog

DLG 1w
"Relative Konstruct k2.0"
NAME sprite 2b dialog

DLG 1x
"Austrian Legionnaire"
NAME sprite 2c dialog

DLG 1z
You picked up the studio keycard.
NAME item d dialog

DLG 2a
The television shows a massive theater. The curtains on the stage are closed.
NAME sprite 32 dialog

DLG 2b
"The Annihilation of the Apostles"
NAME sprite 33 dialog

DLG 2c
"Methuselah's Folly"
NAME sprite 34 dialog

DLG 2d
"""
The Kinoplex
Free admission
Now playing: "Otomo by the Sea"
"""
NAME sprite 35 dialog

DLG 2e
"Seated Buddha"
NAME sprite 36 dialog

DLG 2f
"Atlas"
NAME sprite 37 dialog

DLG 2g
"The 500 Archers of Kublai Khan"
NAME sprite 38 dialog

DLG 2h
"""
{sequence
  - This museum is such a lonely place... I come here a lot.
    It's rare to see another person here at all.
    There are always new exhibits and artworks every time I come here. I wonder who makes them? There aren't any names on the placards.
  - For this exhibit, someone flooded the entire floor with water. Such a monumental effort for something so few people will see.
  - Hmmm...
}
"""
NAME sprite 39 dialog

DLG 2i
"""
{cycle
  - Do you see that window?
    
    It is the only window in the entire museum.
    It is too high up for one such as yourself to see out of, but I see through it with perfect clarity.
    Visions are revealed to me through that window... I turn those visions into art.
  - I get my materials from the inhabitants of these islands... Dumb brutes, all of them.
    
    Few have appreciation for what I do, yet I do it anyway.
    Flotsam. Driftwood. This is my canvas.
    Nine televisions washed ashore. They became my newest exhibition.
  - Do you see that canvas?
    
    The shapes on it must be familiar to you.
    Yes, it is Archipelago Casanova that I am now painting.
    But the painting will never be complete. Not until every minute detail of every island is painted in perfect facsimile.
  - Do you see these figures at my feet?
    They were revealed to me in visions, through my window.
    They are the ancient denizens of this land. Some call them Lords.
    I do not know what they look like, and yet I can craft them in miniature, clear as day.
    
    So far, I've made five. There are six in total, but I can't bring myself to complete the set.
  - Do you see that bed?
    
    I haven't slept there in weeks. Sleep is the cousin of death, an enemy to my work.
  - {
      - {item "8"} == 1 ?
        Do you see tha{clr2}{clr2}t flask on the table?
        Wait, where did it go?
        
        Alright, nevermind.
      - else ?
        Do you see that flask on the table?
        Whiskey. I call it my provision. 
        
        I nabbed it from a poor drunk. I was doing him a favor, really.
        It helps my important work.
    }
}
"""
NAME sprite 3a dialog

DLG 2j
"""
{
  - {item "d"} >= 1 ?
    {property locked false}
    The keycard opens the door.
  - else ?
    {property locked true}
    The door is hermetically sealed. It says "Staff Only".
}
"""
NAME locked exit 4

DLG 2k
"""
{sequence
  - See these flags? The ancient tribes of the archipelago used them to ward off curses.
    
    I bet there's some ancient treasure on this island!
    ...
    Don't look at me like that.
    I'd look for the treasure, but the woods are too scary for me...
  - There were a couple other explorers that came with me, but they left me behind because I was too scared.
    The thought of disturbing some burial ground is terrifying...
}
"""
NAME sprite 3c dialog

DLG 2l
"""
{
  - {item "g"} == 1 ?
    {sequence
      - {item "6" {{item "6"} + 1}}
        Well, that was easy. Oh, he's hiding out on an island? Yeah, I'm beating his thief ass for sure.
        In the meantime, you deserve something for your efforts.
        He gave you a prayer token.
      - What a dope... thought he could run from ol' Tricky Dick.
    }
  - else ?
    {sequence
      - {item "f" {{item "f"} + 1}}
        Augh! I'm steaming mad!
        
        My so-called "friend" ran off with the ancient idol I found, and I got separated from Tyrone and Geoff!
        We were supposed to be in this together, man...
        Could you find him and get him to give me my idol back? I can't find him anywhere!
      - Get me that idol! Please! I'll even pay you!
    }
}
"""
NAME sprite 3d dialog

DLG 2m
"""
{
  - {item "e"} == 1 ?
    ...
    
    By taking that shovel, you've killed the last piece of my soul.
  - else ?
    {sequence
      - Please lord, end our suffering...
        Five of us went into this cursed forest. As far as I know, I'm the only one left.
        
        I'm sick of all the twists and turns, the mutiny, the sand everywhere...
        
        Cornelius was right to be scared of this place. We were fools.
        We thought that great treasure would await us. Look here: this pit I've dug. No treasure to speak of. Instead, I fear this hole will serve as my grave.
        
        Johnson ran off with the one thing we found, and soon after I was separated from Nixon and Geoff.
        There's nothing you can do to help me now... just please don't take my shovel. It's the only possession I have left.
      - It's just not fair... I hate this bastard Archipelago.
    }
}
"""
NAME sprite 3e dialog

DLG 2n
You picked up the failed explorer's shovel.
NAME shovel1 dialog

DLG 2o
"""
{
  - {item "a"} == 1 ?
    He tried to enter the sanctuary without my master's permission.
    I see that you, however, have his key. You may enter.
  - else ?
    He tried to enter the sanctuary without my master's permission.
    I strongly suggest you do not attempt such foolishness, or your fate will be likewise.
}
"""
NAME sprite 2t dialog

DLG 2p
He's dead.
NAME sprite 3f dialog

DLG 2q
A spattering of blood.
NAME sprite 3g dialog

DLG 2r
"""
{
  - {item "f"} == 0 ?
    Whaddaya want, guy? Lookin' for trouble, Jack? You better make yourself scarce before I give you a five-knuckle surprise!
  - else ?
    {sequence
      - {item "g" {{item "g"} + 1}}
        Nixon sent you?
        
        Guess that means he finally tracked me down...
        The stint was good while it lasted. But crime never pays, eh? My boat's broken, and frankly, I'd rather keep my life than this bunk idol.
        
        He gave you the ancient idol.
      - Now I'm screwed...
    }
}
"""
NAME sprite 3h dialog

DLG 2s
"""
{
  - {item "j"} == 1 ?
    You picked up a tattered scrap of parchment.
    It is one half of an ancient glyph.
    You combine the two halves. You now have the complete glyph of life.
    {item "l" {{item "l"} + 1}}
  - else ?
    You picked up a tattered scrap of parchment.
    It is one half of an ancient glyph.
}
"""
NAME item h dialog

DLG 2t
 

DLG 2u
 

DLG 2v
 

DLG 2w
"""
{
  - {item "a"} >= 1 ?
    {property locked false}
    {sequence
      - The silver gate is opened by the progeny's key.
      - 
    }
  - else ?
    {property locked true}
    The massive silver gate is fitted with a single lock.
}
"""
NAME locked exit 5

DLG 2x
It's a magma crab.
NAME sprite 3i dialog

DLG 2y
"""
{sequence
  - Oh, another hiker.
    You're going up, I assume.
    I was just up there. Pretty spectacular view.
    Be careful not to fall in!
  - Awesome...
}
"""
NAME sprite 3j dialog

DLG 2z
"""
{sequence
  - Man, these caves are so hot.
    
    I'm just trying to get to the volcano... it's the highest point in the whole archipelago.
    
    The exit has to be somewhere around here...
  - Everyone's looking for the "secret of life" or whatever...
    I'm just trying to get out of this cave!
}
"""
NAME sprite 3k dialog

DLG 3a
A chisel stuck in a skeletal hand.
NAME sprite 43 dialog

DLG 3b
"""
The Fourth Age
--
Legends of Archipelago Casanova circled the globe, eternalized in myths and word of mouth. Aspiring explorers flocked to the Archipelago, determined to succeed where those before them had failed. And yes, some did succeed, carrying on the legacy of the ancient Lords. But

(The text abruptly ends)
"""
NAME sprite 44 dialog

DLG 3c
A fallen boulder.
NAME sprite 3w dialog

DLG 3d
A fallen boulder.
NAME sprite 3x dialog

DLG 3e
"""
{sequence
  - Wow, this volcano sure is an attraction for us hikers.
    Can't have anything to yourself these days...
  - Can't have anything to yourself these days...
}
"""
NAME sprite 45 dialog

DLG 3f
"""
{sequence
  - Oh, another hiker.
    You're going up, I assume.
    I was just up there. Pretty spectacular view.
    Be careful not to fall in!
  - Awesome...
}
"""
NAME sprite 46 dialog

DLG 3g
"""
{
  - {item "k"} == 0 ?
    It's a king crab.
  - else ?
    {item "k" {{item "k"} - 1}}
    {item "6" {{item "6"} + 1}}
    It's a king crab.
    
    The king crab snatches your coconut!
    The crab cracked it open, ate it, and spit out a prayer token.
    You picked up the prayer token.
}
"""
NAME sprite 47 dialog

DLG 3h
It's a magma crab.
NAME sprite 49 dialog

DLG 3j
It's a magma crab.
NAME sprite 4b dialog

DLG 3k
It's a magma crab.
NAME sprite 4c dialog

DLG 3l
It's a magma crab.
NAME sprite 4d dialog

DLG 3m
"""
{sequence
  - {shk}A plume of lava! A spray of fire! The sky turns black!{shk}
    Truly, the volcano is the perfect emblem of nature's brutality!
  - ...
    
    What's up with that bird?
}
"""
NAME sprite 4e dialog

DLG 3n
"""
{
  - {item "h"} == 1 ?
    You rummage around in the bird's nest.
    You picked up a tattered scrap of parchment.
    It is one half of an ancient glyph.
    You combine the two halves. You now have the complete glyph of life.
    {item "l" {{item "l"} + 1}}
  - else ?
    You rummage around in the bird's nest.
    You picked up a tattered scrap of parchment.
    It is one half of an ancient glyph.
}
"""
NAME item j dialog

DLG 3o
"""
You picked up a floating coconut.
There are no coconut trees in this archipelago... it must've drifted from far away.
"""
NAME item k dialog

DLG 3p
"""
{sequence
  - It's a magma crab man.
    
    He starts to speak...
    
    I'm one with the crabs. Let me tell you a secret...
    The thing about these crabs is that they go crazy for coconuts.
    But there aren't any coconut trees on this archipelago.
    If you can somehow find a coconut, the king would love to have it.
  - It's a magma crab man.
    
    He starts to speak...
    
    I'm half man, half crab, all adrenaline baby!
}
"""
NAME sprite 4g dialog

DLG 3q
"""
{sequence
  - Greetings.
    
    I am a holy man.
    
    I reside in this ancient house of worship, now fallen to ruin.
    My sole pleasure is keeping my birds. They are pigeons, mourning doves, and hummingbirds.
    I also keep numerous holy books.
    
    As you can imagine, sometimes my birds interfere with the books.
    Recently, a pigeon stole an ancient script and took it to the volcano.
    
    That would probably interest an adventurer such as yourself.
  - Before this age, I fancied myself an explorer.
    Intrigued by the allure of these islands, I came here, as so many others did.
    
    I searched for weeks. One day, when sailing in my craft, a great light washed over me.
    
    I realized my true calling through that blessing: I had to continue in the footsteps of the long-gone holy men of this land.
    This holy house, which once thrived with life, is now occupied by none but my birds and I.
    It's better this way... if I don't do it, nobody will.
  - It's not much... not much at all. But it's mine.
}
"""
NAME sprite 4r dialog

DLG 3r
"""
Here lies Naama
Deacon of her time
"""
NAME sprite 4s dialog

DLG 3s
"""
Here lies the Unclean Spirit
One who defied existance itself
"""
NAME sprite 4t dialog

DLG 3t
"""
Here lies El-Berith
The all-seeing deaf-mute
"""
NAME sprite 4u dialog

DLG 3u
"""
Here lies Ekron
Consecrator of the seas
"""
NAME sprite 4v dialog

DLG 3v
"""
Here lies Judge Paul Jacobs
Guilty to the grave
"""
NAME sprite 4w dialog

DLG 3w
You picked up the gravedigger's shovel.
NAME shovel2 dialog

DLG 3x
"""
All the gravestones have been erected.
All the graves have been dug.
"""
NAME sprite 51 dialog

DLG 3y
"""
Here lies Mount Sinai
--
"""
NAME sprite 4x dialog

DLG 3z
"""
Here lies Mount Sinai
--
"""
NAME sprite 4y dialog

DLG 4a
"""
It's an ancient marker, worn down beyond belief. You can barely make out the words. They are not in English, but you understand them nonetheless.

The Spring of the Lords

Melchior, the first man, was granted the gift of life by the Six Celestial Lords on the last day of creation.
He, the first to know life, became the first to know death: on this spot, Melchior lay down into eternal slumber. 
From his corpse sprang the Waters of Life, the Lords' final gift to Man.

The Waters flow eternal, blessing our people with overwhelming life.

Melchior, the Water-Bearer, is memorialized with this statue. Partake in his waters, and become a Lord.
"""
NAME sprite 61 dialog

DLG 4b
"""
You enter now a place most holy.

A glyph is required to traverse the ethereal lands.
"""
NAME sprite 62 dialog

DLG 4c
"""
{
  - {item "l"} == 1 ?
    {exit "26" 5 13 "wave"}
  - else ?
    An ancient glyph is required to partake in the waters.
}
"""
NAME sprite 63 dialog

DLG 4d
"""
{sequence
  - Congratulations.
    
    You have reached the source.
    
    Innumerable years ago, the Lords blessed this spot. My Master sealed it up. Only one with great perseverance, such as yourself, could ever dream of making it here.
    Claim the Ethereal World, the world of creation, as your own.
  - Claim the Ethereal World, the world of creation, as your own.
}
"""
NAME sprite 64 dialog

DLG 4e
"""
{cycle
  - {wvy}Boo-hoo!{wvy}
  - {wvy}Waaah!{wvy}
  - {wvy}*sob*{wvy}
}
"""
NAME sprite 65 dialog

DLG 4f
"""
{exit "1z" 7 12 "wave"}
You left the Ethereal World.
"""
NAME sprite 66 dialog

DLG 4g
"""
{
  - {item "l"} == 1 ?
    Perfect... you've assembled your own glyph.
    Go... visit the birthplace of all life... the Ethereal World.
  - else ?
    Perhaps you're looking for a glyph?
    The first men used glyphs to engage in rituals with higher realms.
    
    To find one of your own, search the forgotten corners of this Archipelago. You'd be surprised by the secrets these islands hold...
}
"""
NAME sprite 67 dialog

DLG 4h
"""
{sequence
  - The mist on the water sparkles like a thousand stars.
    The place you want to reach is far from here.
    Or, it is very close.
    
    It depends on how you look at it.
  - {wvy}*humming tunelessly*{wvy}
}
"""
NAME sprite 69 dialog

DLG 4i
"""
{exit "29" 8 7 "wave"}
You travel for days, weeks, months. The ocean is crystal clear, flat in all directions. Time flows backwards. The ocean turns shallow, and you run ashore by a strange edifice.
{exit "22" 2 13 "wave"}
All is quiet.
"""
NAME sprite g dialog

DLG 4j
"""
{
  - {item "7"} >= 3 ?
    {property locked false}
  - else ?
    {property locked true}
    You don't have enough blessings to unseal the door.
}
"""
NAME locked exit 7

DLG 4k
"""
{
  - {item "i"} >= 3 ?
    {property locked false}
  - else ?
    {property locked true}
    You don't have enough curse to unseal the door.
}
"""
NAME locked exit 8

DLG 4l
"""
It's a rat.

eek
"""
NAME sprite 6c dialog

DLG 4m
"""
There is a slab here.

A human-shaped indentation is carved into the center.
You slide into the indentation. It fits your body perfectly.
{exit "2f" 12 1 "wave"}
A great light 
washes over you.
{exit "2g" 13 2 "wave"}
You're floating on top of a vast sea.
Every
cell
in
your
body
dies
and
is
reborn
a
thousand
times
over.

You lose all sense of self. You are now the endless ocean.
{exit "2h" 13 1 "wave"}
In your deepest depths, a creature of wonder is created.
Slowly, you fade away.
You start to dream...
{exit "2i" 7 12 "fade_b"}
...
"""
NAME sprite 6d dialog

DLG 4n
He's only sleeping. He's having a good dream.
NAME sprite 6e dialog

DLG 4o
"""
There is a slab here.

A human-shaped indentation is carved into the center.
You slide into the indentation. It fits your body perfectly.
{exit "2f" 13 2 "wave"}
A great light 
washes over you.
{exit "2g" 10 2 "wave"}
You're floating on top of a vast sea.
Every
cell
in
your
body
dies
and
is
reborn
a
thousand
times
over.

You lose all sense of self. You are now the endless ocean.
{exit "2h" 12 2 "wave"}
In your deepest depths, a creature of evil is created.
...

You feel a sharp jolt, an intense pain, and then nothing.
Slowly, 
you fade away.
{exit "2j" 7 12 "fade_b"}
...
"""
NAME sprite 6f dialog

DLG 4p
He's dead.
NAME sprite 6g dialog

DLG 4q
A spattering of blood.
NAME sprite 6h dialog

DLG 4r
"""
There is a slab here.

A human-shaped indentation is carved into the center.
You slide into the indentation. It fits your body perfectly.
{exit "2f" 13 2 "wave"}
A great light 
washes over you.
{exit "2g" 10 2 "wave"}
You're floating on top of a vast sea.
Every
cell
in
your
body
dies
and
is
reborn
a
thousand
times
over.

You lose all sense of self. You are now the endless ocean.
{exit "2h" 12 2 "wave"}
In your deepest depths, a creature is created.
...

You feel two souls in the darkness. You drift upwards.
Slowly, 
you fade away.
{exit "2k" 7 12 "fade_b"}
...
"""
NAME sprite 72 dialog

DLG 4s
"""
{sequence
  - I can't believe it worked... you look just like me.
    Uh, sorry.
    I just need some time alone...
  - My progeny...
}
"""
NAME sprite 7d dialog

DLG 4t
"""
{shk}A great evil has been unleashed.{shk}

THE END
"""
NAME ending 1

DLG 4u
"""
{shk}A great evil has been unleashed.{shk}

THE END
"""
NAME ending 2

DLG 4v
"""
{shk}A great evil has been unleashed.{shk}

THE END
"""
NAME ending 3

DLG 4w
"""
The world is becalmed.

THE END
"""
NAME ending 4

DLG 4x
"""
You've succeeded.

THE END
"""
NAME ending 5

DLG 4y
"""
{
  - {item "7"} >= 3 ?
    {property locked true}
    You are too blessed to unseal the door.
  - else ?
    {
      - {item "i"} >= 3 ?
        {property locked true}
        You are too cursed to unseal the door.
      - else ?
        {property locked false}
    }
}
"""
NAME locked exit 9

DLG 4z
"""
You say goodbye to your cat.

{wvy}meow{wvy}
"""
NAME sprite 7e dialog


</script>

<link rel="stylesheet" href="../../styles/otherseas.css">

<!-- SCRIPTS -->
<script>
function startExportedGame() {
	attachCanvas( document.getElementById("game") );
	load_game( document.getElementById("exportedGameData").text.slice(1) );
}
</script>

<script>
//hex-to-rgb method borrowed from stack overflow
function hexToRgb(hex) {
	// Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
	var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
	hex = hex.replace(shorthandRegex, function(m, r, g, b) {
		return r + r + g + g + b + b;
	});

	var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
	return result ? {
		r: parseInt(result[1], 16),
		g: parseInt(result[2], 16),
		b: parseInt(result[3], 16)
	} : null;
}
function componentToHex(c) {
    var hex = c.toString(16);
    return hex.length == 1 ? "0" + hex : hex;
}
function rgbToHex(r, g, b) {
    return "#" + componentToHex(Math.floor(r)) + componentToHex(Math.floor(g)) + componentToHex(Math.floor(b));
}

function hslToHex(h,s,l) {
    var rgbArr = hslToRgb(h,s,l);
    return rgbToHex( Math.floor(rgbArr[0]), Math.floor(rgbArr[1]), Math.floor(rgbArr[2]) );
}

function hexToHsl(hex) {
    var rgb = hexToRgb(hex);
    return rgbToHsl(rgb.r, rgb.g, rgb.b);
}

// really just a vector distance
function colorDistance(a1,b1,c1,a2,b2,c2) {
    return Math.sqrt( Math.pow(a1 - a2, 2) + Math.pow(b1 - b2, 2) + Math.pow(c1 - c2, 2) );
}

function hexColorDistance(hex1,hex2) {
    var color1 = hexToRgb(hex1);
    var color2 = hexToRgb(hex2);
    return rgbColorDistance(color1.r, color1.g, color1.b, color2.r, color2.g, color2.b);
}


// source : http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c
/* accepts parameters
 * h  Object = {h:x, s:y, v:z}
 * OR 
 * h, s, v
*/
function HSVtoRGB(h, s, v) {
    var r, g, b, i, f, p, q, t;
    if (arguments.length === 1) {
        s = h.s, v = h.v, h = h.h;
    }
    i = Math.floor(h * 6);
    f = h * 6 - i;
    p = v * (1 - s);
    q = v * (1 - f * s);
    t = v * (1 - (1 - f) * s);
    switch (i % 6) {
        case 0: r = v, g = t, b = p; break;
        case 1: r = q, g = v, b = p; break;
        case 2: r = p, g = v, b = t; break;
        case 3: r = p, g = q, b = v; break;
        case 4: r = t, g = p, b = v; break;
        case 5: r = v, g = p, b = q; break;
    }
    return {
        r: Math.round(r * 255),
        g: Math.round(g * 255),
        b: Math.round(b * 255)
    };
}

/* accepts parameters
 * r  Object = {r:x, g:y, b:z}
 * OR 
 * r, g, b
*/
function RGBtoHSV(r, g, b) {
    if (arguments.length === 1) {
        g = r.g, b = r.b, r = r.r;
    }
    var max = Math.max(r, g, b), min = Math.min(r, g, b),
        d = max - min,
        h,
        s = (max === 0 ? 0 : d / max),
        v = max / 255;

    switch (max) {
        case min: h = 0; break;
        case r: h = (g - b) + d * (g < b ? 6: 0); h /= 6 * d; break;
        case g: h = (b - r) + d * 2; h /= 6 * d; break;
        case b: h = (r - g) + d * 4; h /= 6 * d; break;
    }

    return {
        h: h,
        s: s,
        v: v
    };
}

// source : https://gist.github.com/mjackson/5311256
/**
 * Converts an HSL color value to RGB. Conversion formula
 * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
 * Assumes h, s, and l are contained in the set [0, 1] and
 * returns r, g, and b in the set [0, 255].
 *
 * @param   Number  h       The hue
 * @param   Number  s       The saturation
 * @param   Number  l       The lightness
 * @return  Array           The RGB representation
 */
function hslToRgb(h, s, l) {
  var r, g, b;

  if (s == 0) {
    r = g = b = l; // achromatic
  } else {
    function hue2rgb(p, q, t) {
      if (t < 0) t += 1;
      if (t > 1) t -= 1;
      if (t < 1/6) return p + (q - p) * 6 * t;
      if (t < 1/2) return q;
      if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
      return p;
    }

    var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
    var p = 2 * l - q;

    r = hue2rgb(p, q, h + 1/3);
    g = hue2rgb(p, q, h);
    b = hue2rgb(p, q, h - 1/3);
  }

  return [ r * 255, g * 255, b * 255 ];
}

/**
 * From: http://stackoverflow.com/questions/2353211/hsl-to-rgb-color-conversion
 *
 * Converts an RGB color value to HSL. Conversion formula
 * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
 * Assumes r, g, and b are contained in the set [0, 255] and
 * returns h, s, and l in the set [0, 1].
 *
 * @param   {number}  r       The red color value
 * @param   {number}  g       The green color value
 * @param   {number}  b       The blue color value
 * @return  {Array}           The HSL representation
 */
function rgbToHsl(r, g, b){
    r /= 255, g /= 255, b /= 255;
    var max = Math.max(r, g, b), min = Math.min(r, g, b);
    var h, s, l = (max + min) / 2;

    if(max == min){
        h = s = 0; // achromatic
    }else{
        var d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch(max){
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
    }

    return [h, s, l];
}
</script>

<script>
var TransitionManager = function() {
	var transitionStart = null;
	var transitionEnd = null;
	var effectImage = null;

	var isTransitioning = false;
	var transitionTime = 0; // milliseconds
	var frameRate = 8; // cap the FPS
	var prevStep = -1; // used to avoid running post-process effect constantly

	this.BeginTransition = function(startRoom,startX,startY,endRoom,endX,endY,effectName) {
		// console.log("--- START ROOM TRANSITION ---");

		curEffect = effectName;

		var tmpRoom = player().room;
		var tmpX = player().x;
		var tmpY = player().y;

		if (transitionEffects[curEffect].showPlayerStart) {
			player().room = startRoom;
			player().x = startX;
			player().y = startY;
		}
		else {
			player().room = "_transition_none"; // kind of hacky!!
		}

		drawRoom(room[startRoom]);
		var startPalette = getPal( room[startRoom].pal );
		var startImage = new PostProcessImage( ctx.getImageData(0,0,canvas.width,canvas.height) ); // TODO : don't use global ctx?
		transitionStart = new TransitionInfo(startImage, startPalette, startX, startY);

		if (transitionEffects[curEffect].showPlayerEnd) {
			player().room = endRoom;
			player().x = endX;
			player().y = endY;
		}
		else {
			player().room = "_transition_none";
		}

		drawRoom(room[endRoom]);
		var endPalette = getPal( room[endRoom].pal );
		var endImage = new PostProcessImage( ctx.getImageData(0,0,canvas.width,canvas.height) );
		transitionEnd = new TransitionInfo(endImage, endPalette, endX, endY);

		effectImage = new PostProcessImage( ctx.createImageData(canvas.width,canvas.height) );

		isTransitioning = true;
		transitionTime = 0;
		prevStep = -1;

		player().room = tmpRoom;
		player().x = tmpX;
		player().y = tmpY;
	}

	this.UpdateTransition = function(dt) {
		if (!isTransitioning) {
			return;
		}

		transitionTime += dt;

		var transitionDelta = transitionTime / transitionEffects[curEffect].duration;
		var maxStep = Math.floor(frameRate * (transitionEffects[curEffect].duration / 1000));
		var step = Math.floor(transitionDelta * maxStep);

		if (step != prevStep) {
			// console.log("step! " + step + " " + transitionDelta);
			for (var y = 0; y < effectImage.Height; y++) {
				for (var x = 0; x < effectImage.Width; x++) {
					var color = transitionEffects[curEffect].pixelEffectFunc(transitionStart,transitionEnd,x,y,(step / maxStep));
					effectImage.SetPixel(x,y,color);
				}
			}
		}
		prevStep = step;

		ctx.putImageData(effectImage.GetData(), 0, 0);

		if (transitionTime >= transitionEffects[curEffect].duration) {
			isTransitioning = false;
			transitionTime = 0;
			transitionStart = null;
			transitionEnd = null;
			effectImage = null;
			prevStep = -1;

			if (transitionCompleteCallback != null) {
				transitionCompleteCallback();
			}
			transitionCompleteCallback = null;
		}
	}

	this.IsTransitionActive = function() {
		return isTransitioning;
	}

	// todo : should this be part of the constructor?
	var transitionCompleteCallback = null;
	this.OnTransitionComplete = function(callback) {
		if (isTransitioning) { // TODO : safety check necessary?
			transitionCompleteCallback = callback;
		}
	}

	var transitionEffects = {};
	var curEffect = "none";
	this.RegisterTransitionEffect = function(name, effect) {
		transitionEffects[name] = effect;
	}

	this.RegisterTransitionEffect("none", {
		showPlayerStart : false,
		showPlayerEnd : false,
		pixelEffectFunc : function() {},
	});

	this.RegisterTransitionEffect("fade_w", { // TODO : have it linger on full white briefly?
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 750,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelColorA = delta < 0.5 ? start.Image.GetPixel(pixelX,pixelY) : {r:255,g:255,b:255,a:255};
			var pixelColorB = delta < 0.5 ? {r:255,g:255,b:255,a:255} : end.Image.GetPixel(pixelX,pixelY);

			delta = delta < 0.5 ? (delta / 0.5) : ((delta - 0.5) / 0.5); // hacky

			return PostProcessUtilities.LerpColor(pixelColorA, pixelColorB, delta);
		}
	});

	this.RegisterTransitionEffect("fade_b", {
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 750,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelColorA = delta < 0.5 ? start.Image.GetPixel(pixelX,pixelY) : {r:0,g:0,b:0,a:255};
			var pixelColorB = delta < 0.5 ? {r:0,g:0,b:0,a:255} : end.Image.GetPixel(pixelX,pixelY);

			delta = delta < 0.5 ? (delta / 0.5) : ((delta - 0.5) / 0.5); // hacky

			return PostProcessUtilities.LerpColor(pixelColorA, pixelColorB, delta);
		}
	});

	this.RegisterTransitionEffect("wave", {
		showPlayerStart : true,
		showPlayerEnd : true,
		duration : 1500,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var waveDelta = delta < 0.5 ? delta / 0.5 : 1 - ((delta - 0.5) / 0.5);

			var offset = (pixelY + (waveDelta * waveDelta * 0.2 * start.Image.Height));
			var freq = 4;
			var size = 2 + (14 * waveDelta);
			pixelX += Math.floor(Math.sin(offset / freq) * size);

			if (pixelX < 0) {
				pixelX += start.Image.Width;
			}
			else if (pixelX >= start.Image.Width) {
				pixelX -= start.Image.Width;
			}

			var curImage = delta < 0.5 ? start.Image : end.Image;
			return curImage.GetPixel(pixelX,pixelY);
		}
	});

	this.RegisterTransitionEffect("tunnel", {
		showPlayerStart : true,
		showPlayerEnd : true,
		duration : 1500,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			if (delta <= 0.4) {
				var tunnelDelta = 1 - (delta / 0.4);

				var xDist = start.PlayerCenter.x - pixelX;
				var yDist = start.PlayerCenter.y - pixelY;
				var dist = Math.sqrt((xDist * xDist) + (yDist * yDist));

				if (dist > start.Image.Width * tunnelDelta) {
					return {r:0,g:0,b:0,a:255};
				}
				else {
					return start.Image.GetPixel(pixelX,pixelY);
				}
			}
			else if (delta <= 0.6)
			{
				return {r:0,g:0,b:0,a:255};
			}
			else {
				var tunnelDelta = (delta - 0.6) / 0.4;

				var xDist = end.PlayerCenter.x - pixelX;
				var yDist = end.PlayerCenter.y - pixelY;
				var dist = Math.sqrt((xDist * xDist) + (yDist * yDist));

				if (dist > end.Image.Width * tunnelDelta) {
					return {r:0,g:0,b:0,a:255};
				}
				else {
					return end.Image.GetPixel(pixelX,pixelY);
				}
			}
		}
	});

	this.RegisterTransitionEffect("slide_u", {
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 1000,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelOffset = -1 * Math.floor(start.Image.Height * delta);
			var slidePixelY = pixelY + pixelOffset;

			var colorDelta = clampLerp(delta, 0.4);

			if (slidePixelY >= 0) {
				var colorA = start.Image.GetPixel(pixelX,slidePixelY);
				var colorB = PostProcessUtilities.GetCorrespondingColorFromPal(colorA,start.Palette,end.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
			else {
				slidePixelY += start.Image.Height;
				var colorB = end.Image.GetPixel(pixelX,slidePixelY);
				var colorA = PostProcessUtilities.GetCorrespondingColorFromPal(colorB,end.Palette,start.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
		}
	});

	this.RegisterTransitionEffect("slide_d", {
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 1000,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelOffset = Math.floor(start.Image.Height * delta);
			var slidePixelY = pixelY + pixelOffset;

			var colorDelta = clampLerp(delta, 0.4);

			if (slidePixelY < start.Image.Height) {
				var colorA = start.Image.GetPixel(pixelX,slidePixelY);
				var colorB = PostProcessUtilities.GetCorrespondingColorFromPal(colorA,start.Palette,end.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
			else {
				slidePixelY -= start.Image.Height;
				var colorB = end.Image.GetPixel(pixelX,slidePixelY);
				var colorA = PostProcessUtilities.GetCorrespondingColorFromPal(colorB,end.Palette,start.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
		}
	});

	this.RegisterTransitionEffect("slide_l", {
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 1000,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelOffset = -1 * Math.floor(start.Image.Width * delta);
			var slidePixelX = pixelX + pixelOffset;

			var colorDelta = clampLerp(delta, 0.4);

			if (slidePixelX >= 0) {
				var colorA = start.Image.GetPixel(slidePixelX,pixelY);
				var colorB = PostProcessUtilities.GetCorrespondingColorFromPal(colorA,start.Palette,end.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
			else {
				slidePixelX += start.Image.Width;
				var colorB = end.Image.GetPixel(slidePixelX,pixelY);
				var colorA = PostProcessUtilities.GetCorrespondingColorFromPal(colorB,end.Palette,start.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
		}
	});

	this.RegisterTransitionEffect("slide_r", {
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 1000,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelOffset = Math.floor(start.Image.Width * delta);
			var slidePixelX = pixelX + pixelOffset;

			var colorDelta = clampLerp(delta, 0.4);

			if (slidePixelX < start.Image.Width) {
				var colorA = start.Image.GetPixel(slidePixelX,pixelY);
				var colorB = PostProcessUtilities.GetCorrespondingColorFromPal(colorA,start.Palette,end.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
			else {
				slidePixelX -= start.Image.Width;
				var colorB = end.Image.GetPixel(slidePixelX,pixelY);
				var colorA = PostProcessUtilities.GetCorrespondingColorFromPal(colorB,end.Palette,start.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
		}
	});

	function clampLerp(deltaIn, clampDuration) {
		var clampOffset = (1.0 - clampDuration) / 2;
		var deltaOut = Math.min(clampDuration, Math.max(0.0, deltaIn - clampOffset)) / clampDuration;
		return deltaOut;
	}

	// TODO : WIP
	// this.RegisterTransitionEffect("fuzz", {
	// 	showPlayerStart : true,
	// 	showPlayerEnd : true,
	// 	duration : 1500,
	// 	pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
	// 		var curImage = delta <= 0.5 ? start : end;
	// 		var sampleSize = delta <= 0.5 ? (2 + Math.floor(14 * (delta/0.5))) : (16 - Math.floor(14 * ((delta-0.5)/0.5)));

	// 		var palIndex = 0;

	// 		var sampleX = Math.floor(pixelX / sampleSize) * sampleSize;
	// 		var sampleY = Math.floor(pixelY / sampleSize) * sampleSize;

	// 		var frameState = transitionEffects["fuzz"].frameState;

	// 		if (frameState.time != delta) {
	// 			frameState.time = delta;
	// 			frameState.preCalcSampleValues = {};
	// 		}

	// 		if (frameState.preCalcSampleValues[[sampleX,sampleY]]) {
	// 			palIndex = frameState.preCalcSampleValues[[sampleX,sampleY]];
	// 		}
	// 		else {
	// 			var paletteCount = {};
	// 			var foregroundValue = 1.0;
	// 			var backgroundValue = 0.4;
	// 			for (var y = sampleY; y < sampleY + sampleSize; y++) {
	// 				for (var x = sampleX; x < sampleX + sampleSize; x++) {
	// 					var color = curImage.Image.GetPixel(x,y)
	// 					var palIndex = PostProcessUtilities.GetColorPalIndex(color,curImage.Palette);
	// 					if (palIndex != -1) {
	// 						if (paletteCount[palIndex]) {
	// 							paletteCount[palIndex] += (palIndex != 0) ? foregroundValue : backgroundValue;
	// 						}
	// 						else {
	// 							paletteCount[palIndex] = (palIndex != 0) ? foregroundValue : backgroundValue;
	// 						}
	// 					}
	// 				}
	// 			}

	// 			var maxCount = 0;
	// 			for (var i in paletteCount) {
	// 				if (paletteCount[i] > maxCount) {
	// 					palIndex = i;
	// 					maxCount = paletteCount[i];
	// 				}
	// 			}

	// 			frameState.preCalcSampleValues[[sampleX,sampleY]] = palIndex;
	// 		}

	// 		return PostProcessUtilities.GetPalColor(curImage.Palette,palIndex);
	// 	},
	// 	frameState : { // ok this is hacky but it's for performance ok
	// 		time : -1,
	// 		preCalcSampleValues : {}
	// 	}
	// });
}; // TransitionManager()


// TODO : extract the scale variable so it can be changed?
var PostProcessUtilities = {
	SamplePixelColor : function(image,x,y) {
		var pixelIndex = (y * scale * image.width * 4) + (x * scale * 4);
		var r = image.data[pixelIndex + 0];
		var g = image.data[pixelIndex + 1];
		var b = image.data[pixelIndex + 2];
		var a = image.data[pixelIndex + 3];
		return { r:r, g:g, b:b, a:a };
	},
	SetPixelColor : function(image,x,y,colorRgba) {
		for (var yDelta = 0; yDelta <= scale; yDelta++) {
			for (var xDelta = 0; xDelta <= scale; xDelta++) {
				var pixelIndex = (((y * scale) + yDelta) * image.width * 4) + (((x * scale) + xDelta) * 4);
				image.data[pixelIndex + 0] = colorRgba.r;
				image.data[pixelIndex + 1] = colorRgba.g;
				image.data[pixelIndex + 2] = colorRgba.b;
				image.data[pixelIndex + 3] = colorRgba.a;
			}
		}
	},
	LerpColor : function(colorA,colorB,t) {
		// TODO: move to color_util.js?
		return {
			r : colorA.r + ((colorB.r - colorA.r) * t),
			g : colorA.g + ((colorB.g - colorA.g) * t),
			b : colorA.b + ((colorB.b - colorA.b) * t),
			a : colorA.a + ((colorB.a - colorA.a) * t),
		};
	},
	GetColorPalIndex : function(colorIn,curPal) {
		var colorIndex = -1;

		for (var i = 0; i < curPal.length; i++) {
			if (colorIn.r == curPal[i][0] && colorIn.g == curPal[i][1] && colorIn.b == curPal[i][2]) {
				colorIndex = i;
			}
		}

		return colorIndex;
	},
	GetPalColor : function(palette,index) {
		return { r: palette[index][0], g: palette[index][1], b: palette[index][2], a: 255 }
	},
	GetCorrespondingColorFromPal : function(colorIn,curPal,otherPal) { // this is kind of hacky!
		var colorIndex = PostProcessUtilities.GetColorPalIndex(colorIn,curPal);

		if (colorIndex >= 0 && colorIndex <= otherPal.length) {
			return PostProcessUtilities.GetPalColor(otherPal,colorIndex);
		}
		else {
			return colorIn;
		}
	},
};

var PostProcessImage = function(imageData) {
	this.Width = imageData.width / scale;
	this.Height = imageData.height / scale;

	this.GetPixel = function(x,y) {
		return PostProcessUtilities.SamplePixelColor(imageData,x,y);
	};

	this.SetPixel = function(x,y,colorRgba) {
		PostProcessUtilities.SetPixelColor(imageData,x,y,colorRgba);
	};

	this.GetData = function() {
		return imageData;
	};
};

var TransitionInfo = function(image, palette, playerX, playerY) {
	this.Image = image;
	this.Palette = palette;
	this.PlayerTilePos = { x: playerX, y: playerY };
	this.PlayerCenter = { x: Math.floor((playerX * tilesize) + (tilesize / 2)), y: Math.floor((playerY * tilesize) + (tilesize / 2)) };
};
</script>

<script>
/*
TODO:
- can I simplify this more now that I've removed the external resources stuff?
*/

function FontManager(packagedFontNames) {

var self = this;

var fontExtension = ".bitsyfont";
this.GetExtension = function() {
	return fontExtension;
}

// place to store font data
var fontResources = {};

// load fonts from the editor
if (packagedFontNames != undefined && packagedFontNames != null && packagedFontNames.length > 0
		&& Resources != undefined && Resources != null) {

	for (var i = 0; i < packagedFontNames.length; i++) {
		var filename = packagedFontNames[i];
		fontResources[filename] = Resources[filename];
	}
}

// manually add resource
this.AddResource = function(filename, fontdata) {
	fontResources[filename] = fontdata;
}

this.ContainsResource = function(filename) {
	return fontResources[filename] != null;
}

function GetData(fontName) {
	return fontResources[fontName + fontExtension];
}
this.GetData = GetData;

function Create(fontData) {
	return new Font(fontData);
}
this.Create = Create;

this.Get = function(fontName) {
	var fontData = self.GetData(fontName);
	return self.Create(fontData);
}

function Font(fontData) {
	var name = "unknown";
	var width = 6; // default size so if you have NO font or an invalid font it displays boxes
	var height = 8;
	var chardata = {};
	var invalidCharData = {};

	this.getName = function() {
		return name;
	}

	this.getData = function() {
		return chardata;
	}

	this.getWidth = function() {
		return width;
	}

	this.getHeight = function() {
		return height;
	}

	this.hasChar = function(char) {
		var codepoint = char.charCodeAt(0);
		return chardata[codepoint] != null;
	}

	this.getChar = function(char) {

		var codepoint = char.charCodeAt(0);

		if (chardata[codepoint] != null) {
			return chardata[codepoint];
		}
		else {
			return invalidCharData;
		}
	}

	this.allCharCodes = function() {
		var codeList = [];
		for (var code in chardata) {
			codeList.push(code);
		}
		return codeList;
	}

	function parseFont(fontData) {
		if (fontData == null)
			return;

		var lines = fontData.split("\n");

		var isReadingChar = false;
		var isReadingCharProperties = false;
		var curCharLineCount = 0;
		var curCharCode = 0;

		for (var i = 0; i < lines.length; i++) {
			var line = lines[i];

			if (line[0] === "#") {
				continue; // skip comment lines
			}

			if (!isReadingChar) {
				// READING NON CHARACTER DATA LINE
				var args = line.split(" ");
				if (args[0] == "FONT") {
					name = args[1];
				}
				else if (args[0] == "SIZE") {
					width = parseInt(args[1]);
					height = parseInt(args[2]);
				}
				else if (args[0] == "CHAR") {
					isReadingChar = true;
					isReadingCharProperties = true;

					curCharLineCount = 0;
					curCharCode = parseInt(args[1]);
					chardata[curCharCode] = { 
						width: width,
						height: height,
						offset: {
							x: 0,
							y: 0
						},
						spacing: width,
						data: []
					};
				}
			}
			else {
				// CHAR PROPERTIES
				if (isReadingCharProperties) {
					var args = line.split(" ");
					if (args[0].indexOf("CHAR_") == 0) { // Sub-properties start with "CHAR_"
						if (args[0] == "CHAR_SIZE") {
							// Custom character size - overrides the default character size for the font
							chardata[curCharCode].width = parseInt(args[1]);
							chardata[curCharCode].height = parseInt(args[2]);
							chardata[curCharCode].spacing = parseInt(args[1]); // HACK : assumes CHAR_SIZE is always declared first
						}
						else if (args[0] == "CHAR_OFFSET") {
							// Character offset - shift the origin of the character on the X or Y axis
							chardata[curCharCode].offset.x = parseInt(args[1]);
							chardata[curCharCode].offset.y = parseInt(args[2]);
						}
						else if (args[0] == "CHAR_SPACING") {
							// Character spacing:
							// specify total horizontal space taken up by the character
							// lets chars take up more or less space on a line than its bitmap does
							chardata[curCharCode].spacing = parseInt(args[1]);
						}
					}
					else {
						isReadingCharProperties = false;
					}
				}

				// CHAR DATA
				if (!isReadingCharProperties) {
					// READING CHARACTER DATA LINE
					for (var j = 0; j < chardata[curCharCode].width; j++)
					{
						chardata[curCharCode].data.push( parseInt(line[j]) );
					}

					curCharLineCount++;
					if (curCharLineCount >= height) {
						isReadingChar = false;
					}
				}
			}
		}

		// init invalid character box
		invalidCharData = { 
			width: width,
			height: height,
			offset: {
				x: 0,
				y: 0
			},
			spacing: width, // TODO : name?
			data: []
		};
		for (var y = 0; y < height; y++) {
			for (var x = 0; x < width; x++) {
				if (x < width-1 && y < height-1) {
					invalidCharData.data.push(1);
				}
				else {
					invalidCharData.data.push(0);
				}
			}
		}
	}

	parseFont(fontData);
}

} // FontManager
</script>

<script>
function Script() {

this.CreateInterpreter = function() {
	return new Interpreter();
};

this.CreateUtils = function() {
	return new Utils();
};

var Interpreter = function() {
	var env = new Environment();
	var parser = new Parser( env );

	this.SetDialogBuffer = function(buffer) { env.SetDialogBuffer( buffer ); };

	// TODO -- maybe this should return a string instead othe actual script??
	this.Compile = function(scriptName, scriptStr) {
		// console.log("COMPILE");
		var script = parser.Parse(scriptStr, scriptName);
		env.SetScript(scriptName, script);
	}
	this.Run = function(scriptName, exitHandler, objectContext) { // Runs pre-compiled script
		var localEnv = new LocalEnvironment(env);

		if (objectContext) {
			localEnv.SetObject(objectContext); // PROTO : should this be folded into the constructor?
		}

		var script = env.GetScript(scriptName);

		script.Eval( localEnv, function(result) { OnScriptReturn(localEnv, exitHandler); } );
	}
	this.Interpret = function(scriptStr, exitHandler, objectContext) { // Compiles and runs code immediately
		// console.log("INTERPRET");
		var localEnv = new LocalEnvironment(env);

		if (objectContext) {
			localEnv.SetObject(objectContext); // PROTO : should this be folded into the constructor?
		}

		var script = parser.Parse(scriptStr, "anonymous");
		script.Eval( localEnv, function(result) { OnScriptReturn(localEnv, exitHandler); } );
	}
	this.HasScript = function(name) { return env.HasScript(name); };

	this.ResetEnvironment = function() {
		env = new Environment();
		parser = new Parser( env );
	}

	this.Parse = function(scriptStr, rootId) { // parses a script but doesn't save it
		return parser.Parse(scriptStr, rootId);
	}

	// TODO : add back in if needed later...
	// this.CompatibilityParse = function(scriptStr, compatibilityFlags) {
	// 	env.compatibilityFlags = compatibilityFlags;

	// 	var result = parser.Parse(scriptStr);

	// 	delete env.compatibilityFlags;

	// 	return result;
	// }

	this.Eval = function(scriptTree, exitHandler) { // runs a script stored externally
		var localEnv = new LocalEnvironment(env); // TODO : does this need an object context?
		scriptTree.Eval(
			localEnv,
			function(result) {
				OnScriptReturn(result, exitHandler);
			});
	}

	function OnScriptReturn(result, exitHandler) {
		if (exitHandler != null) {
			exitHandler(result);
		}
	}

	this.CreateExpression = function(expStr) {
		return parser.CreateExpression(expStr);
	}

	this.SetVariable = function(name,value,useHandler) {
		env.SetVariable(name,value,useHandler);
	}

	this.DeleteVariable = function(name,useHandler) {
		env.DeleteVariable(name,useHandler);
	}
	this.HasVariable = function(name) {
		return env.HasVariable(name);
	}

	this.SetOnVariableChangeHandler = function(onVariableChange) {
		env.SetOnVariableChangeHandler(onVariableChange);
	}
	this.GetVariableNames = function() {
		return env.GetVariableNames();
	}
	this.GetVariable = function(name) {
		return env.GetVariable(name);
	}

	function DebugVisualizeScriptTree(scriptTree) {
		var printVisitor = {
			Visit : function(node,depth) {
				console.log("-".repeat(depth) + "- " + node.ToString());
			},
		};

		scriptTree.VisitAll( printVisitor );
	}

	this.DebugVisualizeScriptTree = DebugVisualizeScriptTree;

	this.DebugVisualizeScript = function(scriptName) {
		DebugVisualizeScriptTree(env.GetScript(scriptName));
	}
}


var Utils = function() {
	// for editor ui
	this.CreateDialogBlock = function(children,doIndentFirstLine) {
		if (doIndentFirstLine === undefined) {
			doIndentFirstLine = true;
		}

		var block = new DialogBlockNode(doIndentFirstLine);

		for (var i = 0; i < children.length; i++) {
			block.AddChild(children[i]);
		}
		return block;
	}

	this.CreateOptionBlock = function() {
		var block = new DialogBlockNode(false);
		block.AddChild(new FuncNode("print", [new LiteralNode(" ")]));
		return block;
	}

	this.CreateItemConditionPair = function() {
		var itemFunc = this.CreateFunctionBlock("item", ["0"]);
		var condition = new ExpNode("==", itemFunc, new LiteralNode(1));
		var result = new DialogBlockNode(true);
		result.AddChild(new FuncNode("print", [new LiteralNode(" ")]));
		var conditionPair = new ConditionPairNode(condition, result);
		return conditionPair;
	}

	this.CreateVariableConditionPair = function() {
		var varNode = this.CreateVariableNode("a");
		var condition = new ExpNode("==", varNode, new LiteralNode(1));
		var result = new DialogBlockNode(true);
		result.AddChild(new FuncNode("print", [new LiteralNode(" ")]));
		var conditionPair = new ConditionPairNode(condition, result);
		return conditionPair;
	}

	this.CreateDefaultConditionPair = function() {
		var condition = this.CreateElseNode();
		var result = new DialogBlockNode(true);
		result.AddChild(new FuncNode("print", [new LiteralNode(" ")]));
		var conditionPair = new ConditionPairNode(condition, result);
		return conditionPair;
	}

	this.CreateEmptyPrintFunc = function() {
		return new FuncNode("print", [new LiteralNode("...")]);
	}

	this.CreateFunctionBlock = function(name, initParamValues) {
		var parameters = [];
		for (var i = 0; i < initParamValues.length; i++) {
			parameters.push(new LiteralNode(initParamValues[i]));
		}

		var node = new FuncNode(name, parameters);
		var block = new CodeBlockNode();
		block.AddChild(node);
		return block;
	}

	// TODO : rename ParseStringToLiteralNode?
	this.CreateLiteralNode = function(str) {
		if (str === "true") {
			return new LiteralNode(true);
		}
		else if (str === "false") {
			return new LiteralNode(false);
		}
		else if (!isNaN(parseFloat(str))) {
			return new LiteralNode(parseFloat(str));
		}
		else {
			return new LiteralNode(str);
		}
	}

	this.CreateVariableNode = function(variableName) {
		return new VarNode(variableName);
	}

	this.CreatePropertyNode = function(propertyName, literalValue) {
		var varNode = new VarNode(propertyName);
		var valNode = new LiteralNode(literalValue);
		var node = new FuncNode("property", [varNode, valNode]);
		var block = new CodeBlockNode();
		block.AddChild(node);
		return block;
	}

	this.CreateElseNode = function() {
		return new ElseNode();
	}

	this.CreateStringLiteralNode = function(str) {
		return new LiteralNode(str);
	}

	// TODO : need to split up code & dialog blocks :|
	this.CreateCodeBlock = function() {
		return new CodeBlockNode();
	}

	this.ChangeSequenceType = function(oldSequence, type) {
		if(type === "sequence") {
			return new SequenceNode(oldSequence.children);
		}
		else if(type === "cycle") {
			return new CycleNode(oldSequence.children);
		}
		else if(type === "shuffle") {
			return new ShuffleNode(oldSequence.children);
		}
		return oldSequence;
	}

	this.CreateSequenceBlock = function() {
		var option1 = new DialogBlockNode( false /*doIndentFirstLine*/ );
		option1.AddChild(new FuncNode("print", [new LiteralNode("...")]));

		var option2 = new DialogBlockNode( false /*doIndentFirstLine*/ );
		option2.AddChild(new FuncNode("print", [new LiteralNode("...")]));

		var sequence = new SequenceNode( [ option1, option2 ] );
		var block = new CodeBlockNode();
		block.AddChild( sequence );
		return block;
	}

	this.CreateCycleBlock = function() {
		var option1 = new DialogBlockNode( false /*doIndentFirstLine*/ );
		option1.AddChild(new FuncNode("print", [new LiteralNode("...")]));

		var option2 = new DialogBlockNode( false /*doIndentFirstLine*/ );
		option2.AddChild(new FuncNode("print", [new LiteralNode("...")]));

		var sequence = new CycleNode( [ option1, option2 ] );
		var block = new CodeBlockNode();
		block.AddChild( sequence );
		return block;
	}

	this.CreateShuffleBlock = function() {
		var option1 = new DialogBlockNode( false /*doIndentFirstLine*/ );
		option1.AddChild(new FuncNode("print", [new LiteralNode("...")]));

		var option2 = new DialogBlockNode( false /*doIndentFirstLine*/ );
		option2.AddChild(new FuncNode("print", [new LiteralNode("...")]));

		var sequence = new ShuffleNode( [ option1, option2 ] );
		var block = new CodeBlockNode();
		block.AddChild( sequence );
		return block;
	}

	this.CreateIfBlock = function() {
		var leftNode = new CodeBlockNode();
		leftNode.AddChild( new FuncNode("item", [new LiteralNode("0")] ) );
		var rightNode = new LiteralNode( 1 );
		var condition1 = new ExpNode("==", leftNode, rightNode );

		var condition2 = new ElseNode();

		var result1 = new DialogBlockNode();
		result1.AddChild(new FuncNode("print", [new LiteralNode("...")]));

		var result2 = new DialogBlockNode();
		result2.AddChild(new FuncNode("print", [new LiteralNode("...")]));

		var ifNode = new IfNode( [ condition1, condition2 ], [ result1, result2 ] );
		var block = new CodeBlockNode();
		block.AddChild( ifNode );
		return block;
	}

	this.ReadDialogScript = function(lines, i) {
		var scriptStr = "";
		if (lines[i] === Sym.DialogOpen) {
			scriptStr += lines[i] + "\n";
			i++;
			while(lines[i] != Sym.DialogClose) {
				scriptStr += lines[i] + "\n";
				i++;
			}
			scriptStr += lines[i];
			i++;
		}
		else {
			scriptStr += lines[i];
			i++;
		}
		return { script:scriptStr, index:i };
	}

	// TODO this.ReadCodeScript (reads through code open and close symbols), and this.ReadScript

	this.EnsureDialogBlockFormat = function(dialogStr) {
		// TODO -- what if it's already enclosed in dialog symbols??
		if(dialogStr.indexOf('\n') > -1) {
			dialogStr = Sym.DialogOpen + "\n" + dialogStr + "\n" + Sym.DialogClose;
		}
		return dialogStr;
	}

	this.RemoveDialogBlockFormat = function(source) {
		var sourceLines = source.split("\n");
		var dialogStr = "";
		if(sourceLines[0] === Sym.DialogOpen) {
			// multi line
			var i = 1;
			while (i < sourceLines.length && sourceLines[i] != Sym.DialogClose) {
				dialogStr += sourceLines[i] + (sourceLines[i+1] != Sym.DialogClose ? '\n' : '');
				i++;
			}
		}
		else {
			// single line
			dialogStr = source;
		}
		return dialogStr;
	}

	this.SerializeDialogNodeList = function(nodeList) {
		var tempBlock = new DialogBlockNode(false);
		 // set children directly to avoid breaking the parenting chain for this temp operation
		tempBlock.children = nodeList;
		return tempBlock.Serialize();
	}

	this.GetOperatorList = function() {
		return [Sym.Set].concat(Sym.Operators);
	}

	this.IsInlineCode = function(node) {
		return isInlineCode(node);
	}
}


/* BUILT-IN FUNCTIONS */ // TODO: better way to encapsulate these?
function deprecatedFunc(environment,parameters,onReturn) {
	console.log("BITSY SCRIPT WARNING: Tried to use deprecated function");
	onReturn(null);
}

function printFunc(environment, parameters, onReturn) {
	if (parameters[0] != undefined && parameters[0] != null) {
		var textStr = "" + parameters[0];
		environment.GetDialogBuffer().AddText(textStr);
		environment.GetDialogBuffer().AddScriptReturn(function() { onReturn(null); });
	}
	else {
		onReturn(null);
	}
}

function linebreakFunc(environment, parameters, onReturn) {
	// console.log("LINEBREAK FUNC");
	environment.GetDialogBuffer().AddLinebreak();
	environment.GetDialogBuffer().AddScriptReturn(function() { onReturn(null); });
}

function pagebreakFunc(environment, parameters, onReturn) {
	environment.GetDialogBuffer().AddPagebreak(function() { onReturn(null); });
}

function printDrawingFunc(environment, parameters, onReturn) {
	var drawingId = parameters[0];
	environment.GetDialogBuffer().AddDrawing(drawingId);
	environment.GetDialogBuffer().AddScriptReturn(function() { onReturn(null); });
}

function printSpriteFunc(environment,parameters,onReturn) {
	var spriteId = parameters[0];
	if(names.sprite.has(spriteId)) spriteId = names.sprite.get(spriteId); // id is actually a name
	var drawingId = sprite[spriteId].drw;
	printDrawingFunc(environment, [drawingId], onReturn);
}

function printTileFunc(environment,parameters,onReturn) {
	var tileId = parameters[0];
	if(names.tile.has(tileId)) tileId = names.tile.get(tileId); // id is actually a name
	var drawingId = tile[tileId].drw;
	printDrawingFunc(environment, [drawingId], onReturn);
}

function printItemFunc(environment,parameters,onReturn) {
	var itemId = parameters[0];
	if(names.item.has(itemId)) itemId = names.item.get(itemId); // id is actually a name
	var drawingId = item[itemId].drw;
	printDrawingFunc(environment, [drawingId], onReturn);
}

function printFontFunc(environment, parameters, onReturn) {
	var allCharacters = "";
	var font = fontManager.Get( fontName );
	var codeList = font.allCharCodes();
	for (var i = 0; i < codeList.length; i++) {
		allCharacters += String.fromCharCode(codeList[i]) + " ";
	}
	printFunc(environment, [allCharacters], onReturn);
}

function itemFunc(environment,parameters,onReturn) {
	var itemId = parameters[0];

	if (names.item.has(itemId)) {
		// id is actually a name
		itemId = names.item.get(itemId);
	}

	var curItemCount = player().inventory[itemId] ? player().inventory[itemId] : 0;

	if (parameters.length > 1) {
		// TODO : is it a good idea to force inventory to be >= 0?
		player().inventory[itemId] = Math.max(0, parseInt(parameters[1]));
		curItemCount = player().inventory[itemId];

		if (onInventoryChanged != null) {
			onInventoryChanged(itemId);
		}
	}

	onReturn(curItemCount);
}

function addOrRemoveTextEffect(environment,name) {
	if( environment.GetDialogBuffer().HasTextEffect(name) )
		environment.GetDialogBuffer().RemoveTextEffect(name);
	else
		environment.GetDialogBuffer().AddTextEffect(name);
}

function rainbowFunc(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"rbw");
	onReturn(null);
}

// TODO : should the colors use a parameter instead of special names?
function color1Func(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"clr1");
	onReturn(null);
}

function color2Func(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"clr2");
	onReturn(null);
}

function color3Func(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"clr3");
	onReturn(null);
}

function wavyFunc(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"wvy");
	onReturn(null);
}

function shakyFunc(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"shk");
	onReturn(null);
}

function propertyFunc(environment, parameters, onReturn) {
	var outValue = null;

	if (parameters.length > 0 && parameters[0]) {
		var propertyName = parameters[0];

		if (environment.HasProperty(propertyName)) {
			// TODO : in a future update I can handle the case of initializing a new property
			// after which we can move this block outside the HasProperty check
			if (parameters.length > 1) {
				var inValue = parameters[1];
				environment.SetProperty(propertyName, inValue);
			}

			outValue = environment.GetProperty(propertyName);
		}
	}

	console.log("PROPERTY! " + propertyName + " " + outValue);

	onReturn(outValue);
}

function endFunc(environment,parameters,onReturn) {
	isEnding = true;
	isNarrating = true;
	dialogRenderer.SetCentered(true);
	onReturn(null);
}

function exitFunc(environment,parameters,onReturn) {
	var destRoom = parameters[0];

	if (names.room.has(destRoom)) {
		// it's a name, not an id! (note: these could cause trouble if people names things weird)
		destRoom = names.room.get(destRoom);
	}

	var destX = parseInt(parameters[1]);
	var destY = parseInt(parameters[2]);

	if (parameters.length >= 4) {
		var transitionEffect = parameters[3];

		transition.BeginTransition(
			player().room,
			player().x,
			player().y,
			destRoom,
			destX,
			destY,
			transitionEffect);
		transition.UpdateTransition(0);
	}

	player().room = destRoom;
	player().x = destX;
	player().y = destY;
	curRoom = destRoom;
	initRoom(curRoom);

	// TODO : this doesn't play nice with pagebreak because it thinks the dialog is finished!
	if (transition.IsTransitionActive()) {
		transition.OnTransitionComplete(function() { onReturn(null); });
	}
	else {
		onReturn(null);
	}
}

/* BUILT-IN OPERATORS */
function setExp(environment,left,right,onReturn) {
	// console.log("SET " + left.name);

	if(left.type != "variable") {
		// not a variable! return null and hope for the best D:
		onReturn( null );
		return;
	}

	right.Eval(environment,function(rVal) {
		environment.SetVariable( left.name, rVal );
		// console.log("VAL " + environment.GetVariable( left.name ) );
		left.Eval(environment,function(lVal) {
			onReturn( lVal );
		});
	});
}
function equalExp(environment,left,right,onReturn) {
	// console.log("EVAL EQUAL");
	// console.log(left);
	// console.log(right);
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal === rVal );
		});
	});
}
function greaterExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal > rVal );
		});
	});
}
function lessExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal < rVal );
		});
	});
}
function greaterEqExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal >= rVal );
		});
	});
}
function lessEqExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal <= rVal );
		});
	});
}
function multExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal * rVal );
		});
	});
}
function divExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal / rVal );
		});
	});
}
function addExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal + rVal );
		});
	});
}
function subExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal - rVal );
		});
	});
}

/* ENVIRONMENT */
var Environment = function() {
	var dialogBuffer = null;
	this.SetDialogBuffer = function(buffer) { dialogBuffer = buffer; };
	this.GetDialogBuffer = function() { return dialogBuffer; };

	var functionMap = new Map();
	functionMap.set("print", printFunc);
	functionMap.set("say", printFunc);
	functionMap.set("br", linebreakFunc);
	functionMap.set("item", itemFunc);
	functionMap.set("rbw", rainbowFunc);
	functionMap.set("clr1", color1Func);
	functionMap.set("clr2", color2Func);
	functionMap.set("clr3", color3Func);
	functionMap.set("wvy", wavyFunc);
	functionMap.set("shk", shakyFunc);
	functionMap.set("printSprite", printSpriteFunc);
	functionMap.set("printTile", printTileFunc);
	functionMap.set("printItem", printItemFunc);
	functionMap.set("debugOnlyPrintFont", printFontFunc); // DEBUG ONLY
	functionMap.set("end", endFunc);
	functionMap.set("exit", exitFunc);
	functionMap.set("pg", pagebreakFunc);
	functionMap.set("property", propertyFunc);

	this.HasFunction = function(name) { return functionMap.has(name); };
	this.EvalFunction = function(name,parameters,onReturn,env) {
		if (env == undefined || env == null) {
			env = this;
		}

		functionMap.get(name)(env, parameters, onReturn);
	}

	var variableMap = new Map();

	this.HasVariable = function(name) { return variableMap.has(name); };
	this.GetVariable = function(name) { return variableMap.get(name); };
	this.SetVariable = function(name,value,useHandler) {
		// console.log("SET VARIABLE " + name + " = " + value);
		if(useHandler === undefined) useHandler = true;
		variableMap.set(name, value);
		if(onVariableChangeHandler != null && useHandler){
			onVariableChangeHandler(name);
		}
	};
	this.DeleteVariable = function(name,useHandler) {
		if(useHandler === undefined) useHandler = true;
		if(variableMap.has(name)) {
			variableMap.delete(name);
			if(onVariableChangeHandler != null && useHandler) {
				onVariableChangeHandler(name);
			}
		}
	};

	var operatorMap = new Map();
	operatorMap.set("=", setExp);
	operatorMap.set("==", equalExp);
	operatorMap.set(">", greaterExp);
	operatorMap.set("<", lessExp);
	operatorMap.set(">=", greaterEqExp);
	operatorMap.set("<=", lessEqExp);
	operatorMap.set("*", multExp);
	operatorMap.set("/", divExp);
	operatorMap.set("+", addExp);
	operatorMap.set("-", subExp);

	this.HasOperator = function(sym) { return operatorMap.get(sym); };
	this.EvalOperator = function(sym,left,right,onReturn) {
		operatorMap.get( sym )( this, left, right, onReturn );
	}

	var scriptMap = new Map();
	this.HasScript = function(name) { return scriptMap.has(name); };
	this.GetScript = function(name) { return scriptMap.get(name); };
	this.SetScript = function(name,script) { scriptMap.set(name, script); };

	var onVariableChangeHandler = null;
	this.SetOnVariableChangeHandler = function(onVariableChange) {
		onVariableChangeHandler = onVariableChange;
	}
	this.GetVariableNames = function() {
		return Array.from( variableMap.keys() );
	}
}

// Local environment for a single run of a script: knows local context
var LocalEnvironment = function(parentEnvironment) {
	// this.SetDialogBuffer // not allowed in local environment?
	this.GetDialogBuffer = function() { return parentEnvironment.GetDialogBuffer(); };

	this.HasFunction = function(name) { return parentEnvironment.HasFunction(name); };
	this.EvalFunction = function(name,parameters,onReturn,env) {
		if (env == undefined || env == null) {
			env = this;
		}

		parentEnvironment.EvalFunction(name,parameters,onReturn,env);
	}

	this.HasVariable = function(name) { return parentEnvironment.HasVariable(name); };
	this.GetVariable = function(name) { return parentEnvironment.GetVariable(name); };
	this.SetVariable = function(name,value,useHandler) { parentEnvironment.SetVariable(name,value,useHandler); };
	// this.DeleteVariable // not needed in local environment?

	this.HasOperator = function(sym) { return parentEnvironment.HasOperator(sym); };
	this.EvalOperator = function(sym,left,right,onReturn,env) {
		if (env == undefined || env == null) {
			env = this;
		}

		parentEnvironment.EvalOperator(sym,left,right,onReturn,env);
	};

	// TODO : I don't *think* any of this is required by the local environment
	// this.HasScript
	// this.GetScript
	// this.SetScript

	// TODO : pretty sure these debug methods aren't required by the local environment either
	// this.SetOnVariableChangeHandler
	// this.GetVariableNames

	/* Here's where specific local context data goes:
	 * this includes access to the object running the script
	 * and any properties it may have (so far only "locked")
	 */

	// The local environment knows what object called it -- currently only used to access properties
	var curObject = null;
	this.HasObject = function() { return curObject != undefined && curObject != null; }
	this.SetObject = function(object) { curObject = object; }
	this.GetObject = function() { return curObject; }

	// accessors for properties of the object that's running the script
	this.HasProperty = function(name) {
		if (curObject && curObject.property && curObject.property.hasOwnProperty(name)) {
			return true;
		}
		else {
			return false;
		}
	};
	this.GetProperty = function(name) {
		if (curObject && curObject.property && curObject.property.hasOwnProperty(name)) {
			return curObject.property[name]; // TODO : should these be getters and setters instead?
		}
		else {
			return null;
		}
	};
	this.SetProperty = function(name, value) {
		// NOTE : for now, we need to gaurd against creating new properties
		if (curObject && curObject.property && curObject.property.hasOwnProperty(name)) {
			curObject.property[name] = value;
		}
	};
}

function leadingWhitespace(depth) {
	var str = "";
	for(var i = 0; i < depth; i++) {
		str += "  "; // two spaces per indent
	}
	// console.log("WHITESPACE " + depth + " ::" + str + "::");
	return str;
}

/* NODES */
var TreeRelationship = function() {
	this.parent = null;
	this.children = [];

	this.AddChild = function(node) {
		this.children.push(node);
		node.parent = this;
	};

	this.AddChildren = function(nodeList) {
		for (var i = 0; i < nodeList.length; i++) {
			this.AddChild(nodeList[i]);
		}
	};

	this.SetChildren = function(nodeList) {
		this.children = [];
		this.AddChildren(nodeList);
	};

	this.VisitAll = function(visitor, depth) {
		if (depth == undefined || depth == null) {
			depth = 0;
		}

		visitor.Visit(this, depth);
		for (var i = 0; i < this.children.length; i++) {
			this.children[i].VisitAll( visitor, depth + 1 );
		}
	};

	this.rootId = null; // for debugging
	this.GetId = function() {
		// console.log(this);
		if (this.rootId != null) {
			return this.rootId;
		}
		else if (this.parent != null) {
			var parentId = this.parent.GetId();
			if (parentId != null) {
				return parentId + "_" + this.parent.children.indexOf(this);
			}
		}
		else {
			return null;
		}
	}
}

var DialogBlockNode = function(doIndentFirstLine) {
	Object.assign( this, new TreeRelationship() );
	// Object.assign( this, new Runnable() );
	this.type = "dialog_block";

	this.Eval = function(environment, onReturn) {
		// console.log("EVAL BLOCK " + this.children.length);

		if (isPlayerEmbeddedInEditor && events != undefined && events != null) {
			events.Raise("script_node_enter", { id: this.GetId() });
		}

		var lastVal = null;
		var i = 0;

		function evalChildren(children, done) {
			if (i < children.length) {
				// console.log(">> CHILD " + i);
				children[i].Eval(environment, function(val) {
					// console.log("<< CHILD " + i);
					lastVal = val;
					i++;
					evalChildren(children,done);
				});
			}
			else {
				done();
			}
		};

		var self = this;
		evalChildren(this.children, function() {
			if (isPlayerEmbeddedInEditor && events != undefined && events != null) {
				events.Raise("script_node_exit", { id: self.GetId() });
			}

			onReturn(lastVal);
		});
	}

	if (doIndentFirstLine === undefined) {
		doIndentFirstLine = true; // This is just for serialization
	}

	this.Serialize = function(depth) {
		if (depth === undefined) {
			depth = 0;
		}

		var str = "";
		var lastNode = null;

		for (var i = 0; i < this.children.length; i++) {

			var curNode = this.children[i];

			var curNodeIsNonInlineCode = curNode.type === "code_block" && !isInlineCode(curNode);
			var prevNodeIsNonInlineCode = lastNode && lastNode.type === "code_block" && !isInlineCode(lastNode);

			var shouldIndentFirstLine = (i == 0 && doIndentFirstLine);
			var shouldIndentAfterLinebreak = (lastNode && lastNode.type === "function" && lastNode.name === "br");
			var shouldIndentCodeBlock = i > 0 && curNodeIsNonInlineCode;
			var shouldIndentAfterCodeBlock = prevNodeIsNonInlineCode;

			// need to insert a newline before the first block of non-inline code that isn't 
			// preceded by a {br}, since those will create their own newline
			if (i > 0 && curNodeIsNonInlineCode && !prevNodeIsNonInlineCode && !shouldIndentAfterLinebreak) {
				str += "\n";
			}

			if (shouldIndentFirstLine || shouldIndentAfterLinebreak || shouldIndentCodeBlock || shouldIndentAfterCodeBlock) {
				str += leadingWhitespace(depth);
			}

			str += curNode.Serialize(depth);

			if (i < this.children.length-1 && curNodeIsNonInlineCode) {
				str += "\n";
			}

			lastNode = curNode;
		}

		return str;
	}

	this.ToString = function() {
		return this.type + " " + this.GetId();
	};
}

var CodeBlockNode = function() {
	Object.assign( this, new TreeRelationship() );
	this.type = "code_block";

	this.Eval = function(environment, onReturn) {
		// console.log("EVAL BLOCK " + this.children.length);

		if (isPlayerEmbeddedInEditor && events != undefined && events != null) {
			events.Raise("script_node_enter", { id: this.GetId() });
		}

		var lastVal = null;
		var i = 0;

		function evalChildren(children, done) {
			if (i < children.length) {
				// console.log(">> CHILD " + i);
				children[i].Eval(environment, function(val) {
					// console.log("<< CHILD " + i);
					lastVal = val;
					i++;
					evalChildren(children,done);
				});
			}
			else {
				done();
			}
		};

		var self = this;
		evalChildren(this.children, function() {
			if (isPlayerEmbeddedInEditor && events != undefined && events != null) {
				events.Raise("script_node_exit", { id: self.GetId() });
			}

			onReturn(lastVal);
		});
	}

	this.Serialize = function(depth) {
		if(depth === undefined) {
			depth = 0;
		}

		// console.log("SERIALIZE BLOCK!!!");
		// console.log(depth);
		// console.log(doIndentFirstLine);

		var str = "{"; // todo: increase scope of Sym?

		// TODO : do code blocks ever have more than one child anymore????
		for (var i = 0; i < this.children.length; i++) {
			var curNode = this.children[i];
			str += curNode.Serialize(depth);
		}

		str += "}";

		return str;
	}

	this.ToString = function() {
		return this.type + " " + this.GetId();
	};
}

function isInlineCode(node) {
	return isTextEffectBlock(node) || isUndefinedBlock(node) || isMultilineListBlock(node);
}

function isUndefinedBlock(node) {
	return node.type === "code_block" && node.children.length > 0 && node.children[0].type === "undefined";
}

var textEffectBlockNames = ["clr1", "clr2", "clr3", "wvy", "shk", "rbw", "printSprite", "printItem", "printTile", "print", "say", "br"];
function isTextEffectBlock(node) {
	if (node.type === "code_block") {
		if (node.children.length > 0 && node.children[0].type === "function") {
			var func = node.children[0];
			return textEffectBlockNames.indexOf(func.name) != -1;
		}
	}
	return false;
}

var listBlockTypes = ["sequence", "cycle", "shuffle", "if"];
function isMultilineListBlock(node) {
	if (node.type === "code_block") {
		if (node.children.length > 0) {
			var child = node.children[0];
			return listBlockTypes.indexOf(child.type) != -1;
		}
	}
	return false;
}

// for round-tripping undefined code through the parser (useful for hacks!)
var UndefinedNode = function(sourceStr) {
	Object.assign(this, new TreeRelationship());
	this.type = "undefined";
	this.source = sourceStr;

	this.Eval = function(environment,onReturn) {
		addOrRemoveTextEffect(environment, "_debug_highlight");
		printFunc(environment, ["{" + sourceStr + "}"], function() {
			onReturn(null);
		});
		addOrRemoveTextEffect(environment, "_debug_highlight");
	}

	this.Serialize = function(depth) {
		return this.source;
	}

	this.ToString = function() {
		return "undefined" + " " + this.GetId();
	}
}

var FuncNode = function(name,args) {
	Object.assign( this, new TreeRelationship() );
	// Object.assign( this, new Runnable() );
	this.type = "function";
	this.name = name;
	this.args = args;

	this.Eval = function(environment,onReturn) {
		if (isPlayerEmbeddedInEditor && events != undefined && events != null) {
			events.Raise("script_node_enter", { id: this.GetId() });
		}

		var self = this; // hack to deal with scope (TODO : move up higher?)

		var argumentValues = [];
		var i = 0;

		function evalArgs(args, done) {
			// TODO : really hacky way to make we get the first
			// symbol's NAME instead of its variable value
			// if we are trying to do something with a property
			if (self.name === "property" && i === 0 && i < args.length) {
				if (args[i].type === "variable") {
					argumentValues.push(args[i].name);
					i++;
				}
				else {
					// first argument for a property MUST be a variable symbol
					// -- so skip everything if it's not!
					i = args.length;
				}
			}

			if (i < args.length) {
				// Evaluate each argument
				args[i].Eval(
					environment,
					function(val) {
						argumentValues.push(val);
						i++;
						evalArgs(args, done);
					});
			}
			else {
				done();
			}
		};

		evalArgs(
			this.args,
			function() {
				if (isPlayerEmbeddedInEditor && events != undefined && events != null) {
					events.Raise("script_node_exit", { id: self.GetId() });
				}

				environment.EvalFunction(self.name, argumentValues, onReturn);
			});
	}

	this.Serialize = function(depth) {
		var isDialogBlock = this.parent.type === "dialog_block";
		if (isDialogBlock && this.name === "print") {
			// TODO this could cause problems with "real" print functions
			return this.args[0].value; // first argument should be the text of the {print} func
		}
		else if (isDialogBlock && this.name === "br") {
			return "\n";
		}
		else {
			var str = "";
			str += this.name;
			for(var i = 0; i < this.args.length; i++) {
				str += " ";
				str += this.args[i].Serialize(depth);
			}
			return str;
		}
	}

	this.ToString = function() {
		return this.type + " " + this.name + " " + this.GetId();
	};
}

var LiteralNode = function(value) {
	Object.assign( this, new TreeRelationship() );
	// Object.assign( this, new Runnable() );
	this.type = "literal";
	this.value = value;

	this.Eval = function(environment,onReturn) {
		onReturn(this.value);
	}

	this.Serialize = function(depth) {
		var str = "";

		if (this.value === null) {
			return str;
		}

		if (typeof this.value === "string") {
			str += '"';
		}

		str += this.value;

		if (typeof this.value === "string") {
			str += '"';
		}

		return str;
	}

	this.ToString = function() {
		return this.type + " " + this.value + " " + this.GetId();
	};
}

var VarNode = function(name) {
	Object.assign( this, new TreeRelationship() );
	// Object.assign( this, new Runnable() );
	this.type = "variable";
	this.name = name;

	this.Eval = function(environment,onReturn) {
		// console.log("EVAL " + this.name + " " + environment.HasVariable(this.name) + " " + environment.GetVariable(this.name));
		if( environment.HasVariable(this.name) )
			onReturn( environment.GetVariable( this.name ) );
		else
			onReturn(null); // not a valid variable -- return null and hope that's ok
	} // TODO: might want to store nodes in the variableMap instead of values???

	this.Serialize = function(depth) {
		var str = "" + this.name;
		return str;
	}

	this.ToString = function() {
		return this.type + " " + this.name + " " + this.GetId();
	};
}

var ExpNode = function(operator, left, right) {
	Object.assign( this, new TreeRelationship() );
	this.type = "operator";
	this.operator = operator;
	this.left = left;
	this.right = right;

	this.Eval = function(environment,onReturn) {
		// console.log("EVAL " + this.operator);
		var self = this; // hack to deal with scope
		environment.EvalOperator( this.operator, this.left, this.right, 
			function(val){
				// console.log("EVAL EXP " + self.operator + " " + val);
				onReturn(val);
			} );
		// NOTE : sadly this pushes a lot of complexity down onto the actual operator methods
	}

	this.Serialize = function(depth) {
		var isNegativeNumber = this.operator === "-" && this.left.type === "literal" && this.left.value === null;

		if (!isNegativeNumber) {
			var str = "";

			if (this.left != undefined && this.left != null) {
				str += this.left.Serialize(depth) + " ";
			}

			str += this.operator;

			if (this.right != undefined && this.right != null) {
				str += " " + this.right.Serialize(depth);
			}

			return str;
		}
		else {
			return this.operator + this.right.Serialize(depth); // hacky but seems to work
		}
	}

	this.VisitAll = function(visitor, depth) {
		if (depth == undefined || depth == null) {
			depth = 0;
		}

		visitor.Visit( this, depth );
		if(this.left != null)
			this.left.VisitAll( visitor, depth + 1 );
		if(this.right != null)
			this.right.VisitAll( visitor, depth + 1 );
	};

	this.ToString = function() {
		return this.type + " " + this.operator + " " + this.GetId();
	};
}

var SequenceBase = function() {
	this.Serialize = function(depth) {
		var str = "";
		str += this.type + "\n";
		for (var i = 0; i < this.children.length; i++) {
			str += leadingWhitespace(depth + 1) + Sym.List + " ";
			str += this.children[i].Serialize(depth + 2);
			str += "\n";
		}
		str += leadingWhitespace(depth);
		return str;
	}

	this.VisitAll = function(visitor, depth) {
		if (depth == undefined || depth == null) {
			depth = 0;
		}

		visitor.Visit(this, depth);
		for (var i = 0; i < this.children.length; i++) {
			this.children[i].VisitAll( visitor, depth + 1 );
		}
	};

	this.ToString = function() {
		return this.type + " " + this.GetId();
	};
}

var SequenceNode = function(options) {
	Object.assign(this, new TreeRelationship());
	Object.assign(this, new SequenceBase());
	this.type = "sequence";
	this.AddChildren(options);

	var index = 0;
	this.Eval = function(environment, onReturn) {
		// console.log("SEQUENCE " + index);
		this.children[index].Eval(environment, onReturn);

		var next = index + 1;
		if (next < this.children.length) {
			index = next;
		}
	}
}

var CycleNode = function(options) {
	Object.assign(this, new TreeRelationship());
	Object.assign(this, new SequenceBase());
	this.type = "cycle";
	this.AddChildren(options);

	var index = 0;
	this.Eval = function(environment, onReturn) {
		// console.log("CYCLE " + index);
		this.children[index].Eval(environment, onReturn);

		var next = index + 1;
		if (next < this.children.length) {
			index = next;
		}
		else {
			index = 0;
		}
	}
}

var ShuffleNode = function(options) {
	Object.assign(this, new TreeRelationship());
	Object.assign(this, new SequenceBase());
	this.type = "shuffle";
	this.AddChildren(options);

	var optionsShuffled = [];
	function shuffle(options) {
		optionsShuffled = [];
		var optionsUnshuffled = options.slice();
		while (optionsUnshuffled.length > 0) {
			var i = Math.floor(Math.random() * optionsUnshuffled.length);
			optionsShuffled.push(optionsUnshuffled.splice(i,1)[0]);
		}
	}
	shuffle(this.children);

	var index = 0;
	this.Eval = function(environment, onReturn) {
		optionsShuffled[index].Eval(environment, onReturn);
		
		index++;
		if (index >= this.children.length) {
			shuffle(this.children);
			index = 0;
		}
	}
}

// TODO : rename? ConditionalNode?
var IfNode = function(conditions, results, isSingleLine) {
	Object.assign(this, new TreeRelationship());
	this.type = "if";

	for (var i = 0; i < conditions.length; i++) {
		this.AddChild(new ConditionPairNode(conditions[i], results[i]));
	}

	var self = this;
	this.Eval = function(environment, onReturn) {
		// console.log("EVAL IF");
		var i = 0;
		function TestCondition() {
			self.children[i].Eval(environment, function(result) {
				if (result.conditionValue == true) {
					onReturn(result.resultValue);
				}
				else if (i+1 < self.children.length) {
					i++;
					TestCondition();
				}
				else {
					onReturn(null);
				}
			});
		};
		TestCondition();
	}

	if (isSingleLine === undefined) {
		isSingleLine = false; // This is just for serialization
	}

	this.Serialize = function(depth) {
		var str = "";
		if(isSingleLine) {
			// HACKY - should I even keep this mode???
			str += this.children[0].children[0].Serialize() + " ? " + this.children[0].children[1].Serialize();
			if (this.children.length > 1 && this.children[1].children[0].type === Sym.Else) {
				str += " " + Sym.ElseExp + " " + this.children[1].children[1].Serialize();
			}
		}
		else {
			str += "\n";
			for (var i = 0; i < this.children.length; i++) {
				str += this.children[i].Serialize(depth);
			}
			str += leadingWhitespace(depth);
		}
		return str;
	}

	this.IsSingleLine = function() {
		return isSingleLine;
	}

	this.VisitAll = function(visitor, depth) {
		if (depth == undefined || depth == null) {
			depth = 0;
		}

		visitor.Visit(this, depth);

		for (var i = 0; i < this.children.length; i++) {
			this.children[i].VisitAll(visitor, depth + 1);
		}
	};

	this.ToString = function() {
		return this.type + " " + this.mode + " " + this.GetId();
	};
}

var ConditionPairNode = function(condition, result) {
	Object.assign(this, new TreeRelationship());

	this.type = "condition_pair";

	this.AddChild(condition);
	this.AddChild(result);

	var self = this;

	this.Eval = function(environment, onReturn) {
		self.children[0].Eval(environment, function(conditionSuccess) {
			if (conditionSuccess) {
				self.children[1].Eval(environment, function(resultValue) {
					onReturn({ conditionValue:true, resultValue:resultValue });
				});
			}
			else {
				onReturn({ conditionValue:false });
			}
		});
	}

	this.Serialize = function(depth) {
		var str = "";
		str += leadingWhitespace(depth + 1);
		str += Sym.List + " " + this.children[0].Serialize(depth) + " " + Sym.ConditionEnd + Sym.Linebreak;
		str += this.children[1].Serialize(depth + 2) + Sym.Linebreak;
		return str;
	}

	this.VisitAll = function(visitor, depth) {
		if (depth == undefined || depth == null) {
			depth = 0;
		}

		visitor.Visit(this, depth);

		for (var i = 0; i < this.children.length; i++) {
			this.children[i].VisitAll(visitor, depth + 1);
		}
	}

	this.ToString = function() {
		return this.type + " " + this.GetId();
	}
}

var ElseNode = function() {
	Object.assign( this, new TreeRelationship() );
	this.type = Sym.Else;

	this.Eval = function(environment, onReturn) {
		onReturn(true);
	}

	this.Serialize = function() {
		return Sym.Else;
	}

	this.ToString = function() {
		return this.type + " " + this.mode + " " + this.GetId();
	};
}

var Sym = {
	DialogOpen : '"""',
	DialogClose : '"""',
	CodeOpen : "{",
	CodeClose : "}",
	Linebreak : "\n", // just call it "break" ?
	Separator : ":",
	List : "-",
	String : '"',
	ConditionEnd : "?",
	Else : "else",
	ElseExp : ":", // special shorthand for expressions (deprecate?)
	Set : "=",
	Operators : ["==", ">=", "<=", ">", "<", "-", "+", "/", "*"], // operators need to be in reverse order of precedence
};

var Parser = function(env) {
	var environment = env;

	this.Parse = function(scriptStr, rootId) {
		var rootNode = new DialogBlockNode();
		rootNode.rootId = rootId;
		var state = new ParserState(rootNode, scriptStr);

		console.log(scriptStr);
		console.log(state.Source());

		if (state.MatchAhead(Sym.DialogOpen)) {
			// multi-line dialog block
			var dialogStr = state.ConsumeBlock(Sym.DialogOpen + Sym.Linebreak, Sym.Linebreak + Sym.DialogClose);
			rootNode = new DialogBlockNode();
			rootNode.rootId = rootId; // hacky!!
			state = new ParserState(rootNode, dialogStr);
			state = ParseDialog(state);
		}
		else {
			// single-line dialog block
			state = ParseDialog(state);
		}

		return state.rootNode;
	};

	var ParserState = function( rootNode, str ) {
		this.rootNode = rootNode;
		this.curNode = this.rootNode;

		var sourceStr = str;
		var i = 0;
		this.Index = function() { return i; };
		this.Count = function() { return sourceStr.length; };
		this.Done = function() { return i >= sourceStr.length; };
		this.Char = function() { return sourceStr[i]; };
		this.Step = function(n) { if(n===undefined) n=1; i += n; };
		this.MatchAhead = function(str) {
			// console.log(str);
			str = "" + str; // hack to turn single chars into strings
			// console.log(str);
			// console.log(str.length);
			for (var j = 0; j < str.length; j++) {
				if (i + j >= sourceStr.length) {
					return false;
				}
				else if (str[j] != sourceStr[i+j]) {
					return false;
				}
			}
			return true;
		}
		this.Peak = function(end) {
			var str = "";
			var j = i;
			// console.log(j);
			while (j < sourceStr.length && end.indexOf(sourceStr[j]) == -1) {
				str += sourceStr[j];
				j++;
			}
			// console.log("PEAK ::" + str + "::");
			return str;
		}
		this.ConsumeBlock = function(open, close, includeSymbols) {
			if (includeSymbols === undefined || includeSymbols === null) {
				includeSymbols = false;
			}

			var startIndex = i;

			var matchCount = 0;
			if (this.MatchAhead(open)) {
				matchCount++;
				this.Step(open.length);
			}

			while (matchCount > 0 && !this.Done()) {
				if (this.MatchAhead(close)) {
					matchCount--;
					this.Step( close.length );
				}
				else if (this.MatchAhead(open)) {
					matchCount++;
					this.Step(open.length);
				}
				else {
					this.Step();
				}
			}

			if (includeSymbols) {
				return sourceStr.slice(startIndex, i);
			}
			else {
				return sourceStr.slice(startIndex + open.length, i - close.length);
			}
		}

		this.Print = function() { console.log(sourceStr); };
		this.Source = function() { return sourceStr; };
	};

	/*
		ParseDialog():
		This function adds {print} nodes and linebreak {br} nodes to display text,
		interleaved with bracketed code nodes for functions and flow control,
		such as text effects {shk} {wvy} or sequences like {cycle} and {shuffle}.
		The parsing of those code blocks is handled by ParseCode.

		Note on parsing newline characters:
		- there should be an implicit linebreak {br} after each dialog line
		- a "dialog line" is defined as any line that either:
			- 1) contains dialog text (any text outside of a code block)
			- 2) is entirely empty (no text, no code)
			- *or* 3) contains a list block (sequence, cycle, shuffle, or conditional)
		- lines *only* containing {code} blocks are not dialog lines

		NOTE TO SELF: all the state I'm storing in here feels like
		evidence that the parsing system kind of broke down at this point :(
		Maybe it would feel better if I move into the "state" object
	*/
	function ParseDialog(state) {
		var curLineNodeList = [];
		var curText = "";
		var curLineIsEmpty = true;
		var curLineContainsDialogText = false;
		var prevLineIsDialogLine = false;

		var curLineIsDialogLine = function() {
			return curLineContainsDialogText || curLineIsEmpty;
		}

		var resetLineStateForNewLine = function() {
			prevLineIsDialogLine = curLineIsDialogLine();
			curLineContainsDialogText = false;
			curLineIsEmpty = true;
			curText = "";
			curLineNodeList = [];
		}

		var tryAddTextNodeToList = function() {
			if (curText.length > 0) {
				var printNode = new FuncNode("print", [new LiteralNode(curText)]);
				curLineNodeList.push(printNode);

				curText = "";
				curLineIsEmpty = false;
				curLineContainsDialogText = true;
			}
		}

		var addCodeNodeToList = function() {
			var codeSource = state.ConsumeBlock(Sym.CodeOpen, Sym.CodeClose);
			var codeState = new ParserState(new CodeBlockNode(), codeSource);
			codeState = ParseCode(codeState);
			var codeBlockNode = codeState.rootNode;
			curLineNodeList.push(codeBlockNode);

			curLineIsEmpty = false;

			// lists count as dialog text, because they can contain it
			if (isMultilineListBlock(codeBlockNode)) {
				curLineContainsDialogText = true;
			}
		}

		var tryAddLinebreakNodeToList = function() {
			if (prevLineIsDialogLine) {
				var linebreakNode = new FuncNode("br", []);
				curLineNodeList.unshift(linebreakNode);
			}
		}

		var addLineNodesToParent = function() {
			for (var i = 0; i < curLineNodeList.length; i++) {
				state.curNode.AddChild(curLineNodeList[i]);
			}
		}

		while (!state.Done()) {
			if (state.MatchAhead(Sym.CodeOpen)) { // process code block
				// add any buffered text to a print node, and parse the code
				tryAddTextNodeToList();
				addCodeNodeToList();
			}
			else if (state.MatchAhead(Sym.Linebreak)) { // process new line
				// add any buffered text to a print node, 
				// and add a linebreak if we are between two dialog lines
				tryAddTextNodeToList();
				tryAddLinebreakNodeToList();

				// since we've reached the end of a line
				// add stored nodes for this line to the parent node we are building,
				// and reset state for the next line
				addLineNodesToParent();
				resetLineStateForNewLine();

				state.Step();
			}
			else {
				// continue adding text to the current text buffer
				curText += state.Char();
				state.Step();
			}
		}

		// to make sure we don't leave anything behind:
		// add buffered text to a print node and add all nodes
		// to the current parent node
		tryAddTextNodeToList();
		tryAddLinebreakNodeToList();
		addLineNodesToParent();

		return state;
	}

	function ParseDialogBlock(state) {
		var dialogStr = state.ConsumeBlock( Sym.DialogOpen, Sym.DialogClose );

		var dialogState = new ParserState(new DialogBlockNode(), dialogStr);
		dialogState = ParseDialog( dialogState );

		state.curNode.AddChild( dialogState.rootNode );

		return state;
	}

	/*
		ParseConditional():
		A conditional contains a list of conditions that can be
		evaluated to true or false, followed by more dialog
		that will be evaluated if the condition is true. The first
		true condition is the one that gets evaluated.
	*/
	function ParseConditional(state) {
		var conditionStrings = [];
		var resultStrings = [];
		var curIndex = -1;
		var requiredLeadingWhitespace = -1;

		// TODO : very similar to sequence parsing - can we share anything?
		function parseConditionalItemLine(state) {
			var lineText = "";
			var whitespaceCount = 0;
			var isNewCondition = false;
			var encounteredNonWhitespace = false;
			var encounteredConditionEnd = false;

			while (!state.Done() && !(state.Char() === Sym.Linebreak)) {
				// count whitespace until we hit the first non-whitespace character
				if (!encounteredNonWhitespace) {
					if (state.Char() === " " || state.Char() === "\t") {
						whitespaceCount++;
					}
					else {
						encounteredNonWhitespace = true;

						if (state.Char() === Sym.List) {
							isNewCondition = true;
							whitespaceCount += 2; // count the list seperator AND the following extra space
						}
					}
				}

				// if this is the condition, we need to track whether we've
				// reached the end of the condition
				if (isNewCondition && !encounteredConditionEnd) {
					if (state.Char() === Sym.ConditionEnd) {
						encounteredConditionEnd = true;
					}
				}

				// add characters one at a time, unless it's a code block
				// since code blocks can contain additional sequences inside
				// them that will mess up our list item detection
				if (state.Char() === Sym.CodeOpen) {
					lineText += state.ConsumeBlock(Sym.CodeOpen, Sym.CodeClose, true /*includeSymbols*/);
				}
				else {
					if (!encounteredConditionEnd) { // skip all characters including & after the condition end
						lineText += state.Char();
					}
					state.Step();
				}
			}

			if (state.Char() === Sym.Linebreak) {
				state.Step();
			}

			return { text:lineText, whitespace:whitespaceCount, isNewCondition:isNewCondition };
		}

		// TODO : this is copied from sequence parsing; share?
		function trimLeadingWhitespace(text, trimLength) {
			var textSplit = text.split(Sym.linebreak);
			textSplit = textSplit.map(function(line) { return line.slice(trimLength) });
			return textSplit.join(Sym.linebreak);
		}

		while (!state.Done()) {
			var lineResults = parseConditionalItemLine(state);

			if (lineResults.isNewCondition) {
				requiredLeadingWhitespace = lineResults.whitespace;
				curIndex++;
				conditionStrings[curIndex] = "";
				resultStrings[curIndex] = "";
			}

			// to avoid extra newlines in nested conditionals, only count lines
			// that at least match the whitespace count of the initial line
			// NOTE: see the comment in sequence parsing for more details
			if (lineResults.whitespace >= requiredLeadingWhitespace) {
				var trimmedText = trimLeadingWhitespace(lineResults.text, requiredLeadingWhitespace);

				if (lineResults.isNewCondition) {
					conditionStrings[curIndex] += trimmedText;
				}
				else {
					resultStrings[curIndex] += trimmedText + Sym.Linebreak;
				}
			}
		}

		// hack: cut off the trailing newlines from all the result strings
		resultStrings = resultStrings.map(function(result) { return result.slice(0,-1); });

		var conditions = [];
		for (var i = 0; i < conditionStrings.length; i++) {
			var str = conditionStrings[i].trim();
			if (str === Sym.Else) {
				conditions.push(new ElseNode());
			}
			else {
				var exp = CreateExpression(str);
				conditions.push(exp);
			}
		}

		var results = [];
		for (var i = 0; i < resultStrings.length; i++) {
			var str = resultStrings[i];
			var dialogBlockState = new ParserState(new DialogBlockNode(), str);
			dialogBlockState = ParseDialog(dialogBlockState);
			var dialogBlock = dialogBlockState.rootNode;
			results.push(dialogBlock);
		}

		state.curNode.AddChild(new IfNode(conditions, results));

		return state;
	}

	function IsSequence(str) {
		// console.log("IsSequence? " + str);
		return str === "sequence" || str === "cycle" || str === "shuffle";
	}

	/*
		ParseSequence():
		Sequence nodes contain a list of dialog block nodes. The order those
		nodes are evaluated is determined by the type of sequence:
		- sequence: each child node evaluated once in order
		- cycle: repeats from the beginning after all nodes evaluate
		- shuffle: evaluate in a random order

		Each item in a sequence is sepearated by a "-" character.
		The seperator must come at the beginning of the line,
		but may be preceded by whitespace (in any amount).

		About whitespace: Whitespace at the start of a line
		is ignored if it less than or equal to the count of
		whitespace that preceded the list separator ("-") at
		the start of that item. (The count also includes the
		seperator and the extra space after the seperator.)
	 */
	function ParseSequence(state, sequenceType) {
		var itemStrings = [];
		var curItemIndex = -1; // -1 indicates not reading an item yet
		var requiredLeadingWhitespace = -1;

		function parseSequenceItemLine(state) {
			var lineText = "";
			var whitespaceCount = 0;
			var isNewListItem = false;
			var encounteredNonWhitespace = false;

			while (!state.Done() && !(state.Char() === Sym.Linebreak)) {
				// count whitespace until we hit the first non-whitespace character
				if (!encounteredNonWhitespace) {
					if (state.Char() === " " || state.Char() === "\t") {
						whitespaceCount++;
					}
					else {
						encounteredNonWhitespace = true;

						if (state.Char() === Sym.List) {
							isNewListItem = true;
							whitespaceCount += 2; // count the list seperator AND the following extra space
						}
					}
				}

				// add characters one at a time, unless it's a code block
				// since code blocks can contain additional sequences inside
				// them that will mess up our list item detection
				if (state.Char() === Sym.CodeOpen) {
					lineText += state.ConsumeBlock(Sym.CodeOpen, Sym.CodeClose, true /*includeSymbols*/);
				}
				else {
					lineText += state.Char();
					state.Step();
				}
			}

			if (state.Char() === Sym.Linebreak) {
				state.Step();
			}

			return { text:lineText, whitespace:whitespaceCount, isNewListItem:isNewListItem };
		}

		function trimLeadingWhitespace(text, trimLength) {
			// the split and join is necessary because a single "line"
			// can contain sequences that may contain newlines of their own
			// (we treat them all as one "line" for sequence parsing purposes)
			var textSplit = text.split(Sym.linebreak);
			textSplit = textSplit.map(function(line) { return line.slice(trimLength) });
			return textSplit.join(Sym.linebreak);
		}

		while (!state.Done()) {
			var lineResults = parseSequenceItemLine(state);

			if (lineResults.isNewListItem) {
				requiredLeadingWhitespace = lineResults.whitespace;
				curItemIndex++;
				itemStrings[curItemIndex] = "";
			}

			// to avoid double counting closing lines (empty ones ending in a curly brace)
			// we only allow lines that have at least as much whitespace as the start of the list item
			// TODO : I think right now this leads to a bug if the list item's indentation is less than
			// its parent code block... hopefully that won't be a big deal for now
			// (NOTE: I think the bug could be fixed by only applying this to the FINAL line of an item, but
			// that would require more consideration and testing)
			if (lineResults.whitespace >= requiredLeadingWhitespace) {
				var trimmedText = trimLeadingWhitespace(lineResults.text, requiredLeadingWhitespace);
				itemStrings[curItemIndex] += trimmedText + Sym.Linebreak;
			}
		}

		// a bit hacky: cut off the trailing newlines from all the items
		itemStrings = itemStrings.map(function(item) { return item.slice(0,-1); });

		var options = [];
		for (var i = 0; i < itemStrings.length; i++) {
			var str = itemStrings[i];
			var dialogBlockState = new ParserState(new DialogBlockNode(false /* doIndentFirstLine */), str);
			dialogBlockState = ParseDialog(dialogBlockState);
			var dialogBlock = dialogBlockState.rootNode;
			options.push(dialogBlock);
		}

		if (sequenceType === "sequence") {
			state.curNode.AddChild(new SequenceNode(options));
		}
		else if (sequenceType === "cycle") {
			state.curNode.AddChild(new CycleNode(options));
		}
		else if (sequenceType === "shuffle") {
			state.curNode.AddChild(new ShuffleNode(options));
		}

		return state;
	}

	function ParseFunction(state, funcName) {
		console.log("~~~ PARSE FUNCTION " + funcName);

		var args = [];

		var curSymbol = "";
		function OnSymbolEnd() {
			curSymbol = curSymbol.trim();
			// console.log("PARAMTER " + curSymbol);
			args.push( StringToValue(curSymbol) );
			// console.log(args);
			curSymbol = "";
		}

		while( !( state.Char() === "\n" || state.Done() ) ) {
			if( state.MatchAhead(Sym.CodeOpen) ) {
				var codeBlockState = new ParserState(new CodeBlockNode(), state.ConsumeBlock(Sym.CodeOpen, Sym.CodeClose));
				codeBlockState = ParseCode( codeBlockState );
				var codeBlock = codeBlockState.rootNode;
				args.push( codeBlock );
				curSymbol = "";
			}
			else if( state.MatchAhead(Sym.String) ) {
				/* STRING LITERAL */
				var str = state.ConsumeBlock(Sym.String, Sym.String);
				// console.log("STRING " + str);
				args.push( new LiteralNode(str) );
				curSymbol = "";
			}
			else if(state.Char() === " " && curSymbol.length > 0) {
				OnSymbolEnd();
			}
			else {
				curSymbol += state.Char();
			}
			state.Step();
		}

		if(curSymbol.length > 0) {
			OnSymbolEnd();
		}

		state.curNode.AddChild( new FuncNode( funcName, args ) );

		return state;
	}

	function IsValidVariableName(str) {
		var reg = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;
		var isValid = reg.test(str);
		// console.log("VALID variable??? " + isValid);
		return isValid;
	}

	function StringToValue(valStr) {
		if(valStr[0] === Sym.CodeOpen) {
			// CODE BLOCK!!!
			var codeStr = (new ParserState( null, valStr )).ConsumeBlock(Sym.CodeOpen, Sym.CodeClose); //hacky
			var codeBlockState = new ParserState(new CodeBlockNode(), codeStr);
			codeBlockState = ParseCode( codeBlockState );
			return codeBlockState.rootNode;
		}
		else if(valStr[0] === Sym.String) {
			// STRING!!
			// console.log("STRING");
			var str = "";
			var i = 1;
			while (i < valStr.length && valStr[i] != Sym.String) {
				str += valStr[i];
				i++;
			}
			// console.log(str);
			return new LiteralNode( str );
		}
		else if(valStr === "true") {
			// BOOL
			return new LiteralNode( true );
		}
		else if(valStr === "false") {
			// BOOL
			return new LiteralNode( false );
		}
		else if( !isNaN(parseFloat(valStr)) ) {
			// NUMBER!!
			// console.log("NUMBER!!! " + valStr);
			return new LiteralNode( parseFloat(valStr) );
		}
		else if(IsValidVariableName(valStr)) {
			// VARIABLE!!
			// console.log("VARIABLE");
			return new VarNode(valStr); // TODO : check for valid potential variables
		}
		else {
			// uh oh
			return new LiteralNode(null);
		}
	}

	function CreateExpression(expStr) {
		expStr = expStr.trim();

		function IsInsideString(index) {
			var inString = false;
			for(var i = 0; i < expStr.length; i++) {
				if(expStr[i] === Sym.String)
					inString = !inString;

				if(index === i)
					return inString;
			}
			return false;
		}

		function IsInsideCode(index) {
			var count = 0;
			for(var i = 0; i < expStr.length; i++) {
				if(expStr[i] === Sym.CodeOpen)
					count++;
				else if(expStr[i] === Sym.CodeClose)
					count--;

				if(index === i)
					return count > 0;
			}
			return false;
		}

		var operator = null;

		// set is special because other operator can look like it, and it has to go first in the order of operations
		var setIndex = expStr.indexOf(Sym.Set);
		if( setIndex > -1 && !IsInsideString(setIndex) && !IsInsideCode(setIndex) ) { // it might be a set operator
			if( expStr[setIndex+1] != "=" && expStr[setIndex-1] != ">" && expStr[setIndex-1] != "<" ) {
				// ok it actually IS a set operator and not ==, >=, or <=
				operator = Sym.Set;
				var variableName = expStr.substring(0,setIndex).trim(); // TODO : valid variable name testing
				var left = IsValidVariableName(variableName) ? new VarNode( variableName ) : new LiteralNode(null);
				var right = CreateExpression( expStr.substring(setIndex+Sym.Set.length) );
				var exp = new ExpNode( operator, left, right );
				return exp;
			}
		}

		// special if "expression" for single-line if statements
		var ifIndex = expStr.indexOf(Sym.ConditionEnd);
		if( ifIndex > -1 && !IsInsideString(ifIndex) && !IsInsideCode(ifIndex) ) {
			operator = Sym.ConditionEnd;
			var conditionStr = expStr.substring(0,ifIndex).trim();
			var conditions = [ CreateExpression(conditionStr) ];

			var resultStr = expStr.substring(ifIndex+Sym.ConditionEnd.length);
			var results = [];
			function AddResult(str) {
				var dialogBlockState = new ParserState(new DialogBlockNode(), str);
				dialogBlockState = ParseDialog( dialogBlockState );
				var dialogBlock = dialogBlockState.rootNode;
				results.push( dialogBlock );
			}

			var elseIndex = resultStr.indexOf(Sym.ElseExp); // does this need to test for strings?
			if(elseIndex > -1) {
				conditions.push( new ElseNode() );

				var elseStr = resultStr.substring(elseIndex+Sym.ElseExp.length);
				var resultStr = resultStr.substring(0,elseIndex);

				AddResult( resultStr.trim() );
				AddResult( elseStr.trim() );
			}
			else {
				AddResult( resultStr.trim() );
			}

			return new IfNode( conditions, results, true /*isSingleLine*/ );
		}

		for( var i = 0; (operator == null) && (i < Sym.Operators.length); i++ ) {
			var opSym = Sym.Operators[i];
			var opIndex = expStr.indexOf( opSym );
			if( opIndex > -1 && !IsInsideString(opIndex) && !IsInsideCode(opIndex) ) {
				operator = opSym;
				var left = CreateExpression( expStr.substring(0,opIndex) );
				var right = CreateExpression( expStr.substring(opIndex+opSym.length) );
				var exp = new ExpNode( operator, left, right );
				return exp;
			}
		}

		if( operator == null ) {
			return StringToValue(expStr);
		}
	}
	this.CreateExpression = CreateExpression;

	function IsWhitespace(str) {
		return ( str === " " || str === "\t" || str === "\n" );
	}

	function IsExpression(str) {
		var tempState = new ParserState(null, str); // hacky
		var textOutsideCodeBlocks = "";

		while (!tempState.Done()) {
			if (tempState.MatchAhead(Sym.CodeOpen)) {
				tempState.ConsumeBlock(Sym.CodeOpen, Sym.CodeClose);
			}
			else {
				textOutsideCodeBlocks += tempState.Char();
				tempState.Step();
			}
		}

		var containsAnyExpressionOperators = (textOutsideCodeBlocks.indexOf(Sym.ConditionEnd) != -1) ||
				(textOutsideCodeBlocks.indexOf(Sym.Set) != -1) ||
				(Sym.Operators.some(function(opSym) { return textOutsideCodeBlocks.indexOf(opSym) != -1; }));

		return containsAnyExpressionOperators;
	}

	function IsLiteral(str) {
		var isBool = str === "true" || str === "false";
		var isNum = !isNaN(parseFloat(str));
		var isStr = str[0] === '"' && str[str.length-1] === '"';
		var isVar = IsValidVariableName(str);
		var isEmpty = str.length === 0;
		return isBool || isNum || isStr || isVar || isEmpty;
	}

	function ParseExpression(state) {
		var line = state.Source(); // state.Peak( [Sym.Linebreak] ); // TODO : remove the linebreak thing
		// console.log("EXPRESSION " + line);
		var exp = CreateExpression(line);
		// console.log(exp);
		state.curNode.AddChild(exp);
		state.Step(line.length);
		return state;
	}

	function IsConditionalBlock(state) {
		var peakToFirstListSymbol = state.Peak([Sym.List]);

		var foundListSymbol = peakToFirstListSymbol < state.Source().length;

		var areAllCharsBeforeListWhitespace = true;
		for (var i = 0; i < peakToFirstListSymbol.length; i++) {
			if (!IsWhitespace(peakToFirstListSymbol[i])) {
				areAllCharsBeforeListWhitespace = false;
			}
		}

		var peakToFirstConditionSymbol = state.Peak([Sym.ConditionEnd]);
		peakToFirstConditionSymbol = peakToFirstConditionSymbol.slice(peakToFirstListSymbol.length);
		var hasNoLinebreakBetweenListAndConditionEnd = peakToFirstConditionSymbol.indexOf(Sym.Linebreak) == -1;

		return foundListSymbol && 
			areAllCharsBeforeListWhitespace && 
			hasNoLinebreakBetweenListAndConditionEnd;
	}

	function ParseCode(state) {
		if (IsConditionalBlock(state)) {
			state = ParseConditional(state);
		}
		else if (environment.HasFunction(state.Peak([" "]))) { // TODO --- what about newlines???
			var funcName = state.Peak([" "]);
			state.Step(funcName.length);
			state = ParseFunction(state, funcName);
		}
		else if (IsSequence(state.Peak([" ", Sym.Linebreak]))) {
			var sequenceType = state.Peak([" ", Sym.Linebreak]);
			state.Step(sequenceType.length);
			state = ParseSequence(state, sequenceType);
		}
		else if (IsLiteral(state.Source()) || IsExpression(state.Source())) {
			state = ParseExpression(state);
		}
		else {
			var undefinedSrc = state.Peak([]);
			var undefinedNode = new UndefinedNode(undefinedSrc);
			state.curNode.AddChild(undefinedNode);
		}

		// just go to the end now
		while (!state.Done()) {
			state.Step();
		}

		return state;
	}

	function ParseCodeBlock(state) {
		var codeStr = state.ConsumeBlock( Sym.CodeOpen, Sym.CodeClose );
		var codeState = new ParserState(new CodeBlockNode(), codeStr);
		codeState = ParseCode( codeState );
		state.curNode.AddChild( codeState.rootNode );
		return state;
	}

}

} // Script()
</script>

<script>
function Dialog() {

this.CreateRenderer = function() {
	return new DialogRenderer();
};

this.CreateBuffer = function() {
	return new DialogBuffer();
};

var DialogRenderer = function() {

	// TODO : refactor this eventually? remove everything from struct.. avoid the defaults?
	var textboxInfo = {
		img : null,
		width : 104,
		height : 8+4+2+5, //8 for text, 4 for top-bottom padding, 2 for line padding, 5 for arrow
		top : 12,
		left : 12,
		bottom : 12, //for drawing it from the bottom
		font_scale : 0.5, // we draw font at half-size compared to everything else
		padding_vert : 2,
		padding_horz : 4,
		arrow_height : 5,
	};

	var font = null;
	this.SetFont = function(f) {
		font = f;
		textboxInfo.height = (textboxInfo.padding_vert * 3) + (relativeFontHeight() * 2) + textboxInfo.arrow_height;
		textboxInfo.img = context.createImageData(textboxInfo.width*scale, textboxInfo.height*scale);
	}

	function textScale() {
		return scale * textboxInfo.font_scale;
	}

	function relativeFontWidth() {
		return Math.ceil( font.getWidth() * textboxInfo.font_scale );
	}

	function relativeFontHeight() {
		return Math.ceil( font.getHeight() * textboxInfo.font_scale );
	}

	var context = null;
	this.AttachContext = function(c) {
		context = c;
	};

	this.ClearTextbox = function() {
		if(context == null) return;

		//create new image none exists
		if(textboxInfo.img == null)
			textboxInfo.img = context.createImageData(textboxInfo.width*scale, textboxInfo.height*scale);

		// fill text box with black
		for (var i=0;i<textboxInfo.img.data.length;i+=4)
		{
			textboxInfo.img.data[i+0]=0;
			textboxInfo.img.data[i+1]=0;
			textboxInfo.img.data[i+2]=0;
			textboxInfo.img.data[i+3]=255;
		}
	};

	var isCentered = false;
	this.SetCentered = function(centered) {
		isCentered = centered;
	};

	this.DrawTextbox = function() {
		if(context == null) return;
		if (isCentered) {
			context.putImageData(textboxInfo.img, textboxInfo.left*scale, ((height/2)-(textboxInfo.height/2))*scale);
		}
		else if (player().y < mapsize/2) {
			//bottom
			context.putImageData(textboxInfo.img, textboxInfo.left*scale, (height-textboxInfo.bottom-textboxInfo.height)*scale);
		}
		else {
			//top
			context.putImageData(textboxInfo.img, textboxInfo.left*scale, textboxInfo.top*scale);
		}
	};

	var arrowdata = [
		1,1,1,1,1,
		0,1,1,1,0,
		0,0,1,0,0
	];
	this.DrawNextArrow = function() {
		// console.log("draw arrow!");
		var top = (textboxInfo.height-5) * scale;
		var left = (textboxInfo.width-(5+4)) * scale;
		if (textDirection === TextDirection.RightToLeft) { // RTL hack
			left = 4 * scale;
		}

		for (var y = 0; y < 3; y++) {
			for (var x = 0; x < 5; x++) {
				var i = (y * 5) + x;
				if (arrowdata[i] == 1) {
					//scaling nonsense
					for (var sy = 0; sy < scale; sy++) {
						for (var sx = 0; sx < scale; sx++) {
							var pxl = 4 * ( ((top+(y*scale)+sy) * (textboxInfo.width*scale)) + (left+(x*scale)+sx) );
							textboxInfo.img.data[pxl+0] = 255;
							textboxInfo.img.data[pxl+1] = 255;
							textboxInfo.img.data[pxl+2] = 255;
							textboxInfo.img.data[pxl+3] = 255;
						}
					}
				}
			}
		}
	};

	var text_scale = 2; //using a different scaling factor for text feels like cheating... but it looks better
	this.DrawChar = function(char, row, col, leftPos) {
		char.offset = {
			x: char.base_offset.x,
			y: char.base_offset.y
		}; // compute render offset *every* frame

		char.SetPosition(row,col);
		char.ApplyEffects(effectTime);

		var charData = char.bitmap;

		var top = (4 * scale) + (row * 2 * scale) + (row * font.getHeight() * text_scale) + Math.floor( char.offset.y );
		var left = (4 * scale) + (leftPos * text_scale) + Math.floor( char.offset.x );

		var debug_r = Math.random() * 255;

		for (var y = 0; y < char.height; y++) {
			for (var x = 0; x < char.width; x++) {

				var i = (y * char.width) + x;
				if ( charData[i] == 1 ) {

					//scaling nonsense
					for (var sy = 0; sy < text_scale; sy++) {
						for (var sx = 0; sx < text_scale; sx++) {
							var pxl = 4 * ( ((top+(y*text_scale)+sy) * (textboxInfo.width*scale)) + (left+(x*text_scale)+sx) );
							textboxInfo.img.data[pxl+0] = char.color.r;
							textboxInfo.img.data[pxl+1] = char.color.g;
							textboxInfo.img.data[pxl+2] = char.color.b;
							textboxInfo.img.data[pxl+3] = char.color.a;
						}
					}
				}
				// else {
				// 	// DEBUG

				// 	//scaling nonsense
				// 	for (var sy = 0; sy < text_scale; sy++) {
				// 		for (var sx = 0; sx < text_scale; sx++) {
				// 			var pxl = 4 * ( ((top+(y*text_scale)+sy) * (textboxInfo.width*scale)) + (left+(x*text_scale)+sx) );
				// 			textboxInfo.img.data[pxl+0] = debug_r;
				// 			textboxInfo.img.data[pxl+1] = 0;
				// 			textboxInfo.img.data[pxl+2] = 0;
				// 			textboxInfo.img.data[pxl+3] = 255;
				// 		}
				// 	}
				// }

			}
		}
		
		// call printHandler for character
		char.OnPrint();
	};

	var effectTime = 0; // TODO this variable should live somewhere better
	this.Draw = function(buffer, dt) {
		effectTime += dt;

		this.ClearTextbox();

		buffer.ForEachActiveChar(this.DrawChar);

		if (buffer.CanContinue()) {
			this.DrawNextArrow();
		}

		this.DrawTextbox();

		if (buffer.DidPageFinishThisFrame() && onPageFinish != null) {
			onPageFinish();
		}
	};

	/* this is a hook for GIF rendering */
	var onPageFinish = null;
	this.SetPageFinishHandler = function(handler) {
		onPageFinish = handler;
	};

	this.Reset = function() {
		effectTime = 0;
		// TODO - anything else?
	}

	// this.CharsPerRow = function() {
	// 	return textboxInfo.charsPerRow;
	// }
}


var DialogBuffer = function() {
	var buffer = [[[]]]; // holds dialog in an array buffer
	var pageIndex = 0;
	var rowIndex = 0;
	var charIndex = 0;
	var nextCharTimer = 0;
	var nextCharMaxTime = 50; // in milliseconds
	var isDialogReadyToContinue = false;
	var activeTextEffects = [];
	var font = null;
	var arabicHandler = new ArabicHandler();
	var onDialogEndCallbacks = [];

	this.SetFont = function(f) {
		font = f;
	}

	this.CurPage = function() { return buffer[ pageIndex ]; };
	this.CurRow = function() { return this.CurPage()[ rowIndex ]; };
	this.CurChar = function() { return this.CurRow()[ charIndex ]; };
	this.CurPageCount = function() { return buffer.length; };
	this.CurRowCount = function() { return this.CurPage().length; };
	this.CurCharCount = function() { return this.CurRow().length; };

	this.ForEachActiveChar = function(handler) { // Iterates over visible characters on the active page
		var rowCount = rowIndex + 1;
		for (var i = 0; i < rowCount; i++) {
			var row = this.CurPage()[i];
			var charCount = (i == rowIndex) ? charIndex+1 : row.length;
			// console.log(charCount);

			var leftPos = 0;
			if (textDirection === TextDirection.RightToLeft) {
				leftPos = 24 * 8; // hack -- I think this is correct?
			}

			for(var j = 0; j < charCount; j++) {
				var char = row[j];
				if(char) {
					if (textDirection === TextDirection.RightToLeft) {
						leftPos -= char.spacing;
					}
					// console.log(j + " " + leftPos);

					// handler( char, i /*rowIndex*/, j /*colIndex*/ );
					handler(char, i /*rowIndex*/, j /*colIndex*/, leftPos)

					if (textDirection === TextDirection.LeftToRight) {
						leftPos += char.spacing;
					}
				}
			}
		}
	}

	this.Reset = function() {
		buffer = [[[]]];
		pageIndex = 0;
		rowIndex = 0;
		charIndex = 0;
		isDialogReadyToContinue = false;

		afterManualPagebreak = false;

		activeTextEffects = [];

		onDialogEndCallbacks = [];

		isActive = false;
	};

	this.DoNextChar = function() {
		nextCharTimer = 0; //reset timer

		//time to update characters
		if (charIndex + 1 < this.CurCharCount()) {
			//add char to current row
			charIndex++;
		}
		else if (rowIndex + 1 < this.CurRowCount()) {
			//start next row
			rowIndex++;
			charIndex = 0;
		}
		else {
			//the page is full!
			isDialogReadyToContinue = true;
			didPageFinishThisFrame = true;
		}

		if (this.CurChar() != null) {
			if (this.CurChar().isPageBreak) {
				// special case for page break marker character!
				isDialogReadyToContinue = true;
				didPageFinishThisFrame = true;
			}
			
			this.CurChar().OnPrint(); // make sure we hit the callback before we run out of text
		}
	};

	this.Update = function(dt) {
		didPageFinishThisFrame = false;
		didFlipPageThisFrame = false;
		// this.Draw(dt); // TODO move into a renderer object
		if (isDialogReadyToContinue) {
			return; //waiting for dialog to be advanced by player
		}

		nextCharTimer += dt; //tick timer

		if (nextCharTimer > nextCharMaxTime) {
			this.DoNextChar();
		}
	};

	this.Skip = function() {
		console.log("SKIPPP");
		didPageFinishThisFrame = false;
		didFlipPageThisFrame = false;
		// add new characters until you get to the end of the current line of dialog
		while (rowIndex < this.CurRowCount()) {
			this.DoNextChar();

			if(isDialogReadyToContinue) {
				//make sure to push the rowIndex past the end to break out of the loop
				rowIndex++;
				charIndex = 0;
			}
		}
		rowIndex = this.CurRowCount()-1;
		charIndex = this.CurCharCount()-1;
	};

	this.FlipPage = function() {
		didFlipPageThisFrame = true;
		isDialogReadyToContinue = false;
		pageIndex++;
		rowIndex = 0;
		charIndex = 0;
	}

	this.EndDialog = function() {
		isActive = false; // no more text to show... this should be a sign to stop rendering dialog

		for (var i = 0; i < onDialogEndCallbacks.length; i++) {
			onDialogEndCallbacks[i]();
		}
	}

	var afterManualPagebreak = false; // is it bad to track this state like this?

	this.Continue = function() {
		console.log("CONTINUE");

		// if we used a page break character to continue we need
		// to run whatever is in the script afterwards! // TODO : make this comment better
		if (this.CurChar().isPageBreak) {
			// hacky: always treat a page break as the end of dialog
			// if there's more dialog later we re-activate the dialog buffer
			this.EndDialog();
			afterManualPagebreak = true;
			this.CurChar().OnContinue();
			return false;
		}
		if (pageIndex + 1 < this.CurPageCount()) {
			console.log("FLIP PAGE!");
			//start next page
			this.FlipPage();
			return true; /* hasMoreDialog */
		}
		else {
			console.log("END DIALOG!");
			//end dialog mode
			this.EndDialog();
			return false; /* hasMoreDialog */
		}
	};

	var isActive = false;
	this.IsActive = function() { return isActive; };

	this.OnDialogEnd = function(callback) {
		if (!isActive) {
			callback();
		}
		else {
			onDialogEndCallbacks.push(callback);
		}
	}

	this.CanContinue = function() { return isDialogReadyToContinue; };

	function DialogChar(effectList) {
		this.effectList = effectList.slice(); // clone effect list (since it can change between chars)

		this.color = { r:255, g:255, b:255, a:255 };
		this.offset = { x:0, y:0 }; // in pixels (screen pixels?)

		this.col = 0;
		this.row = 0;

		this.SetPosition = function(row,col) {
			// console.log("SET POS");
			// console.log(this);
			this.row = row;
			this.col = col;
		}

		this.ApplyEffects = function(time) {
			// console.log("APPLY EFFECTS! " + time);
			for(var i = 0; i < this.effectList.length; i++) {
				var effectName = this.effectList[i];
				// console.log("FX " + effectName);
				TextEffects[ effectName ].DoEffect( this, time );
			}
		}

		var printHandler = null; // optional function to be called once on printing character
		this.SetPrintHandler = function(handler) {
			printHandler = handler;
		}
		this.OnPrint = function() {
			if (printHandler != null) {
				// console.log("PRINT HANDLER ---- DIALOG BUFFER");
				printHandler();
				printHandler = null; // only call handler once (hacky)
			}
		}

		this.bitmap = [];
		this.width = 0;
		this.height = 0;
		this.base_offset = { // hacky name
 			x: 0,
			y: 0
		};
		this.spacing = 0;
	}

	function DialogFontChar(font, char, effectList) {
		Object.assign(this, new DialogChar(effectList));

		var charData = font.getChar(char);
		this.bitmap = charData.data;
		this.width = charData.width;
		this.height = charData.height;
		this.base_offset.x = charData.offset.x;
		this.base_offset.y = charData.offset.y;
		this.spacing = charData.spacing;
	}

	function DialogDrawingChar(drawingId, effectList) {
		Object.assign(this, new DialogChar(effectList));

		var imageData = renderer.GetImageSource(drawingId)[0];
		var imageDataFlat = [];
		for (var i = 0; i < imageData.length; i++) {
			// console.log(imageData[i]);
			imageDataFlat = imageDataFlat.concat(imageData[i]);
		}

		this.bitmap = imageDataFlat;
		this.width = 8;
		this.height = 8;
		this.spacing = 8;
	}

	function DialogScriptControlChar() {
		Object.assign(this, new DialogChar([]));

		this.width = 0;
		this.height = 0;
		this.spacing = 0;
	}

	// is a control character really the best way to handle page breaks?
	function DialogPageBreakChar() {
		Object.assign(this, new DialogChar([]));

		this.width = 0;
		this.height = 0;
		this.spacing = 0;

		this.isPageBreak = true;

		var continueHandler = null;

		this.SetContinueHandler = function(handler) {
			continueHandler = handler;
		}

		this.OnContinue = function() {
			if (continueHandler) {
				continueHandler();
			}
		}
	}

	function AddWordToCharArray(charArray,word,effectList) {
		for(var i = 0; i < word.length; i++) {
			charArray.push( new DialogFontChar( font, word[i], effectList ) );
		}
		return charArray;
	}

	function GetCharArrayWidth(charArray) {
		var width = 0;
		for(var i = 0; i < charArray.length; i++) {
			width += charArray[i].spacing;
		}
		return width;
	}

	function GetStringWidth(str) {
		var width = 0;
		for (var i = 0; i < str.length; i++) {
			var charData = font.getChar(str[i]);
			width += charData.spacing;
		}
		return width;
	}

	var pixelsPerRow = 192; // hard-coded fun times!!!

	this.AddScriptReturn = function(onReturnHandler) {
		var curPageIndex = buffer.length - 1;
		var curRowIndex = buffer[curPageIndex].length - 1;
		var curRowArr = buffer[curPageIndex][curRowIndex];

		var controlChar = new DialogScriptControlChar();
		controlChar.SetPrintHandler(onReturnHandler);

		curRowArr.push(controlChar);

		isActive = true;
	}

	this.AddDrawing = function(drawingId) {
		// console.log("DRAWING ID " + drawingId);

		var curPageIndex = buffer.length - 1;
		var curRowIndex = buffer[curPageIndex].length - 1;
		var curRowArr = buffer[curPageIndex][curRowIndex];

		var drawingChar = new DialogDrawingChar(drawingId, activeTextEffects);

		var rowLength = GetCharArrayWidth(curRowArr);

		// TODO : clean up copy-pasted code here :/
		if (afterManualPagebreak) {
			this.FlipPage(); // hacky

			buffer[curPageIndex][curRowIndex] = curRowArr;
			buffer.push([]);
			curPageIndex++;
			buffer[curPageIndex].push([]);
			curRowIndex = 0;
			curRowArr = buffer[curPageIndex][curRowIndex];
			curRowArr.push(drawingChar);

			afterManualPagebreak = false;
		}
		else if (rowLength + drawingChar.spacing  <= pixelsPerRow || rowLength <= 0) {
			//stay on same row
			curRowArr.push(drawingChar);
		}
		else if (curRowIndex == 0) {
			//start next row
			buffer[curPageIndex][curRowIndex] = curRowArr;
			buffer[curPageIndex].push([]);
			curRowIndex++;
			curRowArr = buffer[curPageIndex][curRowIndex];
			curRowArr.push(drawingChar);
		}
		else {
			//start next page
			buffer[curPageIndex][curRowIndex] = curRowArr;
			buffer.push([]);
			curPageIndex++;
			buffer[curPageIndex].push([]);
			curRowIndex = 0;
			curRowArr = buffer[curPageIndex][curRowIndex];
			curRowArr.push(drawingChar);
		}

		isActive = true; // this feels like a bad way to do this???
	}

	// TODO : convert this into something that takes DialogChar arrays
	this.AddText = function(textStr) {
		console.log("ADD TEXT " + textStr);

		//process dialog so it's easier to display
		var words = textStr.split(" ");

		// var curPageIndex = this.CurPageCount() - 1;
		// var curRowIndex = this.CurRowCount() - 1;
		// var curRowArr = this.CurRow();

		var curPageIndex = buffer.length - 1;
		var curRowIndex = buffer[curPageIndex].length - 1;
		var curRowArr = buffer[curPageIndex][curRowIndex];

		for (var i = 0; i < words.length; i++) {
			var word = words[i];
			if (arabicHandler.ContainsArabicCharacters(word)) {
				word = arabicHandler.ShapeArabicCharacters(word);
			}

			var wordWithPrecedingSpace = ((i == 0) ? "" : " ") + word;
			var wordLength = GetStringWidth(wordWithPrecedingSpace);

			var rowLength = GetCharArrayWidth(curRowArr);

			if (afterManualPagebreak) {
				this.FlipPage();

				// hacky copied bit for page breaks
				buffer[curPageIndex][curRowIndex] = curRowArr;
				buffer.push([]);
				curPageIndex++;
				buffer[curPageIndex].push([]);
				curRowIndex = 0;
				curRowArr = buffer[curPageIndex][curRowIndex];
				curRowArr = AddWordToCharArray(curRowArr, word, activeTextEffects);

				afterManualPagebreak = false;
			}
			else if (rowLength + wordLength <= pixelsPerRow || rowLength <= 0) {
				//stay on same row
				curRowArr = AddWordToCharArray(curRowArr, wordWithPrecedingSpace, activeTextEffects);
			}
			else if (curRowIndex == 0) {
				//start next row
				buffer[curPageIndex][curRowIndex] = curRowArr;
				buffer[curPageIndex].push([]);
				curRowIndex++;
				curRowArr = buffer[curPageIndex][curRowIndex];
				curRowArr = AddWordToCharArray(curRowArr, word, activeTextEffects);
			}
			else {
				//start next page
				buffer[curPageIndex][curRowIndex] = curRowArr;
				buffer.push([]);
				curPageIndex++;
				buffer[curPageIndex].push([]);
				curRowIndex = 0;
				curRowArr = buffer[curPageIndex][curRowIndex];
				curRowArr = AddWordToCharArray(curRowArr, word, activeTextEffects);
			}
		}

		//destroy any empty stuff
		var lastPage = buffer[buffer.length-1];
		var lastRow = lastPage[lastPage.length-1];
		if (lastRow.length == 0) {
			lastPage.splice(lastPage.length-1, 1);
		}
		if (lastPage.length == 0) {
			buffer.splice(buffer.length-1, 1);
		}

		//finish up 
		lastPage = buffer[buffer.length-1];
		lastRow = lastPage[lastPage.length-1];
		if (lastRow.length > 0) {
			var lastChar = lastRow[lastRow.length-1];
		}

		// console.log(buffer);

		isActive = true;
	};

	this.AddLinebreak = function() {
		var lastPage = buffer[buffer.length-1];
		if (lastPage.length <= 1) {
			// console.log("LINEBREAK - NEW ROW ");
			// add new row
			lastPage.push([]);
		}
		else {
			// add new page
			buffer.push([[]]);
		}
		// console.log(buffer);

		isActive = true;
	}

	this.AddPagebreak = function(onReturnHandler) {
		var curPageIndex = buffer.length - 1;
		var curRowIndex = buffer[curPageIndex].length - 1;
		var curRowArr = buffer[curPageIndex][curRowIndex];

		// need to actually create a whole new page if following another pagebreak character
		if (this.CurChar() && this.CurChar().isPageBreak) {
			buffer.push([]);
			curPageIndex++;
			buffer[curPageIndex].push([]);
			curRowIndex = 0;
			curRowArr = buffer[curPageIndex][curRowIndex];
		}

		var pagebreakChar = new DialogPageBreakChar();
		pagebreakChar.SetContinueHandler(onReturnHandler);

		curRowArr.push(pagebreakChar);

		isActive = true;		
	}

	/* new text effects */
	this.HasTextEffect = function(name) {
		return activeTextEffects.indexOf( name ) > -1;
	}
	this.AddTextEffect = function(name) {
		activeTextEffects.push( name );
	}
	this.RemoveTextEffect = function(name) {
		activeTextEffects.splice( activeTextEffects.indexOf( name ), 1 );
	}

	/* this is a hook for GIF rendering */
	var didPageFinishThisFrame = false;
	this.DidPageFinishThisFrame = function(){ return didPageFinishThisFrame; };

	var didFlipPageThisFrame = false;
	this.DidFlipPageThisFrame = function(){ return didFlipPageThisFrame; };

	// this.SetCharsPerRow = function(num){ charsPerRow = num; }; // hacky
};

/* ARABIC */
var ArabicHandler = function() {

	var arabicCharStart = 0x0621;
	var arabicCharEnd = 0x064E;

	var CharacterForm = {
		Isolated : 0,
		Final : 1,
		Initial : 2,
		Middle : 3
	};

	// map glyphs to their character forms
	var glyphForms = {
		/*		 Isolated, Final, Initial, Middle Forms	*/
		0x0621: [0xFE80,0xFE80,0xFE80,0xFE80], /*  HAMZA  */ 
		0x0622: [0xFE81,0xFE82,0xFE81,0xFE82], /*  ALEF WITH MADDA ABOVE  */ 
		0x0623: [0xFE83,0xFE84,0xFE83,0xFE84], /*  ALEF WITH HAMZA ABOVE  */ 
		0x0624: [0xFE85,0xFE86,0xFE85,0xFE86], /*  WAW WITH HAMZA ABOVE  */ 
		0x0625: [0xFE87,0xFE88,0xFE87,0xFE88], /*  ALEF WITH HAMZA BELOW  */ 
		0x0626: [0xFE89,0xFE8A,0xFE8B,0xFE8C], /*  YEH WITH HAMZA ABOVE  */ 
		0x0627: [0xFE8D,0xFE8E,0xFE8D,0xFE8E], /*  ALEF  */ 
		0x0628: [0xFE8F,0xFE90,0xFE91,0xFE92], /*  BEH  */ 
		0x0629: [0xFE93,0xFE94,0xFE93,0xFE94], /*  TEH MARBUTA  */ 
		0x062A: [0xFE95,0xFE96,0xFE97,0xFE98], /*  TEH  */ 
		0x062B: [0xFE99,0xFE9A,0xFE9B,0xFE9C], /*  THEH  */ 
		0x062C: [0xFE9D,0xFE9E,0xFE9F,0xFEA0], /*  JEEM  */ 
		0x062D: [0xFEA1,0xFEA2,0xFEA3,0xFEA4], /*  HAH  */ 
		0x062E: [0xFEA5,0xFEA6,0xFEA7,0xFEA8], /*  KHAH  */ 
		0x062F: [0xFEA9,0xFEAA,0xFEA9,0xFEAA], /*  DAL  */ 
		0x0630: [0xFEAB,0xFEAC,0xFEAB,0xFEAC], /*  THAL */ 
		0x0631: [0xFEAD,0xFEAE,0xFEAD,0xFEAE], /*  RAA  */ 
		0x0632: [0xFEAF,0xFEB0,0xFEAF,0xFEB0], /*  ZAIN  */ 
		0x0633: [0xFEB1,0xFEB2,0xFEB3,0xFEB4], /*  SEEN  */ 
		0x0634: [0xFEB5,0xFEB6,0xFEB7,0xFEB8], /*  SHEEN  */ 
		0x0635: [0xFEB9,0xFEBA,0xFEBB,0xFEBC], /*  SAD  */ 
		0x0636: [0xFEBD,0xFEBE,0xFEBF,0xFEC0], /*  DAD  */ 
		0x0637: [0xFEC1,0xFEC2,0xFEC3,0xFEC4], /*  TAH  */ 
		0x0638: [0xFEC5,0xFEC6,0xFEC7,0xFEC8], /*  ZAH  */ 
		0x0639: [0xFEC9,0xFECA,0xFECB,0xFECC], /*  AIN  */ 
		0x063A: [0xFECD,0xFECE,0xFECF,0xFED0], /*  GHAIN  */ 
		0x063B: [0x0000,0x0000,0x0000,0x0000], /*  space */
		0x063C: [0x0000,0x0000,0x0000,0x0000], /*  space */
		0x063D: [0x0000,0x0000,0x0000,0x0000], /*  space */
		0x063E: [0x0000,0x0000,0x0000,0x0000], /*  space */
		0x063F: [0x0000,0x0000,0x0000,0x0000], /*  space */
		0x0640: [0x0640,0x0640,0x0640,0x0640], /*  TATWEEL  */ 
		0x0641: [0xFED1,0xFED2,0xFED3,0xFED4], /*  FAA  */ 
		0x0642: [0xFED5,0xFED6,0xFED7,0xFED8], /*  QAF  */ 
		0x0643: [0xFED9,0xFEDA,0xFEDB,0xFEDC], /*  KAF  */ 
		0x0644: [0xFEDD,0xFEDE,0xFEDF,0xFEE0], /*  LAM  */ 
		0x0645: [0xFEE1,0xFEE2,0xFEE3,0xFEE4], /*  MEEM  */ 
		0x0646: [0xFEE5,0xFEE6,0xFEE7,0xFEE8], /*  NOON  */ 
		0x0647: [0xFEE9,0xFEEA,0xFEEB,0xFEEC], /*  HEH  */ 
		0x0648: [0xFEED,0xFEEE,0xFEED,0xFEEE], /*  WAW  */ 
		0x0649: [0xFEEF,0xFEF0,0xFBE8,0xFBE9], /*  ALEF MAKSURA  */ 
		0x064A: [0xFEF1,0xFEF2,0xFEF3,0xFEF4], /*  YEH  */ 
		0x064B: [0xFEF5,0xFEF6,0xFEF5,0xFEF6], /*  LAM ALEF MADD*/
		0x064C: [0xFEF7,0xFEF8,0xFEF7,0xFEF8], /*  LAM ALEF HAMZA ABOVE*/
		0x064D: [0xFEF9,0xFEFa,0xFEF9,0xFEFa], /*  LAM ALEF HAMZA BELOW*/
		0x064E: [0xFEFb,0xFEFc,0xFEFb,0xFEFc], /*  LAM ALEF */
	};

	var disconnectedCharacters = [0x0621,0x0622,0x0623,0x0624,0x0625,0x0627,0x062f,0x0630,0x0631,0x0632,0x0648,0x0649,0x064b,0x064c,0x064d,0x064e];

	function IsArabicCharacter(char) {
		var code = char.charCodeAt(0);
		return (code >= arabicCharStart && code <= arabicCharEnd);
	}

	function ContainsArabicCharacters(word) {
		for (var i = 0; i < word.length; i++) {
			if (IsArabicCharacter(word[i])) {
				return true;
			}
		}
		return false;
	}

	function IsDisconnectedCharacter(char) {
		var code = char.charCodeAt(0);
		return disconnectedCharacters.indexOf(code) != -1;
	}

	function ShapeArabicCharacters(word) {
		var shapedWord = "";

		for (var i = 0; i < word.length; i++) {
			if (!IsArabicCharacter(word[i])) {
				shapedWord += word[i];
				continue;
			}

			var connectedToPreviousChar = i-1 >= 0 && IsArabicCharacter(word[i-1]) && !IsDisconnectedCharacter(word[i-1]);

			var connectedToNextChar = i+1 < word.length && IsArabicCharacter(word[i+1]) && !IsDisconnectedCharacter(word[i]);

			var form;
			if (!connectedToPreviousChar && !connectedToNextChar) {
				form = CharacterForm.Isolated;
			}
			else if (connectedToPreviousChar && !connectedToNextChar) {
				form = CharacterForm.Final;
			}
			else if (!connectedToPreviousChar && connectedToNextChar) {
				form = CharacterForm.Initial;
			}
			else if (connectedToPreviousChar && connectedToNextChar) {
				form = CharacterForm.Middle;
			}

			var code = word[i].charCodeAt(0);

			// handle lam alef special case
			if (code == 0x0644 && connectedToNextChar) {
				var nextCode = word[i+1].charCodeAt(0);
				var specialCode = null;
				if (nextCode == 0x0622) {
					// alef madd
					specialCode = glyphForms[0x064b][form];
				}
				else if (nextCode == 0x0623) {
					// hamza above
					specialCode = glyphForms[0x064c][form];
				}
				else if (nextCode == 0x0625) {
					// hamza below
					specialCode = glyphForms[0x064d][form];
				}
				else if (nextCode == 0x0627) {
					// alef
					specialCode = glyphForms[0x064e][form];
				}

				if (specialCode != null) {
					shapedWord += String.fromCharCode(specialCode);
					i++; // skip a step
					continue;
				}
			}

			// hacky?
			if (form === CharacterForm.Isolated) {
				shapedWord += word[i];
				continue;
			}

			var shapedCode = glyphForms[code][form];
			shapedWord += String.fromCharCode(shapedCode);
		}

		return shapedWord;
	}

	this.ContainsArabicCharacters = ContainsArabicCharacters;
	this.ShapeArabicCharacters = ShapeArabicCharacters;
}

/* NEW TEXT EFFECTS */
var TextEffects = new Map();

var RainbowEffect = function() { // TODO - should it be an object or just a method?
	this.DoEffect = function(char,time) {
		// console.log("RAINBOW!!!");
		// console.log(char);
		// console.log(char.color);
		// console.log(char.col);

		var h = Math.abs( Math.sin( (time / 600) - (char.col / 8) ) );
		var rgb = hslToRgb( h, 1, 0.5 );
		char.color.r = rgb[0];
		char.color.g = rgb[1];
		char.color.b = rgb[2];
		char.color.a = 255;
	}
};
TextEffects["rbw"] = new RainbowEffect();

var ColorEffect = function(index) {
	this.DoEffect = function(char) {
		var pal = getPal( curPal() );
		var color = pal[ parseInt( index ) ];
		// console.log(color);
		char.color.r = color[0];
		char.color.g = color[1];
		char.color.b = color[2];
		char.color.a = 255;
	}
};
TextEffects["clr1"] = new ColorEffect(0);
TextEffects["clr2"] = new ColorEffect(1); // TODO : should I use parameters instead of special names?
TextEffects["clr3"] = new ColorEffect(2);

var WavyEffect = function() {
	this.DoEffect = function(char,time) {
		char.offset.y += Math.sin( (time / 250) - (char.col / 2) ) * 4;
	}
};
TextEffects["wvy"] = new WavyEffect();

var ShakyEffect = function() {
	function disturb(func,time,offset,mult1,mult2) {
		return func( (time * mult1) - (offset * mult2) );
	}

	this.DoEffect = function(char,time) {
		char.offset.y += 3
						* disturb(Math.sin,time,char.col,0.1,0.5)
						* disturb(Math.cos,time,char.col,0.3,0.2)
						* disturb(Math.sin,time,char.row,2.0,1.0);
		char.offset.x += 3
						* disturb(Math.cos,time,char.row,0.1,1.0)
						* disturb(Math.sin,time,char.col,3.0,0.7)
						* disturb(Math.cos,time,char.col,0.2,0.3);
	}
};
TextEffects["shk"] = new ShakyEffect();

var DebugHighlightEffect = function() {
	this.DoEffect = function(char) {
		char.color.r = 255;
		char.color.g = 255;
		char.color.b = 0;
		char.color.a = 255;
	}
}
TextEffects["_debug_highlight"] = new DebugHighlightEffect();

} // Dialog()
</script>

<script>
/*
TODO
- reset renderer function
- react to changes in: drawings, palettes
- possible future plan: limit size of cache (remove old images)
- change image store path from (pal > col > draw) to (draw > pal > col)
- get rid of old getSpriteImage (etc) methods
- get editor working again [in progress]
- move debug timer class into core (seems useful)
*/

function Renderer(tilesize, scale) {

console.log("!!!!! NEW RENDERER");

var imageStore = { // TODO : rename to imageCache
	source: {},
	render: {}
};

var palettes = null; // TODO : need null checks?
var context = null;

function setPalettes(paletteObj) {
	palettes = paletteObj;

	// TODO : should this really clear out the render cache?
	imageStore.render = {};
}

function getPaletteColor(paletteId, colorIndex) {
	if (palettes[paletteId] === undefined) {
		paletteId = "default";
	}

	var palette = palettes[paletteId];

	if (colorIndex > palette.colors.length) { // do I need this failure case? (seems un-reliable)
		colorIndex = 0;
	}

	var color = palette.colors[colorIndex];

	return {
		r : color[0],
		g : color[1],
		b : color[2]
	};
}

var debugRenderCount = 0;

// TODO : change image store path from (pal > col > draw) to (draw > pal > col)
function renderImage(drawing, paletteId) {
	// debugRenderCount++;
	// console.log("RENDER COUNT " + debugRenderCount);

	var col = drawing.col;
	var colStr = "" + col;
	var pal = paletteId;
	var drwId = drawing.drw;
	var imgSrc = imageStore.source[ drawing.drw ];

	// initialize render cache entry
	if (imageStore.render[drwId] === undefined || imageStore.render[drwId] === null) {
		imageStore.render[drwId] = {};
	}

	if (imageStore.render[drwId][pal] === undefined || imageStore.render[drwId][pal] === null) {
		imageStore.render[drwId][pal] = {};
	}

	// create array of ImageData frames
	imageStore.render[drwId][pal][colStr] = [];

	for (var i = 0; i < imgSrc.length; i++) {
		var frameSrc = imgSrc[i];
		var frameData = imageDataFromImageSource( frameSrc, pal, col );
		imageStore.render[drwId][pal][colStr].push(frameData);
	}
}

function imageDataFromImageSource(imageSource, pal, col) {
	//console.log(imageSource);

	var img = context.createImageData(tilesize*scale,tilesize*scale);

	var backgroundColor = getPaletteColor(pal,0);
	var foregroundColor = getPaletteColor(pal,col);

	for (var y = 0; y < tilesize; y++) {
		for (var x = 0; x < tilesize; x++) {
			var px = imageSource[y][x];
			for (var sy = 0; sy < scale; sy++) {
				for (var sx = 0; sx < scale; sx++) {
					var pxl = (((y * scale) + sy) * tilesize * scale * 4) + (((x*scale) + sx) * 4);
					if ( px === 1 ) {
						img.data[pxl + 0] = foregroundColor.r;
						img.data[pxl + 1] = foregroundColor.g;
						img.data[pxl + 2] = foregroundColor.b;
						img.data[pxl + 3] = 255;
					}
					else { //ch === 0
						img.data[pxl + 0] = backgroundColor.r;
						img.data[pxl + 1] = backgroundColor.g;
						img.data[pxl + 2] = backgroundColor.b;
						img.data[pxl + 3] = 255;
					}
				}
			}
		}
	}

	// convert to canvas: chrome has poor performance when working directly with image data
	var imageCanvas = document.createElement("canvas");
	imageCanvas.width = img.width;
	imageCanvas.height = img.height;
	var imageContext = imageCanvas.getContext("2d");
	imageContext.putImageData(img,0,0);

	return imageCanvas;
}

// TODO : move into core
function undefinedOrNull(x) {
	return x === undefined || x === null;
}

function isImageRendered(drawing, paletteId) {
	var col = drawing.col;
	var colStr = "" + col;
	var pal = paletteId;
	var drwId = drawing.drw;

	if (undefinedOrNull(imageStore.render[drwId]) ||
		undefinedOrNull(imageStore.render[drwId][pal]) ||
		undefinedOrNull(imageStore.render[drwId][pal][colStr])) {
			return false;
	}
	else {
		return true;
	}
}

function getImageSet(drawing, paletteId) {
	return imageStore.render[drawing.drw][paletteId][drawing.col];
}

function getImageFrame(drawing, paletteId, frameOverride) {
	var frameIndex = 0;
	if (drawing.animation.isAnimated) {
		if (frameOverride != undefined && frameOverride != null) {
			frameIndex = frameOverride;
		}
		else {
			frameIndex = drawing.animation.frameIndex;
		}
	}

	return getImageSet(drawing, paletteId)[frameIndex];
}

function getOrRenderImage(drawing, paletteId, frameOverride) {
	if (!isImageRendered(drawing, paletteId)) {
		renderImage(drawing, paletteId);
	}

	return getImageFrame(drawing, paletteId, frameOverride);
}

/* PUBLIC INTERFACE */
this.GetImage = getOrRenderImage;

this.SetPalettes = setPalettes;

this.SetImageSource = function(drawingId, imageSourceData) {
	imageStore.source[drawingId] = imageSourceData;
	imageStore.render[drawingId] = {}; // reset render cache for this image
}

this.GetImageSource = function(drawingId) {
	return imageStore.source[drawingId];
}

this.GetFrameCount = function(drawingId) {
	return imageStore.source[drawingId].length;
}

this.AttachContext = function(ctx) {
	context = ctx;
}

} // Renderer()
</script>

<script>
var xhr; // TODO : remove
var canvas;
var context; // TODO : remove if safe?
var ctx;

var room = {};
var tile = {};
var sprite = {};
var item = {};
var dialog = {};
var palette = { //start off with a default palette
		"default" : {
			name : "default",
			colors : [[0,0,0],[255,255,255],[255,255,255]]
		}
	};
var variable = {}; // these are starting variable values -- they don't update (or I don't think they will)
var playerId = "A";

var titleDialogId = "title";
function getTitle() {
	return dialog[titleDialogId].src;
}
function setTitle(titleSrc) {
	dialog[titleDialogId] = { src:titleSrc, name:null };
}

var defaultFontName = "ascii_small";
var fontName = defaultFontName;
var TextDirection = {
	LeftToRight : "LTR",
	RightToLeft : "RTL"
};
var textDirection = TextDirection.LeftToRight;

var names = {
	room : new Map(),
	tile : new Map(), // Note: Not currently enabled in the UI
	sprite : new Map(),
	item : new Map(),
	dialog : new Map(),
};
function updateNamesFromCurData() {

	function createNameMap(objectStore) {
		var map = new Map();
		for (id in objectStore) {
			if (objectStore[id].name != undefined && objectStore[id].name != null) {
				map.set(objectStore[id].name, id);
			}
		}
		return map;
	}

	names.room = createNameMap(room);
	names.tile = createNameMap(tile);
	names.sprite = createNameMap(sprite);
	names.item = createNameMap(item);
	names.dialog = createNameMap(dialog);
}

var spriteStartLocations = {};

/* VERSION */
var version = {
	major: 7, // major changes
	minor: 0, // smaller changes
	devBuildPhase: "RELEASE",
};
function getEngineVersion() {
	return version.major + "." + version.minor;
}

/* FLAGS */
var flags;
function resetFlags() {
	flags = {
		ROOM_FORMAT : 0 // 0 = non-comma separated, 1 = comma separated
	};
}
resetFlags(); //init flags on load script

// SUPER hacky location... :/
var editorDevFlags = {
	// NONE right now!
};

function clearGameData() {
	room = {};
	tile = {};
	sprite = {};
	item = {};
	dialog = {};
	palette = { //start off with a default palette
		"default" : {
			name : "default",
			colors : [[0,0,0],[255,255,255],[255,255,255]]
		}
	};
	isEnding = false; //todo - correct place for this?
	variable = {};

	// TODO RENDERER : clear data?

	spriteStartLocations = {};

	// hacky to have this multiple times...
	names = {
		room : new Map(),
		tile : new Map(),
		sprite : new Map(),
		item : new Map(),
		dialog : new Map(),
	};

	fontName = defaultFontName; // TODO : reset font manager too?
	textDirection = TextDirection.LeftToRight;
}

var width = 128;
var height = 128;
var scale = 4; //this is stupid but necessary
var tilesize = 8;
var mapsize = 16;

var curRoom = "0";

var key = {
	left : 37,
	right : 39,
	up : 38,
	down : 40,
	space : 32,
	enter : 13,
	w : 87,
	a : 65,
	s : 83,
	d : 68,
	r : 82,
	shift : 16,
	ctrl : 17,
	alt : 18,
	cmd : 224
};

var prevTime = 0;
var deltaTime = 0;

//methods used to trigger gif recording
var didPlayerMoveThisFrame = false;
var onPlayerMoved = null;
// var didDialogUpdateThisFrame = false;
var onDialogUpdate = null;

//inventory update UI handles
var onInventoryChanged = null;
var onVariableChanged = null;
var onGameReset = null;

var isPlayerEmbeddedInEditor = false;

var renderer = new Renderer(tilesize, scale);

function getGameNameFromURL() {
	var game = window.location.hash.substring(1);
	// console.log("game name --- " + game);
	return game;
}

function attachCanvas(c) {
	canvas = c;
	canvas.width = width * scale;
	canvas.height = width * scale;
	ctx = canvas.getContext("2d");
	dialogRenderer.AttachContext(ctx);
	renderer.AttachContext(ctx);
}

var curGameData = null;
function load_game(game_data, startWithTitle) {
	curGameData = game_data; //remember the current game (used to reset the game)

	dialogBuffer.Reset();
	scriptInterpreter.ResetEnvironment(); // ensures variables are reset -- is this the best way?

	parseWorld(game_data);

	if (!isPlayerEmbeddedInEditor) {
		// hack to ensure default font is available
		fontManager.AddResource(defaultFontName + fontManager.GetExtension(), document.getElementById(defaultFontName).text.slice(1));
	}

	var font = fontManager.Get( fontName );
	dialogBuffer.SetFont(font);
	dialogRenderer.SetFont(font);

	setInitialVariables();

	// setInterval(updateLoadingScreen, 300); // hack test

	onready(startWithTitle);
}

function reset_cur_game() {
	if (curGameData == null) {
		return; //can't reset if we don't have the game data
	}

	stopGame();
	clearGameData();
	load_game(curGameData);

	if (isPlayerEmbeddedInEditor && onGameReset != null) {
		onGameReset();
	}
}

var update_interval = null;
function onready(startWithTitle) {
	if(startWithTitle === undefined || startWithTitle === null) startWithTitle = true;

	clearInterval(loading_interval);

	input = new InputManager();

	document.addEventListener('keydown', input.onkeydown);
	document.addEventListener('keyup', input.onkeyup);

	if (isPlayerEmbeddedInEditor) {
		canvas.addEventListener('touchstart', input.ontouchstart, {passive:false});
		canvas.addEventListener('touchmove', input.ontouchmove, {passive:false});
		canvas.addEventListener('touchend', input.ontouchend, {passive:false});
	}
	else {
		// creates a 'touchTrigger' element that covers the entire screen and can universally have touch event listeners added w/o issue.

		// we're checking for existing touchTriggers both at game start and end, so it's slightly redundant.
	  	var existingTouchTrigger = document.querySelector('#touchTrigger');
	  	if (existingTouchTrigger === null){
	  	  var touchTrigger = document.createElement("div");
	  	  touchTrigger.setAttribute("id","touchTrigger");

	  	  // afaik css in js is necessary here to force a fullscreen element
	  	  touchTrigger.setAttribute(
	  	    "style","position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; overflow: hidden;"
	  	  );
	  	  document.body.appendChild(touchTrigger);

	  	  touchTrigger.addEventListener('touchstart', input.ontouchstart);
	  	  touchTrigger.addEventListener('touchmove', input.ontouchmove);
	  	  touchTrigger.addEventListener('touchend', input.ontouchend);
	  	}
	}

	window.onblur = input.onblur;

	update_interval = setInterval(update,16);

	if(startWithTitle) { // used by editor 
		startNarrating(getTitle());
	}
}

function setInitialVariables() {
	for(id in variable) {
		var value = variable[id]; // default to string
		if(value === "true") {
			value = true;
		}
		else if(value === "false") {
			value = false;
		}
		else if(!isNaN(parseFloat(value))) {
			value = parseFloat(value);
		}
		scriptInterpreter.SetVariable(id,value);
	}
	scriptInterpreter.SetOnVariableChangeHandler( onVariableChanged );
}

function getOffset(evt) {
	var offset = { x:0, y:0 };

	var el = evt.target;
	var rect = el.getBoundingClientRect();

	offset.x += rect.left + el.scrollLeft;
	offset.y += rect.top + el.scrollTop;

	offset.x = evt.clientX - offset.x;
	offset.y = evt.clientY - offset.y;

	return offset;
}

function stopGame() {
	console.log("stop GAME!");

	document.removeEventListener('keydown', input.onkeydown);
	document.removeEventListener('keyup', input.onkeyup);

	if (isPlayerEmbeddedInEditor) {
		canvas.removeEventListener('touchstart', input.ontouchstart);
		canvas.removeEventListener('touchmove', input.ontouchmove);
		canvas.removeEventListener('touchend', input.ontouchend);
	}
	else {
		//check for touchTrigger and removes it

    		var existingTouchTrigger = document.querySelector('#touchTrigger');
    		if (existingTouchTrigger !== null){
    			existingTouchTrigger.removeEventListener('touchstart', input.ontouchstart);
    			existingTouchTrigger.removeEventListener('touchmove', input.ontouchmove);
    			existingTouchTrigger.removeEventListener('touchend', input.ontouchend);

    			existingTouchTrigger.parentElement.removeChild(existingTouchTrigger);
    		}
	}

	window.onblur = null;

	clearInterval(update_interval);
}

/* loading animation */
var loading_anim_data = [
	[
		0,1,1,1,1,1,1,0,
		0,0,1,1,1,1,0,0,
		0,0,1,1,1,1,0,0,
		0,0,0,1,1,0,0,0,
		0,0,0,1,1,0,0,0,
		0,0,1,0,0,1,0,0,
		0,0,1,0,0,1,0,0,
		0,1,1,1,1,1,1,0,
	],
	[
		0,1,1,1,1,1,1,0,
		0,0,1,0,0,1,0,0,
		0,0,1,1,1,1,0,0,
		0,0,0,1,1,0,0,0,
		0,0,0,1,1,0,0,0,
		0,0,1,0,0,1,0,0,
		0,0,1,1,1,1,0,0,
		0,1,1,1,1,1,1,0,
	],
	[
		0,1,1,1,1,1,1,0,
		0,0,1,0,0,1,0,0,
		0,0,1,0,0,1,0,0,
		0,0,0,1,1,0,0,0,
		0,0,0,1,1,0,0,0,
		0,0,1,1,1,1,0,0,
		0,0,1,1,1,1,0,0,
		0,1,1,1,1,1,1,0,
	],
	[
		0,1,1,1,1,1,1,0,
		0,0,1,0,0,1,0,0,
		0,0,1,0,0,1,0,0,
		0,0,0,1,1,0,0,0,
		0,0,0,1,1,0,0,0,
		0,0,1,1,1,1,0,0,
		0,0,1,1,1,1,0,0,
		0,1,1,1,1,1,1,0,
	],
	[
		0,0,0,0,0,0,0,0,
		1,0,0,0,0,0,0,1,
		1,1,1,0,0,1,1,1,
		1,1,1,1,1,0,0,1,
		1,1,1,1,1,0,0,1,
		1,1,1,0,0,1,1,1,
		1,0,0,0,0,0,0,1,
		0,0,0,0,0,0,0,0,
	]
];
var loading_anim_frame = 0;
var loading_anim_speed = 500;
var loading_interval = null;

function loadingAnimation() {
	//create image
	var loadingAnimImg = ctx.createImageData(8*scale, 8*scale);
	//draw image
	for (var y = 0; y < 8; y++) {
		for (var x = 0; x < 8; x++) {
			var i = (y * 8) + x;
			if (loading_anim_data[loading_anim_frame][i] == 1) {
				//scaling nonsense
				for (var sy = 0; sy < scale; sy++) {
					for (var sx = 0; sx < scale; sx++) {
						var pxl = 4 * ( (((y*scale)+sy) * (8*scale)) + ((x*scale)+sx) );
						loadingAnimImg.data[pxl+0] = 255;
						loadingAnimImg.data[pxl+1] = 255;
						loadingAnimImg.data[pxl+2] = 255;
						loadingAnimImg.data[pxl+3] = 255;
					}
				}
			}
		}
	}
	//put image on canvas
	ctx.putImageData(loadingAnimImg,scale*(width/2 - 4),scale*(height/2 - 4));
	//update frame
	loading_anim_frame++;
	if (loading_anim_frame >= 5) loading_anim_frame = 0;
}

function updateLoadingScreen() {
	// TODO : in progress
	ctx.fillStyle = "rgb(0,0,0)";
	ctx.fillRect(0,0,canvas.width,canvas.height);

	loadingAnimation();
	drawSprite( getSpriteImage(sprite["a"],"0",0), 8, 8, ctx );
}

function update() {
	var curTime = Date.now();
	deltaTime = curTime - prevTime;

	if (curRoom == null) {
		// in the special case where there is no valid room, end the game
		startNarrating( "", true /*isEnding*/ );
	}

	if (!transition.IsTransitionActive()) {
		updateInput();
	}

	if (transition.IsTransitionActive()) {
		// transition animation takes over everything!
		transition.UpdateTransition(deltaTime);
	}
	else {
		if (!isNarrating && !isEnding) {
			updateAnimation();
			drawRoom( room[curRoom] ); // draw world if game has begun
		}
		else {
			//make sure to still clear screen
			ctx.fillStyle = "rgb(" + getPal(curPal())[0][0] + "," + getPal(curPal())[0][1] + "," + getPal(curPal())[0][2] + ")";
			ctx.fillRect(0,0,canvas.width,canvas.height);
		}

		// if (isDialogMode) { // dialog mode
		if(dialogBuffer.IsActive()) {
			dialogRenderer.Draw( dialogBuffer, deltaTime );
			dialogBuffer.Update( deltaTime );
		}

		// keep moving avatar if player holds down button
		if( !dialogBuffer.IsActive() && !isEnding )
		{
			if( curPlayerDirection != Direction.None ) {
				playerHoldToMoveTimer -= deltaTime;

				if( playerHoldToMoveTimer <= 0 )
				{
					movePlayer( curPlayerDirection );
					playerHoldToMoveTimer = 150;
				}
			}
		}
	}

	prevTime = curTime;

	//for gif recording
	if (didPlayerMoveThisFrame && onPlayerMoved != null) {
		onPlayerMoved();
	}
	didPlayerMoveThisFrame = false;

	/* hacky replacement */
	if (onDialogUpdate != null) {
		dialogRenderer.SetPageFinishHandler( onDialogUpdate );
	}

	input.resetKeyPressed();
	input.resetTapReleased();
}

function updateInput() {
	if( dialogBuffer.IsActive() ) {
		if (input.anyKeyPressed() || input.isTapReleased()) {
			/* CONTINUE DIALOG */
			if (dialogBuffer.CanContinue()) {
				var hasMoreDialog = dialogBuffer.Continue();
				if(!hasMoreDialog) {
					// ignore currently held keys UNTIL they are released (stops player from insta-moving)
					input.ignoreHeldKeys();
				}
			}
			else {
				dialogBuffer.Skip();
			}
		}
	}
	else if ( isEnding ) {
		if (input.anyKeyPressed() || input.isTapReleased()) {
			/* RESTART GAME */
			reset_cur_game();
		}
	}
	else {
		/* WALK */
		var prevPlayerDirection = curPlayerDirection;

		if ( input.isKeyDown( key.left ) || input.isKeyDown( key.a ) || input.swipeLeft() ) {
			curPlayerDirection = Direction.Left;
		}
		else if ( input.isKeyDown( key.right ) || input.isKeyDown( key.d ) || input.swipeRight() ) {
			curPlayerDirection = Direction.Right;
		}
		else if ( input.isKeyDown( key.up ) || input.isKeyDown( key.w ) || input.swipeUp() ) {
			curPlayerDirection = Direction.Up;
		}
		else if ( input.isKeyDown( key.down ) || input.isKeyDown( key.s ) || input.swipeDown() ) {
			curPlayerDirection = Direction.Down;
		}
		else {
			curPlayerDirection = Direction.None;
		}

		if (curPlayerDirection != Direction.None && curPlayerDirection != prevPlayerDirection) {
			movePlayer( curPlayerDirection );
			playerHoldToMoveTimer = 500;
		}
	}
}

var animationCounter = 0;
var animationTime = 400;
function updateAnimation() {
	animationCounter += deltaTime;

	if ( animationCounter >= animationTime ) {

		// animate sprites
		for (id in sprite) {
			var spr = sprite[id];
			if (spr.animation.isAnimated) {
				spr.animation.frameIndex = ( spr.animation.frameIndex + 1 ) % spr.animation.frameCount;
			}
		}

		// animate tiles
		for (id in tile) {
			var til = tile[id];
			if (til.animation.isAnimated) {
				til.animation.frameIndex = ( til.animation.frameIndex + 1 ) % til.animation.frameCount;
			}
		}

		// animate items
		for (id in item) {
			var itm = item[id];
			if (itm.animation.isAnimated) {
				itm.animation.frameIndex = ( itm.animation.frameIndex + 1 ) % itm.animation.frameCount;
			}
		}

		// reset counter
		animationCounter = 0;

	}
}

function resetAllAnimations() {
	for (id in sprite) {
		var spr = sprite[id];
		if (spr.animation.isAnimated) {
			spr.animation.frameIndex = 0;
		}
	}

	for (id in tile) {
		var til = tile[id];
		if (til.animation.isAnimated) {
			til.animation.frameIndex = 0;
		}
	}

	for (id in item) {
		var itm = item[id];
		if (itm.animation.isAnimated) {
			itm.animation.frameIndex = 0;
		}
	}
}

function getSpriteAt(x,y) {
	for (id in sprite) {
		var spr = sprite[id];
		if (spr.room === curRoom) {
			if (spr.x == x && spr.y == y) {
				return id;
			}
		}
	}
	return null;
}

var Direction = {
	None : -1,
	Up : 0,
	Down : 1,
	Left : 2,
	Right : 3
};

var curPlayerDirection = Direction.None;
var playerHoldToMoveTimer = 0;

var InputManager = function() {
	var self = this;

	var pressed;
	var ignored;
	var newKeyPress;
	var touchState;

	function resetAll() {
		pressed = {};
		ignored = {};
		newKeyPress = false;

		touchState = {
			isDown : false,
			startX : 0,
			startY : 0,
			curX : 0,
			curY : 0,
			swipeDistance : 30,
			swipeDirection : Direction.None,
			tapReleased : false
		};
	}
	resetAll();

	function stopWindowScrolling(e) {
		if(e.keyCode == key.left || e.keyCode == key.right || e.keyCode == key.up || e.keyCode == key.down || !isPlayerEmbeddedInEditor)
			e.preventDefault();
	}

	function tryRestartGame(e) {
		/* RESTART GAME */
		if ( e.keyCode === key.r && ( e.getModifierState("Control") || e.getModifierState("Meta") ) ) {
			if ( confirm("Restart the game?") ) {
				reset_cur_game();
			}
		}
	}

	function eventIsModifier(event) {
		return (event.keyCode == key.shift || event.keyCode == key.ctrl || event.keyCode == key.alt || event.keyCode == key.cmd);
	}

	function isModifierKeyDown() {
		return ( self.isKeyDown(key.shift) || self.isKeyDown(key.ctrl) || self.isKeyDown(key.alt) || self.isKeyDown(key.cmd) );
	}

	this.ignoreHeldKeys = function() {
		for (var key in pressed) {
			if (pressed[key]) { // only ignore keys that are actually held
				ignored[key] = true;
				// console.log("IGNORE -- " + key);
			}
		}
	}

	this.onkeydown = function(event) {
		// console.log("KEYDOWN -- " + event.keyCode);

		stopWindowScrolling(event);

		tryRestartGame(event);

		// Special keys being held down can interfere with keyup events and lock movement
		// so just don't collect input when they're held
		{
			if (isModifierKeyDown()) {
				return;
			}

			if (eventIsModifier(event)) {
				resetAll();
			}
		}

		if (ignored[event.keyCode]) {
			return;
		}

		if (!self.isKeyDown(event.keyCode)) {
			newKeyPress = true;
		}

		pressed[event.keyCode] = true;
		ignored[event.keyCode] = false;
	}

	this.onkeyup = function(event) {
		// console.log("KEYUP -- " + event.keyCode);
		pressed[event.keyCode] = false;
		ignored[event.keyCode] = false;
	}

	this.ontouchstart = function(event) {
		event.preventDefault();

		if( event.changedTouches.length > 0 ) {
			touchState.isDown = true;

			touchState.startX = touchState.curX = event.changedTouches[0].clientX;
			touchState.startY = touchState.curY = event.changedTouches[0].clientY;

			touchState.swipeDirection = Direction.None;
		}
	}

	this.ontouchmove = function(event) {
		event.preventDefault();

		if( touchState.isDown && event.changedTouches.length > 0 ) {
			touchState.curX = event.changedTouches[0].clientX;
			touchState.curY = event.changedTouches[0].clientY;

			var prevDirection = touchState.swipeDirection;

			if( touchState.curX - touchState.startX <= -touchState.swipeDistance ) {
				touchState.swipeDirection = Direction.Left;
			}
			else if( touchState.curX - touchState.startX >= touchState.swipeDistance ) {
				touchState.swipeDirection = Direction.Right;
			}
			else if( touchState.curY - touchState.startY <= -touchState.swipeDistance ) {
				touchState.swipeDirection = Direction.Up;
			}
			else if( touchState.curY - touchState.startY >= touchState.swipeDistance ) {
				touchState.swipeDirection = Direction.Down;
			}

			if( touchState.swipeDirection != prevDirection ) {
				// reset center so changing directions is easier
				touchState.startX = touchState.curX;
				touchState.startY = touchState.curY;
			}
		}
	}

	this.ontouchend = function(event) {
		event.preventDefault();

		touchState.isDown = false;

		if( touchState.swipeDirection == Direction.None ) {
			// tap!
			touchState.tapReleased = true;
		}

		touchState.swipeDirection = Direction.None;
	}

	this.isKeyDown = function(keyCode) {
		return pressed[keyCode] != null && pressed[keyCode] == true && (ignored[keyCode] == null || ignored[keyCode] == false);
	}

	this.anyKeyPressed = function() {
		return newKeyPress;
	}

	this.resetKeyPressed = function() {
		newKeyPress = false;
	}

	this.swipeLeft = function() {
		return touchState.swipeDirection == Direction.Left;
	}

	this.swipeRight = function() {
		return touchState.swipeDirection == Direction.Right;
	}

	this.swipeUp = function() {
		return touchState.swipeDirection == Direction.Up;
	}

	this.swipeDown = function() {
		return touchState.swipeDirection == Direction.Down;
	}

	this.isTapReleased = function() {
		return touchState.tapReleased;
	}

	this.resetTapReleased = function() {
		touchState.tapReleased = false;
	}

	this.onblur = function() {
		// console.log("~~~ BLUR ~~");
		resetAll();
	}
}
var input = null;

function movePlayer(direction) {
	if (player().room == null || !Object.keys(room).includes(player().room)) {
		return; // player room is missing or invalid.. can't move them!
	}

	var spr = null;

	if ( curPlayerDirection == Direction.Left && !(spr = getSpriteLeft()) && !isWallLeft()) {
		player().x -= 1;
		didPlayerMoveThisFrame = true;
	}
	else if ( curPlayerDirection == Direction.Right && !(spr = getSpriteRight()) && !isWallRight()) {
		player().x += 1;
		didPlayerMoveThisFrame = true;
	}
	else if ( curPlayerDirection == Direction.Up && !(spr = getSpriteUp()) && !isWallUp()) {
		player().y -= 1;
		didPlayerMoveThisFrame = true;
	}
	else if ( curPlayerDirection == Direction.Down && !(spr = getSpriteDown()) && !isWallDown()) {
		player().y += 1;
		didPlayerMoveThisFrame = true;
	}
	
	var ext = getExit( player().room, player().x, player().y );
	var end = getEnding( player().room, player().x, player().y );
	var itmIndex = getItemIndex( player().room, player().x, player().y );

	// do items first, because you can pick up an item AND go through a door
	if (itmIndex > -1) {
		var itm = room[player().room].items[itmIndex];
		var itemRoom = player().room;

		startItemDialog(itm.id, function() {
			// remove item from room
			room[itemRoom].items.splice(itmIndex, 1);

			// update player inventory
			if (player().inventory[itm.id]) {
				player().inventory[itm.id] += 1;
			}
			else {
				player().inventory[itm.id] = 1;
			}

			// show inventory change in UI
			if (onInventoryChanged != null) {
				onInventoryChanged(itm.id);
			}
		});
	}

	if (end) {
		startEndingDialog(end);
	}
	else if (ext) {
		movePlayerThroughExit(ext);
	}
	else if (spr) {
		startSpriteDialog(spr /*spriteId*/);
	}
}

var transition = new TransitionManager();

function movePlayerThroughExit(ext) {
	var GoToDest = function() {
		if (ext.transition_effect != null) {
			transition.BeginTransition(player().room, player().x, player().y, ext.dest.room, ext.dest.x, ext.dest.y, ext.transition_effect);
			transition.UpdateTransition(0);
		}

		player().room = ext.dest.room;
		player().x = ext.dest.x;
		player().y = ext.dest.y;
		curRoom = ext.dest.room;

		initRoom(curRoom);
	};

	if (ext.dlg != undefined && ext.dlg != null) {
		// TODO : I need to simplify dialog code,
		// so I don't have to get the ID and the source str
		// every time!
		startDialog(
			dialog[ext.dlg].src,
			ext.dlg,
			function(result) {
				var isLocked = ext.property && ext.property.locked === true;
				if (!isLocked) {
					GoToDest();
				}
			},
			ext);
	}
	else {
		GoToDest();
	}
}

function initRoom(roomId) {
	// init exit properties
	for (var i = 0; i < room[roomId].exits.length; i++) {
		room[roomId].exits[i].property = { locked:false };
	}

	// init ending properties
	for (var i = 0; i < room[roomId].endings.length; i++) {
		room[roomId].endings[i].property = { locked:false };
	}
}

function getItemIndex( roomId, x, y ) {
	for( var i = 0; i < room[roomId].items.length; i++ ) {
		var itm = room[roomId].items[i];
		if ( itm.x == x && itm.y == y)
			return i;
	}
	return -1;
}

function getSpriteLeft() { //repetitive?
	return getSpriteAt( player().x - 1, player().y );
}

function getSpriteRight() {
	return getSpriteAt( player().x + 1, player().y );
}

function getSpriteUp() {
	return getSpriteAt( player().x, player().y - 1 );
}

function getSpriteDown() {
	return getSpriteAt( player().x, player().y + 1 );
}

function isWallLeft() {
	return (player().x - 1 < 0) || isWall( player().x - 1, player().y );
}

function isWallRight() {
	return (player().x + 1 >= 16) || isWall( player().x + 1, player().y );
}

function isWallUp() {
	return (player().y - 1 < 0) || isWall( player().x, player().y - 1 );
}

function isWallDown() {
	return (player().y + 1 >= 16) || isWall( player().x, player().y + 1 );
}

function isWall(x,y,roomId) {
	if(roomId == undefined || roomId == null)
		roomId = curRoom;

	var tileId = getTile( x, y );

	if( tileId === '0' )
		return false; // Blank spaces aren't walls, ya doofus

	if( tile[tileId].isWall === undefined || tile[tileId].isWall === null ) {
		// No wall-state defined: check room-specific walls
		var i = room[roomId].walls.indexOf( getTile(x,y) );
		return i > -1;
	}

	// Otherwise, use the tile's own wall-state
	return tile[tileId].isWall;
}

function getItem(roomId,x,y) {
	for (i in room[roomId].items) {
		var item = room[roomId].items[i];
		if (x == item.x && y == item.y) {
			return item;
		}
	}
	return null;
}

function getExit(roomId,x,y) {
	for (i in room[roomId].exits) {
		var e = room[roomId].exits[i];
		if (x == e.x && y == e.y) {
			return e;
		}
	}
	return null;
}

function getEnding(roomId,x,y) {
	for (i in room[roomId].endings) {
		var e = room[roomId].endings[i];
		if (x == e.x && y == e.y) {
			return e;
		}
	}
	return null;
}

function getTile(x,y) {
	// console.log(x + " " + y);
	var t = getRoom().tilemap[y][x];
	return t;
}

function player() {
	return sprite[playerId];
}

// Sort of a hack for legacy palette code (when it was just an array)
function getPal(id) {
	if (palette[id] === undefined) {
		id = "default";
	}

	return palette[ id ].colors;
}

function getRoom() {
	return room[curRoom];
}

function isSpriteOffstage(id) {
	return sprite[id].room == null;
}

function parseWorld(file) {
	spriteStartLocations = {};

	resetFlags();

	var versionNumber = 0;

	// flags to keep track of which compatibility conversions
	// need to be applied to this game data
	var compatibilityFlags = {
		convertSayToPrint : false,
		combineEndingsWithDialog : false,
		convertImplicitSpriteDialogIds : false,
	};

	var lines = file.split("\n");
	var i = 0;
	while (i < lines.length) {
		var curLine = lines[i];

		// console.log(lines[i]);

		if (i == 0) {
			i = parseTitle(lines, i);
		}
		else if (curLine.length <= 0 || curLine.charAt(0) === "#") {
			// collect version number (from a comment.. hacky I know)
			if (curLine.indexOf("# BITSY VERSION ") != -1) {
				versionNumber = parseFloat(curLine.replace("# BITSY VERSION ", ""));

				if (versionNumber < 5.0) {
					compatibilityFlags.convertSayToPrint = true;
				}

				if (versionNumber < 7.0) {
					compatibilityFlags.combineEndingsWithDialog = true;
					compatibilityFlags.convertImplicitSpriteDialogIds = true;
				}
			}

			//skip blank lines & comments
			i++;
		}
		else if (getType(curLine) == "PAL") {
			i = parsePalette(lines, i);
		}
		else if (getType(curLine) === "ROOM" || getType(curLine) === "SET") { //SET for back compat
			i = parseRoom(lines, i, compatibilityFlags);
		}
		else if (getType(curLine) === "TIL") {
			i = parseTile(lines, i);
		}
		else if (getType(curLine) === "SPR") {
			i = parseSprite(lines, i);
		}
		else if (getType(curLine) === "ITM") {
			i = parseItem(lines, i);
		}
		else if (getType(curLine) === "DRW") {
			i = parseDrawing(lines, i);
		}
		else if (getType(curLine) === "DLG") {
			i = parseDialog(lines, i, compatibilityFlags);
		}
		else if (getType(curLine) === "END" && compatibilityFlags.combineEndingsWithDialog) {
			// parse endings for back compat
			i = parseEnding(lines, i, compatibilityFlags);
		}
		else if (getType(curLine) === "VAR") {
			i = parseVariable(lines, i);
		}
		else if (getType(curLine) === "DEFAULT_FONT") {
			i = parseFontName(lines, i);
		}
		else if (getType(curLine) === "TEXT_DIRECTION") {
			i = parseTextDirection(lines, i);
		}
		else if (getType(curLine) === "FONT") {
			i = parseFontData(lines, i);
		}
		else if (getType(curLine) === "!") {
			i = parseFlag(lines, i);
		}
		else {
			i++;
		}
	}

	placeSprites();

	var roomIds = Object.keys(room);
	if (player() != undefined && player().room != null && roomIds.includes(player().room)) {
		// player has valid room
		curRoom = player().room;
	}
	else if (roomIds.length > 0) {
		// player not in any room! what the heck
		curRoom = roomIds[0];
	}
	else {
		// uh oh there are no rooms I guess???
		curRoom = null;
	}

	if (curRoom != null) {
		initRoom(curRoom);
	}

	renderer.SetPalettes(palette);

	scriptCompatibility(compatibilityFlags);

	return versionNumber;
}

function scriptCompatibility(compatibilityFlags) {
	if (compatibilityFlags.convertSayToPrint) {
		console.log("CONVERT SAY TO PRINT!");

		var PrintFunctionVisitor = function() {
			var didChange = false;
			this.DidChange = function() { return didChange; };

			this.Visit = function(node) {
				if (node.type != "function") {
					return;
				}

				if (node.name === "say") {
					node.name = "print";
					didChange = true;
				}
			};
		};

		for (dlgId in dialog) {
			var dialogScript = scriptInterpreter.Parse(dialog[dlgId].src);
			var visitor = new PrintFunctionVisitor();
			dialogScript.VisitAll(visitor);
			if (visitor.DidChange()) {
				var newDialog = dialogScript.Serialize();
				if (newDialog.indexOf("\n") > -1) {
					newDialog = '"""\n' + newDialog + '\n"""';
				}
				dialog[dlgId].src = newDialog;
			}
		}
	}
}

//TODO this is in progress and doesn't support all features
function serializeWorld(skipFonts) {
	if (skipFonts === undefined || skipFonts === null)
		skipFonts = false;

	var worldStr = "";
	/* TITLE */
	worldStr += getTitle() + "\n";
	worldStr += "\n";
	/* VERSION */
	worldStr += "# BITSY VERSION " + getEngineVersion() + "\n"; // add version as a comment for debugging purposes
	if (version.devBuildPhase != "RELEASE") {
		worldStr += "# DEVELOPMENT BUILD -- " + version.devBuildPhase;
	}
	worldStr += "\n";
	/* FLAGS */
	for (f in flags) {
		worldStr += "! " + f + " " + flags[f] + "\n";
	}
	worldStr += "\n"
	/* FONT */
	if (fontName != defaultFontName) {
		worldStr += "DEFAULT_FONT " + fontName + "\n";
		worldStr += "\n"
	}
	if (textDirection != TextDirection.LeftToRight) {
		worldStr += "TEXT_DIRECTION " + textDirection + "\n";
		worldStr += "\n"
	}
	/* PALETTE */
	for (id in palette) {
		if (id != "default") {
			worldStr += "PAL " + id + "\n";
			if( palette[id].name != null )
				worldStr += "NAME " + palette[id].name + "\n";
			for (i in getPal(id)) {
				for (j in getPal(id)[i]) {
					worldStr += getPal(id)[i][j];
					if (j < 2) worldStr += ",";
				}
				worldStr += "\n";
			}
			worldStr += "\n";
		}
	}
	/* ROOM */
	for (id in room) {
		worldStr += "ROOM " + id + "\n";
		if ( flags.ROOM_FORMAT == 0 ) {
			// old non-comma separated format
			for (i in room[id].tilemap) {
				for (j in room[id].tilemap[i]) {
					worldStr += room[id].tilemap[i][j];	
				}
				worldStr += "\n";
			}
		}
		else if ( flags.ROOM_FORMAT == 1 ) {
			// new comma separated format
			for (i in room[id].tilemap) {
				for (j in room[id].tilemap[i]) {
					worldStr += room[id].tilemap[i][j];
					if (j < room[id].tilemap[i].length-1) worldStr += ","
				}
				worldStr += "\n";
			}
		}
		if (room[id].name != null) {
			/* NAME */
			worldStr += "NAME " + room[id].name + "\n";
		}
		if (room[id].walls.length > 0) {
			/* WALLS */
			worldStr += "WAL ";
			for (j in room[id].walls) {
				worldStr += room[id].walls[j];
				if (j < room[id].walls.length-1) {
					worldStr += ",";
				}
			}
			worldStr += "\n";
		}
		if (room[id].items.length > 0) {
			/* ITEMS */
			for (j in room[id].items) {
				var itm = room[id].items[j];
				worldStr += "ITM " + itm.id + " " + itm.x + "," + itm.y;
				worldStr += "\n";
			}
		}
		if (room[id].exits.length > 0) {
			/* EXITS */
			for (j in room[id].exits) {
				var e = room[id].exits[j];
				if ( isExitValid(e) ) {
					worldStr += "EXT " + e.x + "," + e.y + " " + e.dest.room + " " + e.dest.x + "," + e.dest.y;
					if (e.transition_effect != undefined && e.transition_effect != null) {
						worldStr += " FX " + e.transition_effect;
					}
					if (e.dlg != undefined && e.dlg != null) {
						worldStr += " DLG " + e.dlg;
					}
					worldStr += "\n";
				}
			}
		}
		if (room[id].endings.length > 0) {
			/* ENDINGS */
			for (j in room[id].endings) {
				var e = room[id].endings[j];
				// todo isEndingValid
				worldStr += "END " + e.id + " " + e.x + "," + e.y;
				worldStr += "\n";
			}
		}
		if (room[id].pal != null && room[id].pal != "default") {
			/* PALETTE */
			worldStr += "PAL " + room[id].pal + "\n";
		}
		worldStr += "\n";
	}
	/* TILES */
	for (id in tile) {
		worldStr += "TIL " + id + "\n";
		worldStr += serializeDrawing( "TIL_" + id );
		if (tile[id].name != null && tile[id].name != undefined) {
			/* NAME */
			worldStr += "NAME " + tile[id].name + "\n";
		}
		if (tile[id].isWall != null && tile[id].isWall != undefined) {
			/* WALL */
			worldStr += "WAL " + tile[id].isWall + "\n";
		}
		if (tile[id].col != null && tile[id].col != undefined && tile[id].col != 1) {
			/* COLOR OVERRIDE */
			worldStr += "COL " + tile[id].col + "\n";
		}
		worldStr += "\n";
	}
	/* SPRITES */
	for (id in sprite) {
		worldStr += "SPR " + id + "\n";
		worldStr += serializeDrawing( "SPR_" + id );
		if (sprite[id].name != null && sprite[id].name != undefined) {
			/* NAME */
			worldStr += "NAME " + sprite[id].name + "\n";
		}
		if (sprite[id].dlg != null) {
			worldStr += "DLG " + sprite[id].dlg + "\n";
		}
		if (sprite[id].room != null) {
			/* SPRITE POSITION */
			worldStr += "POS " + sprite[id].room + " " + sprite[id].x + "," + sprite[id].y + "\n";
		}
		if (sprite[id].inventory != null) {
			for(itemId in sprite[id].inventory) {
				worldStr += "ITM " + itemId + " " + sprite[id].inventory[itemId] + "\n";
			}
		}
		if (sprite[id].col != null && sprite[id].col != undefined && sprite[id].col != 2) {
			/* COLOR OVERRIDE */
			worldStr += "COL " + sprite[id].col + "\n";
		}
		worldStr += "\n";
	}
	/* ITEMS */
	for (id in item) {
		worldStr += "ITM " + id + "\n";
		worldStr += serializeDrawing( "ITM_" + id );
		if (item[id].name != null && item[id].name != undefined) {
			/* NAME */
			worldStr += "NAME " + item[id].name + "\n";
		}
		if (item[id].dlg != null) {
			worldStr += "DLG " + item[id].dlg + "\n";
		}
		if (item[id].col != null && item[id].col != undefined && item[id].col != 2) {
			/* COLOR OVERRIDE */
			worldStr += "COL " + item[id].col + "\n";
		}
		worldStr += "\n";
	}
	/* DIALOG */
	for (id in dialog) {
		if (id != titleDialogId) {
			worldStr += "DLG " + id + "\n";
			worldStr += dialog[id].src + "\n";
			if (dialog[id].name != null) {
				worldStr += "NAME " + dialog[id].name + "\n";
			}
			worldStr += "\n";
		}
	}
	/* VARIABLES */
	for (id in variable) {
		worldStr += "VAR " + id + "\n";
		worldStr += variable[id] + "\n";
		worldStr += "\n";
	}
	/* FONT */
	// TODO : support multiple fonts
	if (fontName != defaultFontName && !skipFonts) {
		worldStr += fontManager.GetData(fontName);
	}

	return worldStr;
}

function serializeDrawing(drwId) {
	var imageSource = renderer.GetImageSource(drwId);
	var drwStr = "";
	for (f in imageSource) {
		for (y in imageSource[f]) {
			var rowStr = "";
			for (x in imageSource[f][y]) {
				rowStr += imageSource[f][y][x];
			}
			drwStr += rowStr + "\n";
		}
		if (f < (imageSource.length-1)) drwStr += ">\n";
	}
	return drwStr;
}

function isExitValid(e) {
	var hasValidStartPos = e.x >= 0 && e.x < 16 && e.y >= 0 && e.y < 16;
	var hasDest = e.dest != null;
	var hasValidRoomDest = (e.dest.room != null && e.dest.x >= 0 && e.dest.x < 16 && e.dest.y >= 0 && e.dest.y < 16);
	return hasValidStartPos && hasDest && hasValidRoomDest;
}

function placeSprites() {
	for (id in spriteStartLocations) {
		//console.log(id);
		//console.log( spriteStartLocations[id] );
		//console.log(sprite[id]);
		sprite[id].room = spriteStartLocations[id].room;
		sprite[id].x = spriteStartLocations[id].x;
		sprite[id].y = spriteStartLocations[id].y;
		//console.log(sprite[id]);
	}
}

/* ARGUMENT GETTERS */
function getType(line) {
	return getArg(line,0);
}

function getId(line) {
	return getArg(line,1);
}

function getArg(line,arg) {
	return line.split(" ")[arg];
}

function getCoord(line,arg) {
	return getArg(line,arg).split(",");
}

function parseTitle(lines, i) {
	var results = scriptUtils.ReadDialogScript(lines,i);
	setTitle(results.script);
	i = results.index;

	i++;

	return i;
}

function parseRoom(lines, i, compatibilityFlags) {
	var id = getId(lines[i]);
	room[id] = {
		id : id,
		tilemap : [],
		walls : [],
		exits : [],
		endings : [],
		items : [],
		pal : null,
		name : null
	};
	i++;

	// create tile map
	if ( flags.ROOM_FORMAT == 0 ) {
		// old way: no commas, single char tile ids
		var end = i + mapsize;
		var y = 0;
		for (; i<end; i++) {
			room[id].tilemap.push( [] );
			for (x = 0; x<mapsize; x++) {
				room[id].tilemap[y].push( lines[i].charAt(x) );
			}
			y++;
		}
	}
	else if ( flags.ROOM_FORMAT == 1 ) {
		// new way: comma separated, multiple char tile ids
		var end = i + mapsize;
		var y = 0;
		for (; i<end; i++) {
			room[id].tilemap.push( [] );
			var lineSep = lines[i].split(",");
			for (x = 0; x<mapsize; x++) {
				room[id].tilemap[y].push( lineSep[x] );
			}
			y++;
		}
	}

	while (i < lines.length && lines[i].length > 0) { //look for empty line
		// console.log(getType(lines[i]));
		if (getType(lines[i]) === "SPR") {
			/* NOTE SPRITE START LOCATIONS */
			var sprId = getId(lines[i]);
			if (sprId.indexOf(",") == -1 && lines[i].split(" ").length >= 3) { //second conditional checks for coords
				/* PLACE A SINGLE SPRITE */
				var sprCoord = lines[i].split(" ")[2].split(",");
				spriteStartLocations[sprId] = {
					room : id,
					x : parseInt(sprCoord[0]),
					y : parseInt(sprCoord[1])
				};
			}
			else if ( flags.ROOM_FORMAT == 0 ) { // TODO: right now this shortcut only works w/ the old comma separate format
				/* PLACE MULTIPLE SPRITES*/ 
				//Does find and replace in the tilemap (may be hacky, but its convenient)
				var sprList = sprId.split(",");
				for (row in room[id].tilemap) {
					for (s in sprList) {
						var col = room[id].tilemap[row].indexOf( sprList[s] );
						//if the sprite is in this row, replace it with the "null tile" and set its starting position
						if (col != -1) {
							room[id].tilemap[row][col] = "0";
							spriteStartLocations[ sprList[s] ] = {
								room : id,
								x : parseInt(col),
								y : parseInt(row)
							};
						}
					}
				}
			}
		}
		else if (getType(lines[i]) === "ITM") {
			var itmId = getId(lines[i]);
			var itmCoord = lines[i].split(" ")[2].split(",");
			var itm = {
				id: itmId,
				x : parseInt(itmCoord[0]),
				y : parseInt(itmCoord[1])
			};
			room[id].items.push( itm );
		}
		else if (getType(lines[i]) === "WAL") {
			/* DEFINE COLLISIONS (WALLS) */
			room[id].walls = getId(lines[i]).split(",");
		}
		else if (getType(lines[i]) === "EXT") {
			/* ADD EXIT */
			var exitArgs = lines[i].split(" ");
			//arg format: EXT 10,5 M 3,2 [AVA:7 LCK:a,9] [AVA 7 LCK a 9]
			var exitCoords = exitArgs[1].split(",");
			var destName = exitArgs[2];
			var destCoords = exitArgs[3].split(",");
			var ext = {
				x : parseInt(exitCoords[0]),
				y : parseInt(exitCoords[1]),
				dest : {
					room : destName,
					x : parseInt(destCoords[0]),
					y : parseInt(destCoords[1])
				},
				transition_effect : null,
				dlg: null,
			};

			// optional arguments
			var exitArgIndex = 4;
			while (exitArgIndex < exitArgs.length) {
				if (exitArgs[exitArgIndex] == "FX") {
					ext.transition_effect = exitArgs[exitArgIndex+1];
					exitArgIndex += 2;
				}
				else if (exitArgs[exitArgIndex] == "DLG") {
					ext.dlg = exitArgs[exitArgIndex+1];
					exitArgIndex += 2;
				}
				else {
					exitArgIndex += 1;
				}
			}

			room[id].exits.push(ext);
		}
		else if (getType(lines[i]) === "END") {
			/* ADD ENDING */
			var endId = getId(lines[i]);

			// compatibility with when endings were stored separate from other dialog
			if (compatibilityFlags.combineEndingsWithDialog) {
				endId = "end_" + endId;
			}

			var endCoords = getCoord(lines[i], 2);
			var end = {
				id : endId,
				x : parseInt(endCoords[0]),
				y : parseInt(endCoords[1])
			};

			room[id].endings.push(end);
		}
		else if (getType(lines[i]) === "PAL") {
			/* CHOOSE PALETTE (that's not default) */
			room[id].pal = getId(lines[i]);
		}
		else if (getType(lines[i]) === "NAME") {
			var name = lines[i].split(/\s(.+)/)[1];
			room[id].name = name;
			names.room.set(name, id);
		}

		i++;
	}

	return i;
}

function parsePalette(lines,i) { //todo this has to go first right now :(
	var id = getId(lines[i]);
	i++;
	var colors = [];
	var name = null;
	while (i < lines.length && lines[i].length > 0) { //look for empty line
		var args = lines[i].split(" ");
		if (args[0] === "NAME") {
			name = lines[i].split(/\s(.+)/)[1];
		}
		else {
			var col = [];
			lines[i].split(",").forEach(function(i) {
				col.push(parseInt(i));
			});
			colors.push(col);
		}
		i++;
	}
	palette[id] = {
		id : id,
		name : name,
		colors : colors
	};
	return i;
}

function parseTile(lines, i) {
	var id = getId(lines[i]);
	var drwId = null;
	var name = null;

	i++;

	if (getType(lines[i]) === "DRW") { //load existing drawing
		drwId = getId(lines[i]);
		i++;
	}
	else {
		// store tile source
		drwId = "TIL_" + id;
		i = parseDrawingCore( lines, i, drwId );
	}

	//other properties
	var colorIndex = 1; // default palette color index is 1
	var isWall = null; // null indicates it can vary from room to room (original version)
	while (i < lines.length && lines[i].length > 0) { //look for empty line
		if (getType(lines[i]) === "COL") {
			colorIndex = parseInt( getId(lines[i]) );
		}
		else if (getType(lines[i]) === "NAME") {
			/* NAME */
			name = lines[i].split(/\s(.+)/)[1];
			names.tile.set( name, id );
		}
		else if (getType(lines[i]) === "WAL") {
			var wallArg = getArg( lines[i], 1 );
			if( wallArg === "true" ) {
				isWall = true;
			}
			else if( wallArg === "false" ) {
				isWall = false;
			}
		}
		i++;
	}

	//tile data
	tile[id] = {
		id : id,
		drw : drwId, //drawing id
		col : colorIndex,
		animation : {
			isAnimated : (renderer.GetFrameCount(drwId) > 1),
			frameIndex : 0,
			frameCount : renderer.GetFrameCount(drwId)
		},
		name : name,
		isWall : isWall
	};

	return i;
}

function parseSprite(lines, i) {
	var id = getId(lines[i]);
	var drwId = null;
	var name = null;

	i++;

	if (getType(lines[i]) === "DRW") { //load existing drawing
		drwId = getId(lines[i]);
		i++;
	}
	else {
		// store sprite source
		drwId = "SPR_" + id;
		i = parseDrawingCore( lines, i, drwId );
	}

	//other properties
	var colorIndex = 2; //default palette color index is 2
	var dialogId = null;
	var startingInventory = {};
	while (i < lines.length && lines[i].length > 0) { //look for empty line
		if (getType(lines[i]) === "COL") {
			/* COLOR OFFSET INDEX */
			colorIndex = parseInt( getId(lines[i]) );
		}
		else if (getType(lines[i]) === "POS") {
			/* STARTING POSITION */
			var posArgs = lines[i].split(" ");
			var roomId = posArgs[1];
			var coordArgs = posArgs[2].split(",");
			spriteStartLocations[id] = {
				room : roomId,
				x : parseInt(coordArgs[0]),
				y : parseInt(coordArgs[1])
			};
		}
		else if(getType(lines[i]) === "DLG") {
			dialogId = getId(lines[i]);
		}
		else if (getType(lines[i]) === "NAME") {
			/* NAME */
			name = lines[i].split(/\s(.+)/)[1];
			names.sprite.set( name, id );
		}
		else if (getType(lines[i]) === "ITM") {
			/* ITEM STARTING INVENTORY */
			var itemId = getId(lines[i]);
			var itemCount = parseFloat( getArg(lines[i], 2) );
			startingInventory[itemId] = itemCount;
		}
		i++;
	}

	//sprite data
	sprite[id] = {
		id : id,
		drw : drwId, //drawing id
		col : colorIndex,
		dlg : dialogId,
		room : null, //default location is "offstage"
		x : -1,
		y : -1,
		animation : {
			isAnimated : (renderer.GetFrameCount(drwId) > 1),
			frameIndex : 0,
			frameCount : renderer.GetFrameCount(drwId)
		},
		inventory : startingInventory,
		name : name
	};
	return i;
}

function parseItem(lines, i) {
	var id = getId(lines[i]);
	var drwId = null;
	var name = null;

	i++;

	if (getType(lines[i]) === "DRW") { //load existing drawing
		drwId = getId(lines[i]);
		i++;
	}
	else {
		// store item source
		drwId = "ITM_" + id; // these prefixes are maybe a terrible way to differentiate drawing tyepes :/
		i = parseDrawingCore( lines, i, drwId );
	}

	//other properties
	var colorIndex = 2; //default palette color index is 2
	var dialogId = null;
	while (i < lines.length && lines[i].length > 0) { //look for empty line
		if (getType(lines[i]) === "COL") {
			/* COLOR OFFSET INDEX */
			colorIndex = parseInt( getArg( lines[i], 1 ) );
		}
		// else if (getType(lines[i]) === "POS") {
		// 	/* STARTING POSITION */
		// 	var posArgs = lines[i].split(" ");
		// 	var roomId = posArgs[1];
		// 	var coordArgs = posArgs[2].split(",");
		// 	spriteStartLocations[id] = {
		// 		room : roomId,
		// 		x : parseInt(coordArgs[0]),
		// 		y : parseInt(coordArgs[1])
		// 	};
		// }
		else if(getType(lines[i]) === "DLG") {
			dialogId = getId(lines[i]);
		}
		else if (getType(lines[i]) === "NAME") {
			/* NAME */
			name = lines[i].split(/\s(.+)/)[1];
			names.item.set( name, id );
		}
		i++;
	}

	//item data
	item[id] = {
		id : id,
		drw : drwId, //drawing id
		col : colorIndex,
		dlg : dialogId,
		// room : null, //default location is "offstage"
		// x : -1,
		// y : -1,
		animation : {
			isAnimated : (renderer.GetFrameCount(drwId) > 1),
			frameIndex : 0,
			frameCount : renderer.GetFrameCount(drwId)
		},
		name : name
	};

	// console.log("ITM " + id);
	// console.log(item[id]);

	return i;
}

function parseDrawing(lines, i) {
	// store drawing source
	var drwId = getId( lines[i] );
	return parseDrawingCore( lines, i, drwId );
}

function parseDrawingCore(lines, i, drwId) {
	var frameList = []; //init list of frames
	frameList.push( [] ); //init first frame
	var frameIndex = 0;
	var y = 0;
	while ( y < tilesize ) {
		var l = lines[i+y];
		var row = [];
		for (x = 0; x < tilesize; x++) {
			row.push( parseInt( l.charAt(x) ) );
		}
		frameList[frameIndex].push( row );
		y++;

		if (y === tilesize) {
			i = i + y;
			if ( lines[i] != undefined && lines[i].charAt(0) === ">" ) {
				// start next frame!
				frameList.push( [] );
				frameIndex++;
				//start the count over again for the next frame
				i++;
				y = 0;
			}
		}
	}

	renderer.SetImageSource(drwId, frameList);

	return i;
}

function parseScript(lines, i, backCompatPrefix, compatibilityFlags) {
	var id = getId(lines[i]);
	id = backCompatPrefix + id;
	i++;

	var results = scriptUtils.ReadDialogScript(lines,i);

	dialog[id] = { src:results.script, name:null };

	if (compatibilityFlags.convertImplicitSpriteDialogIds) {
		// explicitly hook up dialog that used to be implicitly
		// connected by sharing sprite and dialog IDs in old versions
		if (sprite[id]) {
			if (sprite[id].dlg === undefined || sprite[id].dlg === null) {
				sprite[id].dlg = id;
			}
		}
	}

	i = results.index;

	return i;
}

function parseDialog(lines, i, compatibilityFlags) {
	// hacky but I need to store this so I can set the name below
	var id = getId(lines[i]);

	i = parseScript(lines, i, "", compatibilityFlags);

	if (lines[i].length > 0 && getType(lines[i]) === "NAME") {
		dialog[id].name = lines[i].split(/\s(.+)/)[1]; // TODO : hacky to keep copying this regex around...
		names.dialog.set(dialog[id].name, id);
		i++;
	}

	return i;
}

// keeping this around to parse old files where endings were separate from dialogs
function parseEnding(lines, i, compatibilityFlags) {
	return parseScript(lines, i, "end_", compatibilityFlags);
}

function parseVariable(lines, i) {
	var id = getId(lines[i]);
	i++;
	var value = lines[i];
	i++;
	variable[id] = value;
	return i;
}

function parseFontName(lines, i) {
	fontName = getArg(lines[i], 1);
	i++;
	return i;
}

function parseTextDirection(lines, i) {
	textDirection = getArg(lines[i], 1);
	i++;
	return i;
}

function parseFontData(lines, i) {
	// NOTE : we're not doing the actual parsing here --
	// just grabbing the block of text that represents the font
	// and giving it to the font manager to use later

	var localFontName = getId(lines[i]);
	var localFontData = lines[i];
	i++;

	while (i < lines.length && lines[i] != "") {
		localFontData += "\n" + lines[i];
		i++;
	}

	var localFontFilename = localFontName + fontManager.GetExtension();
	fontManager.AddResource( localFontFilename, localFontData );

	return i;
}

function parseFlag(lines, i) {
	var id = getId(lines[i]);
	var valStr = lines[i].split(" ")[2];
	flags[id] = parseInt( valStr );
	i++;
	return i;
}

function drawTile(img,x,y,context) {
	if (!context) { //optional pass in context; otherwise, use default
		context = ctx;
	}
	// NOTE: images are now canvases, instead of raw image data (for chrome performance reasons)
	context.drawImage(img,x*tilesize*scale,y*tilesize*scale,tilesize*scale,tilesize*scale);
}

function drawSprite(img,x,y,context) { //this may differ later (or not haha)
	drawTile(img,x,y,context);
}

function drawItem(img,x,y,context) {
	drawTile(img,x,y,context); //TODO these methods are dumb and repetitive
}

// var debugLastRoomDrawn = "0";

function drawRoom(room,context,frameIndex) { // context & frameIndex are optional
	if (!context) { //optional pass in context; otherwise, use default (ok this is REAL hacky isn't it)
		context = ctx;
	}

	// if (room.id != debugLastRoomDrawn) {
	// 	debugLastRoomDrawn = room.id;
	// 	console.log("DRAW ROOM " + debugLastRoomDrawn);
	// }

	var paletteId = "default";

	if (room === undefined) {
		// protect against invalid rooms
		context.fillStyle = "rgb(" + getPal(paletteId)[0][0] + "," + getPal(paletteId)[0][1] + "," + getPal(paletteId)[0][2] + ")";
		context.fillRect(0,0,canvas.width,canvas.height);
		return;
	}

	//clear screen
	if (room.pal != null && palette[paletteId] != undefined) {
		paletteId = room.pal;
	}
	context.fillStyle = "rgb(" + getPal(paletteId)[0][0] + "," + getPal(paletteId)[0][1] + "," + getPal(paletteId)[0][2] + ")";
	context.fillRect(0,0,canvas.width,canvas.height);

	//draw tiles
	for (i in room.tilemap) {
		for (j in room.tilemap[i]) {
			var id = room.tilemap[i][j];
			if (id != "0") {
				//console.log(id);
				if (tile[id] == null) { // hack-around to avoid corrupting files (not a solution though!)
					id = "0";
					room.tilemap[i][j] = id;
				}
				else {
					// console.log(id);
					drawTile( getTileImage(tile[id],paletteId,frameIndex), j, i, context );
				}
			}
		}
	}

	//draw items
	for (var i = 0; i < room.items.length; i++) {
		var itm = room.items[i];
		drawItem( getItemImage(item[itm.id],paletteId,frameIndex), itm.x, itm.y, context );
	}

	//draw sprites
	for (id in sprite) {
		var spr = sprite[id];
		if (spr.room === room.id) {
			drawSprite( getSpriteImage(spr,paletteId,frameIndex), spr.x, spr.y, context );
		}
	}
}

// TODO : remove these get*Image methods
function getTileImage(t,palId,frameIndex) {
	return renderer.GetImage(t,palId,frameIndex);
}

function getSpriteImage(s,palId,frameIndex) {
	return renderer.GetImage(s,palId,frameIndex);
}

function getItemImage(itm,palId,frameIndex) {
	return renderer.GetImage(itm,palId,frameIndex);
}

function curPal() {
	return getRoomPal(curRoom);
}

function getRoomPal(roomId) {
	var defaultId = "default";

	if (roomId == null) {
		return defaultId;
	}
	else if (room[roomId].pal != null) {
		//a specific palette was chosen
		return room[roomId].pal;
	}
	else {
		if (roomId in palette) {
			//there is a palette matching the name of the room
			return roomId;
		}
		else {
			//use the default palette
			return defaultId;
		}
	}
	return defaultId;
}

var isDialogMode = false;
var isNarrating = false;
var isEnding = false;
var dialogModule = new Dialog();
var dialogRenderer = dialogModule.CreateRenderer();
var dialogBuffer = dialogModule.CreateBuffer();
var fontManager = new FontManager();

function onExitDialog(scriptResult, dialogCallback) {
	console.log("EXIT DIALOG!");

	isDialogMode = false;

	if (isNarrating) {
		isNarrating = false;
	}

	if (isDialogPreview) {
		isDialogPreview = false;

		if (onDialogPreviewEnd != null) {
			onDialogPreviewEnd();
		}
	}

	if (dialogCallback != undefined && dialogCallback != null) {
		dialogCallback(scriptResult);
	}
}

/*
TODO
- titles and endings should also take advantage of the script pre-compilation if possible??
- could there be a namespace collision?
- what about dialog NAMEs vs IDs?
- what about a special script block separate from DLG?
*/
function startNarrating(dialogStr,end) {
	console.log("NARRATE " + dialogStr);

	if(end === undefined) {
		end = false;
	}

	isNarrating = true;
	isEnding = end;

	startDialog(dialogStr);
}

function startEndingDialog(ending) {
	isNarrating = true;
	isEnding = true;

	startDialog(
		dialog[ending.id].src,
		ending.id,
		function() {
			var isLocked = ending.property && ending.property.locked === true;
			if (isLocked) {
				isEnding = false;
			}
		},
		ending);
}

function startItemDialog(itemId, dialogCallback) {
	var dialogId = item[itemId].dlg;
	// console.log("START ITEM DIALOG " + dialogId);
	if (dialog[dialogId]) {
		var dialogStr = dialog[dialogId].src;
		startDialog(dialogStr, dialogId, dialogCallback);
	}
	else {
		dialogCallback();
	}
}

function startSpriteDialog(spriteId) {
	var spr = sprite[spriteId];
	var dialogId = spr.dlg;
	// console.log("START SPRITE DIALOG " + dialogId);
	if (dialog[dialogId]){
		var dialogStr = dialog[dialogId].src;
		startDialog(dialogStr,dialogId);
	}
}

function startDialog(dialogStr, scriptId, dialogCallback, objectContext) {
	// console.log("START DIALOG ");
	if (dialogStr.length <= 0) {
		// console.log("ON EXIT DIALOG -- startDialog 1");
		onExitDialog(dialogCallback);
		return;
	}

	isDialogMode = true;

	dialogRenderer.Reset();
	dialogRenderer.SetCentered(isNarrating /*centered*/);
	dialogBuffer.Reset();
	scriptInterpreter.SetDialogBuffer(dialogBuffer);

	var onScriptEnd = function(scriptResult) {
		dialogBuffer.OnDialogEnd(function() {
			onExitDialog(scriptResult, dialogCallback);
		});
	};

	if (scriptId === undefined) { // TODO : what's this for again?
		scriptInterpreter.Interpret(dialogStr, onScriptEnd);
	}
	else {
		if (!scriptInterpreter.HasScript(scriptId)) {
			scriptInterpreter.Compile(scriptId, dialogStr);
		}
		// scriptInterpreter.DebugVisualizeScript(scriptId);
		scriptInterpreter.Run(scriptId, onScriptEnd, objectContext);
	}

}

var isDialogPreview = false;
function startPreviewDialog(script, dialogCallback) {
	isNarrating = true;

	isDialogMode = true;

	isDialogPreview = true;

	dialogRenderer.Reset();
	dialogRenderer.SetCentered(true);
	dialogBuffer.Reset();
	scriptInterpreter.SetDialogBuffer(dialogBuffer);

	// TODO : do I really need a seperate callback for this debug mode??
	onDialogPreviewEnd = dialogCallback;

	var onScriptEndCallback = function(scriptResult) {
		dialogBuffer.OnDialogEnd(function() {
			onExitDialog(scriptResult, null);
		});
	};

	scriptInterpreter.Eval(script, onScriptEndCallback);
}

/* NEW SCRIPT STUFF */
var scriptModule = new Script();
var scriptInterpreter = scriptModule.CreateInterpreter();
var scriptUtils = scriptModule.CreateUtils(); // TODO: move to editor.js?
// scriptInterpreter.SetDialogBuffer( dialogBuffer );

</script>

<!-- store default font in separate script tag for back compat-->
<!-- Borksy modification: uses better encoded default font. -->
<script type="bitsyFontData" id="ascii_small">
FONT ascii_small
SIZE 6 8
CHAR 0
000000
000000
000000
000000
000000
000000
000000
000000
CHAR 32
000000
000000
000000
000000
000000
000000
000000
000000
CHAR 33
000100
001110
001110
000100
000100
000000
000100
000000
CHAR 34
011011
011011
010010
000000
000000
000000
000000
000000
CHAR 35
000000
001010
011111
001010
001010
011111
001010
000000
CHAR 36
001000
001110
010000
001100
000010
011100
000100
000000
CHAR 37
011001
011001
000010
000100
001000
010011
010011
000000
CHAR 38
001000
010100
010100
001000
010101
010010
001101
000000
CHAR 39
001100
001100
001000
000000
000000
000000
000000
000000
CHAR 40
000100
001000
001000
001000
001000
001000
000100
000000
CHAR 41
001000
000100
000100
000100
000100
000100
001000
000000
CHAR 42
000000
001010
001110
011111
001110
001010
000000
000000
CHAR 43
000000
000100
000100
011111
000100
000100
000000
000000
CHAR 44
000000
000000
000000
000000
000000
001100
001100
001000
CHAR 45
000000
000000
000000
011111
000000
000000
000000
000000
CHAR 46
000000
000000
000000
000000
000000
001100
001100
000000
CHAR 47
000000
000001
000010
000100
001000
010000
000000
000000
CHAR 48
001110
010001
010011
010101
011001
010001
001110
000000
CHAR 49
000100
001100
000100
000100
000100
000100
001110
000000
CHAR 50
001110
010001
000001
000110
001000
010000
011111
000000
CHAR 51
001110
010001
000001
001110
000001
010001
001110
000000
CHAR 52
000010
000110
001010
010010
011111
000010
000010
000000
CHAR 53
011111
010000
010000
011110
000001
010001
001110
000000
CHAR 54
000110
001000
010000
011110
010001
010001
001110
000000
CHAR 55
011111
000001
000010
000100
001000
001000
001000
000000
CHAR 56
001110
010001
010001
001110
010001
010001
001110
000000
CHAR 57
001110
010001
010001
001111
000001
000010
001100
000000
CHAR 58
000000
000000
001100
001100
000000
001100
001100
000000
CHAR 59
000000
000000
001100
001100
000000
001100
001100
001000
CHAR 60
000010
000100
001000
010000
001000
000100
000010
000000
CHAR 61
000000
000000
011111
000000
000000
011111
000000
000000
CHAR 62
001000
000100
000010
000001
000010
000100
001000
000000
CHAR 63
001110
010001
000001
000110
000100
000000
000100
000000
CHAR 64
001110
010001
010111
010101
010111
010000
001110
000000
CHAR 65
001110
010001
010001
010001
011111
010001
010001
000000
CHAR 66
011110
010001
010001
011110
010001
010001
011110
000000
CHAR 67
001110
010001
010000
010000
010000
010001
001110
000000
CHAR 68
011110
010001
010001
010001
010001
010001
011110
000000
CHAR 69
011111
010000
010000
011110
010000
010000
011111
000000
CHAR 70
011111
010000
010000
011110
010000
010000
010000
000000
CHAR 71
001110
010001
010000
010111
010001
010001
001111
000000
CHAR 72
010001
010001
010001
011111
010001
010001
010001
000000
CHAR 73
001110
000100
000100
000100
000100
000100
001110
000000
CHAR 74
000001
000001
000001
000001
010001
010001
001110
000000
CHAR 75
010001
010010
010100
011000
010100
010010
010001
000000
CHAR 76
010000
010000
010000
010000
010000
010000
011111
000000
CHAR 77
010001
011011
010101
010001
010001
010001
010001
000000
CHAR 78
010001
011001
010101
010011
010001
010001
010001
000000
CHAR 79
001110
010001
010001
010001
010001
010001
001110
000000
CHAR 80
011110
010001
010001
011110
010000
010000
010000
000000
CHAR 81
001110
010001
010001
010001
010101
010010
001101
000000
CHAR 82
011110
010001
010001
011110
010010
010001
010001
000000
CHAR 83
001110
010001
010000
001110
000001
010001
001110
000000
CHAR 84
011111
000100
000100
000100
000100
000100
000100
000000
CHAR 85
010001
010001
010001
010001
010001
010001
001110
000000
CHAR 86
010001
010001
010001
010001
010001
001010
000100
000000
CHAR 87
010001
010001
010101
010101
010101
010101
001010
000000
CHAR 88
010001
010001
001010
000100
001010
010001
010001
000000
CHAR 89
010001
010001
010001
001010
000100
000100
000100
000000
CHAR 90
011110
000010
000100
001000
010000
010000
011110
000000
CHAR 91
001110
001000
001000
001000
001000
001000
001110
000000
CHAR 92
000000
010000
001000
000100
000010
000001
000000
000000
CHAR 93
001110
000010
000010
000010
000010
000010
001110
000000
CHAR 94
000100
001010
010001
000000
000000
000000
000000
000000
CHAR 95
000000
000000
000000
000000
000000
000000
000000
111111
CHAR 96
001100
001100
000100
000000
000000
000000
000000
000000
CHAR 97
000000
000000
001110
000001
001111
010001
001111
000000
CHAR 98
010000
010000
011110
010001
010001
010001
011110
000000
CHAR 99
000000
000000
001110
010001
010000
010001
001110
000000
CHAR 100
000001
000001
001111
010001
010001
010001
001111
000000
CHAR 101
000000
000000
001110
010001
011110
010000
001110
000000
CHAR 102
000110
001000
001000
011110
001000
001000
001000
000000
CHAR 103
000000
000000
001111
010001
010001
001111
000001
001110
CHAR 104
010000
010000
011100
010010
010010
010010
010010
000000
CHAR 105
000100
000000
000100
000100
000100
000100
000110
000000
CHAR 106
000010
000000
000110
000010
000010
000010
010010
001100
CHAR 107
010000
010000
010010
010100
011000
010100
010010
000000
CHAR 108
000100
000100
000100
000100
000100
000100
000110
000000
CHAR 109
000000
000000
011010
010101
010101
010001
010001
000000
CHAR 110
000000
000000
011100
010010
010010
010010
010010
000000
CHAR 111
000000
000000
001110
010001
010001
010001
001110
000000
CHAR 112
000000
000000
011110
010001
010001
010001
011110
010000
CHAR 113
000000
000000
001111
010001
010001
010001
001111
000001
CHAR 114
000000
000000
010110
001001
001000
001000
011100
000000
CHAR 115
000000
000000
001110
010000
001110
000001
001110
000000
CHAR 116
000000
001000
011110
001000
001000
001010
000100
000000
CHAR 117
000000
000000
010010
010010
010010
010110
001010
000000
CHAR 118
000000
000000
010001
010001
010001
001010
000100
000000
CHAR 119
000000
000000
010001
010001
010101
011111
001010
000000
CHAR 120
000000
000000
010010
010010
001100
010010
010010
000000
CHAR 121
000000
000000
010010
010010
010010
001110
000100
011000
CHAR 122
000000
000000
011110
000010
001100
010000
011110
000000
CHAR 123
000110
001000
001000
011000
001000
001000
000110
000000
CHAR 124
000100
000100
000100
000100
000100
000100
000100
000100
CHAR 125
001100
000010
000010
000011
000010
000010
001100
000000
CHAR 126
000000
000000
000000
001010
010100
000000
000000
000000
CHAR 160
000000
000000
000000
000000
000000
000000
000000
000000
CHAR 161
000100
000000
000100
000100
001110
001110
000100
000000
CHAR 162
000000
000100
001110
010000
010000
001110
000100
000000
CHAR 163
000110
001001
001000
011110
001000
001001
010111
000000
CHAR 165
010001
001010
000100
011111
000100
011111
000100
000000
CHAR 167
001110
010001
001100
001010
000110
010001
001110
000000
CHAR 171
000000
000000
001001
010010
001001
000000
000000
000000
CHAR 172
000000
000000
111111
000001
000001
000000
000000
000000
CHAR 177
000000
000100
001110
000100
000000
001110
000000
000000
CHAR 178
011000
000100
001000
011100
000000
000000
000000
000000
CHAR 181
000000
000000
010010
010010
010010
011100
010000
010000
CHAR 182
001111
010101
010101
001101
000101
000101
000101
000000
CHAR 187
000000
000000
010010
001001
010010
000000
000000
000000
CHAR 188
010000
010010
010100
001011
010101
000111
000001
000000
CHAR 189
010000
010010
010100
001110
010001
000010
000111
000000
CHAR 191
000100
000000
000100
001100
010000
010001
001110
000000
CHAR 196
001010
000000
000100
001010
010001
011111
010001
000000
CHAR 197
001110
001010
001110
011011
010001
011111
010001
000000
CHAR 198
001111
010100
010100
011111
010100
010100
010111
000000
CHAR 199
001110
010001
010000
010000
010001
001110
000100
001100
CHAR 201
000011
000000
011111
010000
011110
010000
011111
000000
CHAR 209
001010
010100
000000
010010
011010
010110
010010
000000
CHAR 214
010010
001100
010010
010010
010010
010010
001100
000000
CHAR 220
001010
000000
010010
010010
010010
010010
001100
000000
CHAR 223
000000
011100
010010
011100
010010
010010
011100
010000
CHAR 224
001100
000000
001110
000001
001111
010001
001111
000000
CHAR 225
000110
000000
001110
000001
001111
010001
001111
000000
CHAR 226
001110
000000
001110
000001
001111
010001
001111
000000
CHAR 228
001010
000000
001110
000001
001111
010001
001111
000000
CHAR 229
001110
001010
001110
000001
001111
010001
001111
000000
CHAR 230
000000
000000
011110
000101
011111
010100
001111
000000
CHAR 231
000000
001110
010001
010000
010001
001110
000100
001100
CHAR 232
001100
000000
001110
010001
011110
010000
001110
000000
CHAR 233
000011
000000
001110
010001
011110
010000
001110
000000
CHAR 234
001110
000000
001110
010001
011110
010000
001110
000000
CHAR 235
001010
000000
001110
010001
011110
010000
001110
000000
CHAR 236
001000
000000
000100
000100
000100
000100
000110
000000
CHAR 237
000110
000000
000100
000100
000100
000100
000110
000000
CHAR 238
000100
001010
000000
000100
000100
000100
000110
000000
CHAR 239
001010
000000
000100
000100
000100
000100
000110
000000
CHAR 241
001010
010100
000000
011100
010010
010010
010010
000000
CHAR 242
011000
000000
001100
010010
010010
010010
001100
000000
CHAR 243
000110
000000
001100
010010
010010
010010
001100
000000
CHAR 244
001110
000000
001100
010010
010010
010010
001100
000000
CHAR 246
001010
000000
001100
010010
010010
010010
001100
000000
CHAR 247
001010
000000
001110
010001
010001
010001
001110
000000
CHAR 249
011000
000000
010010
010010
010010
010110
001010
000000
CHAR 250
000110
000000
010010
010010
010010
010110
001010
000000
CHAR 251
001110
000000
010010
010010
010010
010110
001010
000000
CHAR 252
010010
000000
010010
010010
010010
010110
001010
000000
CHAR 255
001010
000000
010010
010010
010010
001110
000100
011000
CHAR 402
000010
000101
000100
001110
000100
000100
010100
001000
CHAR 915
011110
010010
010000
010000
010000
010000
010000
000000
CHAR 920
001100
010010
010010
011110
010010
010010
001100
000000
CHAR 931
011111
010000
001000
000100
001000
010000
011111
000000
CHAR 934
001110
000100
001110
010001
001110
000100
001110
000000
CHAR 937
000000
001110
010001
010001
001010
001010
011011
000000
CHAR 948
001100
010000
001000
000100
001110
010010
001100
000000
CHAR 949
000000
001110
010000
011110
010000
001110
000000
000000
CHAR 960
000000
011111
001010
001010
001010
001010
001010
000000
CHAR 963
000000
000000
001111
010010
010010
001100
000000
000000
CHAR 964
000000
000000
001010
010100
000100
000100
000100
000000
CHAR 966
000000
000100
001110
010101
010101
001110
000100
000000
CHAR 8226
000000
000000
000000
001100
001100
000000
000000
000000
CHAR 8252
001010
001010
001010
001010
001010
000000
001010
000000
CHAR 8592
000000
000100
001100
011111
001100
000100
000000
000000
CHAR 8593
000100
001110
011111
000100
000100
000100
000100
000000
CHAR 8594
000000
000100
000110
011111
000110
000100
000000
000000
CHAR 8595
000100
000100
000100
000100
011111
001110
000100
000000
CHAR 8734
000000
000000
001010
010101
010101
001010
000000
000000
CHAR 8735
000000
000000
000000
010000
010000
010000
011111
000000
CHAR 8801
000000
011110
000000
011110
000000
011110
000000
000000
CHAR 8804
000010
001100
010000
001100
000010
000000
011110
000000
CHAR 8805
010000
001100
000010
001100
010000
000000
011110
000000
CHAR 8962
000100
001110
011011
010001
010001
011111
000000
000000
CHAR 8976
000000
000000
011111
010000
010000
010000
000000
000000
CHAR 9472
000000
000000
000000
111111
000000
000000
000000
000000
CHAR 9474
000100
000100
000100
000100
000100
000100
000100
000100
CHAR 9488
000000
000000
000000
111100
000100
000100
000100
000100
CHAR 9492
000100
000100
000100
000111
000000
000000
000000
000000
CHAR 9500
000100
000100
000100
000111
000100
000100
000100
000100
CHAR 9508
000100
000100
000100
111100
000100
000100
000100
000100
CHAR 9516
000000
000000
000000
111111
000100
000100
000100
000100
CHAR 9524
000100
000100
000100
111111
000000
000000
000000
000000
CHAR 9532
000100
000100
000100
111111
000100
000100
000100
000100
CHAR 9552
000000
111111
000000
111111
000000
000000
000000
000000
CHAR 9553
010100
010100
010100
010100
010100
010100
010100
010100
CHAR 9556
000000
011111
010000
010111
010100
010100
010100
010100
CHAR 9557
000000
111100
000100
111100
000100
000100
000100
000100
CHAR 9558
000000
000000
000000
111100
010100
010100
010100
010100
CHAR 9559
000000
111100
000100
110100
010100
010100
010100
010100
CHAR 9561
010100
010100
010100
011111
000000
000000
000000
000000
CHAR 9562
010100
010111
010000
011111
000000
000000
000000
000000
CHAR 9563
000100
111100
000100
111100
000000
000000
000000
000000
CHAR 9564
010100
010100
010100
111100
000000
000000
000000
000000
CHAR 9565
010100
110100
000100
111100
000000
000000
000000
000000
CHAR 9566
000100
000111
000100
000111
000100
000100
000100
000100
CHAR 9567
010100
010100
010100
010111
010100
010100
010100
010100
CHAR 9568
010100
010111
010000
010111
010100
010100
010100
010100
CHAR 9569
000000
000000
010010
010010
010010
011100
010000
010000
CHAR 9570
010100
010100
010100
110100
010100
010100
010100
010100
CHAR 9571
010100
110100
000100
110100
010100
010100
010100
010100
CHAR 9572
000000
111111
000000
111111
000100
000100
000100
000100
CHAR 9573
000000
000000
000000
111111
010100
010100
010100
010100
CHAR 9574
000000
111111
000000
110111
010100
010100
010100
010100
CHAR 9575
000100
111111
000000
111111
000000
000000
000000
000000
CHAR 9576
010100
010100
010100
111111
000000
000000
000000
000000
CHAR 9577
010100
110111
000000
111111
000000
000000
000000
000000
CHAR 9580
010100
110111
000000
110111
010100
010100
010100
010100
CHAR 9601
000000
000000
000000
000000
000000
000000
000000
111111
CHAR 9602
000000
000000
000000
000000
000000
000000
111111
111111
CHAR 9603
000000
000000
000000
000000
000000
111111
111111
111111
CHAR 9604
000000
000000
000000
000000
111111
111111
111111
111111
CHAR 9605
000000
000000
000000
111111
111111
111111
111111
111111
CHAR 9606
000000
000000
111111
111111
111111
111111
111111
111111
CHAR 9607
000000
111111
111111
111111
111111
111111
111111
111111
CHAR 9608
111111
111111
111111
111111
111111
111111
111111
111111
CHAR 9609
111100
111100
111100
111100
111100
111100
111100
111100
CHAR 9610
111100
111100
111100
111100
111100
111100
111100
111100
CHAR 9611
111000
111000
111000
111000
111000
111000
111000
111000
CHAR 9613
110000
110000
110000
110000
110000
110000
110000
110000
CHAR 9615
100000
100000
100000
100000
100000
100000
100000
100000
CHAR 9617
010101
000000
101010
000000
010101
000000
101010
000000
CHAR 9618
010101
101010
010101
101010
010101
101010
010101
101010
CHAR 9619
101010
111111
010101
111111
101010
111111
010101
111111
CHAR 9644
000000
000000
000000
000000
000000
011110
011110
000000
CHAR 9650
000100
000100
001110
001110
011111
011111
000000
000000
CHAR 9658
001000
001100
001110
001111
001110
001100
001000
000000
CHAR 9660
011111
011111
001110
001110
000100
000100
000000
000000
CHAR 9668
000010
000110
001110
011110
001110
000110
000010
000000
CHAR 9675
000000
000000
011110
010010
010010
011110
000000
000000
CHAR 9688
111111
111111
111111
110011
110011
111111
111111
111111
CHAR 9689
111111
111111
100001
101101
101101
100001
111111
111111
CHAR 9786
001110
010001
011011
010001
010101
010001
001110
000000
CHAR 9787
001110
011111
010101
011111
010001
011111
001110
000000
CHAR 9788
000000
010101
001110
011011
001110
010101
000000
000000
CHAR 9792
001110
010001
010001
001110
000100
001110
000100
000000
CHAR 9794
000000
000111
000011
001101
010010
010010
001100
000000
CHAR 9824
000000
000100
001110
011111
011111
000100
001110
000000
CHAR 9827
000100
001110
001110
000100
011111
011111
000100
000000
CHAR 9829
000000
001010
011111
011111
011111
001110
000100
000000
CHAR 9830
000000
000100
001110
011111
011111
001110
000100
000000
CHAR 9834
000100
000110
000101
000100
001100
011100
011000
000000
CHAR 9835
000011
001101
001011
001101
001011
011011
011000
000000
</script>

<!-- BORKSY HACKS -->
<script type="text/javascript" id="borksyHacks">
//borksy uses dist versions of hacks from the bitsy hacks repo now

/**

@file bitsymuse
@summary A variety of Bitsy sound and music handlers
@license MIT
@version 3.1.4
@requires 4.8, 4.9
@author David Mowatt

@description
A hack that adds a variety of audio controls, including music that changes as you move between rooms.
If the same song is played as you move between rooms, the audio file will continue playing.

HOW TO USE:
1. Place your audio files somewhere relative to your bitsy html file (in the zip if you're uploading to itch.io)
2. Copy-paste this script into a script tag after the bitsy source.
3. Edit hackOptions below to set up the track list for rooms you move through.

In addition to the track list, which will play audio based on the room id/name,
you have access to the following commands you can add to dialogue:

1. (soundeffectNow "<audio ID>") will play a sound without interrupting the music as soon as it is called in the dialogue
2. (soundeffect "<audio ID>") will play a sound without interrupting the music once the dialogue box closes
3. (musicNow "<audio ID>") will change the music as soon as it is called in the dialogue
4. (music "<audio ID>") will change the music once the dialogue box closes

You can call both musicNow and music in the same dialogue, to e.g. change the music while you speak to a character
and then restart the regular room music once you stop speaking to them.
You can also use a special ID ("S" by default) to Silence the music.

By default, music tracks automatically restart from the beginning if you go back to a previous track.
This can also be changed in the hackOptions below.
*/
this.hacks = this.hacks || {};
(function (exports, bitsy) {
'use strict';
var hackOptions = {
// Put entries in this list for each audio file you want to use.
// The key will be the id needed to play it in dialog tags and 
// the musicByRoom options below, and the value will be the 
// properties of the corresponding <audio> tag (e.g. src, loop, volume)
// Note: you can add <audio> tags to the html manually if you prefer

audio: {
	// Note: the entries below are examples that should be removed and replaced with your own audio files
	'theme': { src: './theme.mp3', loop: true },
},
	
// Put entries in this list for every room ID or name that will 
// change the music. If the player moves between rooms with the 
// same audio ID, the music keeps playing seamlessly.

// Undefined rooms will keep playing whatever music they were last playing.

musicByRoom: {
	// Note: the entries below are examples that should be removed and replaced with your own room -> audio id mappings
	'start.1': 'theme',
},

silenceId: 'S', // Use this song ID to make a room fall silent.
resume: false, // If true, songs will pause/resume on change; otherwise, they'll stop/play (doesn't affect sound effect
};

bitsy = bitsy && Object.prototype.hasOwnProperty.call(bitsy, 'default') ? bitsy['default'] : bitsy;

/**
@file utils
@summary miscellaneous bitsy utilities
@author Sean S. LeBlanc
*/

/*
Helper used to replace code in a script tag based on a search regex
To inject code without erasing original string, using capturing groups; e.g.
	inject(/(some string)/,'injected before $1 injected after')
*/
function inject(searchRegex, replaceString) {
	// find the relevant script tag
	var scriptTags = document.getElementsByTagName('script');
	var scriptTag;
	var code;
	for (var i = 0; i < scriptTags.length; ++i) {
		scriptTag = scriptTags[i];
		var matchesSearch = scriptTag.textContent.search(searchRegex) !== -1;
		var isCurrentScript = scriptTag === document.currentScript;
		if (matchesSearch && !isCurrentScript) {
			code = scriptTag.textContent;
			break;
		}
	}

	// error-handling
	if (!code) {
		throw new Error('Couldn\'t find "' + searchRegex + '" in script tags');
	}

	// modify the content
	code = code.replace(searchRegex, replaceString);

	// replace the old script tag with a new one using our modified code
	var newScriptTag = document.createElement('script');
	newScriptTag.textContent = code;
	scriptTag.insertAdjacentElement('afterend', newScriptTag);
	scriptTag.remove();
}

/**
 * Helper for getting room by name or id
 * @param {string} name id or name of room to return
 * @return {string} room, or undefined if it doesn't exist
 */
function getRoom(name) {
	var id = Object.prototype.hasOwnProperty.call(bitsy.room, name) ? name : bitsy.names.room.get(name);
	return bitsy.room[id];
}

/**
 * Helper for getting an array with unique elements
 * @param  {Array} array Original array
 * @return {Array}       Copy of array, excluding duplicates
 */
function unique(array) {
	return array.filter(function (item, idx) {
		return array.indexOf(item) === idx;
	});
}

/**

@file kitsy-script-toolkit
@summary makes it easier and cleaner to run code before and after Bitsy functions or to inject new code into Bitsy script tags
@license WTFPL (do WTF you want)
@version 4.0.1
@requires Bitsy Version: 4.5, 4.6
@author @mildmojo

@description
HOW TO USE:
  import {before, after, inject, addDialogTag, addDeferredDialogTag} from "./helpers/kitsy-script-toolkit";

  before(targetFuncName, beforeFn);
  after(targetFuncName, afterFn);
  inject(searchRegex, replaceString);
  addDialogTag(tagName, dialogFn);
  addDeferredDialogTag(tagName, dialogFn);

  For more info, see the documentation at:
  https://github.com/seleb/bitsy-hacks/wiki/Coding-with-kitsy
*/


// Ex: inject(/(names.sprite.set\( name, id \);)/, '$1console.dir(names)');
function inject$1(searchRegex, replaceString) {
	var kitsy = kitsyInit();
	kitsy.queuedInjectScripts.push({
		searchRegex: searchRegex,
		replaceString: replaceString
	});
}

// Ex: before('load_game', function run() { alert('Loading!'); });
//     before('show_text', function run(text) { return text.toUpperCase(); });
//     before('show_text', function run(text, done) { done(text.toUpperCase()); });
function before(targetFuncName, beforeFn) {
	var kitsy = kitsyInit();
	kitsy.queuedBeforeScripts[targetFuncName] = kitsy.queuedBeforeScripts[targetFuncName] || [];
	kitsy.queuedBeforeScripts[targetFuncName].push(beforeFn);
}

// Ex: after('load_game', function run() { alert('Loaded!'); });
function after(targetFuncName, afterFn) {
	var kitsy = kitsyInit();
	kitsy.queuedAfterScripts[targetFuncName] = kitsy.queuedAfterScripts[targetFuncName] || [];
	kitsy.queuedAfterScripts[targetFuncName].push(afterFn);
}

function kitsyInit() {
	// return already-initialized kitsy
	if (bitsy.kitsy) {
		return bitsy.kitsy;
	}

	// Initialize kitsy
	bitsy.kitsy = {
		queuedInjectScripts: [],
		queuedBeforeScripts: {},
		queuedAfterScripts: {}
	};

	var oldStartFunc = bitsy.startExportedGame;
	bitsy.startExportedGame = function doAllInjections() {
		// Only do this once.
		bitsy.startExportedGame = oldStartFunc;

		// Rewrite scripts and hook everything up.
		doInjects();
		applyAllHooks();

		// Start the game
		bitsy.startExportedGame.apply(this, arguments);
	};

	return bitsy.kitsy;
}


function doInjects() {
	bitsy.kitsy.queuedInjectScripts.forEach(function (injectScript) {
		inject(injectScript.searchRegex, injectScript.replaceString);
	});
	_reinitEngine();
}

function applyAllHooks() {
	var allHooks = unique(Object.keys(bitsy.kitsy.queuedBeforeScripts).concat(Object.keys(bitsy.kitsy.queuedAfterScripts)));
	allHooks.forEach(applyHook);
}

function applyHook(functionName) {
	var functionNameSegments = functionName.split('.');
	var obj = bitsy;
	while (functionNameSegments.length > 1) {
		obj = obj[functionNameSegments.shift()];
	}
	var lastSegment = functionNameSegments[0];
	var superFn = obj[lastSegment];
	var superFnLength = superFn ? superFn.length : 0;
	var functions = [];
	// start with befores
	functions = functions.concat(bitsy.kitsy.queuedBeforeScripts[functionName] || []);
	// then original
	if (superFn) {
		functions.push(superFn);
	}
	// then afters
	functions = functions.concat(bitsy.kitsy.queuedAfterScripts[functionName] || []);

	// overwrite original with one which will call each in order
	obj[lastSegment] = function () {
		var returnVal;
		var args = [].slice.call(arguments);
		var i = 0;

		function runBefore() {
			// All outta functions? Finish
			if (i === functions.length) {
				return returnVal;
			}

			// Update args if provided.
			if (arguments.length > 0) {
				args = [].slice.call(arguments);
			}

			if (functions[i].length > superFnLength) {
				// Assume funcs that accept more args than the original are
				// async and accept a callback as an additional argument.
				return functions[i++].apply(this, args.concat(runBefore.bind(this)));
			} else {
				// run synchronously
				returnVal = functions[i++].apply(this, args);
				if (returnVal && returnVal.length) {
					args = returnVal;
				}
				return runBefore.apply(this, args);
			}
		}

		return runBefore.apply(this, arguments);
	};
}

function _reinitEngine() {
	// recreate the script and dialog objects so that they'll be
	// referencing the code with injections instead of the original
	bitsy.scriptModule = new bitsy.Script();
	bitsy.scriptInterpreter = bitsy.scriptModule.CreateInterpreter();

	bitsy.dialogModule = new bitsy.Dialog();
	bitsy.dialogRenderer = bitsy.dialogModule.CreateRenderer();
	bitsy.dialogBuffer = bitsy.dialogModule.CreateBuffer();
}

// Rewrite custom functions' parentheses to curly braces for Bitsy's
// interpreter. Unescape escaped parentheticals, too.
function convertDialogTags(input, tag) {
	return input
		.replace(new RegExp('\\\\?\\((' + tag + '(\\s+(".+?"|.+?))?)\\\\?\\)', 'g'), function (match, group) {
			if (match.substr(0, 1) === '\\') {
				return '(' + group + ')'; // Rewrite \(tag "..."|...\) to (tag "..."|...)
			}
			return '{' + group + '}'; // Rewrite (tag "..."|...) to {tag "..."|...}
		});
}


function addDialogFunction(tag, fn) {
	var kitsy = kitsyInit();
	kitsy.dialogFunctions = kitsy.dialogFunctions || {};
	if (kitsy.dialogFunctions[tag]) {
		throw new Error('The dialog function "' + tag + '" already exists.');
	}

	// Hook into game load and rewrite custom functions in game data to Bitsy format.
	before('parseWorld', function (game_data) {
		return [convertDialogTags(game_data, tag)];
	});

	kitsy.dialogFunctions[tag] = fn;
}

function injectDialogTag(tag, code) {
	inject$1(
		/(var functionMap = new Map\(\);[^]*?)(this.HasFunction)/m,
		'$1\nfunctionMap.set("' + tag + '", ' + code + ');\n$2'
	);
}

/**
 * Adds a custom dialog tag which executes the provided function.
 * For ease-of-use with the bitsy editor, tags can be written as
 * (tagname "parameters") in addition to the standard {tagname "parameters"}
 * 
 * Function is executed immediately when the tag is reached.
 *
 * @param {string}   tag Name of tag
 * @param {Function} fn  Function to execute, with signature `function(environment, parameters, onReturn){}`
 *                       environment: provides access to SetVariable/GetVariable (among other things, see Environment in the bitsy source for more info)
 *                       parameters: array containing parameters as string in first element (i.e. `parameters[0]`)
 *                       onReturn: function to call with return value (just call `onReturn(null);` at the end of your function if your tag doesn't interact with the logic system)
 */
function addDialogTag(tag, fn) {
	addDialogFunction(tag, fn);
	injectDialogTag(tag, 'kitsy.dialogFunctions["' + tag + '"]');
}

/**
 * Adds a custom dialog tag which executes the provided function.
 * For ease-of-use with the bitsy editor, tags can be written as
 * (tagname "parameters") in addition to the standard {tagname "parameters"}
 * 
 * Function is executed after the dialog box.
 *
 * @param {string}   tag Name of tag
 * @param {Function} fn  Function to execute, with signature `function(environment, parameters){}`
 *                       environment: provides access to SetVariable/GetVariable (among other things, see Environment in the bitsy source for more info)
 *                       parameters: array containing parameters as string in first element (i.e. `parameters[0]`)
 */
function addDeferredDialogTag(tag, fn) {
	addDialogFunction(tag, fn);
	bitsy.kitsy.deferredDialogFunctions = bitsy.kitsy.deferredDialogFunctions || {};
	var deferred = bitsy.kitsy.deferredDialogFunctions[tag] = [];
	injectDialogTag(tag, 'function(e, p, o){ kitsy.deferredDialogFunctions["' + tag + '"].push({e:e,p:p}); o(null); }');
	// Hook into the dialog finish event and execute the actual function
	after('onExitDialog', function () {
		while (deferred.length) {
			var args = deferred.shift();
			bitsy.kitsy.dialogFunctions[tag](args.e, args.p, args.o);
		}
	});
	// Hook into the game reset and make sure data gets cleared
	after('clearGameData', function () {
		deferred.length = 0;
	});
}

/**
 * Adds two custom dialog tags which execute the provided function,
 * one with the provided tagname executed after the dialog box,
 * and one suffixed with 'Now' executed immediately when the tag is reached.
 *
 * i.e. helper for the (exit)/(exitNow) pattern.
 *
 * @param {string}   tag Name of tag
 * @param {Function} fn  Function to execute, with signature `function(environment, parameters){}`
 *                       environment: provides access to SetVariable/GetVariable (among other things, see Environment in the bitsy source for more info)
 *                       parameters: array containing parameters as string in first element (i.e. `parameters[0]`)
 */
function addDualDialogTag(tag, fn) {
	addDialogTag(tag + 'Now', function (environment, parameters, onReturn) {
		fn(environment, parameters);
		onReturn(null);
	});
	addDeferredDialogTag(tag, fn);
}





var audioElementsById = {};
var currentMusic;
var roomMusicFlag = null;

// cleanup old audio tags if any are present (e.g. on restart)
before('load_game', function () {
	Object.entries(hackOptions.audio).forEach(function (entry) {
		var el = document.getElementById(entry[0]);
		if (el) {
			el.remove();
		}
		delete audioElementsById[entry[0]];
	});
});

after('load_game', function () {
	var room;
	// expand the map to include ids of rooms listed by name
	Object.entries(hackOptions.musicByRoom).forEach(function (entry) {
		room = getRoom(entry[0]);
		if (room) {
			hackOptions.musicByRoom[room.id] = entry[1];
		}
	});
	// add audio tags from options
	Object.entries(hackOptions.audio).forEach(function (entry) {
		var el = document.createElement('audio');
		el.id = entry[0];
		Object.assign(el, entry[1]);
		document.body.appendChild(el);
		audioElementsById[el.id] = el;
	});

	// handle autoplay restrictions by playing then pausing
	// every audio element on the first user interaction
	function handleAutoPlayRestrictions() {
		Object.values(audioElementsById).forEach(function (audio) {
			audio.play();
			// let the current song play
			if (currentMusic === audio.id) {
				return;
			}
			audio.pause();
			audio.currentTime = 0;
		});
		document.body.removeEventListener('pointerup', handleAutoPlayRestrictions);
		document.body.removeEventListener('keydown', handleAutoPlayRestrictions);
	}

	document.body.addEventListener('pointerup', handleAutoPlayRestrictions);
	document.body.addEventListener('keydown', handleAutoPlayRestrictions);
});


function getAudio(id) {
	var el = audioElementsById[id] || (audioElementsById[id] = document.getElementById(id));
	if (!el) {
		throw new Error("bitsymuse tried to use audio with id '" + id + "' but couldn't find one on the page!");
	}
	return el;
}

function playSound(soundParam) {
	if (!soundParam) {
		return;
	}
	getAudio(soundParam).play();
}

function changeMusic(newMusic) {
	var audio;
	// if we didn't get new music,
	// or the music didn't change,
	// there's no work to be done
	if (!newMusic || newMusic === currentMusic) {
		return;
	}

	// stop old music
	if (currentMusic && currentMusic !== hackOptions.silenceId) {
		audio = getAudio(currentMusic);
		audio.pause();
		if (!hackOptions.resume) {
			audio.currentTime = 0.0;
		}
	}

	// start new music
	currentMusic = newMusic;
	// special case: don't start anything new
	if (newMusic === hackOptions.silenceId) {
		return;
	}
	getAudio(newMusic).play();
}

after('drawRoom', function () {
	if (roomMusicFlag !== bitsy.curRoom) {
		changeMusic(hackOptions.musicByRoom[bitsy.curRoom]);
		roomMusicFlag = bitsy.curRoom;
	}
});

// Implement the dialog functions
addDualDialogTag('music', function (environment, parameters) {
	if (!parameters[0]) {
		throw new Error('{music/musicNow} was missing parameters! Usage: {music/musicNow "track name"}');
	}
	changeMusic(parameters[0]);
});

addDualDialogTag('soundeffect', function (environment, parameters) {
	if (!parameters[0]) {
		throw new Error('{soundeffect/soundeffectNow} was missing parameters! Usage: {soundeffect/soundeffectNow "track name"}');
	}
	playSound(parameters[0]);
});
// End of (music) dialog function mod

exports.hackOptions = hackOptions;

}(this.hacks.bitsymuse = this.hacks.bitsymuse || {}, window));



</script>

<script type="text/javascript" id="borksyAdditionalJS">

</script>

</head>


<!-- DOCUMENT BODY -->

<body onload='startExportedGame()'>
<!-- GAME CANVAS -->
<canvas id='game'></canvas>
</body>

<a class="button" style="bottom:6vh; right:1vh; position: absolute" id="openInfo" href="../../art+music/games.html">[Back]</a>
<a class="button" style="bottom:2vh; right:1vh; position: absolute; z-index: 1000;" href="../../index.html">[]</a>

</html>